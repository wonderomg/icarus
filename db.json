{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/img/simple.png","path":"img/simple.png","modified":0,"renderable":0},{"_id":"source/img/7th.jpg","path":"img/7th.jpg","modified":0,"renderable":0},{"_id":"themes/icarus/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/activate-power-mode.js","path":"js/activate-power-mode.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/js/particles.min.js","path":"js/particles.min.js","modified":0,"renderable":1},{"_id":"source/img/fans.jpg","path":"img/fans.jpg","modified":0,"renderable":0},{"_id":"source/img/penaltykick.jpg","path":"img/penaltykick.jpg","modified":0,"renderable":0},{"_id":"source/img/start.jpg","path":"img/start.jpg","modified":0,"renderable":0},{"_id":"source/img/thank.jpg","path":"img/thank.jpg","modified":0,"renderable":0},{"_id":"themes/icarus/source/css/images/logo.png","path":"css/images/logo.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/css/images/thumb-default-small.png","path":"css/images/thumb-default-small.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/css/images/wonderomg.png","path":"css/images/wonderomg.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/justified-gallery/jquery.justifiedGallery.min.js","path":"libs/justified-gallery/jquery.justifiedGallery.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/justified-gallery/justifiedGallery.min.css","path":"libs/justified-gallery/justifiedGallery.min.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/styles.css","path":"libs/open-sans/styles.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/styles.css","path":"libs/source-code-pro/styles.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.css","path":"libs/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.min.css","path":"libs/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css","path":"libs/lightgallery/css/lg-fb-comment-box.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css.map","path":"libs/lightgallery/css/lg-fb-comment-box.css.map","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.min.css","path":"libs/lightgallery/css/lg-fb-comment-box.min.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css","path":"libs/lightgallery/css/lg-transitions.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css.map","path":"libs/lightgallery/css/lg-transitions.css.map","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.min.css","path":"libs/lightgallery/css/lg-transitions.min.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css","path":"libs/lightgallery/css/lightgallery.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css.map","path":"libs/lightgallery/css/lightgallery.css.map","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.min.css","path":"libs/lightgallery/css/lightgallery.min.css","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.eot","path":"libs/lightgallery/fonts/lg.eot","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.svg","path":"libs/lightgallery/fonts/lg.svg","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.ttf","path":"libs/lightgallery/fonts/lg.ttf","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.woff","path":"libs/lightgallery/fonts/lg.woff","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/loading.gif","path":"libs/lightgallery/img/loading.gif","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/video-play.png","path":"libs/lightgallery/img/video-play.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/vimeo-play.png","path":"libs/lightgallery/img/vimeo-play.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/img/youtube-play.png","path":"libs/lightgallery/img/youtube-play.png","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.js","path":"libs/lightgallery/js/lg-autoplay.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.min.js","path":"libs/lightgallery/js/lg-autoplay.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.js","path":"libs/lightgallery/js/lg-fullscreen.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.min.js","path":"libs/lightgallery/js/lg-fullscreen.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.js","path":"libs/lightgallery/js/lg-hash.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.min.js","path":"libs/lightgallery/js/lg-hash.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.js","path":"libs/lightgallery/js/lg-pager.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.min.js","path":"libs/lightgallery/js/lg-pager.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.js","path":"libs/lightgallery/js/lg-share.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.min.js","path":"libs/lightgallery/js/lg-share.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.min.js","path":"libs/lightgallery/js/lg-thumbnail.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.js","path":"libs/lightgallery/js/lg-thumbnail.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.js","path":"libs/lightgallery/js/lg-video.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.min.js","path":"libs/lightgallery/js/lg-video.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.js","path":"libs/lightgallery/js/lg-zoom.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.min.js","path":"libs/lightgallery/js/lg-zoom.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.js","path":"libs/lightgallery/js/lightgallery.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.min.js","path":"libs/lightgallery/js/lightgallery.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","path":"libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","path":"libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","path":"libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","path":"libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","path":"libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","path":"libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/FontAwesome.otf","path":"libs/font-awesome/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.eot","path":"libs/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff","path":"libs/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff2","path":"libs/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/jquery/2.1.3/jquery.min.js","path":"libs/jquery/2.1.3/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.ttf","path":"libs/font-awesome/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.svg","path":"libs/font-awesome/fonts/fontawesome-webfont.svg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/icarus/.gitignore","hash":"542aaea07afe90211c6a45c90b7d6879a4503043","modified":1491956064000},{"_id":"themes/icarus/LICENSE","hash":"df00918fa95de563927fd92b26f14c7affdc3052","modified":1491956064000},{"_id":"themes/icarus/README.md","hash":"25c75503f044b817297995a96621c92ce037a098","modified":1491956064000},{"_id":"themes/icarus/_config.yml","hash":"239876c47672f280bb3cc7dd17ea2a5a6e0645d2","modified":1529676928276},{"_id":"themes/icarus/_config.yml.example","hash":"96b245d58abb6e2a7f59edfccd93dedbea48821d","modified":1511137518000},{"_id":"themes/icarus/package.json","hash":"b024ebe21bd44bd1a4159a7f0cd78470567180f0","modified":1494515729134},{"_id":"source/_posts/Elasticsearch实践api分页查询.md","hash":"383e975bf6162701558c3f4ec22e9608dba92ef1","modified":1538143777461},{"_id":"source/_posts/Elasticsearch实践搭建及IK中文分词.md","hash":"697eb05bc7f2fe8168ca0ced86164cbb86d5489d","modified":1539175705846},{"_id":"source/_posts/C++中sprintf函数的用法.md","hash":"fbfa71599fefac88b08cb8a665702fdcf971ac8f","modified":1500472319644},{"_id":"source/_posts/Elasticsearch实践索引及索引别名alias.md","hash":"34f9b1acefe46ee01ef0f77c9d91ac5caf260fa3","modified":1529677126247},{"_id":"source/_posts/Packet for query is too large.md","hash":"d9db094a46df688a80aabe9f112478637543094b","modified":1522680540580},{"_id":"source/_posts/Socket_send函数和recv函数详解.md","hash":"2b3da492e147d4f16f6e5c7cee660ee177efc04e","modified":1501596208443},{"_id":"source/_posts/TCP长连接与短连接的区别.md","hash":"79a66b04ba0328768fecfee622d13e194488a7b9","modified":1504794323988},{"_id":"source/_posts/idea搭建springdata+mongodb+maven+springmvc.md","hash":"acc318bad1a04bc5c2fba45b321a9e284d9d972b","modified":1530627124322},{"_id":"source/_posts/linux-crontab定时执行任务.md","hash":"2798668883a99d5f1499f4018a05f33d506189db","modified":1529676541940},{"_id":"source/_posts/mongodb学习笔记--$elemMatch操作符的使用.md","hash":"f1beadc7838def39ee700925c94269f8cd3823a7","modified":1499956482732},{"_id":"source/_posts/mongodb学习笔记--C++操作mongodb.md","hash":"11232b5edd8803b0eaff53dbd3e07b243e542f8c","modified":1501596328317},{"_id":"source/_posts/mybatis_operator.md","hash":"1222b48d228fd59e733f42e00e814ca203fb47fb","modified":1499956452283},{"_id":"source/_posts/zookeeper提示Unable to read additional data from server sessionid 0x.md","hash":"992a4b6e0bc70be52ebb935260e3fa980c25394a","modified":1516194678649},{"_id":"source/_posts/关于=null和clear()问题(Java性能篇).md","hash":"a9ac484acefeb462400795a611125b2ec7c7c089","modified":1501596104714},{"_id":"source/_posts/前后端分离，前端跨域访问后台的两种方式.md","hash":"074d02c1edc4f297783e0a1860e78d1593e3e26d","modified":1499956390247},{"_id":"source/about/index.md","hash":"e3de867d487b0765083f950a3c1d047682d96d21","modified":1537975166385},{"_id":"source/_posts/恒大主上港客.md","hash":"38b0626a9855367eb95923d9407617398a9618e8","modified":1529676236901},{"_id":"source/categories/index.md","hash":"55bee2cb88da438a2e8b1f29b1d7e954c07a9e60","modified":1491956064000},{"_id":"source/img/simple.png","hash":"1978038e414adb225071e750b6e97be811a58d7b","modified":1537975623471},{"_id":"source/tags/index.md","hash":"e999413d6392c34156b5c6e9273f9069f9e6d92d","modified":1491956064000},{"_id":"themes/icarus/.git/FETCH_HEAD","hash":"a7f91c1644a04a4f7b5d1be1501809ebfc9e9276","modified":1516257378482},{"_id":"themes/icarus/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1494427981638},{"_id":"themes/icarus/.git/ORIG_HEAD","hash":"f4c94e8dcf2a004a0b4803f76f6a37a119a2f11c","modified":1494517819443},{"_id":"themes/icarus/.git/config","hash":"7b9dd27b1a850e883885c30b03f2abbc794137fd","modified":1494427981732},{"_id":"themes/icarus/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1494426664170},{"_id":"themes/icarus/.git/index","hash":"2d857cb0327b9a6c13260255aa9644216a6b6e75","modified":1494427985437},{"_id":"themes/icarus/.git/packed-refs","hash":"5cf9ace7c4ebfcad08c0495221ef763311b5de14","modified":1494427981598},{"_id":"themes/icarus/.github/ISSUE_TEMPLATE.md","hash":"9393fd3dbc943f1544facb66af7fd8b7a5b9ddbb","modified":1491956064000},{"_id":"themes/icarus/languages/en.yml","hash":"ade241498b85503a8953a1deca963222f47067a7","modified":1515336239446},{"_id":"themes/icarus/languages/es.yml","hash":"d7432219be5bee4cb569331378ade61b749688e0","modified":1491956064000},{"_id":"themes/icarus/languages/fr.yml","hash":"cb3e597cbec7e8f458858c457bafd1f3a225083d","modified":1491956064000},{"_id":"themes/icarus/languages/id.yml","hash":"70ec9ab2ac04cf882e81377ca5ad15bf8adceca8","modified":1491956064000},{"_id":"themes/icarus/languages/ja.yml","hash":"ff972961e5f468a695d80d21b62c3e9032cdf561","modified":1491956064000},{"_id":"themes/icarus/languages/ko.yml","hash":"7c4ad4577dc0577ad2ca1c0410507f5e5fadf530","modified":1491956064000},{"_id":"themes/icarus/languages/pt-BR.yml","hash":"3c5d5293575593705b9a2dfa9d97b017eb4bc8c3","modified":1491956064000},{"_id":"themes/icarus/languages/ru.yml","hash":"d1aab2b0c939d0c6020f881d664b660a01ee7327","modified":1491956064000},{"_id":"themes/icarus/languages/tr.yml","hash":"8b7eb6aec264db50dbabea89f680acca256f4cd1","modified":1491956064000},{"_id":"themes/icarus/languages/zh-CN.yml","hash":"3dc8ec524805afd090438be717908750da439204","modified":1515336245982},{"_id":"themes/icarus/languages/zh-TW.yml","hash":"d8d96a0a17c20af11919ce036e87379a6b163db9","modified":1491956064000},{"_id":"themes/icarus/layout/archive.ejs","hash":"c1ecf667f40f34d61ab33eed46bab143eb1af36d","modified":1491956064000},{"_id":"themes/icarus/layout/category.ejs","hash":"1d407f9176db84e83062c52ad4755aaea9e74401","modified":1491956064000},{"_id":"themes/icarus/layout/categories.ejs","hash":"aa95629b770cff8cca9d663aeb6b17928f070de5","modified":1491956064000},{"_id":"themes/icarus/layout/index.ejs","hash":"43e971ebc35657b18e08a049559790348a16666f","modified":1491956064000},{"_id":"themes/icarus/layout/layout.ejs","hash":"961aa15a358c713c1d67b5568d396b7d281d14b9","modified":1604847087554},{"_id":"themes/icarus/layout/page.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1491956064000},{"_id":"themes/icarus/layout/post.ejs","hash":"50170783bac99946ae8af483920568de9b2d9801","modified":1494775511975},{"_id":"themes/icarus/layout/tag.ejs","hash":"f6c220d4e5c231028bc71ddc11aec97d7b5a9943","modified":1491956064000},{"_id":"themes/icarus/layout/tags.ejs","hash":"b0fcea68d7c11e5899bf0375d80997685111653f","modified":1491956064000},{"_id":"themes/icarus/scripts/thumbnail.js","hash":"e667a611f9baac270281b765832020d50bf8fb7f","modified":1491956064000},{"_id":"themes/icarus/scripts/meta.js","hash":"1993754a2f3dffa283fa0538eb8f056385b69ad4","modified":1491956064000},{"_id":"source/img/7th.jpg","hash":"abbcf9c9037df28e334fde5ecd4023db1a3fd806","modified":1516193795933},{"_id":"themes/icarus/node_modules/underscore.string/libpeerconnection.log","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1494515718620},{"_id":"themes/icarus/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1494426664174},{"_id":"themes/icarus/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1494426664194},{"_id":"themes/icarus/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1494426664199},{"_id":"themes/icarus/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1494426664221},{"_id":"themes/icarus/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1494426664260},{"_id":"themes/icarus/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1494426664265},{"_id":"themes/icarus/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1494426664290},{"_id":"themes/icarus/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1494426664302},{"_id":"themes/icarus/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1494426664322},{"_id":"themes/icarus/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1494426664342},{"_id":"themes/icarus/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1494426664349},{"_id":"themes/icarus/.git/logs/HEAD","hash":"3415dfda0ba4424ccc9a98522ecaad57e92d8b1c","modified":1494427981697},{"_id":"themes/icarus/_source/about/index.md","hash":"2847759c65295fdc47685cc32e10ae30b2f022ae","modified":1491956064000},{"_id":"themes/icarus/_source/categories/index.md","hash":"55bee2cb88da438a2e8b1f29b1d7e954c07a9e60","modified":1491956064000},{"_id":"themes/icarus/_source/tags/index.md","hash":"e999413d6392c34156b5c6e9273f9069f9e6d92d","modified":1491956064000},{"_id":"themes/icarus/layout/comment/changyan.ejs","hash":"b4bd2e641af59e06becaa8f2dc97867f023b8dcf","modified":1491956064000},{"_id":"themes/icarus/layout/comment/counter.ejs","hash":"466e01abb13d0a2b9ed281b2362740baa32afaff","modified":1491956064000},{"_id":"themes/icarus/layout/comment/disqus.ejs","hash":"1b32a90f400dc580f4b8298de75b94429ca6de68","modified":1491956064000},{"_id":"themes/icarus/layout/comment/duoshuo.ejs","hash":"ce46d7410a99b57704da32e9d09071cef6c9fa93","modified":1491956064000},{"_id":"themes/icarus/layout/comment/facebook.ejs","hash":"5ee16430a4435c2fead0275ff83fc98092d73d4c","modified":1491956064000},{"_id":"themes/icarus/layout/comment/gitment.ejs","hash":"8d44214a3ff0f83e2c54bfbb25c1c3f56aa55e34","modified":1530714284605},{"_id":"themes/icarus/layout/comment/isso.ejs","hash":"4f8b81ff5bb418ec11ce080d515f247bfe436014","modified":1491956064000},{"_id":"themes/icarus/layout/comment/livere.ejs","hash":"792e4f0e93b2bdc5abd85d447d804a5c608a9c5c","modified":1511137518000},{"_id":"themes/icarus/layout/comment/scripts.ejs","hash":"4b5251ba5594e5d53f87b6603fadda400ba46544","modified":1511137518000},{"_id":"themes/icarus/layout/comment/valine.ejs","hash":"0ea90a606f0d386a5ae0da83c0501cbb25319fde","modified":1511137518000},{"_id":"themes/icarus/layout/comment/youyan.ejs","hash":"6fe807992832939caf6c3e7651d052df9520d88e","modified":1491956064000},{"_id":"themes/icarus/layout/common/article.ejs","hash":"9c260a551596f71e93177f2289b5cb1c4bc7d96c","modified":1515336251950},{"_id":"themes/icarus/layout/common/footer.ejs","hash":"cbfe560fcab445d42ceeb5d1beba5957d5be5eaa","modified":1491956064000},{"_id":"themes/icarus/layout/common/head.ejs","hash":"44f30945882afd27c89da2173da501fb1b531488","modified":1494948466794},{"_id":"themes/icarus/layout/common/header.ejs","hash":"738c6a923b2a6de6a81c4892c8a47e03d8b34f88","modified":1491956064000},{"_id":"themes/icarus/layout/comment/index.ejs","hash":"f6549e3113562548ed128181878a8146509cdc7b","modified":1511137518000},{"_id":"themes/icarus/layout/common/profile.ejs","hash":"0d5a9622d490652599e3ba3e4077a7d6bb2eb38e","modified":1491956064000},{"_id":"themes/icarus/layout/common/scripts.ejs","hash":"c0a1a9e53f89440c42c325d5bd8c7234652c8937","modified":1491956064000},{"_id":"themes/icarus/layout/common/sidebar.ejs","hash":"6e80fa52d23c9c39bfa357a1e00c26fc8b851b82","modified":1491956064000},{"_id":"themes/icarus/layout/common/thumbnail.ejs","hash":"1b70f8a98cd8650b159bda858dbee38dbdb7f0c5","modified":1491956064000},{"_id":"themes/icarus/layout/common/timeline.ejs","hash":"6420e34e0332c9b6670011519f341340db989343","modified":1491956064000},{"_id":"themes/icarus/layout/plugin/baidu-analytics.ejs","hash":"6a7bee18e666e627e62541a5e30906f87ba1bfe8","modified":1491956064000},{"_id":"themes/icarus/layout/plugin/google-analytics.ejs","hash":"349f08b6521a16e79046b1f94f04317ac74f556e","modified":1491956064000},{"_id":"themes/icarus/layout/plugin/scripts.ejs","hash":"b349c7089a44302eaa8291c0ed13ef815f868a68","modified":1491956064000},{"_id":"themes/icarus/layout/search/baidu.ejs","hash":"3e603a702d20c53fd3bcbeb570a16a86d54781ce","modified":1491956064000},{"_id":"themes/icarus/layout/search/index-mobile.ejs","hash":"50a727ac1dfe3073eb6fa6699ba01e66f4ac41c0","modified":1491956064000},{"_id":"themes/icarus/layout/search/index.ejs","hash":"24935e32e61d4706454b174ea3bed0726ae7fb34","modified":1491956064000},{"_id":"themes/icarus/layout/search/insight.ejs","hash":"130fe3d33ac71da0b50f7fee6a87979f30938a1b","modified":1491956064000},{"_id":"themes/icarus/layout/search/swiftype.ejs","hash":"379e66d2c13526e72e4120c443f95fccf4edef71","modified":1491956064000},{"_id":"themes/icarus/layout/share/addtoany.ejs","hash":"ac180c4c84b73a04d61b17e7dc18c257e20bf59f","modified":1491956064000},{"_id":"themes/icarus/layout/share/bdshare.ejs","hash":"a1e772c5a6f174d585b0c1e574058f75dc8e2898","modified":1491956064000},{"_id":"themes/icarus/layout/share/default.ejs","hash":"ebfb919dc525b3ed61a6a5ee05ee71410eedc541","modified":1491956064000},{"_id":"themes/icarus/layout/share/index.ejs","hash":"2a2c0095b95b11e5692bd8ad6a2337aa644189a2","modified":1491956064000},{"_id":"themes/icarus/layout/share/jiathis.ejs","hash":"21ebaa51e828cba2cefbeeaccb01514643565755","modified":1491956064000},{"_id":"themes/icarus/layout/widget/archive.ejs","hash":"d9ebbb7f6ce2f25df5ae25e4a1fef3c08f7054b9","modified":1491956064000},{"_id":"themes/icarus/layout/widget/category.ejs","hash":"583bda80cf15b3ef11fefbd1b502897dfff40100","modified":1491956064000},{"_id":"themes/icarus/layout/widget/links.ejs","hash":"aad118699718b62c0d3f3cfd6f17a181139a76af","modified":1491956064000},{"_id":"themes/icarus/layout/widget/recent_posts.ejs","hash":"2ca923465275fb38a7ac7d67211d6e94a977e957","modified":1491956064000},{"_id":"themes/icarus/layout/widget/tag.ejs","hash":"3b8ae5953990436893da9d68f910ebe592005659","modified":1491956064000},{"_id":"themes/icarus/layout/widget/tagcloud.ejs","hash":"ca8c7bf555fb6ce4904f2c59160548405c2c8a82","modified":1491956064000},{"_id":"themes/icarus/node_modules/.bin/which","hash":"0a816df3d5e49ffec52fcc7685d90b9ddc58f0ab","modified":1494515723984},{"_id":"themes/icarus/node_modules/.bin/which.cmd","hash":"a45b4777cb1c1246caf994f5e3cc2a39eb196498","modified":1494515723984},{"_id":"themes/icarus/node_modules/bluebird/LICENSE","hash":"59002342e7a5468c5b5b9ae6fb4eb41bbc7f33ae","modified":1494515717717},{"_id":"themes/icarus/node_modules/bluebird/README.md","hash":"4d77de80f7a139ea6c4c26f590c27a28fc80e38c","modified":1494515717548},{"_id":"themes/icarus/node_modules/bluebird/changelog.md","hash":"bc6df7caea3b83fa361fa0a96c9b34c09465a93a","modified":1494515717873},{"_id":"themes/icarus/node_modules/bluebird/package.json","hash":"b3e5372e241070066fd90749fa934954fda303b5","modified":1494515720390},{"_id":"themes/icarus/node_modules/camel-case/LICENSE","hash":"3a7f886b632d2197676a40020d354e84b7860604","modified":1494515717566},{"_id":"themes/icarus/node_modules/camel-case/camel-case.d.ts","hash":"30e10eb66736cbb97c906af8b2ceb7b4755e6259","modified":1494515717874},{"_id":"themes/icarus/node_modules/camel-case/camel-case.js","hash":"6828b41a59ec548d513d5a7f1c91f7e683f926ce","modified":1494515717742},{"_id":"themes/icarus/node_modules/camel-case/package.json","hash":"e1a6a2b5075e652275f8e154746b7c910580a11e","modified":1494515718130},{"_id":"themes/icarus/node_modules/cross-spawn/LICENSE","hash":"45c1476739d0c028c845b2c90c401c3a4435de04","modified":1494515717770},{"_id":"themes/icarus/node_modules/cross-spawn/README.md","hash":"179da75e34197ceca8bc1b79ce95c9ab7f13c43c","modified":1494515717589},{"_id":"themes/icarus/node_modules/cross-spawn/index.js","hash":"db81cb7b0c65f5b0dfe1b81f2217a6277bc4822a","modified":1494515717937},{"_id":"themes/icarus/node_modules/cross-spawn/package.json","hash":"30adfe93da36213cbd26505e3bb770aed4fe6904","modified":1494515718623},{"_id":"themes/icarus/node_modules/hexo-generator-json-content/.npmignore","hash":"fa3b2eb70de258c0efb3efac3dceb5abd7c92666","modified":1494515717620},{"_id":"themes/icarus/node_modules/hexo-generator-json-content/LICENSE","hash":"d9ae358aefebd8c2242c55044bc7fb9edbae3b0a","modified":1494515718055},{"_id":"themes/icarus/node_modules/hexo-generator-json-content/README.md","hash":"c884c52fdda83064e889dc7e116cb63a223e5558","modified":1494515717795},{"_id":"themes/icarus/node_modules/hexo-generator-json-content/index.js","hash":"37e7ce344478ab903c825cc9b2173d76ce47e298","modified":1494515718164},{"_id":"themes/icarus/node_modules/hexo-generator-json-content/package.json","hash":"cc508b0a9868f065e4fe924ca14d3c6706e37031","modified":1494515718369},{"_id":"themes/icarus/node_modules/hexo-util/.eslintignore","hash":"0abf1c392f32bdf193fe824ead96926f550a85ae","modified":1494515718151},{"_id":"themes/icarus/node_modules/hexo-util/.eslintrc","hash":"2c4a55a386408308d637f658a4b2f5e82f4e58db","modified":1494515718222},{"_id":"themes/icarus/node_modules/hexo-util/.jscsrc","hash":"5f410f9c9caedfdd1eabb1571de1f8f9014eefb6","modified":1494515718069},{"_id":"themes/icarus/node_modules/hexo-util/.npmignore","hash":"6fe0e77d6437d02bf947346807e8ad4ad7b7523f","modified":1494515717538},{"_id":"themes/icarus/node_modules/hexo-util/LICENSE","hash":"fecd013bdadc9ead2732027f06bf8fc19761efcb","modified":1494515717890},{"_id":"themes/icarus/node_modules/hexo-util/README.md","hash":"1079641dc5026d8c8ead9e7f8212d7a3c1a105fa","modified":1494515717703},{"_id":"themes/icarus/node_modules/hexo-util/highlight_alias.json","hash":"40fcb466bb15760fc776c8680e697da1fa8221f9","modified":1494515729028},{"_id":"themes/icarus/node_modules/hexo-util/package.json","hash":"d641ad76b0f5bfee3b896cf0f7c6ca37df0e73a6","modified":1494515719156},{"_id":"themes/icarus/node_modules/highlight.js/LICENSE","hash":"cd25196630fe891662ad77810f0f6dee5bc85ddc","modified":1494515717821},{"_id":"themes/icarus/node_modules/highlight.js/README.md","hash":"087887d419ba2c138058e6fac56c24d838bb4114","modified":1494515717636},{"_id":"themes/icarus/node_modules/highlight.js/package.json","hash":"e6612706b87ba644f3612ada08cc9cf5b345da39","modified":1494515722129},{"_id":"themes/icarus/node_modules/html-entities/LICENSE","hash":"f10f3a5e9b16a526fbf6abc4be406e6f07ecad93","modified":1494515717707},{"_id":"themes/icarus/node_modules/html-entities/README.md","hash":"15dea62352c313d8eee8b0069a5b0a8a9294e5c6","modified":1494515717545},{"_id":"themes/icarus/node_modules/html-entities/index.js","hash":"eb15b4fed782c7736a02ad14c97901080ab85f44","modified":1494515717872},{"_id":"themes/icarus/node_modules/html-entities/package.json","hash":"abc3819addfe655ccad2fc8f6e93be9152f953d7","modified":1494515718600},{"_id":"themes/icarus/node_modules/isexe/.npmignore","hash":"5c82cb364ccc42139031fc6519c138ef81f2df26","modified":1494515717533},{"_id":"themes/icarus/node_modules/isexe/LICENSE","hash":"bb408e929caeb1731945b2ba54bc337edb87cc66","modified":1494515717873},{"_id":"themes/icarus/node_modules/isexe/README.md","hash":"5245f0db9a9f95b37f4cac50e75dc66e2ea8e1a5","modified":1494515717694},{"_id":"themes/icarus/node_modules/isexe/index.js","hash":"9348ece80fd6208f0b8740d43cd652db4a5f06e6","modified":1494515718188},{"_id":"themes/icarus/node_modules/isexe/package.json","hash":"f7ac4d4ee0a7d55ff2559791bfe1025d7166d69a","modified":1494515718613},{"_id":"themes/icarus/node_modules/isexe/mode.js","hash":"5f33b53cc6b89f9ebe2ebd1dcfeb434cd96a3192","modified":1494515718278},{"_id":"themes/icarus/node_modules/isexe/windows.js","hash":"1a6d0c635f67223d5e3890068f32f2da46e45151","modified":1494515718091},{"_id":"themes/icarus/node_modules/keyword-extractor/.npmignore","hash":"1061654723a72f7aa74896d084c9e31fa5f61733","modified":1494515717529},{"_id":"themes/icarus/node_modules/keyword-extractor/LICENSE","hash":"449a0ef15761526ad764889d4e8fffb05a01bcb1","modified":1494515717878},{"_id":"themes/icarus/node_modules/keyword-extractor/Makefile","hash":"c2b750775cd3ab94e3a1420dd128e74e0106ac0c","modified":1494515718152},{"_id":"themes/icarus/node_modules/keyword-extractor/README.md","hash":"ce132d404d6c663ad0f306930ba0693e4b986d35","modified":1494515717697},{"_id":"themes/icarus/node_modules/keyword-extractor/index.js","hash":"cd67fd429bb78e1ae525908abfe9e4731d506f5e","modified":1494515718069},{"_id":"themes/icarus/node_modules/keyword-extractor/package.json","hash":"a069517c6098f01e5ba9474d302cad6fd3583305","modified":1494515719251},{"_id":"themes/icarus/node_modules/lower-case/LICENSE","hash":"3a7f886b632d2197676a40020d354e84b7860604","modified":1494515717739},{"_id":"themes/icarus/node_modules/lower-case/README.md","hash":"69ed872fccaa2ae235890bf01958115a178ca713","modified":1494515717560},{"_id":"themes/icarus/node_modules/lower-case/lower-case.d.ts","hash":"f6cc8841b3395a746a5984327edb3c6411302b11","modified":1494515718097},{"_id":"themes/icarus/node_modules/lower-case/lower-case.js","hash":"6c8e4acdd39af940362a63b3fdd40d98bce5b073","modified":1494515717902},{"_id":"themes/icarus/node_modules/lower-case/package.json","hash":"62dc93971ee98856058e29cf3271b37189b33ebb","modified":1494515718264},{"_id":"themes/icarus/node_modules/lru-cache/LICENSE","hash":"bb408e929caeb1731945b2ba54bc337edb87cc66","modified":1494515717781},{"_id":"themes/icarus/node_modules/lru-cache/README.md","hash":"d977bae4b6994f0a930d7e8727b099b8db4572f5","modified":1494515717615},{"_id":"themes/icarus/node_modules/lru-cache/package.json","hash":"8c03fb3a3c6165973a1544bc3a5db5f26ea51d47","modified":1494515718257},{"_id":"themes/icarus/node_modules/moment/CHANGELOG.md","hash":"26e752c3d577a4bfe8473f6cbf5a84afe2b96cf7","modified":1494515721527},{"_id":"themes/icarus/node_modules/moment/LICENSE","hash":"aab97739ef7d50750adbc9ffbfd1cbf9608eb678","modified":1494515717782},{"_id":"themes/icarus/node_modules/moment/README.md","hash":"9109da3a08855d73337baa4dd0c4e19b437ab5da","modified":1494515717595},{"_id":"themes/icarus/node_modules/moment/ender.js","hash":"f26dfccd69e35b733a945a083bb64b20bf968bb3","modified":1494515717971},{"_id":"themes/icarus/node_modules/moment/moment.d.ts","hash":"f28a2959e828e696f2ee68b8a65494d3320094e8","modified":1494515721542},{"_id":"themes/icarus/node_modules/moment/package.js","hash":"ea880b139fa5aad30129356d4c2b61c7acad7452","modified":1494515718450},{"_id":"themes/icarus/node_modules/moment/package.json","hash":"0e85efb7145f66765acf4832f94ce524a2064261","modified":1494515723719},{"_id":"themes/icarus/node_modules/no-case/LICENSE","hash":"3a7f886b632d2197676a40020d354e84b7860604","modified":1494515717718},{"_id":"themes/icarus/node_modules/no-case/README.md","hash":"0923fc0a30d1c6e59f9d79872e5718f460ef1f77","modified":1494515717554},{"_id":"themes/icarus/node_modules/no-case/no-case.d.ts","hash":"fd30ef64614965e6d611b05aaa579e1abb2bfa70","modified":1494515718073},{"_id":"themes/icarus/node_modules/no-case/no-case.js","hash":"9c9bed3c4f4bd9cd9c74b8384e17170677e7cdc3","modified":1494515717890},{"_id":"themes/icarus/node_modules/no-case/package.json","hash":"5844f1d9e9893697f10780214465173339812026","modified":1494515718606},{"_id":"themes/icarus/node_modules/pseudomap/LICENSE","hash":"bb408e929caeb1731945b2ba54bc337edb87cc66","modified":1494515717752},{"_id":"themes/icarus/node_modules/pseudomap/README.md","hash":"93ca8dd88b562f1cd856143e500bdb679419e088","modified":1494515717569},{"_id":"themes/icarus/node_modules/pseudomap/map.js","hash":"f0d63208dec47fe1d9c69ab74fdf54298406dce4","modified":1494515717885},{"_id":"themes/icarus/node_modules/pseudomap/package.json","hash":"e175ea6d5ecbccd26e6c7463fd2a588bdfd3d218","modified":1494515718437},{"_id":"themes/icarus/node_modules/pseudomap/pseudomap.js","hash":"34cddc0bc6daaf6c7092d2659612969b8700d8fa","modified":1494515718130},{"_id":"themes/icarus/node_modules/striptags/.npmignore","hash":"631c0bbafc06a9acdf32b5f1d0a32b425d5327a9","modified":1494515717548},{"_id":"themes/icarus/node_modules/striptags/.travis.yml","hash":"d9c5d47c7c006d737ad01c2a1f10d42206189a33","modified":1494515718195},{"_id":"themes/icarus/node_modules/striptags/LICENSE","hash":"88d9c86133613e38d3fcdc5766654e81d0cf0205","modified":1494515717900},{"_id":"themes/icarus/node_modules/striptags/README.md","hash":"312dad4632c3d8c145980983451c551bfcf1c352","modified":1494515717721},{"_id":"themes/icarus/node_modules/striptags/bower.json","hash":"721bd625f002394f7422251062ee4cd8e409388c","modified":1494515718285},{"_id":"themes/icarus/node_modules/striptags/package.json","hash":"2e019290e6edbae070aef9028a1cf639420a2bfc","modified":1494515718619},{"_id":"themes/icarus/node_modules/striptags/striptags.js","hash":"b76eaea01c6f86d3a6f187ca1e4b30e7f059ab07","modified":1494515718124},{"_id":"themes/icarus/node_modules/underscore/LICENSE","hash":"4a536006299d219843f69f87ecac4b52158b3efc","modified":1494515717731},{"_id":"themes/icarus/node_modules/underscore/README.md","hash":"fb13eed34314e90170be6290876a9a66c4051272","modified":1494515717560},{"_id":"themes/icarus/node_modules/underscore/package.json","hash":"4413514ecb5d1afb1337c1656ff0de09d1c1a67c","modified":1494515718464},{"_id":"themes/icarus/node_modules/underscore/underscore.js","hash":"07147a83bfaba702d30426c7c31bccb25e692a2e","modified":1494515718243},{"_id":"themes/icarus/node_modules/underscore/underscore-min.js","hash":"fb26909af4ad2a6c240b9aa4b35bb983cf4b20e4","modified":1494515718035},{"_id":"themes/icarus/node_modules/underscore.string/.travis.yml","hash":"e33e8d35cf94d67804af457d709d8db1d16f73ae","modified":1494515718647},{"_id":"themes/icarus/node_modules/underscore.string/Gemfile","hash":"dab95a91b5a30ded482c35d9efbc00d33a9322aa","modified":1494515718208},{"_id":"themes/icarus/node_modules/underscore.string/Gemfile.lock","hash":"9236e4ffa7c8ca067369e9b77bd26bc850fd51ea","modified":1494515717718},{"_id":"themes/icarus/node_modules/underscore.string/README.markdown","hash":"d5862c720a95a582201ff26ff11bdf44911dde36","modified":1494515717943},{"_id":"themes/icarus/node_modules/underscore.string/Rakefile","hash":"aebecba3b976b65bb74d63704f37d6f74d7419cf","modified":1494515718135},{"_id":"themes/icarus/node_modules/underscore.string/component.json","hash":"b929b12ac3a7bdf402fa87863621259a39a883c2","modified":1494515717528},{"_id":"themes/icarus/node_modules/underscore.string/package.json","hash":"784096e823cfb55ab8786d5b09eb8d7ffb6da7e8","modified":1494515719744},{"_id":"themes/icarus/node_modules/upper-case/LICENSE","hash":"3a7f886b632d2197676a40020d354e84b7860604","modified":1494515717760},{"_id":"themes/icarus/node_modules/upper-case/README.md","hash":"2eeec02b0cf6dfdd2881c754a3ef3340f7cbc348","modified":1494515717573},{"_id":"themes/icarus/node_modules/upper-case/package.json","hash":"845d0f83bb6b8740cf40a4eafe6547d8d719e106","modified":1494515718285},{"_id":"themes/icarus/node_modules/upper-case/upper-case.d.ts","hash":"a5610dcff5a1a1f54b45b84e2f82b8393aeaa682","modified":1494515718109},{"_id":"themes/icarus/node_modules/upper-case/upper-case.js","hash":"cc2dbbcf88c099a8c8a4db4c424e663ce9826a5b","modified":1494515717969},{"_id":"themes/icarus/node_modules/which/CHANGELOG.md","hash":"2c522460b1680bacffbd26aab9cb553adf7c0547","modified":1494515718277},{"_id":"themes/icarus/node_modules/which/LICENSE","hash":"bb408e929caeb1731945b2ba54bc337edb87cc66","modified":1494515717791},{"_id":"themes/icarus/node_modules/which/README.md","hash":"6269a83ac37a211a4f54a0b6d00ca5dfc3e14eaa","modified":1494515717634},{"_id":"themes/icarus/node_modules/which/package.json","hash":"e2a5cfeb1c999dd365444977767ec5b4ef5df616","modified":1494515718493},{"_id":"themes/icarus/node_modules/which/which.js","hash":"61d19a144cbe06216aec47ec61c48a5d01806d13","modified":1494515718050},{"_id":"themes/icarus/node_modules/yallist/LICENSE","hash":"bb408e929caeb1731945b2ba54bc337edb87cc66","modified":1494515717773},{"_id":"themes/icarus/node_modules/yallist/README.md","hash":"930460a06c3414c2dceeeca378fbe0057779fab5","modified":1494515717595},{"_id":"themes/icarus/node_modules/yallist/iterator.js","hash":"baf1ff1052a38543b84d4bba85a62dc78b1ab107","modified":1494515717922},{"_id":"themes/icarus/node_modules/yallist/package.json","hash":"ad37ec7b04d00f88ab600dcbcc35d643b223b446","modified":1494515718398},{"_id":"themes/icarus/node_modules/yallist/yallist.js","hash":"c042dba0e8d1672a56531936a03533f5aaaca9de","modified":1494515718186},{"_id":"themes/icarus/source/css/_extend.styl","hash":"539e02107f35e8b3bdb9bf160dc212a433a7b60e","modified":1491956064000},{"_id":"themes/icarus/source/css/_variables.styl","hash":"d62af931be6612ec8c3a917836379a8cd92fbce1","modified":1491956064000},{"_id":"themes/icarus/source/css/style.styl","hash":"1716b199dba80b26086f325d69c36fa682465106","modified":1491956064000},{"_id":"themes/icarus/source/js/activate-power-mode.js","hash":"1e75e9d156bd04b75aa2d3c10dfb289edf6ef56f","modified":1508226150914},{"_id":"themes/icarus/source/js/main.js","hash":"93dc932946e2898bf4f39c42af1b27295e886af1","modified":1491956064000},{"_id":"themes/icarus/source/js/insight.js","hash":"6ee84c42c2b230ff9e9bf605a444bd671d44f9e3","modified":1491956064000},{"_id":"themes/icarus/source/js/particles.min.js","hash":"8017f8b1869077db728573f1ca4684a00af69462","modified":1537257553358},{"_id":"themes/icarus/node_modules/moment/moment.js","hash":"71a0f6e03a34656d5a8a9f764e5c8b70cc5934ae","modified":1494515718362},{"_id":"source/img/fans.jpg","hash":"f68e7be6b65bb5320e75464812a678ecf67118ec","modified":1516193954871},{"_id":"source/img/penaltykick.jpg","hash":"5dc7e46afa0799b69575d9efd0243e3c06bb1ce2","modified":1516194009942},{"_id":"source/img/start.jpg","hash":"52e2913a317c58a61e95e8e4938cc56b2a3492f2","modified":1516194031609},{"_id":"source/img/thank.jpg","hash":"6da7edead639e7a35c831f4efb209702cf69540a","modified":1516194056849},{"_id":"themes/icarus/.git/objects/0a/fae239716ebf8b706677681168ea07c3eda53e","hash":"85bd7fe93a306ae9504c67de17351eef5a647bfd","modified":1516257378199},{"_id":"themes/icarus/.git/objects/10/d6b3008b65e215657687daa3d26733e7204893","hash":"732e57c52db51b1b3675c18898332692177021a1","modified":1516257378176},{"_id":"themes/icarus/.git/objects/13/f36913cab03392dbae7a75886853ecef50b503","hash":"396ab2547d81b49f0302b86ba9e3e39af3703350","modified":1516257378197},{"_id":"themes/icarus/.git/objects/14/b3dfccf11f0fc9f347a0d98665a4b5b1999d6f","hash":"994ef7acaca83a513a61330aedf9c7a526614445","modified":1516257378259},{"_id":"themes/icarus/.git/objects/16/aff88fe9fc90b9bec1de11879cd261d49c450b","hash":"09a10f3ae5b2bf48b144829c7b26e896dae32f49","modified":1516257378095},{"_id":"themes/icarus/.git/objects/20/770456243a0966edf7aaf7a51a3d8f2fad6cb9","hash":"ced63a59cff1cdfd45206756e8cfb8b6a3a79f16","modified":1516257378203},{"_id":"themes/icarus/.git/objects/21/31ce8cbf14863873a799015fc2e06ecee59b24","hash":"191d9a528f880e1189e866d05f15db044812607f","modified":1516257378195},{"_id":"themes/icarus/.git/objects/21/5978aa7fdb8555d33a7fd3dff919433cb2d780","hash":"4eec372454caea3c5be4fa5511e153d3d66de2b0","modified":1516257378255},{"_id":"themes/icarus/.git/objects/24/1780094300a6d7dd015dc5fd43e41ce7f50a00","hash":"619e799ea403820155e89d66450b79a182d77609","modified":1516257378182},{"_id":"themes/icarus/.git/objects/2b/e97068c01a65345a087c6b40dc41f02ef03d4e","hash":"32c682dc64a7338ca528605c5b121668dd0f65b6","modified":1516257378220},{"_id":"themes/icarus/.git/objects/2e/38f2fe9a914409d29f4562f344938011f0cb08","hash":"092989dc2036a86fb30c021e6d2834db997d7d92","modified":1516257378170},{"_id":"themes/icarus/.git/objects/34/d90af458ab6fd7cc8343e0d12aa3532c208f3e","hash":"a3d59165a6771eab2edc197c417cffbd77270b3c","modified":1516257378193},{"_id":"themes/icarus/.git/objects/36/56a80d8749294c457d99e75b8c3cc7c3293c2f","hash":"b2685ddad0f45321406e3386fb7091f4c98a7b46","modified":1516257378235},{"_id":"themes/icarus/.git/objects/3c/65e6956655bb97a333fb8ee32f5ee28d163bdf","hash":"db85824a520745c2a1caa59edda7b00a48552424","modified":1516257378209},{"_id":"themes/icarus/.git/objects/3c/f1eb21b569b291238581487b7ba3627efa7e00","hash":"8467e955ba0f17a09d1256b2ee0a785cf72d52a0","modified":1516257378207},{"_id":"themes/icarus/.git/objects/3d/5e3ffc7d61a056c35c052b562e16277ce38e55","hash":"3410a60b8bd623e3d036792d5530e503b7214e32","modified":1516257378260},{"_id":"themes/icarus/.git/objects/3e/5240f40d5009190a05a319898d99ef721ecfb2","hash":"ad3f981c64be14353c027f35598f710384d1f621","modified":1516257378190},{"_id":"themes/icarus/.git/objects/3e/66b25aaa06d3147991e165abc7ee64ea44c9ce","hash":"41cc3d465525141cdcbd1041c0f710d1c38b827d","modified":1516257378137},{"_id":"themes/icarus/.git/objects/3e/d3b9ee22526471ef3a74304c3a0499cfd82a28","hash":"6e037ce3c27a31c61b7cdb11717c2dccf65f0b0f","modified":1516257378152},{"_id":"themes/icarus/.git/objects/42/edb63e92d782dc3ac3db92ff28215ffbda9fa9","hash":"7a16fb91be13073d4d6c57f1df8d48eeb565e1c4","modified":1516257378215},{"_id":"themes/icarus/.git/objects/45/1198931d6d83a879b4c633991c56181e18a942","hash":"8a960ae072e430a434297d48d03c24bb9d3c41d4","modified":1516257378141},{"_id":"themes/icarus/.git/objects/46/2873fbd84ba7127dc8a9aa692983182edc2006","hash":"fa31269910bca816096e0da82ab7a2e872027091","modified":1516257378247},{"_id":"themes/icarus/.git/objects/48/6b1fc0778553a4d2af593ff4a89c5caa5a6d60","hash":"c50fac3bc36f82a2c1bc304d94d9fd2766fe7f2b","modified":1516257378150},{"_id":"themes/icarus/.git/objects/4a/5d99e24ba996ad1dfcf0e63e23be19fde2a7a5","hash":"473966b999ae3490830607690897d0040cdfb1aa","modified":1516257378240},{"_id":"themes/icarus/.git/objects/4c/2985a04697f76f41985b27a609baaf87a5db4a","hash":"bf01f0092f8e21bbdba48f14109c4ef398fabe10","modified":1516257378221},{"_id":"themes/icarus/.git/objects/4c/ceb55155b1f49cbd9928ad43f5c525e09652c7","hash":"eeb1d40a6f78b175d6892247c4aff7d743daeac8","modified":1516257378135},{"_id":"themes/icarus/.git/objects/53/aa8890a7ef146f246f8eacad12a0f38a07ed49","hash":"ec77c53503b174fb4a478d3ff3c85a4aab3811f6","modified":1516257378257},{"_id":"themes/icarus/.git/objects/54/801819a6dbc024ceeea943abd8c4f118b2482d","hash":"dd9b4383e7775f7e2f4ded7d12fe36078d760b19","modified":1516257378205},{"_id":"themes/icarus/.git/objects/54/dde2eba387d3879e54c6406f60ba9fba3313e2","hash":"ddbb95c2bd5323b59580b3eef1a66b192bf875ef","modified":1516257378214},{"_id":"themes/icarus/.git/objects/56/2d0a1ce49f1dbd9110612a591fcded806969e0","hash":"ac05af219b90b359396d28a59da78c11aafab611","modified":1516257378161},{"_id":"themes/icarus/.git/objects/58/d75d9ad5b2a5434505580baacbaa22d0f59d06","hash":"ab080a9c45ba581a5f0084ddeaa6178d1b6a0b49","modified":1516257378185},{"_id":"themes/icarus/.git/objects/5d/eba812bac26851ff61ff7f8390bd9b9faaccf6","hash":"5226c1712c46b7218e1996cc6e699d49ad95d222","modified":1516257378238},{"_id":"themes/icarus/.git/objects/5e/850c4a8f870072c06332351b589a25eacfe834","hash":"20505ede3b997085e030a2918e7280abb6f63b3c","modified":1516257378168},{"_id":"themes/icarus/.git/objects/5f/a0dafb4c921c718814ad766e382221198d5428","hash":"7c7e89bdb4ecc912f27f64d5c40c3cde4e0720d0","modified":1516257378154},{"_id":"themes/icarus/.git/objects/61/d75c67b063f801ddde4a5a57d3c8f4a9e936d7","hash":"7670a9f1c468c7d9eb1f5a2985108b09cb323fc7","modified":1516257378155},{"_id":"themes/icarus/.git/objects/63/eaccc2d9fb9f293fcc4ce6ce08ee65659f362d","hash":"a7d5c1c4b93f9233a002a75e931899d478cada98","modified":1516257378218},{"_id":"themes/icarus/.git/objects/6b/d938cc8bd24faac500147f25c5572744342983","hash":"ed5308a713d787723390a454406b1f23cbf9c65b","modified":1516257378187},{"_id":"themes/icarus/.git/objects/6c/3d4dd88791d3eccf2dc91e263c18280f4066c5","hash":"2251554e32ef94d91e080f6419b69baacb8302e5","modified":1516257378165},{"_id":"themes/icarus/.git/objects/6e/ce2bcaf66a22547468e343906f18ae9f40231f","hash":"b226d2de70b94356c3111a2da8b05bfa90ec9b25","modified":1516257378226},{"_id":"themes/icarus/.git/objects/6f/08ed9cbf0848466484f7514b86e6304b99a562","hash":"1968cd4c27664e4d9ef4fc86c7766e76845d3d71","modified":1516257378262},{"_id":"themes/icarus/.git/objects/80/d85a69bf188de3ec482704c4f589434733b82a","hash":"58304bb788fafad2b14d7522b80162035cced122","modified":1516257378210},{"_id":"themes/icarus/.git/objects/84/9facc6144366266f29b5605ea79b020b0f59e0","hash":"97ff9ac82c131317e568ade962f3b8dcaa5aa754","modified":1516257378244},{"_id":"themes/icarus/.git/objects/8a/f0f352d0aaec6107bdf425010c7a12195f686a","hash":"e90c0460c9a82d542f510682c842846b5c198c79","modified":1516257378230},{"_id":"themes/icarus/.git/objects/8b/0da479afc5d6787b0b4f9e71c2963ba2767a93","hash":"f662b4cf4ae3da08b8bbbfa1a458fe37a0d552d7","modified":1516257378192},{"_id":"themes/icarus/.git/objects/8e/80cfe4540fc540c7da8385996f87939e87c50e","hash":"13c0b8e196dbc0c91b0cec3c832f64ea828607bb","modified":1516257378253},{"_id":"themes/icarus/.git/objects/95/29314bc46d152e3d894df7943c66d19b4a7344","hash":"2faede08ef9b149dc6104f6696e6ed7386bb6cb4","modified":1516257378157},{"_id":"themes/icarus/.git/objects/96/8a31ed90acd4907f269c4a98a69cea3c23ae2c","hash":"76efc88a3188a69e94b8873cae75c351bac2186c","modified":1516257378145},{"_id":"themes/icarus/.git/objects/98/10c3162c82a42b4971a7b175f09e57189895cf","hash":"217d3976788cee28e2bf13114cce1f7c99c9cf23","modified":1516257378167},{"_id":"themes/icarus/.git/objects/9e/d876f49e8fd20a739d5d80f0bac78b24fe3611","hash":"2ea0ef38fc5b87e158807fbb1fb7159236d7064e","modified":1516257378143},{"_id":"themes/icarus/.git/objects/a5/6512b055c2cc16c968d8c62b0edb3faa22fe35","hash":"15ce465bcd6b43c6e95597c361ffe0beb4d627a0","modified":1516257378163},{"_id":"themes/icarus/.git/objects/a5/c9e8d7bf2b46569f85bbe16fcd593ea1d29ec6","hash":"caa10717bd319e2a1b7957e5f0d567994e8d9ef5","modified":1516257378183},{"_id":"themes/icarus/.git/objects/a5/df063eb3ad50d2e835e04a52c9b211b646e5b9","hash":"6d652dab443da1026899e0942cc9d3d8aee98184","modified":1516257378224},{"_id":"themes/icarus/.git/objects/b9/fcb1631ef5fb8a746ac52a4109ddbcbc9f007f","hash":"af91810bba17c54356485be55891ebd51e2e2550","modified":1516257378174},{"_id":"themes/icarus/.git/objects/c1/7af880fd7c3a1c96aef3109f30a6de2165b746","hash":"86d5130d3d86a35d04a3bd446c0d696bdfcbbd13","modified":1516257378223},{"_id":"themes/icarus/.git/objects/c4/8162ad2082610caa5713ce62b6c15f7e0be5fd","hash":"4c8da6bab7dbaa5b334d292797545e41dc4207cd","modified":1516257378189},{"_id":"themes/icarus/.git/objects/c7/6810086e755ff698cd99add4f69e74366bec27","hash":"c76530ec8eb88267f7a74d341d3c4b0b72b3d1dd","modified":1516257378177},{"_id":"themes/icarus/.git/objects/cc/54a33495f294a0582ea5221eb5c7aa211843fd","hash":"db4de7f3e63ee3e9420b9c38c30d91c40a54c1d2","modified":1516257378233},{"_id":"themes/icarus/.git/objects/cc/a84aa6bef4263e442b84afa07662e0bf714925","hash":"f4b91d270ae958f2309928aed752a31abcd2831e","modified":1516257378172},{"_id":"themes/icarus/.git/objects/ce/681e89a29af1c691990fa19b18083ab43cafec","hash":"06383c9d613b048a8887d8761d144e6aec8ed7a0","modified":1516257378159},{"_id":"themes/icarus/.git/objects/ce/7955afb0bc4be9d6249ed8687e1fd831f07478","hash":"5b28882a270f9ce911af6f6f94f283dffd744c3b","modified":1516257378254},{"_id":"themes/icarus/.git/objects/cf/56ae28cbf04c2f83741659f3dcb3e2b23426cc","hash":"32106afeef6dae583edf71f3113bba67bb6b4142","modified":1516257378181},{"_id":"themes/icarus/.git/objects/d6/fced85cf8e7927a127af2a9486c1a8b15a8f55","hash":"5dae906f8ec7a9c35e49177024ed2cb2de52c2b3","modified":1516257378232},{"_id":"themes/icarus/.git/objects/dd/72e1def42aea862f6d3ff47bdbffdfea357f69","hash":"ed8f4b74d22f6225981c73c64289af1d263db1a3","modified":1516257378237},{"_id":"themes/icarus/.git/objects/e6/949cfe253078cf0362903009da689099eda183","hash":"47435c75a930c35c53eac49ee7d0f6c9207234de","modified":1516257378179},{"_id":"themes/icarus/.git/objects/e7/3377676201203933edf35a287711d885587b10","hash":"6f65ec19a4abe31d6fca3f07385ef97533d8050f","modified":1516257378241},{"_id":"themes/icarus/.git/objects/ee/9af247cfbc0dd2e8a3664515981f272fc31738","hash":"3d90b57c9859ab72a749e6946fe7d1a95d81a4a6","modified":1516257378227},{"_id":"themes/icarus/.git/objects/f0/02a03aab276cc9d9b80cf3672dcf2d7ac8b18b","hash":"34e42430f14001cbac660878ec5eeaee28f89b69","modified":1516257378229},{"_id":"themes/icarus/.git/objects/f2/ca1be7e47f87162b1f5f5a7eaff2bdccc4596f","hash":"eda366798f4f555f084941d8a17bf37463c812fa","modified":1516257378248},{"_id":"themes/icarus/.git/objects/f4/d2092f4a3c99360d233a1bb0b71fac272b63ab","hash":"165e70e1119bae0c2f6f2c423c3d2ba74f6211d0","modified":1516257378148},{"_id":"themes/icarus/.git/objects/f6/9a0fa4ef8d3bba2de0cfd97add888f35bab873","hash":"e9740eee4def1a318b006ecda159ddf80598e530","modified":1516257378201},{"_id":"themes/icarus/.git/objects/f7/1297933344df9dc7639d69ab73c2e58c1d1e68","hash":"30895b8f1b87e1aac8837227e07b9826f62e45c8","modified":1516257378243},{"_id":"themes/icarus/.git/objects/f9/a6819f9418be8b26453507be67fe340387606e","hash":"e2772988a722dec04a6be4475b076ff809c1c7ef","modified":1516257378251},{"_id":"themes/icarus/.git/objects/fb/574207f9ed3bee8dc6e2c5ae31b93751b62756","hash":"7ab09427467147d15acc26529986e1330783051c","modified":1516257378139},{"_id":"themes/icarus/.git/objects/fb/ad5c6917c9a363b01bd95e6f1395c4f65ccd17","hash":"39b90f17ad0f2475c3a5ee2316a7cb1825eb3e8d","modified":1516257378211},{"_id":"themes/icarus/.git/objects/pack/pack-b46b358ba5a6be048e7d7f1380864e23c27edc6e.idx","hash":"a7c2977f11e806f53f70028eb151a4f5f5bb8ab7","modified":1494427981322},{"_id":"themes/icarus/.git/refs/heads/master","hash":"f4c94e8dcf2a004a0b4803f76f6a37a119a2f11c","modified":1494427981695},{"_id":"themes/icarus/.git/refs/tags/v0.4.0","hash":"58b2233be98194dcfbb24adeff1b6c1d4b558fff","modified":1516257378481},{"_id":"themes/icarus/layout/common/post/banner.ejs","hash":"47ced3f03525698c79c6b1c07b48383fb6c496b2","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/category.ejs","hash":"75c9dda2e7ec041943855ca163a6b1c4c8b4f260","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/gallery.ejs","hash":"659f019761116313169148ec61773e7b84abb739","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/date.ejs","hash":"45cb0bcad461036cdd1fe2e3fbb5f2f19940025c","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/tag.ejs","hash":"2e966216256321aa0c76fe1b9be689601c76ef31","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/nav.ejs","hash":"d7cd611e642327f33dff3963ef869c2b46824a11","modified":1491956064000},{"_id":"themes/icarus/layout/common/post/title.ejs","hash":"669ddb46fefa100856588351a7a2d30ad996b755","modified":1491956064000},{"_id":"themes/icarus/node_modules/cross-spawn/lib/enoent.js","hash":"6318a907092ab4ff4ff31305e4a272f5fd877a9e","modified":1494515718119},{"_id":"themes/icarus/node_modules/cross-spawn/lib/hasBrokenSpawn.js","hash":"bb8d6bdbd5251c907d86a4d57cd6623b3ade53c0","modified":1494515718208},{"_id":"themes/icarus/node_modules/cross-spawn/lib/parse.js","hash":"d2fa758fe5a3f564c953b1e9203d4eea138102ab","modified":1494515718362},{"_id":"themes/icarus/node_modules/cross-spawn/lib/resolveCommand.js","hash":"2d7efa07faaa5429bd7ac215ec720fcc3d0657e9","modified":1494515718467},{"_id":"themes/icarus/node_modules/hexo-util/lib/cache_stream.js","hash":"9346587fa9871e9a4529592e91a997e5b0a41ae9","modified":1494515718345},{"_id":"themes/icarus/node_modules/hexo-util/lib/camel_case_keys.js","hash":"0e506d8ee3dfae6ab57d1a04c7e6e4d82287b1db","modified":1494515719058},{"_id":"themes/icarus/node_modules/hexo-util/lib/escape_diacritic.js","hash":"9b62a42bde7671daba738e6652baee44ba30d6ba","modified":1494515718977},{"_id":"themes/icarus/node_modules/hexo-util/lib/escape_html.js","hash":"f3c3f1a422cd2e519a805fbdbf5f20b63a10fd9a","modified":1494515718694},{"_id":"themes/icarus/node_modules/hexo-util/lib/escape_regexp.js","hash":"c74fc0d14a2930007336aa11e8af4224cefac86c","modified":1494515718469},{"_id":"themes/icarus/node_modules/hexo-util/lib/hash.js","hash":"95b9f5fe38c62a76eff26c6e9771a4267a0e284d","modified":1494515718550},{"_id":"themes/icarus/node_modules/hexo-util/lib/highlight.js","hash":"c7d5424d75ff0b6a2a8d3e349f4e2da2e54ea2fa","modified":1494515718649},{"_id":"themes/icarus/node_modules/hexo-util/lib/html_tag.js","hash":"38f1df0d200011332249bf599980f1476f723d9c","modified":1494515718675},{"_id":"themes/icarus/node_modules/hexo-util/lib/index.js","hash":"721f908f2c5e561a11cbee61f2f3b753066c1618","modified":1494515719101},{"_id":"themes/icarus/node_modules/hexo-util/lib/permalink.js","hash":"0ac9bb1eb47dcb79cff07a6631fe2714eac5fe1c","modified":1494515718796},{"_id":"themes/icarus/node_modules/hexo-util/lib/pattern.js","hash":"384485bf36b97513c7b61bff21af43570ca2c8fb","modified":1494515718740},{"_id":"themes/icarus/node_modules/hexo-util/lib/slugize.js","hash":"662f671305418218da6c22af093dafa90b21c674","modified":1494515718840},{"_id":"themes/icarus/node_modules/hexo-util/lib/spawn.js","hash":"8f3edb5b5268cf7d3abc1c86989d01da95f8a8f5","modified":1494515718877},{"_id":"themes/icarus/node_modules/hexo-util/lib/strip_html.js","hash":"f20be4f49702fd241dcbf65fa73f01ff42028550","modified":1494515718909},{"_id":"themes/icarus/node_modules/hexo-util/lib/truncate.js","hash":"102d57d757c88853ccc57e81747a843a0acb7eb7","modified":1494515719024},{"_id":"themes/icarus/node_modules/hexo-util/lib/word_wrap.js","hash":"68a9e133470558981bf038a75ef9f11c5145955b","modified":1494515719084},{"_id":"themes/icarus/node_modules/hexo-util/scripts/build_highlight_alias.js","hash":"8a999b74cd11da29e6092a26469b29a770981436","modified":1494515719118},{"_id":"themes/icarus/node_modules/highlight.js/docs/api.rst","hash":"7ea61691713b45ca2bba06ccd64d382d05296ccd","modified":1494515718189},{"_id":"themes/icarus/node_modules/highlight.js/docs/building-testing.rst","hash":"435f8700ad54ebdc199fea29bd5709cb50c16356","modified":1494515718624},{"_id":"themes/icarus/node_modules/highlight.js/docs/css-classes-reference.rst","hash":"639242ca0eaa4a055b47fa12740da8287bc7c74d","modified":1494515718328},{"_id":"themes/icarus/node_modules/highlight.js/docs/language-contribution.rst","hash":"755e23f46a3ff5d2f59ebef2a6c6d7a5317bcc40","modified":1494515718531},{"_id":"themes/icarus/node_modules/highlight.js/docs/language-guide.rst","hash":"5a7cf267ab1661bef71913c7d16167043e3d2657","modified":1494515718034},{"_id":"themes/icarus/node_modules/highlight.js/docs/language-requests.rst","hash":"d5de8f9936fa7450384696c4d2454e28c5102a6f","modified":1494515718652},{"_id":"themes/icarus/node_modules/highlight.js/docs/line-numbers.rst","hash":"fb2b891ec631ba4e18214d467114bfb026e42c5c","modified":1494515718693},{"_id":"themes/icarus/node_modules/highlight.js/docs/index.rst","hash":"64ff5bc891f7cc8bf28d987efe64328d981c6f25","modified":1494515718440},{"_id":"themes/icarus/node_modules/highlight.js/docs/release-process.rst","hash":"f33baf124c0d5fc87b00ba4d6a391ee8eff0900e","modified":1494515718774},{"_id":"themes/icarus/node_modules/highlight.js/docs/reference.rst","hash":"e43d2d965426401ff22c72b60fcfe77a08b745ed","modified":1494515718729},{"_id":"themes/icarus/node_modules/highlight.js/docs/style-guide.rst","hash":"6348488507d7deaf05b6c8c43470b033aef090d5","modified":1494515718828},{"_id":"themes/icarus/node_modules/highlight.js/lib/highlight.js","hash":"b7e74cd3626a38b9fa3e14ea310331e16e1d8df6","modified":1494515718895},{"_id":"themes/icarus/node_modules/highlight.js/lib/index.js","hash":"dbd975eca9f6bd306e3b0a0a984cd57b2af93c1e","modified":1494515718928},{"_id":"themes/icarus/node_modules/highlight.js/styles/androidstudio.css","hash":"958baa24814c06a625612a3b2b478d54bc1bf1b1","modified":1494515721881},{"_id":"themes/icarus/node_modules/highlight.js/styles/agate.css","hash":"8e122b0f00f5a7ec4e6dc492bf1560441eeef7f0","modified":1494515721659},{"_id":"themes/icarus/node_modules/highlight.js/styles/arduino-light.css","hash":"c6e05580b51b755e229e99eb156940ad2cab192b","modified":1494515721663},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-cave-dark.css","hash":"f397d4418ce88b998841fd9135242461ba1a79b5","modified":1494515721678},{"_id":"themes/icarus/node_modules/highlight.js/styles/ascetic.css","hash":"6358377b5c25667886aca0d605cbc497cf02405f","modified":1494515721672},{"_id":"themes/icarus/node_modules/highlight.js/styles/arta.css","hash":"17b23b9fa57ef7a05a6aaeea9b5feb5442a8e584","modified":1494515721668},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-cave-light.css","hash":"2933f0247ac6d84c2954dd4946e359853abbf70a","modified":1494515721689},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-dune-dark.css","hash":"081d73e454db140cd41b2bb595be297cfcab25e0","modified":1494515721693},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-dune-light.css","hash":"7ba074de897e6a5e27d8b97f7cd06c1746474e72","modified":1494515721698},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-estuary-dark.css","hash":"a0c46a0f955e3864f5e967ea93f5e61519a17be8","modified":1494515721703},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-estuary-light.css","hash":"91ae4668c15a085ffce15ca21e93da445b5ecf3a","modified":1494515721708},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-forest-dark.css","hash":"d8a4dc060b3fc719aa2f7d7b3f1019a3964b8101","modified":1494515721713},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-forest-light.css","hash":"8a78a4eea0f32d094d1f9e316d59e990ba739d97","modified":1494515721718},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-heath-dark.css","hash":"b93c2241ff123e62d4edb3dfc20410e4d1da3e78","modified":1494515721725},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-lakeside-dark.css","hash":"fa707b252d5d5caccc0589374522bed47b7ca100","modified":1494515721739},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-lakeside-light.css","hash":"8ba595b9ba6e8be6dc029bf80caab38e85aed686","modified":1494515721746},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-heath-light.css","hash":"172b98f783d213a20211ec6aca9a3840ba524f55","modified":1494515721731},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-plateau-dark.css","hash":"240f79f4e1fd63485c13900875b64c5a0d1bd06d","modified":1494515721753},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-plateau-light.css","hash":"9731db1052f23351c983210701edd3f5ceed343f","modified":1494515721761},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-savanna-light.css","hash":"6bd3a62c32558476d436bd389500e5fbeb693d67","modified":1494515721774},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-savanna-dark.css","hash":"09d45a218f87b8cb55b5ca7f4e9d76ea89a9404a","modified":1494515721768},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-seaside-dark.css","hash":"b2800804a21f729a3d0a16b3aadc17679fd0639c","modified":1494515721779},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-seaside-light.css","hash":"3e6b9e2a3a5de455490b8224401f19702df4cde9","modified":1494515721785},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-sulphurpool-dark.css","hash":"1f006f8bd28e2ffbb73f708769605ba766787fff","modified":1494515721791},{"_id":"themes/icarus/node_modules/highlight.js/styles/atelier-sulphurpool-light.css","hash":"0319c3eea893601b79b6c57652ef49b9222cc9de","modified":1494515721797},{"_id":"themes/icarus/node_modules/highlight.js/styles/atom-one-dark.css","hash":"a6d28e1c04cee20cd874fc7ac0903d8e2e4bd54e","modified":1494515721801},{"_id":"themes/icarus/node_modules/highlight.js/styles/atom-one-light.css","hash":"eda63d8cce440dbf3bb823e10577a134e9941deb","modified":1494515721806},{"_id":"themes/icarus/node_modules/highlight.js/styles/brown-paper.css","hash":"a6817d890e58f80ce79d87620791dae821a70fff","modified":1494515721810},{"_id":"themes/icarus/node_modules/highlight.js/styles/brown-papersq.png","hash":"3a1332ede3a75a3d24f60b6ed69035b72da5e182","modified":1494515721812},{"_id":"themes/icarus/node_modules/highlight.js/styles/codepen-embed.css","hash":"c4520e45d18259817b8942d17971f27c94f0fb09","modified":1494515721817},{"_id":"themes/icarus/node_modules/highlight.js/styles/color-brewer.css","hash":"96332573db854e7b7411caa94ba29b238fede2d3","modified":1494515721822},{"_id":"themes/icarus/node_modules/highlight.js/styles/darcula.css","hash":"7740224d07375ddc321147dffabbfa83e39f0d8b","modified":1494515721828},{"_id":"themes/icarus/node_modules/highlight.js/styles/dark.css","hash":"fc77519d4f5d731054c5d4b7e7bbdbb510833271","modified":1494515721834},{"_id":"themes/icarus/node_modules/highlight.js/styles/darkula.css","hash":"0be948bb84acc05f93a1e5e9b48fe34cf61673a0","modified":1494515721838},{"_id":"themes/icarus/node_modules/highlight.js/styles/default.css","hash":"fba68624d1b34a5543fe0bf4b2af2ac1ddf65e74","modified":1494515721844},{"_id":"themes/icarus/node_modules/highlight.js/styles/docco.css","hash":"1be7be09a1b927c22c7f11451becdb335145bdd2","modified":1494515721849},{"_id":"themes/icarus/node_modules/highlight.js/styles/dracula.css","hash":"2633f2e84680e9f381e9ac1df344b542e28f9774","modified":1494515721855},{"_id":"themes/icarus/node_modules/highlight.js/styles/far.css","hash":"67e0658b2376e91e4894636a3522a30c2aec42de","modified":1494515721860},{"_id":"themes/icarus/node_modules/highlight.js/styles/foundation.css","hash":"75b0674dd1ed35d61977bd5c35dc29ca35835a7b","modified":1494515721867},{"_id":"themes/icarus/node_modules/highlight.js/styles/github-gist.css","hash":"77cf684fda415812d6279a52f299c84850244778","modified":1494515721874},{"_id":"themes/icarus/node_modules/highlight.js/styles/github.css","hash":"ee593952684a791317ee8b77ad096e729dec649e","modified":1494515721653},{"_id":"themes/icarus/node_modules/highlight.js/styles/googlecode.css","hash":"fed3d439d0c305b337dd9c0f68dcbfa51429f445","modified":1494515721886},{"_id":"themes/icarus/node_modules/highlight.js/styles/grayscale.css","hash":"5688658c28fc5799517e8f3c224ae3da3797ba44","modified":1494515721892},{"_id":"themes/icarus/node_modules/highlight.js/styles/gruvbox-dark.css","hash":"aaf90d076e34bc44016462d70f83985e0e55c8dc","modified":1494515721898},{"_id":"themes/icarus/node_modules/highlight.js/styles/gruvbox-light.css","hash":"084699ab0aa326fede86e38bf41ebe49edde3a90","modified":1494515721904},{"_id":"themes/icarus/node_modules/highlight.js/styles/hopscotch.css","hash":"03e7b9ec74bbd375db8d476836aac3729a6c86e8","modified":1494515721910},{"_id":"themes/icarus/node_modules/highlight.js/styles/hybrid.css","hash":"1e2d54598b5f948b597059909d4bd158b7df021f","modified":1494515721916},{"_id":"themes/icarus/node_modules/highlight.js/styles/idea.css","hash":"164649ae1e7c891a0d88cca075521af28656e2a1","modified":1494515721922},{"_id":"themes/icarus/node_modules/highlight.js/styles/ir-black.css","hash":"95aad65ba77183500ce0f7ad62a7535b647ee20c","modified":1494515721927},{"_id":"themes/icarus/node_modules/highlight.js/styles/kimbie.dark.css","hash":"58ed061c204fbc09d221ee9135d66bad976e5fc3","modified":1494515721933},{"_id":"themes/icarus/node_modules/highlight.js/styles/kimbie.light.css","hash":"b7aa9b1b21a25dfefcac7649a328962f84c47913","modified":1494515721939},{"_id":"themes/icarus/node_modules/highlight.js/styles/magula.css","hash":"ebc291f90e456abeeccb16937e7f51735733f4f7","modified":1494515721945},{"_id":"themes/icarus/node_modules/highlight.js/styles/mono-blue.css","hash":"fd0f39cd4c93ccb8d0bb2f6a1f359522e15a89cb","modified":1494515721951},{"_id":"themes/icarus/node_modules/highlight.js/styles/monokai-sublime.css","hash":"e4f3df87cbfa634c86b489e9cc43acf44d415986","modified":1494515721956},{"_id":"themes/icarus/node_modules/highlight.js/styles/monokai.css","hash":"f69df92e3ccdce28e6f811ec84f11698f2811198","modified":1494515721962},{"_id":"themes/icarus/node_modules/highlight.js/styles/obsidian.css","hash":"6ed475813fe4886a58b236297862ff2f181e66f7","modified":1494515721968},{"_id":"themes/icarus/node_modules/highlight.js/styles/ocean.css","hash":"fce6858e1c5eb9d2857cb5b5d24069c5994cfc91","modified":1494515721974},{"_id":"themes/icarus/node_modules/highlight.js/styles/paraiso-dark.css","hash":"8f5445327ce3c83b62f6bf4c1a0d87fa6f036341","modified":1494515721981},{"_id":"themes/icarus/node_modules/highlight.js/styles/paraiso-light.css","hash":"6eb3ab7a3337f9cad3a2e5fa6bf7dd83685228d8","modified":1494515721987},{"_id":"themes/icarus/node_modules/highlight.js/styles/pojoaque.css","hash":"4e1e6a431212f5043a550474a1acda63362cdd6f","modified":1494515721994},{"_id":"themes/icarus/node_modules/highlight.js/styles/pojoaque.jpg","hash":"c5fe6533b88b21f8d90d3d03954c6b29baa67791","modified":1494515722000},{"_id":"themes/icarus/node_modules/highlight.js/styles/purebasic.css","hash":"f353a2cedf3f261a0676fce7c824bdd2e8197775","modified":1494515722006},{"_id":"themes/icarus/node_modules/highlight.js/styles/qtcreator_dark.css","hash":"213a40d203c4986cdbcb1bdf7d0b9013b29041ba","modified":1494515722013},{"_id":"themes/icarus/node_modules/highlight.js/styles/qtcreator_light.css","hash":"9a2a19ac2f6e6a7d5edd7fae67b7de4a3957e878","modified":1494515722019},{"_id":"themes/icarus/node_modules/highlight.js/styles/railscasts.css","hash":"a6d2043478fae5915926914cbd96fe9b706d98a6","modified":1494515722026},{"_id":"themes/icarus/node_modules/highlight.js/styles/rainbow.css","hash":"1b2d98ccdda36aa926d0e6d069b673fdacd2d33e","modified":1494515722032},{"_id":"themes/icarus/node_modules/highlight.js/styles/school-book.css","hash":"60fe3d8063b1acc4d52de02033095adb0a2b35a9","modified":1494515722040},{"_id":"themes/icarus/node_modules/highlight.js/styles/school-book.png","hash":"711ec983c874e093bb89eb77afcbdf6741fa61ee","modified":1494515722042},{"_id":"themes/icarus/node_modules/highlight.js/styles/solarized-dark.css","hash":"d02fc2dcbeec4b7af2cadec4bbbfc5b016aed4c7","modified":1494515722048},{"_id":"themes/icarus/node_modules/highlight.js/styles/solarized-light.css","hash":"6b70caf1e84d096b1bc6318d5dae78d69e5dd1d3","modified":1494515722054},{"_id":"themes/icarus/node_modules/highlight.js/styles/sunburst.css","hash":"8309eab2e5b1765dbee81a626baacbdad869b76a","modified":1494515722060},{"_id":"themes/icarus/node_modules/highlight.js/styles/tomorrow-night-blue.css","hash":"cd257d7d6a37cd5a09419b5f5f9d34b6b282423f","modified":1494515722066},{"_id":"themes/icarus/node_modules/highlight.js/styles/tomorrow-night-bright.css","hash":"04f0af30fdda5e5d6ebdeef5a860b6b7e49cfe89","modified":1494515722072},{"_id":"themes/icarus/node_modules/highlight.js/styles/tomorrow-night-eighties.css","hash":"d82b84bcda0588105dbbc0e8e8ba5e62c208a061","modified":1494515722078},{"_id":"themes/icarus/node_modules/highlight.js/styles/tomorrow-night.css","hash":"86264dd861d35a8b135f9fcb8ff2675e9fa69c16","modified":1494515722085},{"_id":"themes/icarus/node_modules/highlight.js/styles/tomorrow.css","hash":"163593ad70770d0296c5e643fa62e58e63f1b340","modified":1494515722091},{"_id":"themes/icarus/node_modules/highlight.js/styles/vs.css","hash":"2ac5e89ceb3d5a0e0fdab1ed6d9a411ec7d221aa","modified":1494515722096},{"_id":"themes/icarus/node_modules/highlight.js/styles/xcode.css","hash":"65d775a7e11e238c91e0d3c7370547348c92d6b3","modified":1494515722102},{"_id":"themes/icarus/node_modules/highlight.js/styles/xt256.css","hash":"bbe28ec69177699cb6300d777598adf6323f7861","modified":1494515722108},{"_id":"themes/icarus/node_modules/highlight.js/styles/zenburn.css","hash":"933a3b196d01254dea5e6f48105ea15e210ae000","modified":1494515722113},{"_id":"themes/icarus/node_modules/html-entities/lib/html4-entities.js","hash":"a96528844c399772b52fbbac531b405990b16e5f","modified":1494515718088},{"_id":"themes/icarus/node_modules/html-entities/lib/html5-entities.js","hash":"e596021d6845ca29a00a19e65bc8134b7a642101","modified":1494515718275},{"_id":"themes/icarus/node_modules/html-entities/lib/xml-entities.js","hash":"4cbf15e7e85a5d7b7af287f48efc75bf66701e1f","modified":1494515718424},{"_id":"themes/icarus/node_modules/isexe/test/basic.js","hash":"5ecbf6a46a596324cb23fdca6df539be08a4f4ee","modified":1494515718420},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/.name","hash":"25819fa8187fbc80a4c54f67ae05ebffa226f150","modified":1494515719039},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/encodings.xml","hash":"84a3e2826b2b347096020089807b162036f3fd3e","modified":1494515719058},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/jsLibraryMappings.xml","hash":"3900d881a4380ad08dce82639cea60ed24538b0a","modified":1494515719076},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/keyword-extractor.iml","hash":"b2c1dea5cbc868c8067425a81cca2d36c555645e","modified":1494515719097},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/misc.xml","hash":"24b557cec899d489dc38dc5613811262f8643c9c","modified":1494515719133},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/modules.xml","hash":"62cbada10a437f44be92524e1e52b95c54e7bb00","modified":1494515719156},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/vcs.xml","hash":"1fc34617f0e3c1b12f38b5bfa9a106c9239a01c1","modified":1494515719184},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/workspace.xml","hash":"5d1d329f7aab2e0074d0c6681bbf2337a6936616","modified":1494515719203},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/keyword_extractor.js","hash":"9607a777594f87de04bb43bb30a36bc815964913","modified":1494515718241},{"_id":"themes/icarus/node_modules/lru-cache/lib/lru-cache.js","hash":"eeb0f7c231e04d00540d0733077c28f1bc122d89","modified":1494515718050},{"_id":"themes/icarus/node_modules/moment/locale/ar-dz.js","hash":"8ed876ceb5269384967227f01bc9fd1c7c1bc3df","modified":1494515721503},{"_id":"themes/icarus/node_modules/moment/locale/af.js","hash":"5679c3bcb6cf348d358796d954b1cf49ebba5dac","modified":1494515719599},{"_id":"themes/icarus/node_modules/moment/locale/ar-kw.js","hash":"6acc08663e76ef305e1932250be0ecedc46405bd","modified":1494515721484},{"_id":"themes/icarus/node_modules/moment/locale/ar-ly.js","hash":"6338f60b2a2680230c1505d9213f3bd56c7c3e39","modified":1494515721463},{"_id":"themes/icarus/node_modules/moment/locale/ar-ma.js","hash":"203e1254860b538ee1c6cbd8e422334579927015","modified":1494515721442},{"_id":"themes/icarus/node_modules/moment/locale/ar-sa.js","hash":"94e17222ffccf5303ea43310f19ad318384a9fd5","modified":1494515721423},{"_id":"themes/icarus/node_modules/moment/locale/ar-tn.js","hash":"55592ee0257fbf66b2735687e61d87abcdab3f3e","modified":1494515721401},{"_id":"themes/icarus/node_modules/moment/locale/ar.js","hash":"10f774fd71531f561f5d62fe4586979b26107240","modified":1494515721383},{"_id":"themes/icarus/node_modules/moment/locale/az.js","hash":"3b4ce5e44bf58dd87f476ff52c41358a87781500","modified":1494515721361},{"_id":"themes/icarus/node_modules/moment/locale/be.js","hash":"672d84d9595de5afb341bdc284b190af5b712160","modified":1494515721341},{"_id":"themes/icarus/node_modules/moment/locale/bg.js","hash":"a0fbc948af83f708e34b8bfcdee26b7e906180d0","modified":1494515721313},{"_id":"themes/icarus/node_modules/moment/locale/bn.js","hash":"82f32aff8bd22b1afbe25472a2d0b0230eef64a1","modified":1494515721271},{"_id":"themes/icarus/node_modules/moment/locale/bo.js","hash":"1b76777fe9052bfe51cfb30977bf0b7db9ba6b6f","modified":1494515721241},{"_id":"themes/icarus/node_modules/moment/locale/br.js","hash":"b7f3733a5127de9c488d6716e521c51376786944","modified":1494515721212},{"_id":"themes/icarus/node_modules/moment/locale/bs.js","hash":"3280c8bcd07b2c4b74cec8f22cad62458c803a4b","modified":1494515721181},{"_id":"themes/icarus/node_modules/moment/locale/ca.js","hash":"2cfe3bbd457ab908ab6425f8644747b8643cfc75","modified":1494515721149},{"_id":"themes/icarus/node_modules/moment/locale/cs.js","hash":"cfed3392a92bca867d78cc6d0b8c83888b590a98","modified":1494515721119},{"_id":"themes/icarus/node_modules/moment/locale/cv.js","hash":"6e4db5d85461838ba777bd64ab9ae83cfa01550d","modified":1494515721089},{"_id":"themes/icarus/node_modules/moment/locale/cy.js","hash":"8d267ec8e982810fde82d99da7121fa48537d3a1","modified":1494515721064},{"_id":"themes/icarus/node_modules/moment/locale/da.js","hash":"193194a5af6b9f116b77dede6ccf119e2ee5641b","modified":1494515721038},{"_id":"themes/icarus/node_modules/moment/locale/de-at.js","hash":"81555649d13cb9e1124fc2dbc96eec759a1b0262","modified":1494515721010},{"_id":"themes/icarus/node_modules/moment/locale/de-ch.js","hash":"1187f862a48cad8fb439560e41cb978a74e60293","modified":1494515720983},{"_id":"themes/icarus/node_modules/moment/locale/de.js","hash":"662cfbcf4306d9c73590fa3f37fe24c0fb58bac6","modified":1494515720958},{"_id":"themes/icarus/node_modules/moment/locale/dv.js","hash":"d5e2757cfb5556e55fabb900bb63a81683016402","modified":1494515720929},{"_id":"themes/icarus/node_modules/moment/locale/el.js","hash":"ab0118f14e5509b7147e01e743b5af8ed4ad98c0","modified":1494515720896},{"_id":"themes/icarus/node_modules/moment/locale/en-au.js","hash":"abf883bc152bdc8969f21fbd7cddf64573f6a3d1","modified":1494515720859},{"_id":"themes/icarus/node_modules/moment/locale/en-ca.js","hash":"7e9b179190b4d3f9e7c36d4eb8e80caa3684e655","modified":1494515720829},{"_id":"themes/icarus/node_modules/moment/locale/en-gb.js","hash":"29ab0baf84c97c8f4e57c066facc9cdd38053314","modified":1494515720803},{"_id":"themes/icarus/node_modules/moment/locale/en-ie.js","hash":"119dc4c30b16570c2afce1ff645550778722f1bb","modified":1494515720775},{"_id":"themes/icarus/node_modules/moment/locale/en-nz.js","hash":"66f6c7da40d7998e6f3b7c40b408be0fc740342b","modified":1494515720748},{"_id":"themes/icarus/node_modules/moment/locale/eo.js","hash":"f8ff0d15c6b26e6755d3e04e0ad370b91bc2b841","modified":1494515720724},{"_id":"themes/icarus/node_modules/moment/locale/es-do.js","hash":"b70b2d9c7df891d67e1c9a9c01f17113f98e8c05","modified":1494515720695},{"_id":"themes/icarus/node_modules/moment/locale/es.js","hash":"8967f31f73619dec1bfe55b6d8cd090e5eba947f","modified":1494515720654},{"_id":"themes/icarus/node_modules/moment/locale/et.js","hash":"a348581076cb7f10e15e51ba79c4621a3a3b6a53","modified":1494515720624},{"_id":"themes/icarus/node_modules/moment/locale/eu.js","hash":"b8de2d4d12407c76f46498e031295a3ba3bb5969","modified":1494515720595},{"_id":"themes/icarus/node_modules/moment/locale/fa.js","hash":"9dfd4cc1ddbcf0c5b94daba27c646cc6afa74fcd","modified":1494515720566},{"_id":"themes/icarus/node_modules/moment/locale/fi.js","hash":"8eeb5da3920219c4bfd47fe2b721ef2b7ada11f1","modified":1494515720527},{"_id":"themes/icarus/node_modules/moment/locale/fo.js","hash":"4f1a2c1703b85ecc94e51adbd8979c21251bc0f8","modified":1494515720491},{"_id":"themes/icarus/node_modules/moment/locale/fr-ca.js","hash":"7318bb4f6cab40041686842cf934d6675215613a","modified":1494515720462},{"_id":"themes/icarus/node_modules/moment/locale/fr-ch.js","hash":"c29ac4e9f5166b0c87c02e69ada7e2bf172c5066","modified":1494515720429},{"_id":"themes/icarus/node_modules/moment/locale/fr.js","hash":"09f34816b44973de6512958fefe980dad7918eb1","modified":1494515720399},{"_id":"themes/icarus/node_modules/moment/locale/fy.js","hash":"4f72bfa849db077c0f295a7d2053e5fed5c01d13","modified":1494515720354},{"_id":"themes/icarus/node_modules/moment/locale/gd.js","hash":"69463180c2a1621098f4bbb7ab40a5ae5fb8a840","modified":1494515720323},{"_id":"themes/icarus/node_modules/moment/locale/gl.js","hash":"97aa7237c5dd9b366a8d8a00ed0f6c4123d64968","modified":1494515720263},{"_id":"themes/icarus/node_modules/moment/locale/gom-latn.js","hash":"ce61962e9008eeac5bdc600f85e5ca262772321d","modified":1494515720226},{"_id":"themes/icarus/node_modules/moment/locale/he.js","hash":"706b57fb51ce50224466aba3318b9ed70f579715","modified":1494515720183},{"_id":"themes/icarus/node_modules/moment/locale/hi.js","hash":"8a6e67ae5952f1a787d44b9aa2b300264b3885ab","modified":1494515720144},{"_id":"themes/icarus/node_modules/moment/locale/hr.js","hash":"231307c101168c64373a4bd4f9bd7d3b84c8ffe3","modified":1494515720081},{"_id":"themes/icarus/node_modules/moment/locale/hu.js","hash":"45cc13231286192424b7cedb584f27798ce0ec6b","modified":1494515720040},{"_id":"themes/icarus/node_modules/moment/locale/hy-am.js","hash":"f92ac95edbd740729859d9ef5abec6f1d8dc5a7e","modified":1494515720000},{"_id":"themes/icarus/node_modules/moment/locale/id.js","hash":"1db74050b089cf24dc23fc6b9ceae79f9a08885f","modified":1494515719962},{"_id":"themes/icarus/node_modules/moment/locale/is.js","hash":"bf3336374dd0e078c06a3d4700d00e85df1951c5","modified":1494515719927},{"_id":"themes/icarus/node_modules/moment/locale/it.js","hash":"903a7f0f0d9528a0b0cb3f30f54fed69dfb4d5fa","modified":1494515719890},{"_id":"themes/icarus/node_modules/moment/locale/ja.js","hash":"b391958332c3973a5fcd424e0e8cf65f0cea11fd","modified":1494515719709},{"_id":"themes/icarus/node_modules/moment/locale/jv.js","hash":"10da9d15a37382aa8426962f605fd830f808b6f7","modified":1494515719631},{"_id":"themes/icarus/node_modules/moment/locale/ka.js","hash":"ed8c5dd8a1d95e59f182d44ba675eb3db1d2321a","modified":1494515719659},{"_id":"themes/icarus/node_modules/moment/locale/kk.js","hash":"d70f987cdc477d46b61b14a7f3287d1569ab28a3","modified":1494515719686},{"_id":"themes/icarus/node_modules/moment/locale/km.js","hash":"192fa102b0b4540bc2fbf35e06e2f626568574dd","modified":1494515721521},{"_id":"themes/icarus/node_modules/moment/locale/kn.js","hash":"80013877bb46e1769edb9a118bc4716291a36fd0","modified":1494515719761},{"_id":"themes/icarus/node_modules/moment/locale/ko.js","hash":"4fad7a689c9b287948b26c7b8772169233b0a7d0","modified":1494515719792},{"_id":"themes/icarus/node_modules/moment/locale/ky.js","hash":"2489963d5be92ce6e13eda11d774134f590fed59","modified":1494515719818},{"_id":"themes/icarus/node_modules/moment/locale/lb.js","hash":"a4932181ec3d885736945f5d9498515cad6b4003","modified":1494515719843},{"_id":"themes/icarus/node_modules/moment/locale/lo.js","hash":"43bfebf20ce8964c13862ed23083af21240193f1","modified":1494515719872},{"_id":"themes/icarus/node_modules/moment/locale/lt.js","hash":"172312cab51e0103cd5bfb29f9cab5f153706355","modified":1494515719910},{"_id":"themes/icarus/node_modules/moment/locale/lv.js","hash":"7a1c2849b50ba14cdbd1473d897014d0b5074154","modified":1494515719945},{"_id":"themes/icarus/node_modules/moment/locale/me.js","hash":"b30faba3dd9892340f0ae0b710023898ec48e41d","modified":1494515719981},{"_id":"themes/icarus/node_modules/moment/locale/mi.js","hash":"7267644621dab92608f059033e901df06c1861b0","modified":1494515720016},{"_id":"themes/icarus/node_modules/moment/locale/mk.js","hash":"4ce84896e076d28799d8ed0cf3f16a2738c45606","modified":1494515720061},{"_id":"themes/icarus/node_modules/moment/locale/ml.js","hash":"762ac191e2ea8848e8f0296c366c51359536fb45","modified":1494515720115},{"_id":"themes/icarus/node_modules/moment/locale/mr.js","hash":"b31c184d26375840b74043ea4587ae531cb0487b","modified":1494515720163},{"_id":"themes/icarus/node_modules/moment/locale/ms-my.js","hash":"9dea850f3db38cc2fe666bc9b410b78ad60eb429","modified":1494515720199},{"_id":"themes/icarus/node_modules/moment/locale/ms.js","hash":"c4a03624a960e3cc4f1a2f387be69f9c21e05396","modified":1494515720243},{"_id":"themes/icarus/node_modules/moment/locale/my.js","hash":"c39d41aa5b5fe1b153fe2775d9b718b7a64bab6a","modified":1494515720306},{"_id":"themes/icarus/node_modules/moment/locale/nb.js","hash":"d4e7e73a51d9db86257c86375ad9f44cb93a858e","modified":1494515720338},{"_id":"themes/icarus/node_modules/moment/locale/ne.js","hash":"3700332e12d40c01f70ea496b7f7c430161c9a3e","modified":1494515720377},{"_id":"themes/icarus/node_modules/moment/locale/nl-be.js","hash":"693320390dcb605ef15824aaf5b98f10ddf7eb56","modified":1494515720415},{"_id":"themes/icarus/node_modules/moment/locale/nl.js","hash":"dcbee1a2991bd3b56b00c8b119337fdeffad48ef","modified":1494515720447},{"_id":"themes/icarus/node_modules/moment/locale/nn.js","hash":"b9ee2d4f707bd2a954d88719fc74502f0bb963d8","modified":1494515720476},{"_id":"themes/icarus/node_modules/moment/locale/pa-in.js","hash":"db49adc9cd457831085de4d634c5140583ca8b6e","modified":1494515720510},{"_id":"themes/icarus/node_modules/moment/locale/pl.js","hash":"52ea684720e6fcfdbcdae586161d4c01e9b541c2","modified":1494515720545},{"_id":"themes/icarus/node_modules/moment/locale/pt-br.js","hash":"1a25c722d0f8cdd0a3b7e51e808f02184c622b7d","modified":1494515720581},{"_id":"themes/icarus/node_modules/moment/locale/pt.js","hash":"0e010526efb9965a05ce27f1755e0c0b76e69500","modified":1494515720611},{"_id":"themes/icarus/node_modules/moment/locale/ro.js","hash":"bee0b735f7cda8cb7e2a8344fd54a96753c98b38","modified":1494515720638},{"_id":"themes/icarus/node_modules/moment/locale/ru.js","hash":"7195e3de206ebd43f2625ade7f7d6db4196e4f6e","modified":1494515720674},{"_id":"themes/icarus/node_modules/moment/locale/sd.js","hash":"a4140d358aaf45444977034f50298853d0dc1107","modified":1494515720713},{"_id":"themes/icarus/node_modules/moment/locale/se.js","hash":"6db433cf0a52742624ee2d1d13fbb8058be2d8ab","modified":1494515720736},{"_id":"themes/icarus/node_modules/moment/locale/si.js","hash":"c6d2255be5f41a1ae324eaab50363f6b8baa4ee3","modified":1494515720763},{"_id":"themes/icarus/node_modules/moment/locale/sk.js","hash":"0c1dd7a5044d7972741d257207dc169cb69a5ca7","modified":1494515720790},{"_id":"themes/icarus/node_modules/moment/locale/sl.js","hash":"e72755bb590fb25d8f692392415e5676f33118ae","modified":1494515720815},{"_id":"themes/icarus/node_modules/moment/locale/sq.js","hash":"013d056702dbe5de4d6caffa63de6af8210b9b05","modified":1494515720844},{"_id":"themes/icarus/node_modules/moment/locale/sr-cyrl.js","hash":"2667d5d980263d194782511d521387dee0c613f4","modified":1494515720875},{"_id":"themes/icarus/node_modules/moment/locale/sr.js","hash":"8d66c7cc5a5081eda6b568b1544e951e9f2751f8","modified":1494515720912},{"_id":"themes/icarus/node_modules/moment/locale/ss.js","hash":"54db50fc0ce0f395ce7b0ce3b13e46dada56403b","modified":1494515720943},{"_id":"themes/icarus/node_modules/moment/locale/sv.js","hash":"5d11438be241657c347ec8941133baac1d38598d","modified":1494515720971},{"_id":"themes/icarus/node_modules/moment/locale/sw.js","hash":"ae13614c9577f810a5e0b38788c2e707bc042156","modified":1494515720997},{"_id":"themes/icarus/node_modules/moment/locale/ta.js","hash":"256303594448d67360b8a99db6842879d5cf3425","modified":1494515721026},{"_id":"themes/icarus/node_modules/moment/locale/te.js","hash":"8e8f8455ac9b0b19d7cf55240ce69a7f2ef43251","modified":1494515721052},{"_id":"themes/icarus/node_modules/moment/locale/tet.js","hash":"b09f4261273617e8829ed825f985a7d5fe2a1440","modified":1494515721076},{"_id":"themes/icarus/node_modules/moment/locale/th.js","hash":"61ea79ee6bfd6d84a90963c134a69c4edc685299","modified":1494515721104},{"_id":"themes/icarus/node_modules/moment/locale/tl-ph.js","hash":"9e145781cf7fbe7443c7f7f0ccea2e6332f048eb","modified":1494515721132},{"_id":"themes/icarus/node_modules/moment/locale/tlh.js","hash":"4e9b4c5cc8aeda2e070409dced22877130014030","modified":1494515721165},{"_id":"themes/icarus/node_modules/moment/locale/tr.js","hash":"4585730b4216937bdee7d2d1f4376666c9d54f7a","modified":1494515721195},{"_id":"themes/icarus/node_modules/moment/locale/tzl.js","hash":"5df2b58b41aecfab1e5bc2a715fe3e501a47beee","modified":1494515721227},{"_id":"themes/icarus/node_modules/moment/locale/tzm-latn.js","hash":"761c4120b3a30f0944ae45f4551a714a5a0be8aa","modified":1494515721254},{"_id":"themes/icarus/node_modules/moment/locale/tzm.js","hash":"a78a9c65351cfbe039e931a61ce831659a7d549d","modified":1494515721284},{"_id":"themes/icarus/node_modules/moment/locale/uk.js","hash":"bd0e7d123f81979a30b6d620ea694883b5947925","modified":1494515721328},{"_id":"themes/icarus/node_modules/moment/locale/ur.js","hash":"54017a10a82bd9645b6deddcdc17ea6d41462430","modified":1494515721351},{"_id":"themes/icarus/node_modules/moment/locale/uz-latn.js","hash":"113bfdf91a3099bfe5493597d9c309d9829b2f01","modified":1494515721369},{"_id":"themes/icarus/node_modules/moment/locale/uz.js","hash":"15442d9fb0733ba3bbfdabcd7c6ed28c79dbe02c","modified":1494515721393},{"_id":"themes/icarus/node_modules/moment/locale/vi.js","hash":"835924f37068a44be0cb6d523b168fce7bcc6a08","modified":1494515721410},{"_id":"themes/icarus/node_modules/moment/locale/x-pseudo.js","hash":"071fa52007f217e961eb9aad718f9a619775fd71","modified":1494515721432},{"_id":"themes/icarus/node_modules/moment/locale/yo.js","hash":"5e898753016067e88da4df7204ecefd7f6b421b2","modified":1494515721449},{"_id":"themes/icarus/node_modules/moment/locale/zh-cn.js","hash":"8caa15e4ec3aa1123b137542b842584f92fdf16f","modified":1494515721474},{"_id":"themes/icarus/node_modules/moment/locale/zh-hk.js","hash":"33641e3629b9e12f5a77c5f1d38309e38f0a887f","modified":1494515721494},{"_id":"themes/icarus/node_modules/moment/locale/zh-tw.js","hash":"c49d9aba893d858ed4e5c131ebe914b86281b6ba","modified":1494515721513},{"_id":"themes/icarus/node_modules/moment/src/moment.js","hash":"f5b1584e202354b7e4ed6f91c11baeb113c56576","modified":1494515721547},{"_id":"themes/icarus/node_modules/moment/min/moment.min.js","hash":"32fdf6730be34538e09378ec6cc55229d9a70151","modified":1494515719578},{"_id":"themes/icarus/node_modules/no-case/vendor/camel-case-regexp.js","hash":"2614bb1d67a0994aab917ce1fb9d55ccf33d0945","modified":1494515718172},{"_id":"themes/icarus/node_modules/no-case/vendor/camel-case-upper-regexp.js","hash":"1d52647770d061bb0156a1c1eba7d66b5a9bb0ec","modified":1494515718310},{"_id":"themes/icarus/node_modules/no-case/vendor/non-word-regexp.js","hash":"921f144a87b5cab2d484a2c256889fc2bed08268","modified":1494515718435},{"_id":"themes/icarus/node_modules/pseudomap/test/basic.js","hash":"dccd686c9c0f397d56318e99c89fa29fe4db84c2","modified":1494515718201},{"_id":"themes/icarus/node_modules/striptags/test/striptags-test.js","hash":"126a9fe92edf65aaa18646fb7d0851dac7c9de9a","modified":1494515718436},{"_id":"themes/icarus/node_modules/underscore.string/dist/underscore.string.min.js","hash":"d9d13d390cbc4422b16a519532491467d938f618","modified":1494515718386},{"_id":"themes/icarus/node_modules/underscore.string/lib/underscore.string.js","hash":"78cd42aa76fc0aedf1d4c87acf5d0dc65df09af1","modified":1494515718557},{"_id":"themes/icarus/node_modules/underscore.string/test/run-qunit.js","hash":"7a2f386db195670628c3d66d229327ebc02dab40","modified":1494515718693},{"_id":"themes/icarus/node_modules/underscore.string/test/speed.js","hash":"1679135dec8aa60e5e8ef8a99c689eec1af61389","modified":1494515718774},{"_id":"themes/icarus/node_modules/underscore.string/test/strings.js","hash":"13f980b52f29d393d3dbc5e70aa4f6a7f31d72bd","modified":1494515718849},{"_id":"themes/icarus/node_modules/underscore.string/test/strings_standalone.js","hash":"d68f872a3522bf6898981a4a95cfaf2f709c66e1","modified":1494515718876},{"_id":"themes/icarus/node_modules/underscore.string/test/test.html","hash":"59ba8455b0abcbcecea5af7dc9daece4621b88d1","modified":1494515719014},{"_id":"themes/icarus/node_modules/underscore.string/test/test_standalone.html","hash":"86605f225d9d22a42e9df65360ee95dbd7ac98db","modified":1494515719043},{"_id":"themes/icarus/node_modules/underscore.string/test/underscore.js","hash":"934a4bcb13026508e16223cf9f00bb4a38c321f1","modified":1494515718967},{"_id":"themes/icarus/node_modules/which/bin/which","hash":"5b6b3e1838316fb3f1b3b4194cdf49db0674eb17","modified":1494515718154},{"_id":"themes/icarus/source/css/_highlight/agate.styl","hash":"601eb70448a16b918df132f6fc41e891ae053653","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/androidstudio.styl","hash":"65d09f1b0e81c6a182f549fd3de51e59823c97ae","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/ascetic.styl","hash":"32cff3bef6fac3760fe78f203096477052a90552","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/arduino-light.styl","hash":"15e8572585cd708221c513dea4bdd89d8fe56c10","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/arta.styl","hash":"1a5accc115f41d1b669ed708ac6a29abac876599","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-cave-dark.styl","hash":"bc647b2c1d971d7cc947aa1ed66e9fd115261921","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-cave-light.styl","hash":"a5be0744a7ecf4a08f600ade4cfd555afc67bc15","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-dune-dark.styl","hash":"df50a85a4b14c7ca6e825d665594b91229d0e460","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-estuary-dark.styl","hash":"d84382bc8298f96730757391d3e761b7e640f406","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-dune-light.styl","hash":"931435fbc6f974e8ce9e32722680035d248a9dc1","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-estuary-light.styl","hash":"344276ca9b27e51d4c907f76afe5d13cf8e60bdf","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-forest-light.styl","hash":"95228d9f2102fad425536aac44b80b2cba1f5950","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-forest-dark.styl","hash":"57c154c6045a038dc7df0a25927853e10bf48c4a","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-heath-dark.styl","hash":"b0cf13b2233e7bc38342032d2d7296591a4c2bcf","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-lakeside-dark.styl","hash":"bb0a8c4ad0dd8e3e7de7122ddf268fc42aa94acb","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-heath-light.styl","hash":"8c8c2e445abef85273be966d59770e9ced6aac21","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-lakeside-light.styl","hash":"2c54cb9bdb259ae3b5b29f63ac2469ed34b08578","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-plateau-dark.styl","hash":"09c64f1a7052aec9070c36c0431df25216afaea1","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-plateau-light.styl","hash":"d1a05fdd1ededc9063d181ab25bad55a164aeb4a","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-savanna-dark.styl","hash":"a16c919a1ccf2f845488078fb341381bec46b1f3","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-savanna-light.styl","hash":"f8244c93711c7cb59dd79d2df966806b30d171ea","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-seaside-dark.styl","hash":"ce233a101daea7124cbfcd34add43ccfe2e1e1c7","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-seaside-light.styl","hash":"0597342da6e2d0c5bdcc7d42dabb07322b1a4177","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-sulphurpool-dark.styl","hash":"414b0cfc142f70afe359c16450b651e28bf7325a","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/atelier-sulphurpool-light.styl","hash":"efa52713efc468abeeb2b9299704371583b857de","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/brown-paper.styl","hash":"c2326ba20a5020a66ca7895258d18833327d4334","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/brown-papersq.png","hash":"3a1332ede3a75a3d24f60b6ed69035b72da5e182","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/codepen-embed.styl","hash":"f4dcc84d8e39f9831a5efe80e51923fc3054feb0","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/color-brewer.styl","hash":"2a439d6214430e2f45dd4939b4dfe1fe1a20aa0f","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/dark.styl","hash":"71ce56d311cc2f3a605f6e2c495ccd7236878404","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/darkula.styl","hash":"ad0d5728d21645039c9f199e7a56814170ed3bab","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/docco.styl","hash":"b1c176378bb275f2e8caa759f36294e42d614bf1","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/far.styl","hash":"d9928010ffe71e80b97a5afcba1a4975efdd7372","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/foundation.styl","hash":"bf8ddc94b4ad995b8b8805b5a4cf95004553fdac","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/github-gist.styl","hash":"48211a03d33e7f7ada0b261162bea06676155a71","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/github.styl","hash":"3336aeba324c6d34a6fd41fef9b47bc598f7064c","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/googlecode.styl","hash":"bda816beee7b439814b514e6869dc678822be1bc","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/grayscale.styl","hash":"bf37d8b8d1e602126c51526f0cc28807440228ed","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/highlightjs.styl","hash":"0e198b7a59191c7a39b641a4ddd22c948edb9358","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/hopscotch.styl","hash":"b374c6550b89b4751aedc8fbc3cf98d95bd70ead","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/hybrid.styl","hash":"ea8d7ddc258b073308746385f5cb85aabb8bfb83","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/idea.styl","hash":"a02967cb51c16a34e0ee895d33ded2b823d35b21","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/index.styl","hash":"002d5596f6379cc87dbd43d9145bc764aa666be1","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/ir-black.styl","hash":"693078bbd72a2091ed30f506cc55949600b717af","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/kimbie.dark.styl","hash":"45dbb168f22d739d0109745d2decd66b5f94e786","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/kimbie.light.styl","hash":"61f8baed25be05288c8604d5070afbcd9f183f49","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/magula.styl","hash":"16d323f989b1420a0f72ef989242ece9bf17a456","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/mono-blue.styl","hash":"4c89a6ae29de67c0700585af82a60607e85df928","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/monokai-sublime.styl","hash":"25aa2fc1dbe38593e7c7ebe525438a39574d9935","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/monokai.styl","hash":"5a4fe9f957fd7a368c21b62a818403db4270452f","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/obsidian.styl","hash":"55572bbcfee1de6c31ac54681bb00336f5ae826d","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/paraiso-dark.styl","hash":"f1537bd868579fa018ecdbfd2eb922dcf3ba2cac","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/paraiso-light.styl","hash":"d224d1df0eb3395d9eea1344cee945c228af2911","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/pojoaque.jpg","hash":"c5fe6533b88b21f8d90d3d03954c6b29baa67791","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/pojoaque.styl","hash":"77dae9dc41945359d17fe84dbd317f1b40b2ee33","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/railscasts.styl","hash":"acd620f8bb7ff0e3fe5f9a22b4433ceef93a05e6","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/rainbow.styl","hash":"ce73b858fc0aba0e57ef9fb136c083082746bc1d","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/school-book.png","hash":"711ec983c874e093bb89eb77afcbdf6741fa61ee","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/school-book.styl","hash":"d43560fe519a931ce6da7d57416d7aa148441b83","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/solarized-dark.styl","hash":"702b9299a48c90124e3ac1d45f1591042f2beccc","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/solarized-light.styl","hash":"aa0dd3fd25c464183b59c5575c9bee8756b397f2","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-blue.styl","hash":"8b3087d4422be6eb800935a22eb11e035341c4ba","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/sunburst.styl","hash":"a0b5b5129547a23865d400cfa562ea0ac1ee3958","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-bright.styl","hash":"0ac6af6ecb446b5b60d6226748e4a6532db34f57","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night-eighties.styl","hash":"fa57b3bb7857a160fc856dbe319b31e30cc5d771","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/tomorrow-night.styl","hash":"19b3080d4b066b40d50d7e7f297472482b5801fd","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/tomorrow.styl","hash":"15779cf6846725c7c35fc56cac39047d7e0aec1c","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/vs.styl","hash":"959a746f4b37aacb5d1d6ff1d57e0c045289d75d","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/xcode.styl","hash":"5e8532ae8366dcf6a4ef5e4813dc3d42ab3d0a50","modified":1491956064000},{"_id":"themes/icarus/source/css/_highlight/zenburn.styl","hash":"fc5ec840435dad80964d04519d3f882ddc03746a","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/archive.styl","hash":"d35088c83ddd7a197d6d94e16a2ce3a7e29fa1dc","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/header.styl","hash":"1e351f741144135871a3373fe7e969dc961b65e7","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/comment.styl","hash":"784646796184d4f27918c22395288a2fafbf9554","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/insight.styl","hash":"19833cd127f26ad90b06c115f8a96a30e0c0e53b","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/profile.styl","hash":"fb0170075dc2a41e01dd11bbfdbccbed544c479a","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/sidebar.styl","hash":"f528ca7064d9fcecd737b9b71c9c54601365d7d3","modified":1491956064000},{"_id":"themes/icarus/source/css/_partial/timeline.styl","hash":"c813b98f4fc45b64d2e07e5d944745a654c8c943","modified":1491956064000},{"_id":"themes/icarus/source/css/_util/grid.styl","hash":"93fb6f1e2f40cd7d88ad0d56dd73d3f9a7bc853e","modified":1491956064000},{"_id":"themes/icarus/source/css/_util/mixin.styl","hash":"c8e1ddfc0fe9108bab592c7a73b73ce9344991fd","modified":1491956064000},{"_id":"themes/icarus/source/css/images/logo.png","hash":"59743fefa9caa597b0ce3e7dfd7573ac15992697","modified":1506347065330},{"_id":"themes/icarus/source/css/images/thumb-default-small.png","hash":"c37e683d36aeb2e908b2fefa94d6e352aea6d7c1","modified":1506347662933},{"_id":"themes/icarus/source/css/_partial/article.styl","hash":"ad5bb891aea432a81b628932e8ba61e7f597467e","modified":1494759206648},{"_id":"themes/icarus/source/css/images/wonderomg.png","hash":"e289686c90e376e72874fd21bd23838a3b536d6b","modified":1506347028960},{"_id":"themes/icarus/source/css/_partial/footer.styl","hash":"484776654e4c1691dc844e6e93786a08855c1c99","modified":1491956064000},{"_id":"themes/icarus/source/libs/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1491956064000},{"_id":"themes/icarus/source/libs/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/styles.css","hash":"5ca6e111046232bde112d33201a60532aee7d3c4","modified":1491956064000},{"_id":"themes/icarus/source/libs/source-code-pro/styles.css","hash":"93c308012738728f906cd4c5cfdb34189e0c712b","modified":1491956064000},{"_id":"themes/icarus/.git/logs/refs/heads/master","hash":"3415dfda0ba4424ccc9a98522ecaad57e92d8b1c","modified":1494427981701},{"_id":"themes/icarus/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1494427981619},{"_id":"themes/icarus/.git/refs/remotes/origin/master","hash":"58b2233be98194dcfbb24adeff1b6c1d4b558fff","modified":1516257378477},{"_id":"themes/icarus/node_modules/bluebird/js/browser/bluebird.core.min.js","hash":"4d410cd630a354c09f2ce0c595a3c4d699153470","modified":1494515718623},{"_id":"themes/icarus/node_modules/bluebird/js/release/any.js","hash":"424dfe2a1afeaad729ca2be5ccfd443311716c41","modified":1494515719029},{"_id":"themes/icarus/node_modules/bluebird/js/release/assert.js","hash":"da909f13035601fbcdc3a28937dd44e3008327ee","modified":1494515720299},{"_id":"themes/icarus/node_modules/bluebird/js/release/bind.js","hash":"6ba64f83e985a1cb7dcf945490e4c280460ccb25","modified":1494515720178},{"_id":"themes/icarus/node_modules/bluebird/js/release/async.js","hash":"18b0242372dcdf745ae68b6c0f193b6fb2f40b96","modified":1494515720251},{"_id":"themes/icarus/node_modules/bluebird/js/release/bluebird.js","hash":"f68f4e491f49be5a5a3c5d04fafcd8abaf02fc2a","modified":1494515720135},{"_id":"themes/icarus/node_modules/bluebird/js/release/call_get.js","hash":"b53dcc39da361dbc72a49ced90d5290d94c70b80","modified":1494515720080},{"_id":"themes/icarus/node_modules/bluebird/js/release/cancel.js","hash":"1a6c901863d671048f58095fe9b568b2a8407729","modified":1494515719977},{"_id":"themes/icarus/node_modules/bluebird/js/release/catch_filter.js","hash":"cbdedec0db19fe2af76d5594ed8bf819000d7c79","modified":1494515719919},{"_id":"themes/icarus/node_modules/bluebird/js/release/debuggability.js","hash":"62e0ea2d37c5b359f036f8ea08354feb54135dc7","modified":1494515719798},{"_id":"themes/icarus/node_modules/bluebird/js/release/context.js","hash":"ea7eb1ab2c8231fa6bfa8446cf730736735396e0","modified":1494515719885},{"_id":"themes/icarus/node_modules/bluebird/js/release/direct_resolve.js","hash":"470ca4d9a7e387ceceb383bc2640202f5fa6bda2","modified":1494515719690},{"_id":"themes/icarus/node_modules/bluebird/js/release/each.js","hash":"44949d491571dd38f6ffdd777cb44f96aebb5fc8","modified":1494515719626},{"_id":"themes/icarus/node_modules/bluebird/js/release/errors.js","hash":"98deaaee17f36851937108257e028a7e237b3f5e","modified":1494515719556},{"_id":"themes/icarus/node_modules/bluebird/js/release/es5.js","hash":"019c4e8b62031ea49aedc86dedd20318c6122698","modified":1494515719443},{"_id":"themes/icarus/node_modules/bluebird/js/release/filter.js","hash":"a5f3aee4afbc67d372e5b4fbaeac047d0d9c779b","modified":1494515719205},{"_id":"themes/icarus/node_modules/bluebird/js/release/finally.js","hash":"cc388e93ecc2e12145c080cc67b0d8517e481c13","modified":1494515719085},{"_id":"themes/icarus/node_modules/bluebird/js/release/generators.js","hash":"6b334d17275b48548e44f74f477b2e8bd49da304","modified":1494515719143},{"_id":"themes/icarus/node_modules/bluebird/js/release/join.js","hash":"5ab50e4fd76d09506700b47e7672c9d528816d4b","modified":1494515719188},{"_id":"themes/icarus/node_modules/bluebird/js/release/map.js","hash":"4d96c67c999d7f8a155934d25bfe8cc4912ad469","modified":1494515720361},{"_id":"themes/icarus/node_modules/bluebird/js/release/method.js","hash":"02a5a493c2cf2045fbb20b2751381e4b4e29dbe8","modified":1494515719235},{"_id":"themes/icarus/node_modules/bluebird/js/release/nodeback.js","hash":"46fc87ede6ca68434439a5216fe8e6f89d8d8a1f","modified":1494515719268},{"_id":"themes/icarus/node_modules/bluebird/js/release/nodeify.js","hash":"ebd75c010fcf1c4f709f4b444e62b80cfcde2a0f","modified":1494515719306},{"_id":"themes/icarus/node_modules/bluebird/js/release/promise.js","hash":"1420cd148b7a28f42f8edd1c9411f64c85e313e1","modified":1494515719367},{"_id":"themes/icarus/node_modules/bluebird/js/release/promise_array.js","hash":"2b05f82b39c408715260b264dbeb886d080efc59","modified":1494515719418},{"_id":"themes/icarus/node_modules/bluebird/js/release/promisify.js","hash":"3831be99120a57a3c07406f7012467f02346e92c","modified":1494515719521},{"_id":"themes/icarus/node_modules/bluebird/js/release/props.js","hash":"d26e05c3860fd45b7ae9008995493c6d01c2f2e7","modified":1494515719602},{"_id":"themes/icarus/node_modules/bluebird/js/release/queue.js","hash":"e6fddd439658a46c57132ec8d07dd04bf1d743e6","modified":1494515719659},{"_id":"themes/icarus/node_modules/bluebird/js/release/race.js","hash":"5f5b5403be19793dec5658af27fe996173eb4990","modified":1494515719710},{"_id":"themes/icarus/node_modules/bluebird/js/release/reduce.js","hash":"8f0d6b75ed5682d3a7e45254d76618258b45bb2a","modified":1494515719859},{"_id":"themes/icarus/node_modules/bluebird/js/release/schedule.js","hash":"bad77d032baf76d04dd40cc5f01c5d4adebd4578","modified":1494515719906},{"_id":"themes/icarus/node_modules/bluebird/js/release/settle.js","hash":"36f97c3732ae907af622fd4c859d29da1255fdfa","modified":1494515719938},{"_id":"themes/icarus/node_modules/bluebird/js/release/some.js","hash":"b548ddd7eb6b35ae6e97d931e0a8ef6dd512b3b5","modified":1494515720030},{"_id":"themes/icarus/node_modules/bluebird/js/release/synchronous_inspection.js","hash":"21be4c93fd5b93b07315c5edc930800e686e4dea","modified":1494515720125},{"_id":"themes/icarus/node_modules/bluebird/js/release/thenables.js","hash":"b06e617f4b1e5c9c33c9c4e0baabe709550154b1","modified":1494515720154},{"_id":"themes/icarus/node_modules/bluebird/js/release/timers.js","hash":"ad830b808b63bd4b291a3b23210bdaf850f1f818","modified":1494515720199},{"_id":"themes/icarus/node_modules/bluebird/js/release/using.js","hash":"5b287a7d967647d38091aec63f880abc46caeb4f","modified":1494515720282},{"_id":"themes/icarus/node_modules/bluebird/js/release/util.js","hash":"5c6207f919f7efb4453dd7ceef0ec47845bdc0ea","modified":1494515720330},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/abnf.js","hash":"82addec1b6c07619aca7aada359aed3f34c02642","modified":1494515721632},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/1c.js","hash":"31a645e9d1b863add65b020a347f94fdffb95c94","modified":1494515719001},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/actionscript.js","hash":"0ea1dbcc03123f7d61ac0d69cfe55bfbc517d2a9","modified":1494515721606},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/accesslog.js","hash":"348d234c7253b8b308b74376fd92824d7788e745","modified":1494515721620},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ada.js","hash":"f03675f08c9750f48c33ea202894cd3b13d8600e","modified":1494515721585},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/applescript.js","hash":"64c56abbca58a0881b736a5b7519a178a0a1d782","modified":1494515721548},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/apache.js","hash":"c60412ca3c2543b47727c8915286750873a24c09","modified":1494515721570},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/arduino.js","hash":"873698f166f498133260f60b37b8c2fea4bbc55b","modified":1494515721524},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/asciidoc.js","hash":"b7e01e2d240ff73a8695ed1447a47c4a0be7b62d","modified":1494515721492},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/armasm.js","hash":"d49048f28a92ae394e0c2fdddad8e46a53732513","modified":1494515721509},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/aspectj.js","hash":"53e02075ee7d4923f95bbd47e3697f6b6bf58783","modified":1494515721470},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/autohotkey.js","hash":"951f24817084840b56ea98066f24a36629a1cbfa","modified":1494515721454},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/avrasm.js","hash":"474db1f6917d9ee3b1679286ec1583f1bbd19c2c","modified":1494515721414},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/awk.js","hash":"b749eda162b5bfcb684da29e1c2e71712afd2f57","modified":1494515721397},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/axapta.js","hash":"0f0f21ccab8b6874e965d53791465ed89e3aa13b","modified":1494515721380},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/bash.js","hash":"466ccf60240eaeb73902399dfe2613d01d0845ed","modified":1494515721363},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/basic.js","hash":"78824065536502064ecceaf75d9571d3380d9642","modified":1494515721346},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/bnf.js","hash":"ef775edcfecec203e6c67fa994ceb6d7d81d90eb","modified":1494515721330},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/brainfuck.js","hash":"b6d4f266923cc946678a9060be5ad4a02a358db8","modified":1494515721317},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/cal.js","hash":"7d7b9e510ad2ead900b097c38074f755378647e1","modified":1494515721287},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/capnproto.js","hash":"0d947410d260600d3b110c4c427545b2a97f7947","modified":1494515721266},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ceylon.js","hash":"586cc177a3c7dee9836e9f474bc3947e93424ab4","modified":1494515721247},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/clean.js","hash":"2f08f6fd4734e0a12c39362b34b6312865f5ea80","modified":1494515721226},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/clojure-repl.js","hash":"1e9b837580d563935b9e4a2314e1c618c42cf052","modified":1494515721206},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/clojure.js","hash":"216f43777af0fcee770f98d85b91c95e6b6562c1","modified":1494515721189},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/cmake.js","hash":"72aef704f3645ffc6cbfb8d534fa31c0181e1455","modified":1494515721157},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/coffeescript.js","hash":"149af704b2951ac39ff2be20d99466cbe5fc1629","modified":1494515721132},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/coq.js","hash":"f0d48985501355c966a12d54ce236c2c92982b03","modified":1494515721106},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/cos.js","hash":"112dc8b9329863653b8e9d648b8eec0f7f0cb45d","modified":1494515721076},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/cpp.js","hash":"fbc740e6517cbeba0d7608bc595f0c04ef5465ca","modified":1494515721057},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/crmsh.js","hash":"c8ad2da6b6603b62172e2865eea4add11fd79800","modified":1494515721032},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/crystal.js","hash":"53e6826083ba99130621c6ad6015304ef59299e2","modified":1494515721008},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/cs.js","hash":"e3dc15061eea6aaba9732c3db5816bcc243040ac","modified":1494515720989},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/csp.js","hash":"8a4c03add8f3c7815fbbe8dbc28748e6fd19cb1a","modified":1494515720954},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/css.js","hash":"e3e285a4fde1eeed5120211054b1e5f0e4cbf92b","modified":1494515720934},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/d.js","hash":"229d02046adf47a87e6229917998b564a0726ea5","modified":1494515720909},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dart.js","hash":"06e74990e6dabb0d55b90bfa1e32786b26ed49b6","modified":1494515720887},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/delphi.js","hash":"4771dd9abe3394931dc8e9cf717612617f94e22b","modified":1494515720862},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/diff.js","hash":"ce359050293199c8667739f88ecb435a4d08111b","modified":1494515720829},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/django.js","hash":"f2fdd57b3a4aad786b3cb81aaa1151abbac9de2f","modified":1494515720808},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dns.js","hash":"de0553c09bac9edacdb1c492dd05960cc7cf971f","modified":1494515720787},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dos.js","hash":"bed63b430d0245c8b6c3e430d849c64a8e40db4a","modified":1494515720740},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dockerfile.js","hash":"6a16033eb47225bc4bdc3957c3e685874263b8dc","modified":1494515720758},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dsconfig.js","hash":"e1b080939fb6e23065003841f1b81e84cbd9f411","modified":1494515720722},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dts.js","hash":"23612dd62fc09eb91bff8e7eafd684d469ef3392","modified":1494515720697},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/dust.js","hash":"2996fd8585906dd1ae8f1dc9e8b8abd7ccd568fc","modified":1494515720662},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ebnf.js","hash":"a2668958d3f99499f250158dd0adc549793c0ec3","modified":1494515720640},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/elixir.js","hash":"4d352797253b7fd81a0836ad9d590e515f79d0c6","modified":1494515720618},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/elm.js","hash":"f6a06178460a203c8c49f889be4b51f40832914e","modified":1494515720593},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/erb.js","hash":"3e67ebd4a54e38f7c4352facbb0114b914df773d","modified":1494515720572},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/erlang.js","hash":"eab318990e71134e5ffb248663d141dc418a43f7","modified":1494515720531},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/excel.js","hash":"741ee6d1f9ddbf7614a75d90f30c4afd6278b9e9","modified":1494515720501},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/erlang-repl.js","hash":"b40072b8f60479a3b2fda37c6ffa5c6065e160bb","modified":1494515720551},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/fix.js","hash":"225c32c97aad884ad5c3d256b13aac89ab7b3569","modified":1494515720463},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/flix.js","hash":"dcccd8fe672c40b1db80c26ad3389d621f3304be","modified":1494515720441},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/fortran.js","hash":"a9d0aa92cb7a7ee12ae3b89233ef4e3f68a1b5ea","modified":1494515720415},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/fsharp.js","hash":"51446ecccedbe24c8477af70d4fbf15d5f090ce5","modified":1494515720377},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/gauss.js","hash":"c40d2988e593edd4d434336a372ab8a04a975129","modified":1494515720322},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/gams.js","hash":"cdf2b1e632b78e22f5fa9fe013839b911b1c02e1","modified":1494515720347},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/gcode.js","hash":"1c35a95ccd30d0949d1f09f586989e036c97187b","modified":1494515720287},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/glsl.js","hash":"c348157dec60d1f1d723b0f88cfc0a9bcc0d74ca","modified":1494515720225},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/gherkin.js","hash":"68eddb4dc9b866bad4fc3b555be92199716489d8","modified":1494515720248},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/go.js","hash":"b4b17b3d63424736f00c4b58afdc313e9094dd7b","modified":1494515720176},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/gradle.js","hash":"3c7ba57616e77ac59b59810515bb6d2bebd6b6f2","modified":1494515720109},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/golo.js","hash":"8d53d68e90a908e33670d075a3727bc3bac48f12","modified":1494515720136},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/groovy.js","hash":"cb9e4ed4363a68859e7fd8365b7024835691d669","modified":1494515720074},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/autoit.js","hash":"5a765d8c3d147df67badc2e4135b8e5df56337ce","modified":1494515721440},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/handlebars.js","hash":"3586163cb9c029239185209044f91567bc9388a6","modified":1494515720000},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/haml.js","hash":"84491f05df1fc74d1084fb253dc12d2bed0a2fca","modified":1494515720040},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/haskell.js","hash":"65d0e2f2dd60d21107438f98bf06b5673a0e395c","modified":1494515719975},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/htmlbars.js","hash":"2b42fc812e7bb39a5e69e2c5a0365a6952689e18","modified":1494515719885},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/hsp.js","hash":"ace444817c7832f9947752ae72f51329502c8d53","modified":1494515719919},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/haxe.js","hash":"a2804355ea896b573c3c4c4d4bbc611f65601dde","modified":1494515719945},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/hy.js","hash":"6456d54268279752bde50e4ced70f8d5a3fa5c30","modified":1494515719821},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ini.js","hash":"ff3f6c019db17271a60c0110d1c0d8bb4b20ecfb","modified":1494515719659},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/irpf90.js","hash":"25b18b62a7eac03d7cd196c12480437ddd957196","modified":1494515719619},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/http.js","hash":"202176d2e4fc551d11162a797c1f2ec002412b28","modified":1494515719857},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/java.js","hash":"90fa24c718396fe72c34f56c34649d104e31cb2a","modified":1494515719517},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/javascript.js","hash":"6aca7e933f0e8d404f1e62a88756328b4e9b0b15","modified":1494515719437},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/jboss-cli.js","hash":"11af05d6fe833154c0fc13a8817c325ecafd0c8b","modified":1494515719397},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/inform7.js","hash":"f7019518299290c408b65cae8a5d9a2170f260b8","modified":1494515719730},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/json.js","hash":"75b75bff84a88d6b0b630442d4b588719e3ccf22","modified":1494515719336},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/julia.js","hash":"67e252d67fdc75715ccae67895ef3197b770a9e1","modified":1494515719130},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/kotlin.js","hash":"840cb5085e1394694c6c22d8139225d9a2bddbb8","modified":1494515719042},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/lasso.js","hash":"e519685b2d7e0f11dd850041085b97fcacd8fd3e","modified":1494515719065},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ldif.js","hash":"2f6f2bf8d3ff343e8f3d661fb7b97333a84615a0","modified":1494515719085},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/lisp.js","hash":"b6d09c4efc9f62bd400d3b4e3a830e86433b3650","modified":1494515719158},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/leaf.js","hash":"7a74ea9bf9a65ea1b3b6632a5c7b4725cea86c05","modified":1494515719101},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/less.js","hash":"6c470c8d7a92f1b436536e469b362b92f1b13c67","modified":1494515721648},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/livecodeserver.js","hash":"7966dc033093c1555cbf626b58b9cbbd5f889614","modified":1494515719193},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/livescript.js","hash":"b3a1310bf1b1c812fc28467c136bbd77610c50e8","modified":1494515719226},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/lsl.js","hash":"460ee52b1bc77438274d2a4b7dde478e52798c2f","modified":1494515719306},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/llvm.js","hash":"14449c574014420aaa9131e36c68550b1b46d996","modified":1494515719259},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/lua.js","hash":"0bbe0ee424e83c548d6ce21a12f8885b23419030","modified":1494515719377},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/makefile.js","hash":"dd503cb449593fa6bfed24c922023213e62a367d","modified":1494515719414},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/markdown.js","hash":"226a75a5d3bae188408a8d388ddaa8d702a38194","modified":1494515719493},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/matlab.js","hash":"08d33bc43836283c2181a1077c117c77fc8cc8c9","modified":1494515719643},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/maxima.js","hash":"3522fa58e0e93d36c3267dea5172e33fe64cc843","modified":1494515719700},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mel.js","hash":"6f19c9f0b7e78725e6391a1e2d3990610cf8c006","modified":1494515719795},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mercury.js","hash":"154f4ac390a395eae2bb4246c93c18b7412b3bd5","modified":1494515719843},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mipsasm.js","hash":"adfac05b0dbabb7a5053abdeb7f25b0a2b8df178","modified":1494515719874},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mizar.js","hash":"009acb028481b4f3ad95bec4d0386bb2184e7acf","modified":1494515719896},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/moonscript.js","hash":"485510191b2c8d67c96710cb85dc1a37ebb05af8","modified":1494515719990},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mojolicious.js","hash":"7edb53b8770a591523bbe90601a1097d589a5dc0","modified":1494515719930},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/monkey.js","hash":"64fc8e856e773939f5f50fb03b3e207e77ae5ea6","modified":1494515719959},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/n1ql.js","hash":"c6ab9f27fd4a711387a0d15d75926aa2087b54a9","modified":1494515720026},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/nginx.js","hash":"2d35617087edad25bec36f549a82ae574e6c9a45","modified":1494515720057},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/nix.js","hash":"0e799905fad5eb9a7e86b07654d540eb67d74529","modified":1494515720126},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/nsis.js","hash":"859fa05107b664b9ee9180070a3344b7ee5ac18f","modified":1494515720163},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/nimrod.js","hash":"e892415387bd17ed7f62205b11704e5f0751943d","modified":1494515720087},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/objectivec.js","hash":"b7b8e950fc63070c2187bba4e00439b492f1af5a","modified":1494515720192},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ocaml.js","hash":"03e65e7f07732e214a0d32a0b539e76012ed3970","modified":1494515720238},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/oxygene.js","hash":"a8e62344bc5a3d7db691bcf28d53fc305f790cef","modified":1494515720304},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/openscad.js","hash":"a732c333aa1adaeea2f125e086012305382b674e","modified":1494515720273},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/parser3.js","hash":"ac15e9d440ec885a71761109fe40ba8a06c7b933","modified":1494515720334},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/perl.js","hash":"c1872392209d696ab1ec8a34d5a9a2e8ba51ec35","modified":1494515720361},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/php.js","hash":"a4f9f78b7786797c7f8488220525209393d76c11","modified":1494515720429},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/pf.js","hash":"a7b05b0bce721379a7c5245ab2e87f887d64c100","modified":1494515720395},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/powershell.js","hash":"c2459c6b38115c02b5edb267042da49c998cf08e","modified":1494515720476},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/pony.js","hash":"ebf4ae15519e16eb80c3ab984c648155109ad52b","modified":1494515720455},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/processing.js","hash":"d13b510492292fb16f8d8a8ca7787b5fdf83f9d3","modified":1494515720516},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/protobuf.js","hash":"abbcec351964992b81f75caade03b077850c3949","modified":1494515720581},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/prolog.js","hash":"16087064562b8ee336c7373f2f3f377904a7809a","modified":1494515720564},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/purebasic.js","hash":"684640f179954b84907545c0039460e35da287c6","modified":1494515720630},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/profile.js","hash":"2199270f25b8e1c6e934f44111d3654d7d1b3c00","modified":1494515720541},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/puppet.js","hash":"2b7644a72813e256632310ec9edef0459727f096","modified":1494515720607},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/q.js","hash":"7228dbc817b650907d60ee957a8303d53f727f80","modified":1494515720686},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/python.js","hash":"624da737f0410e476b81d65e02b95693b8e88860","modified":1494515720652},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/qml.js","hash":"69f233e3b6d37347c77070a35e3420a796a7187e","modified":1494515720711},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/r.js","hash":"d4e0224fa019df6fbfdf32173aa6667748e9ea11","modified":1494515720731},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/roboconf.js","hash":"f39efee84c9b8c3308746c82176ff6a305da7eea","modified":1494515720767},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/rib.js","hash":"6ac4095f443d77730802603b2b9161a9bcf72100","modified":1494515720748},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/rsl.js","hash":"ab3dfe5e601148d016c76aab50fb17afb794c435","modified":1494515720797},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ruby.js","hash":"0f92409522686f18e7382800f9f3aba287869ec9","modified":1494515720821},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/ruleslanguage.js","hash":"5600035cd1c59e034c8b710276ec4029e1594da8","modified":1494515720847},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/rust.js","hash":"e200620c4e416154933dcbf0efd6910d07c31fb0","modified":1494515720873},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/scala.js","hash":"fc8d7c529fd4be604eea90cd0a12358fad5f49b9","modified":1494515720898},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/scheme.js","hash":"7511d70a0bd2aba70315c32a5656ce30571615d5","modified":1494515720924},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/scilab.js","hash":"1ff368f39960bba8051de0706aa97d46ffdeb94d","modified":1494515720947},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/scss.js","hash":"3e770e661b2c57b9ee3ead36ef1f358f1a87d6e2","modified":1494515720976},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/shell.js","hash":"1bf20ca21d54e843cea24a675a8842fa44ce419f","modified":1494515720996},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/sml.js","hash":"03e1e7cf2041103f55d57dda1624ff0fba83d47a","modified":1494515721064},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/smalltalk.js","hash":"45d649415c43d5989bc9bb2548885f0820bfa119","modified":1494515721043},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/sqf.js","hash":"3a740091b22b725518953d6710865b48cdb0c8ca","modified":1494515721094},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/smali.js","hash":"9a8ccd28ca3405e5ba86f86d2fcbe82095d81391","modified":1494515721020},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/stan.js","hash":"305e8b20c4ac5762dfb13892f87b1127e65ad2cd","modified":1494515721143},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/sql.js","hash":"4e039f7ea433c538390fd8b4afdc6240af5a3341","modified":1494515721119},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/stata.js","hash":"52b5b3f4bf075e3d31df1b6c432cd48f5af2071a","modified":1494515721175},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/step21.js","hash":"f9c30d58ef59c96f151a74736dfe48260fa90ebe","modified":1494515721199},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/stylus.js","hash":"a6260a532b4ee8ffcbcace1bbbf502a587f56628","modified":1494515721219},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/swift.js","hash":"a90c42aaa8fbb2fe6d9b2542c2ab71836c6a8ac7","modified":1494515721258},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/subunit.js","hash":"58b09d36e6de77766fee9976fa20676fd97914a2","modified":1494515721235},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/tcl.js","hash":"fae3052ea5a3ecb70f4a12d38f2d7fb387cefc94","modified":1494515721324},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/tap.js","hash":"986dce0e93f335db4c120876daf523904ba84922","modified":1494515721308},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/taggerscript.js","hash":"7fc8221bb34ff42d867a68a98f93a33e11cac11f","modified":1494515721276},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/tex.js","hash":"956a6f3ac9e1e2bc40a49191a4f7558f267008eb","modified":1494515721338},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/thrift.js","hash":"47c807c1cc33a57f6f2ecb9e609f56ae74d5ef77","modified":1494515721354},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/tp.js","hash":"7690f71ab4b1616b96873b43116e8ae936b1590c","modified":1494515721372},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/twig.js","hash":"30b6777246eec12be33ba24fc5dfc95565491edc","modified":1494515721389},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/typescript.js","hash":"ba777d301245055bc7ceffa2ec4a0e3dd5d99433","modified":1494515721406},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vala.js","hash":"8cf4daa0d64e112a0eede09353cfc4c95be37619","modified":1494515721422},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vbscript-html.js","hash":"af6c349a4ce7cabf9e94168aa75dfa350664a021","modified":1494515721460},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vbscript.js","hash":"29df599716e626e26b384e259f052c9a68fd29f0","modified":1494515721484},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vbnet.js","hash":"b95eecf676909dab14be6fbbe03d4a4ffd2cdd8f","modified":1494515721447},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/verilog.js","hash":"2385a8df75d73b3a1aebc591432a53d2e58c41c3","modified":1494515721501},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vhdl.js","hash":"3baf1eb9aef43fc2aa1c64a258b639bc4e69219d","modified":1494515721516},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/vim.js","hash":"a726fda2007d43cd0734e96e1530056f32cd0033","modified":1494515721542},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/xl.js","hash":"51b7b4ec88350dbaf8bd115e4c9f4a3c3cee32d4","modified":1494515721577},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/xml.js","hash":"9d6ec52a3d002850caff607948da16e7888979d3","modified":1494515721599},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/x86asm.js","hash":"5eef051aad64bac3c549311cea1f76521f890580","modified":1494515721564},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/xquery.js","hash":"ee7fee4c24dd6112e16b513dd26ca5937d9d637f","modified":1494515721615},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/yaml.js","hash":"bf63ff94dee5f4680436ecf12daf15d2e6675f25","modified":1494515721626},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/zephir.js","hash":"fc7c87476ff8fe68e51d159eddb99d8421505a3e","modified":1494515721640},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/libraries/keyword_extractor_node_modules.xml","hash":"dac58a34689afec66c1ad736386893732f2a09fb","modified":1494515719112},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/da.js","hash":"bb5a01d9007faba1d212578ede92ea817015a088","modified":1494515718381},{"_id":"themes/icarus/node_modules/keyword-extractor/.idea/scopes/scope_settings.xml","hash":"fa07d9d70692f2d31ace346398287a038e2bdc2e","modified":1494515719171},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/de.js","hash":"f12b4f778b25fc05a5bfa5fc37980db1ea2e9635","modified":1494515718940},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/en.js","hash":"79aaa0c732cb118a377ffa3bbd775443c23c817d","modified":1494515718667},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/es.js","hash":"669331dff71de8c2e787f6065da5f27f0c9647b7","modified":1494515718494},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/fr.js","hash":"fdcbeed607cea6ca86bed93aeb580d293aaba57f","modified":1494515718609},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/gl.js","hash":"430c60b0516871709dda368762e4e073266d9491","modified":1494515718641},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/it.js","hash":"0d8a905855b6865f80467b3510453db2fc2665c3","modified":1494515719023},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/nl.js","hash":"08691dc133e26b535f2d245bada2e61caf329951","modified":1494515718693},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/pl.js","hash":"ae20014ce3213fda328e22e98aa081ff8b12e4d0","modified":1494515718709},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/pt.js","hash":"c3b79bbe45724cb835ae66c2a9cf7f42341c6192","modified":1494515718763},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/ru.js","hash":"299c5b172d51738e89ae277fa1d0a353038f3505","modified":1494515718845},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/se.js","hash":"d89283e481307a322f891beab6892b6fe2245f86","modified":1494515718890},{"_id":"themes/icarus/node_modules/keyword-extractor/lib/stopwords/stopwords.js","hash":"0e90de1bec285130395364512019e671881250fe","modified":1494515718997},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-dz.js","hash":"db097c8cacff75fda72540ddd5c62472303813bf","modified":1494515723677},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-kw.js","hash":"f998981362834c2582db215878910d93e714ef16","modified":1494515723658},{"_id":"themes/icarus/node_modules/moment/src/locale/af.js","hash":"7dd0add9840a4bfd95db2ba062b7d217cef04f29","modified":1494515722451},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-ma.js","hash":"f9f75888e7c1f15b014b1577164a5ab49d3b9307","modified":1494515723608},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-sa.js","hash":"b40227810425d95553d174d30fa5f9ceac80e3d7","modified":1494515723589},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-tn.js","hash":"6127e711a88efce81d7a8ab4926a887c9cd46d4f","modified":1494515723559},{"_id":"themes/icarus/node_modules/moment/src/locale/ar.js","hash":"3ce2c76e6ccca70e78a53a66e52a18ae998d19d2","modified":1494515723543},{"_id":"themes/icarus/node_modules/moment/src/locale/az.js","hash":"7c9c88e83a6a8d702f7baf4071d7f227595ad869","modified":1494515723525},{"_id":"themes/icarus/node_modules/moment/src/locale/be.js","hash":"5e8f03b54ec11eadbf57a3b20f00acf340fe990e","modified":1494515723507},{"_id":"themes/icarus/node_modules/moment/src/locale/ar-ly.js","hash":"2c2f7b521eb1925fa1b1f2cdedcb171aa807e36f","modified":1494515723632},{"_id":"themes/icarus/node_modules/moment/src/locale/bg.js","hash":"f03f9999c8519f57638e00ac8138bd509d4b8244","modified":1494515723482},{"_id":"themes/icarus/node_modules/moment/src/locale/bn.js","hash":"12fee0a752e63b371e2b7e440a36514732479535","modified":1494515723461},{"_id":"themes/icarus/node_modules/moment/src/locale/bo.js","hash":"f2cf9226f6385fa8acdc424f16b849f862b4d513","modified":1494515723439},{"_id":"themes/icarus/node_modules/moment/src/locale/br.js","hash":"f6c2decbc48e424007bea0139c63726153fd62ee","modified":1494515723416},{"_id":"themes/icarus/node_modules/moment/src/locale/bs.js","hash":"f265e0ce0f42ad18bc8d11fa2fcf14c47f85dd91","modified":1494515723393},{"_id":"themes/icarus/node_modules/moment/src/locale/ca.js","hash":"8791c5c134ea552e07447db634c0ac09e4f80377","modified":1494515723367},{"_id":"themes/icarus/node_modules/moment/src/locale/cs.js","hash":"96c1ec57bbeb9c164ca6976c0e787bb019ae0087","modified":1494515723253},{"_id":"themes/icarus/node_modules/moment/src/locale/cv.js","hash":"373fc70afa6bdd7962f635282c11cff494f02537","modified":1494515723230},{"_id":"themes/icarus/node_modules/moment/src/locale/da.js","hash":"aaac2c15af08fbb53b40207b3efde345b9548406","modified":1494515723198},{"_id":"themes/icarus/node_modules/moment/src/locale/cy.js","hash":"b921376a9fc9c4cbd05f31e0d2c28506e21afc0c","modified":1494515723214},{"_id":"themes/icarus/node_modules/moment/src/locale/de-at.js","hash":"77461313a914ce95f798ade310e3d531dfcd863d","modified":1494515723170},{"_id":"themes/icarus/node_modules/moment/src/locale/de.js","hash":"5bbc2e81a95828cc25a17b241762e4ee4fb79134","modified":1494515723135},{"_id":"themes/icarus/node_modules/moment/src/locale/de-ch.js","hash":"bdaf1b488b7d743e5f86304871705b5bd684822b","modified":1494515723154},{"_id":"themes/icarus/node_modules/moment/src/locale/dv.js","hash":"5a2ae7f9c13be2a61123a7e8934819ccf93d9088","modified":1494515723119},{"_id":"themes/icarus/node_modules/moment/src/locale/en-au.js","hash":"41d4d6de7f4a267c41489dc7a10a4f2b7a05c15b","modified":1494515723077},{"_id":"themes/icarus/node_modules/moment/src/locale/en-ca.js","hash":"4f7bf35731c937a232d10b7d16ba4986632e19b0","modified":1494515723060},{"_id":"themes/icarus/node_modules/moment/src/locale/en-gb.js","hash":"dba7f75bd30bfcacc92beccec1058309f16b2294","modified":1494515723043},{"_id":"themes/icarus/node_modules/moment/src/locale/en-ie.js","hash":"ae762a4f594b3dd231c9f0c59f96a8f37ec49987","modified":1494515723026},{"_id":"themes/icarus/node_modules/moment/src/locale/eo.js","hash":"eaefff89716f30bc5ed2b99eccf0bd6beb74e0a0","modified":1494515722990},{"_id":"themes/icarus/node_modules/moment/src/locale/en-nz.js","hash":"c3543065e8981a13d5d5748608d19971d0124557","modified":1494515723008},{"_id":"themes/icarus/node_modules/moment/src/locale/es-do.js","hash":"e50bcf492c6626013e01dca0e4b4e2e59c562ca9","modified":1494515722970},{"_id":"themes/icarus/node_modules/moment/src/locale/el.js","hash":"be04d558e13267282e6086cf6c9cfba6887e5691","modified":1494515723099},{"_id":"themes/icarus/node_modules/moment/src/locale/es.js","hash":"d43d463e8fcf16ab9900c817448d8120333830a4","modified":1494515722945},{"_id":"themes/icarus/node_modules/moment/src/locale/eu.js","hash":"66d1124f9a60d9724382a8f7921c7cb4c66b0c30","modified":1494515722907},{"_id":"themes/icarus/node_modules/moment/src/locale/fa.js","hash":"59efbdf02c0c8378a11c953a152007e0d30a1e2c","modified":1494515722886},{"_id":"themes/icarus/node_modules/moment/src/locale/fi.js","hash":"bf73f21eaca51ea1535936bf1765a5c23f1e97ed","modified":1494515722859},{"_id":"themes/icarus/node_modules/moment/src/locale/fo.js","hash":"34248a273f2182c7eb406ea49c71b4b1edd0251d","modified":1494515722837},{"_id":"themes/icarus/node_modules/moment/src/locale/fr-ch.js","hash":"90749cd193ecaf9e437a4de0ae3e99ec7c08c077","modified":1494515722805},{"_id":"themes/icarus/node_modules/moment/src/locale/fr-ca.js","hash":"124f9a10366ae76db6715fc184702b1fd0c3e5ba","modified":1494515722822},{"_id":"themes/icarus/node_modules/moment/src/locale/fr.js","hash":"7a380e47e71fe755264aa8020367088976215ec8","modified":1494515722787},{"_id":"themes/icarus/node_modules/moment/src/locale/fy.js","hash":"9796ecb7f16824743f4c5b2503e6b39e123256ae","modified":1494515722764},{"_id":"themes/icarus/node_modules/moment/src/locale/gd.js","hash":"22bab0253e36f0442b91cb7d1fb20a0e05812e34","modified":1494515722747},{"_id":"themes/icarus/node_modules/moment/src/locale/gl.js","hash":"023447e968c093effb27265fa7c4fbad8c04f1eb","modified":1494515722729},{"_id":"themes/icarus/node_modules/moment/src/locale/gom-latn.js","hash":"00af096b2162f26f55788d7cd256b98d36b8cee9","modified":1494515722708},{"_id":"themes/icarus/node_modules/moment/src/locale/he.js","hash":"029de6398abbf44a0b5231cd5fd798c9c4875449","modified":1494515722689},{"_id":"themes/icarus/node_modules/moment/src/locale/et.js","hash":"bf858627d44a23ed624ee99808a163b9b55a4bf0","modified":1494515722926},{"_id":"themes/icarus/node_modules/moment/src/locale/hr.js","hash":"005f24fc56a1cdac39f332cfe4e45c523b98ba28","modified":1494515722649},{"_id":"themes/icarus/node_modules/moment/src/locale/hi.js","hash":"0c2fe04b188b98b743811813608f120caac46d3a","modified":1494515722667},{"_id":"themes/icarus/node_modules/moment/src/locale/hu.js","hash":"45c6a71a37530ec637181d1c337edb5b986a82de","modified":1494515722628},{"_id":"themes/icarus/node_modules/moment/src/locale/hy-am.js","hash":"40d76c6df3e71a001c6973a476e77fedc03aace5","modified":1494515722608},{"_id":"themes/icarus/node_modules/moment/src/locale/id.js","hash":"a9934bdbbde8dbfbe6f726b78ccb72fcac336f4b","modified":1494515722587},{"_id":"themes/icarus/node_modules/moment/src/locale/is.js","hash":"8a004d1848b55d7899b5d25b3be43d93048ca91b","modified":1494515722570},{"_id":"themes/icarus/node_modules/moment/src/locale/it.js","hash":"663dca8744e5d99f5e63abb0bd8c265746930ba9","modified":1494515722550},{"_id":"themes/icarus/node_modules/moment/src/locale/jv.js","hash":"56691f5726d67f683418892a15b122e45488c3eb","modified":1494515722457},{"_id":"themes/icarus/node_modules/moment/src/locale/ka.js","hash":"681b20664f8f38ae85d2d7c18730ac038ecb37ee","modified":1494515722469},{"_id":"themes/icarus/node_modules/moment/src/locale/ja.js","hash":"7298612717e798c3955beee3aa688927a7b2c43c","modified":1494515722486},{"_id":"themes/icarus/node_modules/moment/src/locale/km.js","hash":"fbb53364ba64afc00a07d410e2f61218ea68e8a4","modified":1494515723707},{"_id":"themes/icarus/node_modules/moment/src/locale/kn.js","hash":"3d8c0551e2078d1bf0c9fde8dffcb04c8cda0dcc","modified":1494515722501},{"_id":"themes/icarus/node_modules/moment/src/locale/kk.js","hash":"79204d61120b33b25639fdc06b465d87c7d33b12","modified":1494515722476},{"_id":"themes/icarus/node_modules/moment/src/locale/ky.js","hash":"c151756ecb2c9f2e468151266cbf5fbf6be407e4","modified":1494515722520},{"_id":"themes/icarus/node_modules/moment/src/locale/lb.js","hash":"d9ac2e44407a4cf771ca0a5810e986a7bee3a98f","modified":1494515722531},{"_id":"themes/icarus/node_modules/moment/src/locale/ko.js","hash":"0704ec2abc31f6acc3a222c74989c57df867561b","modified":1494515722509},{"_id":"themes/icarus/node_modules/moment/src/locale/lo.js","hash":"c5fa7b16b9a052897d4d1a343d88ce2b22146de1","modified":1494515722540},{"_id":"themes/icarus/node_modules/moment/src/locale/lt.js","hash":"3d007b5cc7a9818500a9f43ec7c24a26329fc123","modified":1494515722559},{"_id":"themes/icarus/node_modules/moment/src/locale/lv.js","hash":"8f63ed8c396199db1562393d1a0c0f2b25bebdce","modified":1494515722579},{"_id":"themes/icarus/node_modules/moment/src/locale/me.js","hash":"32afbc7f2204761fc95d22dd6d986d9f6bdd495b","modified":1494515722598},{"_id":"themes/icarus/node_modules/moment/src/locale/mi.js","hash":"5b76e820184090eea4ac47db94ae3edaac84d3c0","modified":1494515722616},{"_id":"themes/icarus/node_modules/moment/src/locale/mk.js","hash":"0da76c0639f65f43d4eccb9734903255090293c2","modified":1494515722639},{"_id":"themes/icarus/node_modules/moment/src/locale/ml.js","hash":"0eaa45a2b4ac824989e56a67c0901743369750bb","modified":1494515722656},{"_id":"themes/icarus/node_modules/moment/src/locale/mr.js","hash":"53bcae00338f8720af7e68bbd1ded193c57c7913","modified":1494515722681},{"_id":"themes/icarus/node_modules/moment/src/locale/ms-my.js","hash":"2e5e65e225bc28681ae47ad37eea46132e5d02d5","modified":1494515722699},{"_id":"themes/icarus/node_modules/moment/src/locale/ms.js","hash":"d178b91d316036ace16ab2c2758e2fa89f05cc7e","modified":1494515722718},{"_id":"themes/icarus/node_modules/moment/src/locale/nb.js","hash":"4aea124f8cb1d339b64b31f0051873c8f9b0a06c","modified":1494515722755},{"_id":"themes/icarus/node_modules/moment/src/locale/ne.js","hash":"a8f602b084d1fe029e1ce4f0cab16ea9d2a56c5e","modified":1494515722776},{"_id":"themes/icarus/node_modules/moment/src/locale/my.js","hash":"c7609984127e431056ab9062f69f6b6ccde2d456","modified":1494515722739},{"_id":"themes/icarus/node_modules/moment/src/locale/nl-be.js","hash":"e8ab9a01ab21649c54aae2481431811af4b004f0","modified":1494515722795},{"_id":"themes/icarus/node_modules/moment/src/locale/nl.js","hash":"38a1056bc4ed37301e1b33cf4ab890b92c5606af","modified":1494515722814},{"_id":"themes/icarus/node_modules/moment/src/locale/nn.js","hash":"f6781c0a5b00441ea510b7dbf38f9702a6df5ba9","modified":1494515722828},{"_id":"themes/icarus/node_modules/moment/src/locale/pa-in.js","hash":"159a7ef8e0d27327610d4aeafcddd0d4ce0bfff7","modified":1494515722849},{"_id":"themes/icarus/node_modules/moment/src/locale/pl.js","hash":"e1b6de70eb65da21f8a81636b679cde36ef745d5","modified":1494515722870},{"_id":"themes/icarus/node_modules/moment/src/locale/pt-br.js","hash":"16a066c3837ee9f9b0b3d4c77185b43eadb1b017","modified":1494515722898},{"_id":"themes/icarus/node_modules/moment/src/locale/pt.js","hash":"f4837fcaaf78cb4ea66e81949578adaaf2f1ef54","modified":1494515722917},{"_id":"themes/icarus/node_modules/moment/src/locale/ro.js","hash":"cecc5f6236df0887839f70873bd9bbf887554099","modified":1494515722933},{"_id":"themes/icarus/node_modules/moment/src/locale/ru.js","hash":"bfbdd2dfc3e6c80e459aad126a07be6766965b49","modified":1494515722958},{"_id":"themes/icarus/node_modules/moment/src/locale/sd.js","hash":"4a2724500aa7667b39edd30d814a49bcf4820a87","modified":1494515722981},{"_id":"themes/icarus/node_modules/moment/src/locale/se.js","hash":"59af5b0281456eb47968a117ae9e227c2c6dde83","modified":1494515722999},{"_id":"themes/icarus/node_modules/moment/src/locale/si.js","hash":"f13ddf40dc4b0e30bcf421beb9189a49ab0da6d3","modified":1494515723019},{"_id":"themes/icarus/node_modules/moment/src/locale/sk.js","hash":"f4825d89991313c1455531123aa250cafe49686b","modified":1494515723035},{"_id":"themes/icarus/node_modules/moment/src/locale/sl.js","hash":"acf569efdfc2bcc545e50bd2b53a120aa93f62ee","modified":1494515723052},{"_id":"themes/icarus/node_modules/moment/src/locale/sq.js","hash":"1f1aacfc1cbfcd4c10a050f186160341526f4c11","modified":1494515723068},{"_id":"themes/icarus/node_modules/moment/src/locale/sr-cyrl.js","hash":"24c14f11e281b0cd56a43be18c172ec1c4afa08b","modified":1494515723088},{"_id":"themes/icarus/node_modules/moment/src/locale/sr.js","hash":"2f1b99e828181c632c26bf45c55debfe9f7cefaa","modified":1494515723109},{"_id":"themes/icarus/node_modules/moment/src/locale/ss.js","hash":"667b3dc144598fae91ff0845a718b44dd529f2fb","modified":1494515723128},{"_id":"themes/icarus/node_modules/moment/src/locale/sv.js","hash":"effbd166d7238aafea7a2d610b9ef24edced7d99","modified":1494515723144},{"_id":"themes/icarus/node_modules/moment/src/locale/sw.js","hash":"126d55ce905a46e79e4639fee65279423666b191","modified":1494515723161},{"_id":"themes/icarus/node_modules/moment/src/locale/ta.js","hash":"1a9c5fe59d759be7cd5dca8515cf6d43257ccd8f","modified":1494515723191},{"_id":"themes/icarus/node_modules/moment/src/locale/te.js","hash":"7a596473c7dd950d4dc211194d48aa8a66fa0a42","modified":1494515723206},{"_id":"themes/icarus/node_modules/moment/src/locale/tet.js","hash":"4ba8651e201d9fa6fd6101b1cc31b8e5450d95bc","modified":1494515723223},{"_id":"themes/icarus/node_modules/moment/src/locale/th.js","hash":"fc99f8df0b64d7856a79160a0228337286a639cc","modified":1494515723241},{"_id":"themes/icarus/node_modules/moment/src/locale/tl-ph.js","hash":"7d81a0e9163936eff694bb5921db6e51ee2926e3","modified":1494515723263},{"_id":"themes/icarus/node_modules/moment/src/locale/tlh.js","hash":"982b024433f2016436e7cf25b046c959e72eb27d","modified":1494515723379},{"_id":"themes/icarus/node_modules/moment/src/locale/tr.js","hash":"e719a144bc2d593fe146f70d2458dd8ae7f2038d","modified":1494515723405},{"_id":"themes/icarus/node_modules/moment/src/locale/tzl.js","hash":"8d0c1cfa8f08f95e8262c6223bf6b504f0a6cd9f","modified":1494515723427},{"_id":"themes/icarus/node_modules/moment/src/locale/tzm-latn.js","hash":"00ee20b3f5ff4d4fe54e95c95473aadfcbd3c1d0","modified":1494515723446},{"_id":"themes/icarus/node_modules/moment/src/locale/tzm.js","hash":"9d3973a2d07d814919dc89a26d0376a48a0965a4","modified":1494515723474},{"_id":"themes/icarus/node_modules/moment/src/locale/uk.js","hash":"995e11f1911c8dbbc4eb91a56679b6156de7338a","modified":1494515723495},{"_id":"themes/icarus/node_modules/moment/src/locale/ur.js","hash":"16ef6ea5c7ed5281fee7616b3e044191678c8272","modified":1494515723516},{"_id":"themes/icarus/node_modules/moment/src/locale/uz-latn.js","hash":"902f11c1de1e8dea865bb62ab828e1c701dbe08e","modified":1494515723532},{"_id":"themes/icarus/node_modules/moment/src/locale/uz.js","hash":"9e611db6c27fd88124071a5af9c9fcfb56a626d9","modified":1494515723550},{"_id":"themes/icarus/node_modules/moment/src/locale/vi.js","hash":"ffa0459b49ec6599bdd62982455dd873e068c2f7","modified":1494515723574},{"_id":"themes/icarus/node_modules/moment/src/locale/x-pseudo.js","hash":"2cfd68713cfee6311182560150dde2149b93c329","modified":1494515723599},{"_id":"themes/icarus/node_modules/moment/src/locale/yo.js","hash":"5bba47366bfe35cf3642863bc731ba0f919964aa","modified":1494515723617},{"_id":"themes/icarus/node_modules/moment/src/locale/zh-cn.js","hash":"6bb5293c705fd7b1d04fc01b02f07bfafbd5503d","modified":1494515723649},{"_id":"themes/icarus/node_modules/moment/src/locale/zh-hk.js","hash":"94520170cb44b44f909236a40b8548e6e0dd0b70","modified":1494515723668},{"_id":"themes/icarus/node_modules/moment/src/locale/zh-tw.js","hash":"c7488f68318577c829ae18dff06fb38186839d48","modified":1494515723696},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/arrays.js","hash":"7e65b546ec41d89756176cca0662bee605054f3a","modified":1494515719085},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/chaining.js","hash":"be55887afb5f05515fc969449c166e924965a0e9","modified":1494515719122},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/collections.js","hash":"735c1cc88fc76df7c4a73c1735d29728404ffe4c","modified":1494515719174},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/functions.js","hash":"51f27a367d732c718ad869b9ed2ab15bc7cadc0b","modified":1494515719235},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/index.html","hash":"a39a08f5018ae1b231aedc06363ae08acc0b19bc","modified":1494515719439},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/objects.js","hash":"ce9b3cc415da73c599fecfb63cb1359439fee3f8","modified":1494515719340},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/speed.js","hash":"395b81dd34c9267a308c055547e28d8d02198e56","modified":1494515719377},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/utility.js","hash":"39dc56c4a644fb09006b6d967109ab9f94466bd6","modified":1494515719418},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.css","hash":"b5020c3860669185ba3f316fa7332cdf5c06f393","modified":1491956064000},{"_id":"themes/icarus/source/libs/font-awesome/css/font-awesome.min.css","hash":"7cd5a3384333f95c3d37d9488ad82cd6c4b03761","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css","hash":"844ce27b8488968bccb3e50bb49184ba2aae0625","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.css.map","hash":"51e9df39edf0faa3f38c1bab0c1fa6c922b9edcb","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-fb-comment-box.min.css","hash":"05830fadb8454f39dcc98c8686eb4d5c24b71fc0","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css","hash":"7871c28498d74451d6aa438c8d3a1817810a1e19","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.css.map","hash":"50c3348638b4d82fa08a449c690e8d2bb593005d","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lg-transitions.min.css","hash":"5c22e2073a4c96d6212c72135391b599e8d1359f","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css","hash":"bef55316a32e512d5a8940e5d0bfe8bf7a9c5c61","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.css.map","hash":"3175b4107078674d25798979f7666f4daf31e624","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/css/lightgallery.min.css","hash":"c9a2e19c932b56f4a2ce30c98910d10b74edb38a","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.svg","hash":"9a732790adc004b22022cc60fd5f77ec4c8e3e5a","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/img/loading.gif","hash":"607810444094b8619fa4efa6273bc2a7e38dd4b4","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/img/video-play.png","hash":"3ea484cdc04d2e4547f80cbf80001dcf248c94ef","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/img/vimeo-play.png","hash":"6190254f2804904a4a1fa1eb390dfd334e416992","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/img/youtube-play.png","hash":"fea6df9d9d43151f9c9d15f000adb30eb3e26fc4","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.js","hash":"426bb78b93acfc39d533ea2bab1cec8dc289cf24","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-autoplay.min.js","hash":"d845741bcaf961579622880eb2a445257efad1ac","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.js","hash":"65c47ac65362854ba44b00a010bb01e3630209d8","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-fullscreen.min.js","hash":"b6b9e4022700b7faf2a5a175ba44a3bd938fdd20","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.js","hash":"15d16516c5642d3de1566ff8fc9160136ccaa405","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-hash.min.js","hash":"43f1e1e720ab0e241c19b83aa26bd6848eab8edc","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.js","hash":"8092c692b244bb26343eb03b91bd97deb9dafc9c","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-pager.min.js","hash":"25caa6ff65b1c6dee09941e795ae2633bdbab211","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.js","hash":"b7fb5f6474911060a351b0a6fe9dbb9ac3fb22aa","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-share.min.js","hash":"39c615f07c5d3aaa65a2c3068a30fdd6dd5c372d","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.min.js","hash":"18dd7d2909d1bfd6852f031d03e774b4428c512b","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-thumbnail.js","hash":"3a6476b6df1d2bef4a21861a78776282a7a11ef1","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.js","hash":"4f99b598f6bb18de9eca8c45c5b4373a03962367","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-video.min.js","hash":"032c001ab045a69856f9c3ed4a2a3bf12a8e310f","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.js","hash":"a758e2c8fcf710f9ff761da0eea0ab9321f3484d","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lg-zoom.min.js","hash":"15b49f9728439819ece15e4295cce254c87a4f45","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.js","hash":"3cd19b33ba99efd5ba1d167da91720566d274b2c","modified":1491956064000},{"_id":"themes/icarus/source/libs/lightgallery/js/lightgallery.min.js","hash":"956ef9b706755318da69ad0b5d7786339d831251","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/59ZRklaO5bWGqF5A9baEERJtnKITppOI_IvcXXDNrsc.woff2","hash":"c4248ea800bd5608344ce163f5658b57e7ef9410","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/K88pR3goAWT7BTt32Z01mxJtnKITppOI_IvcXXDNrsc.woff2","hash":"e0350190d720a8fec0557ab47b318ec4e4486448","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/LWCjsQkB6EMdfHrEVqA1KRJtnKITppOI_IvcXXDNrsc.woff2","hash":"2c5b039b57f62625e88226a938679ec937431ad1","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNShWV49_lSm1NYrwo-zkhivY.woff2","hash":"22413bb8bfb78608c1e25aa1ed5c1f38557df79f","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSj0LW-43aMEzIO6XUTLjad8.woff2","hash":"63eb74ef040aade256f2274a7f31a914edddb0ea","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSpX5f-9o1vgP2EXwfjgl7AY.woff2","hash":"328a22fe3eec71ad9e5ece4d67dd62e79dab6b7f","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSq-j2U0lmluP9RWlSytm3ho.woff2","hash":"4dc6d7174ea6d89f4c45e43e1bfc3e03d8ffebaf","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSugdm0LZdjqr5-oayXSOefg.woff2","hash":"a0b0c389cf46d63c850e61fed572485ff0b68183","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSqaRobkAwv3vxw3jMhVENGA.woff2","hash":"415eee05976ab8b2471602a5ddb78a6c58fc21aa","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/MTP_ySUJH_bn48VBG8sNSv8zf_FOSsgRmwsS7Aa9k2w.woff2","hash":"c5f29fed6632efe0aa83318369f0d8c4061b775b","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/RjgO7rYTmqiVp7vzi-Q5URJtnKITppOI_IvcXXDNrsc.woff2","hash":"be201d32a9aa5d186723ebb3c538be691aa8c53a","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/cJZKeOuBrn4kERxqtaUH3VtXRa8TVwTICgirnJhmVJw.woff2","hash":"afc44700053c9a28f9ab26f6aec4862ac1d0795d","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/u-WUoqrET9fUeobQW7jkRRJtnKITppOI_IvcXXDNrsc.woff2","hash":"113978181dcac77baecef6115a9121d8f6e4fc3a","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBiYE0-AqJ3nfInTTiDXDjU4.woff2","hash":"5067c81462c15422853c94d21a1726865a61634f","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjTOQ_MqJVwkKsUn0wKzc2I.woff2","hash":"b366f2fda2e524eb5ef50058eefff249a3b96e6c","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBjUj_cnvWIuuBMVgbX098Mw.woff2","hash":"d22904914469be735490e3c8cb093c7862896dd5","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBkbcKLIaa1LC45dFaAfauRA.woff2","hash":"ae80fb3cd16339aa7b5da280ab53975523dcaac2","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBmo_sUJ8uO4YLWRInS22T3Y.woff2","hash":"b85efde42fa3a03c32b1d31c6cd74c622fc7916c","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBo4P5ICox8Kq3LLUNMylGO4.woff2","hash":"e75607ba1417181397c700775b84303d5a2957b9","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xjAJXh38I15wypJXxuGMBr6up8jxqWt8HVA3mDhkV_0.woff2","hash":"d0b40a7848703556c6631f24e961a98ca5829255","modified":1491956064000},{"_id":"themes/icarus/source/libs/open-sans/fonts/xozscpT2726on7jbcb_pAhJtnKITppOI_IvcXXDNrsc.woff2","hash":"be365eca44760ce3fc9b377c43d4634958479c69","modified":1491956064000},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasD9V_2ngZ8dMf8fLgjYEouxg.woff2","hash":"942addaec4d3a60af33947a84a3d85f926015947","modified":1491956064000},{"_id":"themes/icarus/source/libs/source-code-pro/fonts/mrl8jkM18OlOQN8JLgasDy2Q8seG17bfDXYR_jUsrzg.woff2","hash":"b0e0bb5ef78db8b15d430d0b9be9d4329289a310","modified":1491956064000},{"_id":"themes/icarus/node_modules/bluebird/js/browser/bluebird.core.js","hash":"6b59fef5650b21ac8c45299c98f4c6a991d56aca","modified":1494515718316},{"_id":"themes/icarus/node_modules/bluebird/js/browser/bluebird.min.js","hash":"3d186ac6d244691754303d3153839bf42b57f7d1","modified":1494515719002},{"_id":"themes/icarus/node_modules/highlight.js/lib/languages/mathematica.js","hash":"78cee2f480b2ddb3e23dc7cebfb0bc07b60e0869","modified":1494515719591},{"_id":"themes/icarus/node_modules/moment/min/locales.min.js","hash":"8dd109cc79263e5f665fd623b91cd031c79536d9","modified":1494515719048},{"_id":"themes/icarus/node_modules/moment/min/moment-with-locales.min.js","hash":"b063846a7c321d3b1b96224d9b6c7318ff587aa6","modified":1494515719493},{"_id":"themes/icarus/source/libs/font-awesome/fonts/FontAwesome.otf","hash":"1b22f17fdc38070de50e6d1ab3a32da71aa2d819","modified":1491956064000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.eot","hash":"965ce8f688fedbeed504efd498bc9c1622d12362","modified":1491956064000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff","hash":"6d7e6a5fc802b13694d8820fc0138037c0977d2e","modified":1491956064000},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.woff2","hash":"97e438cc545714309882fbceadbf344fcaddcec5","modified":1491956064000},{"_id":"themes/icarus/source/libs/jquery/2.1.3/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1491956064000},{"_id":"themes/icarus/.git/logs/refs/remotes/origin/HEAD","hash":"3415dfda0ba4424ccc9a98522ecaad57e92d8b1c","modified":1494427981616},{"_id":"themes/icarus/.git/logs/refs/remotes/origin/master","hash":"a212434443dc6f9a04804cb20889a06617a2ee90","modified":1516257378478},{"_id":"themes/icarus/node_modules/bluebird/js/browser/bluebird.js","hash":"ed088b86547f0b14b351f2ade97f4a39ad8451d0","modified":1494515718796},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/abs.js","hash":"7970d96eb35228bb3ecb4603b63b27d3756367ad","modified":1494515721641},{"_id":"themes/icarus/node_modules/moment/src/lib/format/format.js","hash":"022f3b11c33b096245dd7d727fd31f66f23e33b7","modified":1494515721759},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/add-subtract.js","hash":"0fd8c21e60721fe9945b83988cd2b47122f45c6f","modified":1494515721690},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/as.js","hash":"22402f358f58d8ec75e09851075d4da87690f92c","modified":1494515721650},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/constructor.js","hash":"9b8c51df8302569756215ee82a04840a3251a67f","modified":1494515721666},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/bubble.js","hash":"fd42b8707944aca1780433a52b74ce2f2889fd41","modified":1494515721659},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/create.js","hash":"c9f5aa8cbd54e6f72fea60a3405e98f2db27f299","modified":1494515721676},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/duration.js","hash":"31e369b9d7179286568d61783bcf491e13b85f3c","modified":1494515721740},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/get.js","hash":"a11b95805a9a67d70f3f83d683c880481ec826c5","modified":1494515721696},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/iso-string.js","hash":"2fa876d97d0b4c1b073ca8f388c25f43e7c0ded7","modified":1494515721716},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/humanize.js","hash":"6dbf4405af5bc44e8688b012e1855e52e62cba92","modified":1494515721708},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/prototype.js","hash":"2f7e15caf148beb6855d6906feeffa31133da78d","modified":1494515721724},{"_id":"themes/icarus/node_modules/moment/src/lib/duration/valid.js","hash":"16311f2a2cf6ad766e3c19393a3450a70083d56d","modified":1494515721733},{"_id":"themes/icarus/node_modules/moment/src/lib/create/check-overflow.js","hash":"5eca9703243cdaaf5648cce596d5d9964eb94c98","modified":1494515721555},{"_id":"themes/icarus/node_modules/moment/src/lib/create/date-from-array.js","hash":"163a82cbe1f1c1fa2518826943c282523d65192b","modified":1494515721590},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-anything.js","hash":"f213f5115195de90f372ee44a51ba9eadb25c0ba","modified":1494515721564},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-array.js","hash":"2f2625fa4cdf2d157a0cf9b1b010e381b6517756","modified":1494515721572},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-object.js","hash":"dcb90c6dcfaa874ccb1dda84424137aaf565a244","modified":1494515721577},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-string-and-array.js","hash":"0dd8f1960db97f65ac71395c5c627327ebe7b769","modified":1494515721584},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-string-and-format.js","hash":"afbd37e1bbc2b59746635b8439a8732177203518","modified":1494515721634},{"_id":"themes/icarus/node_modules/moment/src/lib/create/from-string.js","hash":"a98fb8649610948918f07d6c436023cb8b527e52","modified":1494515721602},{"_id":"themes/icarus/node_modules/moment/src/lib/create/local.js","hash":"6b7c65e9ca16eba14ddddeecc1b003b984c78fde","modified":1494515721608},{"_id":"themes/icarus/node_modules/moment/src/lib/create/parsing-flags.js","hash":"99da4478b26bb4c1ed50d5feabd4d1049193986b","modified":1494515721615},{"_id":"themes/icarus/node_modules/moment/src/lib/create/utc.js","hash":"7b05ddc73ee99b7f13f526adbe5ef6d25b87b8b9","modified":1494515721620},{"_id":"themes/icarus/node_modules/moment/src/lib/create/valid.js","hash":"52532d3eda747f160a0150d958de65571aee00de","modified":1494515721626},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/add-subtract.js","hash":"ec42edca925baa1466f472f07caba7b71e5de247","modified":1494515721879},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/calendar.js","hash":"757c364df57f2948148d1d41f7db9bc5cf5cdfb9","modified":1494515722027},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/clone.js","hash":"28653ed90f185af48a3f59fe843b7691bde47ce2","modified":1494515722009},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/compare.js","hash":"11baed31ee42bd8a8436cd1a403208bdc46963ca","modified":1494515721990},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/constructor.js","hash":"ef0d02f717bf7737daddf6a529885dfdf3af54f4","modified":1494515721965},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/creation-data.js","hash":"4673ff4ae13812dd63731aefa0f98fdb58d08bd7","modified":1494515721911},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/diff.js","hash":"2673615fe3f16eb1cb77f9b038466f60b0f33938","modified":1494515721888},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/format.js","hash":"03997a71b08baa3c56d73cc2db2c6bf548d66e30","modified":1494515721898},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/from.js","hash":"76885ca5df3fa448d85db79d21417328c47a7526","modified":1494515721905},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/get-set.js","hash":"16296e75de52771fd8ead8d2f0730ece3fc00c67","modified":1494515722052},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/locale.js","hash":"65a2e75f9d3aba7873ab65c5ce2ff635aa161676","modified":1494515721921},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/moment.js","hash":"87ec5cd2be62750d3d911d7fa48bed7e65d58b72","modified":1494515721940},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/min-max.js","hash":"8fc7d30f7ccfc15fbfab5b340b9349434cbad7ac","modified":1494515721933},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/now.js","hash":"693a36ace148dca0c85c462e8807c754bc5a1826","modified":1494515721947},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/prototype.js","hash":"6bbc0787dc92dbd8bef33f638c6ef7b87777b7c4","modified":1494515721954},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/start-end-of.js","hash":"9998dca34d44284857ef3de6d069c2a6c1ef526a","modified":1494515721976},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/to.js","hash":"c783783792c1e65861196899493580d99e7f5ed9","modified":1494515722017},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/to-type.js","hash":"eb9e331061cdfe96224c395ee32cd13ba01c291f","modified":1494515722002},{"_id":"themes/icarus/node_modules/moment/src/lib/moment/valid.js","hash":"358c8898e1991e71977230a26ef5f96aa4ca03e3","modified":1494515722036},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/base-config.js","hash":"a54ba739ac31f745d39f56c85908ebff3bbd2178","modified":1494515721768},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/constructor.js","hash":"4c99dfd1739fa75db2c2fd920dd5defbdd1f0030","modified":1494515721806},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/calendar.js","hash":"422e8f0d039ab047c6e94cde981fcf4afd48179e","modified":1494515721852},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/en.js","hash":"b8cd576b547ee4dcfde714315f3c6741f77bedcc","modified":1494515721776},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/formats.js","hash":"745faed207ad9922484cf0b551ca0faf45e2cbb0","modified":1494515721784},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/invalid.js","hash":"f719dd1276dceb5593675314c1bd3c4afb33f3c0","modified":1494515721791},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/lists.js","hash":"17d12b7ae719d7edee5106b5e6565a3d634945af","modified":1494515721801},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/locale.js","hash":"2e00925beeb939bef0a1fac476b6c76f9b58c180","modified":1494515721868},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/locales.js","hash":"811c363673c87adacd684373d3f65f42dddcc9ad","modified":1494515721817},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/ordinal.js","hash":"16794f45255732ba8f8a8c20b72eb427ea4c1a97","modified":1494515721823},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/pre-post-format.js","hash":"da591dacc6f6be5e6a38dd204a2c3aba8ebff07f","modified":1494515721829},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/prototype.js","hash":"22a17915e51aa0eeda3e13fffc76762822fa32a1","modified":1494515721835},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/relative.js","hash":"a115cccfbd6d0bfec41c1d53114f2299e6cd05b3","modified":1494515721845},{"_id":"themes/icarus/node_modules/moment/src/lib/locale/set.js","hash":"f53c6d0f3feb85db364fe539143faa1b212821c5","modified":1494515721862},{"_id":"themes/icarus/node_modules/moment/src/lib/parse/regex.js","hash":"ecca165102b92e953a35c9e8cdd19d917cfbcc8a","modified":1494515722065},{"_id":"themes/icarus/node_modules/moment/src/lib/parse/token.js","hash":"70c25cc4e7ac2138c7d7b87881200c2faa143d50","modified":1494515722074},{"_id":"themes/icarus/node_modules/moment/src/lib/units/aliases.js","hash":"d05738b4a8499cac86c552907da325391b84c0aa","modified":1494515722082},{"_id":"themes/icarus/node_modules/moment/src/lib/units/constants.js","hash":"191bac7e3f512f7c878840d9ac4142f83be90ec6","modified":1494515722262},{"_id":"themes/icarus/node_modules/moment/src/lib/units/day-of-week.js","hash":"599a5661160abc0ddda5a351c2caa1604080c678","modified":1494515722230},{"_id":"themes/icarus/node_modules/moment/src/lib/units/day-of-month.js","hash":"f97c299ce27bef09be340dd5d6a2a34c2ac06bc7","modified":1494515722249},{"_id":"themes/icarus/node_modules/moment/src/lib/units/day-of-year.js","hash":"3332403b269764733b11b74570f7878b548ddcdd","modified":1494515722201},{"_id":"themes/icarus/node_modules/moment/src/lib/units/hour.js","hash":"d5f11121bdacbb2d90073799850e321038dca827","modified":1494515722162},{"_id":"themes/icarus/node_modules/moment/src/lib/units/minute.js","hash":"f8a800a3077d4ac78af3ac0ac80f2cb1bb8d3cf1","modified":1494515722102},{"_id":"themes/icarus/node_modules/moment/src/lib/units/millisecond.js","hash":"821ccd1797c28cc384cd21a871913c484ff2611e","modified":1494515722096},{"_id":"themes/icarus/node_modules/moment/src/lib/units/month.js","hash":"9017b003e110bdc60dd95f579c9381cdb64e3968","modified":1494515722126},{"_id":"themes/icarus/node_modules/moment/src/lib/units/offset.js","hash":"f51fc54c4bfab304106ebbe864bdd7e15e8b170a","modified":1494515722146},{"_id":"themes/icarus/node_modules/moment/src/lib/units/priorities.js","hash":"055a4899805f6d3b40504072426e146e666f9cc2","modified":1494515722278},{"_id":"themes/icarus/node_modules/moment/src/lib/units/quarter.js","hash":"482e071ff9d870d4f0db66ff97d957f4175fd790","modified":1494515722168},{"_id":"themes/icarus/node_modules/moment/src/lib/units/second.js","hash":"ed0266435250c25609ad62c4fc2b578ba719015a","modified":1494515722174},{"_id":"themes/icarus/node_modules/moment/src/lib/units/timestamp.js","hash":"f88f2f7a738c12ac183a8a6c75529c99390c892e","modified":1494515722180},{"_id":"themes/icarus/node_modules/moment/src/lib/units/timezone.js","hash":"6003686691e1b58e7a5704077d597c403f01a72a","modified":1494515722188},{"_id":"themes/icarus/node_modules/moment/src/lib/units/units.js","hash":"44ff48f40c6c72cc04eae845d963653d758ff130","modified":1494515722194},{"_id":"themes/icarus/node_modules/moment/src/lib/units/week-calendar-utils.js","hash":"da0d4141725fb331359ab7c7e4e66f476bb38a90","modified":1494515722210},{"_id":"themes/icarus/node_modules/moment/src/lib/units/week-year.js","hash":"876efd2a0d40a20d1f29fd8dbc96deba5796ecf4","modified":1494515722242},{"_id":"themes/icarus/node_modules/moment/src/lib/units/week.js","hash":"fca9262205c450e5045cd59e211950df412ecc8e","modified":1494515722257},{"_id":"themes/icarus/node_modules/moment/src/lib/units/year.js","hash":"eb633bb67c8b88440f2c8b65aba9f6dd45d917fa","modified":1494515722272},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/abs-ceil.js","hash":"cbe89a30190bc1ed24d22f97c4cf824d9ecfe22c","modified":1494515722283},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/abs-floor.js","hash":"14e835a73463b7638602313a8bb999abd879dc1e","modified":1494515722431},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/abs-round.js","hash":"ab565f07682ac2f9526861c3714925d0d516f3a8","modified":1494515722415},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/compare-arrays.js","hash":"98362fe208ec6819fb10c1377e4c29f60df2cd67","modified":1494515722396},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/defaults.js","hash":"23d889aa1c1ebf29489955df68ee0863df09325d","modified":1494515722377},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/deprecate.js","hash":"1f46e2931aa788295eec0f3af7e36b524481cf8b","modified":1494515722359},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/extend.js","hash":"8ddf09c4d51a5cca4a7f389a13530a97abf9267f","modified":1494515722310},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/has-own-prop.js","hash":"29cad3d80496e33e738306d8e33d76ef6f52fafd","modified":1494515722288},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/hooks.js","hash":"83fde0451f1c8d15c73978bbb8d941b083a0177a","modified":1494515722294},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/index-of.js","hash":"b8060c497bbd6f76364bfeffccfab2ef55776ef8","modified":1494515722299},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-array.js","hash":"fefa05cb72285be0bdd3bbcd667ef4c4fc007a41","modified":1494515722304},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-date.js","hash":"de623e76e5abbc4a989105530cb3ea56a7d358ca","modified":1494515722441},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-function.js","hash":"0129d069077b5c9ea4e0b39281a0554489372c23","modified":1494515722316},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-number.js","hash":"83b1e4ec2836fe295de1b24ffef39ed569c586db","modified":1494515722321},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-object-empty.js","hash":"1cb3371ad7e1d766933141a39c70758cba57a291","modified":1494515722328},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-object.js","hash":"2b4153f7a3170e5db5ca8e179726abc31f72e30c","modified":1494515722338},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/is-undefined.js","hash":"073c7156a8b0a1580ef38bed126f0b981ea025bb","modified":1494515722347},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/keys.js","hash":"2a83c998133df29806128760f38e07f9e8540695","modified":1494515722370},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/map.js","hash":"76a82ff4dfdb612ce4233339372b902fbef84768","modified":1494515722386},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/some.js","hash":"f3f99788200e51c767a85fe41efd40409fc817e7","modified":1494515722405},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/to-int.js","hash":"2584cdc4e7102dfa932a8ba84d4051d4f3dde5ed","modified":1494515722423},{"_id":"themes/icarus/node_modules/moment/src/lib/utils/zero-fill.js","hash":"19208d299f6befe694591fd2912306e0f28f1e0d","modified":1494515722436},{"_id":"themes/icarus/node_modules/moment/min/locales.js","hash":"aa34b65f5a2ed9774683b7369f21acb665fa06f7","modified":1494515718798},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/vendor/jslitmus.js","hash":"141af7191b0f8be947e616cab9816e68231230ca","modified":1494515719627},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/vendor/qunit.css","hash":"1cf8b4bfff4b27bfdff531b3f51a34ba1bc7c236","modified":1494515719709},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/vendor/qunit.js","hash":"0d8fdaeec180bcc70af77f58ca31d99f6bded201","modified":1494515719697},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.ttf","hash":"61d8d967807ef12598d81582fa95b9f600c3ee01","modified":1491956064000},{"_id":"themes/icarus/node_modules/moment/min/moment-with-locales.js","hash":"b408c935e497f74dfc88924e0b35a78b2a555539","modified":1494515719338},{"_id":"themes/icarus/node_modules/underscore.string/test/test_underscore/vendor/jquery.js","hash":"0d7896e2bb23f88e26e52b22a075350b354df447","modified":1494515719579},{"_id":"themes/icarus/source/libs/font-awesome/fonts/fontawesome-webfont.svg","hash":"c0522272bbaef2acb3d341912754d6ea2d0ecfc0","modified":1491956064000},{"_id":"themes/icarus/.git/objects/pack/pack-b46b358ba5a6be048e7d7f1380864e23c27edc6e.pack","hash":"81ecac50e942adc90c64f0440714196da6a75ea7","modified":1494427981388}],"Category":[{"name":"elasticsearch","_id":"ckh98hkbn0004dohgda89vuc7"},{"name":"C++","_id":"ckh98hkf6000fdohgfy7k957r"},{"name":"ibatis","_id":"ckh98hkg3000ldohg16pevzpu"},{"name":"tcp","_id":"ckh98hkho000xdohghv73zt87"},{"name":"Java","_id":"ckh98hkil0013dohgvttznf6r"},{"name":"linux","_id":"ckh98hkji0019dohgtrsu28af"},{"name":"mongodb","_id":"ckh98hkju001cdohgzf0mhuhc"},{"name":"mysql","parent":"ckh98hkg3000ldohg16pevzpu","_id":"ckh98hkke001hdohg36c8c9vt"},{"name":"MongoDB","parent":"ckh98hkf6000fdohgfy7k957r","_id":"ckh98hkkv001ldohg5zofuziq"},{"name":"mybatis","_id":"ckh98hkl0001ndohg6ljlw0l4"},{"name":"Socket","parent":"ckh98hkf6000fdohgfy7k957r","_id":"ckh98hkle001qdohgnwpvwreh"},{"name":"zookeeper","_id":"ckh98hklt001wdohg68bt3ys8"},{"name":"Web","_id":"ckh98hkmb0026dohg8mghwvbc"},{"name":"随记","_id":"ckh98hkmk002adohgnvfdslov"},{"name":"resin","parent":"ckh98hkke001hdohg36c8c9vt","_id":"ckh98hkmu002ddohg01t6du1g"}],"Data":[],"Page":[{"title":"关于我","date":"2016-01-20T16:00:00.000Z","_content":"\n---\n\n![less](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/simple.png)\n\n非典型码农，喜好科技资讯，爱装机。航拍，全景制图萌新。\n\n中土世界。\n\n已点属性：\n\n- 三流段子手，机评二十年。\n\n- C++/Java程序猿。\n\n- Less is More.\n\n- 泛学ing\n\n- 待续\n\n- 嗯\n\nps：\n\n  没事的时候多看书准没错，学习新技术，多运动锻炼。","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2016-1-21\n---\n\n---\n\n![less](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/simple.png)\n\n非典型码农，喜好科技资讯，爱装机。航拍，全景制图萌新。\n\n中土世界。\n\n已点属性：\n\n- 三流段子手，机评二十年。\n\n- C++/Java程序猿。\n\n- Less is More.\n\n- 泛学ing\n\n- 待续\n\n- 嗯\n\nps：\n\n  没事的时候多看书准没错，学习新技术，多运动锻炼。","updated":"2018-09-26T15:19:26.385Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckh98hk9u0001dohgw43cwage","content":"<hr>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/simple.png\" alt=\"less\"></p>\n<p>非典型码农，喜好科技资讯，爱装机。航拍，全景制图萌新。</p>\n<p>中土世界。</p>\n<p>已点属性：</p>\n<ul>\n<li><p>三流段子手，机评二十年。</p>\n</li>\n<li><p>C++/Java程序猿。</p>\n</li>\n<li><p>Less is More.</p>\n</li>\n<li><p>泛学ing</p>\n</li>\n<li><p>待续</p>\n</li>\n<li><p>嗯</p>\n</li>\n</ul>\n<p>ps：</p>\n<p>  没事的时候多看书准没错，学习新技术，多运动锻炼。</p>\n","site":{"data":{}},"excerpt":"","more":"<hr>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/simple.png\" alt=\"less\"></p>\n<p>非典型码农，喜好科技资讯，爱装机。航拍，全景制图萌新。</p>\n<p>中土世界。</p>\n<p>已点属性：</p>\n<ul>\n<li><p>三流段子手，机评二十年。</p>\n</li>\n<li><p>C++/Java程序猿。</p>\n</li>\n<li><p>Less is More.</p>\n</li>\n<li><p>泛学ing</p>\n</li>\n<li><p>待续</p>\n</li>\n<li><p>嗯</p>\n</li>\n</ul>\n<p>ps：</p>\n<p>  没事的时候多看书准没错，学习新技术，多运动锻炼。</p>\n"},{"title":"Categories","layout":"categories","_content":"","source":"categories/index.md","raw":"title: \"Categories\"\nlayout: \"categories\"\n---\n","date":"2017-06-15T15:07:51.088Z","updated":"2017-04-12T00:14:24.000Z","path":"categories/index.html","comments":1,"_id":"ckh98hkb40003dohgb2asbu3y","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Tags","layout":"tags","_content":"","source":"tags/index.md","raw":"title: \"Tags\"\nlayout: \"tags\"\n---\n","date":"2017-07-19T13:45:28.752Z","updated":"2017-04-12T00:14:24.000Z","path":"tags/index.html","comments":1,"_id":"ckh98hkd90007dohghv3dbpw1","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Elasticsearch实践(3)-api分页查询","date":"2018-05-16T16:00:00.000Z","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png","_content":"\nelasticsearch系列：\n\n(1)[Elasticsearch实践(1)-搭建及IK中文分词](https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/)\n\n(2)[Elasticsearch实践(2)-索引及索引别名alias](https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/)\n\n(3)[Elasticsearch实践(3)-api分页查询](https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/)\n\nes分页有两种，from size浅分页和scroll深分页，这里对这两种分页都做了实现，使用的是es的java api。from size类似于mysql的limit分页，from偏移，默认为0，size为返回的结果数量，默认为10。在数据量不大的情况下一般会使用from size，数据量大的时候效率比较低，而且很费内存，每次会把from*size条记录全部加载到内存中，对结果返回前进行全局排序，然后丢弃掉范围外的结果，重复这样的操作会导致内存占用过大而使es挂掉，并且受数据条数限制，10000条，需修改索引限制。🤔\n\n<!--more-->\n\nscroll分页通俗来说就是滚屏翻页，设置每页查询数量之后，每次查询会返回一个scroll_id，即当前文档的位置，下次查询再传这个scroll_id给es返回下一页的数据以及一个新的scroll_id，类似于按书页码顺序翻书和游标，遗憾的是不支持跳页。🤔适用于不需要跳页持续批量拉取结果、对所有数据分页或一次性查询大量数据的场景，这种记录文档位置的查询方式效率非常高，也就是常说的倒排索引。下面使用java api实现这两种分页效果。\n\n## 1. 使用from size查询\n\n使用 from and size 的深度分页，比如说 `?size=10&from=10000` 是非常低效的，\n因为 100,000 排序的结果必须从每个分片上取出并重新排序最后返回 10 条。这个过程需要对每个请求页重复。\n\n```shell\ncurl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'\n{ \"from\" : 0, \"size\" : 10,\n  \"query\" : { \"match\" : { \"content\" : \"进口水果\" }}}'\n```\n\n## 2. 使用scroll查询\n\n使用scroll查询，需要设置`scroll_id`的失效时间。\n\n```shell\ncurl '10.10.13.234:9200/index/skuId/_search?scroll=1m'  -d '\n{\n  \"query\" : { \"match\" : { \"name\" : \"进口水果\" }}\n}'\n```\n\n会返回`scroll_id`，根据这个`scroll_id`进行下一次查询\n\n```\ncurl -XGET 10.10.13.234:9200/jd_mall_v2/_search?pretty&scroll=2m -d {\"query\":{\"match_all\":{}}}\ncurl -XGET '10.10.13.234:9200/jd_mall_v2/_search?pretty&scroll=2m&search_type=scan' -d '{\"size\":3,\"query\":{\"match_all\":{}}}'\ncurl –XGET '10.10.13.234:9200/_search/scroll?scroll=2m&pretty\n&scroll_id=c2Nhbjs1OzcyNTY6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjYwOjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7NzI1Nzo3VS04THcyaFJBeTZKMWdqbDhuT05ROzcyNTg6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjU5OjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7MTt0b3RhbF9oaXRzOjUxNTM3MDs='\n\n```\n\n\n\n## 1. 使用es的java api操作\n\njava api可查阅https://es.quanke.name/，\n\n创建springboot工程，可以在[http://start.spring.io/](http://start.spring.io/)\n\n下载springboot工程模板，也可在github:[https://github.com/wonderomg/elasticsearch-visual](https://github.com/wonderomg/elasticsearch-visual)下载本工程。\n\n(1)导入es的maven依赖，pom.xml内容：\n\n```xml\n<!-- Elasticsearch核心依赖包 -->\n<!-- https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch -->\n<dependency>\n  <groupId>org.elasticsearch</groupId>\n  <artifactId>elasticsearch</artifactId>\n  <version>2.2.1</version>\n</dependency>\n\t\t\n```\n\n### 1.1  判断索引是否存在\n\n检验索引是否创建成功，是否存在，通过prepareExists查询指定索引；\n\n```java\n/**\n     * 1.判断索引是否存在\n     *\n     * @param client\n     * @param index\n     * @return\n     */\n    public boolean isIndexExists(Client client, String index) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesExistsResponse response = indicesAdminClient.prepareExists(index).get();\n        return response.isExists();\n        /* 另一种方式\n        IndicesExistsRequest indicesExistsRequest = new IndicesExistsRequest(index);\n        IndicesExistsResponse response = client.admin().indices().exists(indicesExistsRequest).actionGet();*/\n    }\n```\n\n### 1.2 判断类型是否存在 \n\n类型存在的检查与索引的检查类似，只不过类型只挂在索引下，所以需要先指定索引名，然后再查询类型是否存在；\n\n```java\n/**\n     * 2.判断类型是否存在\n     *\n     * @param client\n     * @param index\n     * @param type\n     * @return\n     */\n    public boolean isTypeExists(Client client, String index, String type) {\n        if (!isIndexExists(client, index)) {\n            return false;\n        }\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        TypesExistsResponse response = indicesAdminClient.prepareTypesExists(index).setTypes(type).get();\n        return response.isExists();\n    }\n```\n\n### 1.3 创建复杂索引\n\n```java\n/**\n     * 3.创建复杂索引，即有映射\n     *\n     * @param indices\n     * @param type\n     * @param clusterName\n     * @param host\n     * @param port\n     * @return\n     */\n    public boolean createYxMapping(String indices, String type, String clusterName, String host, int port) {\n        try {\n            Settings settings = Settings.settingsBuilder()\n                    .put(\"cluster.name\", clusterName)\n                    .put(\"client.transport.sniff\", true)\n                    .build();\n            Client client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(host), port));\n            client.admin().indices().prepareCreate(indices).execute().actionGet();\n            new XContentFactory();\n            XContentBuilder builder = XContentFactory.jsonBuilder()\n                    .startObject()\n                    .startObject(type)\n                    .startObject(\"properties\")\n                    .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\", \"ik\").field(\"index\", \"analyzed\").endObject()\n                    .startObject(\"num\").field(\"type\", \"long\").endObject()\n                    .startObject(\"sex\").field(\"type\", \"string\").field(\"index\", \"not_analyzed\").endObject()\n                    .endObject()\n                    .endObject()\n                    .endObject();\n            PutMappingRequest mapping = Requests.putMappingRequest(indices).type(type).source(builder);\n\n            client.admin().indices().putMapping(mapping).actionGet();\n            client.close();\n            return true;\n        } catch (Exception e) {\n            logger.error(\"createMapping error \", e);\n        }\n        return false;\n    }\n```\n\n### 1.4 创建空索引\n\n创建一个空索引，无映射mapping，当我们设计好mapping的相关设置再映射即可，空索引创建如下：\n\n```java\n/**\n * 4.创建空索引  默认setting 无mapping\n * @param client\n * @param index\n * @return\n */\npublic boolean createSimpleIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    CreateIndexResponse response = indicesAdminClient.prepareCreate(index).get();\n    return response.isAcknowledged();\n}\n```\n\n### 1.5 为空索引映射mapping\n\n可以为空索引创建或修改索引的映射，需要确保索引存在，否则会报错，使用如下：\n\n```java\n/**\n * 5.设置映射\n * @param client\n * @param index\n * @param type\n * @return\n */\npublic boolean putIndexMapping(Client client, String index, String type){\n    // mapping\n    XContentBuilder mappingBuilder;\n    try {\n        mappingBuilder = XContentFactory.jsonBuilder()\n                .startObject()\n                .startObject(type)\n                .startObject(\"properties\")\n                .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\", \"ik\").field(\"index\", \"analyzed\").endObject()\n                 .startObject(\"num\").field(\"type\", \"long\").endObject()\n                 .startObject(\"sex\").field(\"type\", \"string\").field(\"index\", \"not_analyzed\").endObject()\n                 .endObject()\n                 .endObject()\n                 .endObject();\n    } catch (Exception e) {\n        logger.error(\"--------- createIndex 创建 mapping 失败：\", e);\n        return false;\n    }\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    PutMappingResponse response = indicesAdminClient.preparePutMapping(index).setType(type).setSource(mappingBuilder).get();\n    return response.isAcknowledged();\n}\n```\n\n\n\n### 1.6 删除索引\n\n删除索引api：\n\n```java\n/**\n     * 6.删除索引\n     *\n     * @param client\n     * @param index\n     */\n    public boolean deleteIndex(Client client, String index) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        DeleteIndexResponse response = indicesAdminClient.prepareDelete(index).execute().actionGet();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.7 关闭索引\n\n如果我们不想直接删除索引，而是仅仅短暂停止某个索引的使用，那么我们可以关闭索引的这个功能，只是短暂使用之，后续可能有恢复的需求，关闭使用如下：\n\n```java\n/**\n * 7.关闭索引\n * @param client\n * @param index\n * @return\n */\npublic boolean closeIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    CloseIndexResponse response = indicesAdminClient.prepareClose(index).get();\n    return response.isAcknowledged();\n}\n\n```\n\n### 1.8 打开索引\n\n既然有关闭索引，那么肯定也有重新打开索引的操作，使用如下：\n\n```java\n/**\n * 8.开启索引\n * @param client\n * @param index\n * @return\n */\npublic boolean openIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    OpenIndexResponse response = indicesAdminClient.prepareOpen(index).get();\n    return response.isAcknowledged();\n}\n```\n\n\n\n### 1.9 判断别名是否存在\n\n上一篇我们学习了索引别名的重要，所以api也不能落下，使用如下：\n\n```java\n/**\n     * 9.判断别名是否存在\n     *\n     * @param\n     * @return\n     */\n    public boolean isAliasExist(Client client, String... aliases) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        AliasesExistResponse response = indicesAdminClient.prepareAliasesExist(aliases).get();\n        return response.isExists();\n    }\n```\n\n### 1.10 添加别名 \n\n别名是映射到实际索引上，所以需要传入实际索引名以及要设置的别名alias，使用如下：\n\n```java\n/**\n     * 10.添加别名\n     *\n     * @param\n     * @return\n     */\n    public boolean addAlias(TransportClient client, String index, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().addAlias(index, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.11 移除别名\n\n当然，添加的别名也可以删除，方便设置新的别名和切换索引别名，使用如下：\n\n```java\n/**\n     * 11.移除别名\n     *\n     * @param\n     * @return\n     */\n    public boolean removeAlias(TransportClient client, String index, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(index, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.12 删除一个别名后再添加一个别名\n\n这里实际上将删除与添加别名放在一起操作，所以需要传就别名和新别名，使用如下：\n\n```java\n/**\n     * 12.删除一个别名后再添加一个\n     *\n     * @param\n     * @return\n     */\n    @Override\n    public boolean removeAndCreateAlias(TransportClient client, String indexOld, String indexNew, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(indexOld, alias)\n                .addAlias(indexNew, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n\n\n\n\n## 2. 创建测试基类连接es\n\n创建test类测试连接、插入、查询数据是否正常。\n\n这里可以模拟一批数据插入es，后面的分页操作对大量数据才看得出效果，我这里有的40万数据加入到es中，方便后面的分页测试。\n\nElasticsearchTest.java:\n\n```java\nimport com.alibaba.fastjson.JSON;\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.sun.controller.DateUtils;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;\nimport org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;\nimport org.elasticsearch.action.delete.DeleteResponse;\nimport org.elasticsearch.action.get.GetResponse;\nimport org.elasticsearch.action.index.IndexResponse;\nimport org.elasticsearch.action.search.SearchRequestBuilder;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.action.search.SearchType;\nimport org.elasticsearch.action.update.UpdateResponse;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.client.Requests;\nimport org.elasticsearch.client.transport.TransportClient;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\nimport org.elasticsearch.common.unit.TimeValue;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.index.query.*;\nimport org.elasticsearch.search.SearchHits;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.io.BufferedReader;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.InputStreamReader;\nimport java.net.InetAddress;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\nimport static org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;\n\n/**\n * 类功能描述:Elasticsearch的基本测试\n *\n * @author liu\n * @since 2018/5/24\n */\npublic class ElasticsearchTest {\n\n    private Logger logger = LoggerFactory.getLogger(ElasticsearchTest.class);\n\n    public final static String HOST = \"10.10.13.234\";\n\n    /** http请求的端口是9200，客户端是9300 */\n    public final static int PORT = 9300;\n\n    Client client;\n    /** 索引库名 */\n    private static String index = \"my_index\";\n    /** 类型名称 */\n    private static String type = \"skuId\";\n    private static String clusterName = \"my-application\";\n\n    /**\n     * 创建mapping，注意：每次只能创建一次\n     * 创建mapping(field(\"indexAnalyzer\",\"ik\")该字段分词IK索引 ；field(\"searchAnalyzer\",\"ik\")该字段分词ik查询；具体分词插件请看IK分词插件说明)\n     * 创建mapping(field(\"analyzer\",\"ik\")该字段分词IK索引 ；field(\"index\",\"analyzed\")该字段分词ik查询；具体分词插件请看IK分词插件说明)2.x版\n     * @param indices 索引名称；\n     * @param mappingType 类型\n     * @throws Exception\n     */\n    @Test\n    public void createMapping()throws Exception {\n        String indices = \"jd_mall_v2\";\n        String mappingType = \"goods\";\n\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        Client client = TransportClient.builder().settings(settings).build()\n                .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n\n        client.admin().indices().prepareCreate(indices).execute().actionGet();\n        new XContentFactory();\n        XContentBuilder builder=XContentFactory.jsonBuilder()\n                .startObject()\n                .startObject(mappingType)\n                .startObject(\"properties\")\n                .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\",\"ik\").field(\"index\",\"analyzed\").endObject()\n                .startObject(\"price\").field(\"type\", \"long\").endObject()\n                .endObject()\n                .endObject()\n                .endObject();\n        PutMappingRequest mapping = Requests.putMappingRequest(indices).type(mappingType).source(builder);\n\n        client.admin().indices().putMapping(mapping).actionGet();\n        client.close();\n    }\n\n\n\n    @Before\n    public void before()\n    {\n\n        /**\n         * 1:通过 setting对象来指定集群配置信息\n         * //指定集群名称\n         * //启动嗅探功能\n         */\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        /**\n         * 2：创建客户端\n         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch\n         * 链接使用tcp协议即9300\n         */\n        try {\n            client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n            System.out.println(\"Elasticsearch connect info:\" + client.toString());\n        } catch (UnknownHostException e) {\n            e.printStackTrace();\n        }\n        /*transportClient = new TransportClient(setting);\n        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);\n        transportClient.addTransportAddresses(transportAddress);*/\n\n        /**\n         * 3：查看集群信息\n         * 注意我的集群结构是：\n         *   131的elasticsearch.yml中指定为主节点不能存储数据，\n         *   128的elasticsearch.yml中指定不为主节点只能存储数据。\n         * 所有控制台只打印了192.168.79.128,只能获取数据节点\n         *\n         */\n        /*ImmutableList<DiscoveryNode> connectedNodes = client.connectedNodes();\n        for(DiscoveryNode node : connectedNodes)\n        {\n            System.out.println(node.getHostAddress());\n        }*/\n\n    }\n\n    /**\n     * 测试Elasticsearch客户端连接\n     * @Title: test1\n     * @author sunt\n     * @date 2017年11月22日\n     * @return void\n     * @throws UnknownHostException\n     */\n    @SuppressWarnings(\"resource\")\n    @Test\n    public void test1() throws UnknownHostException {\n        //创建客户端\n        /*TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddresses(\n                new InetSocketTransportAddress(InetAddress.getByName(HOST),PORT));*/\n        TransportClient client = TransportClient.builder().build().addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n\n        logger.debug(\"Elasticsearch connect info:\" + client.toString());\n        System.out.println(\"Elasticsearch connect info:\" + client.toString());\n\n        //关闭客户端\n        client.close();\n    }\n\n    /**\n     * 查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testGet() throws Exception {\n\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n\n        //获取_id为1的类型\n        /*GetResponse response1 = client.prepareGet(index, \"person\", \"9\").get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));*/\n\n        //获取分词\n        List<String> listAnalysis = getIkAnalyzeSearchTerms(\"进口水果\");\n\n        //List<Map<String, Object>> resultList6 = testMultiQueryStringQuery(index, type, \"name\", listAnalysis);\n        List<Map<String, Object>> resultList3 = testQueryStringQuery(index, type, \"name\", \"进口水果\");\n        //List<Map<String, Object>> resultList4 = getDataByWildcard(index, type, \"name\", \"*水果*\");\n        //List<Map<String, Object>> resultList5 = getDataByMatch(index, type, \"name\", \"进口 水果\");\n        //List<Map<String, Object>> resultList = getQueryDataBySingleField(index, type, \"name\", \"进口水果\");\n        //List<Map<String, Object>> resultList2 = testSearchByPrefix(index, \"name\", \"进口水果\");\n        //System.out.println();\n\n\n    }\n\n    /**\n     * 增查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testCreate() throws Exception {\n        String[] skuIds = {\"2246904\", \"2138027\", \"3724941\", \"5664705\", \"3711635\"};\n        String[] skuNames = {\"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\",\n                            \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",\n                            \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\",\n                            \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\",\n                            \"江西名牌 杨氏精品脐橙 5kg装 铂金果 水果橙子礼盒 2种包装随机发货\"};\n        String[] skuPrices = {\"500\", \"3800\", \"4990\", \"8500\", \"5880\"};\n\n        for (int i=0; i<skuIds.length; i++) {\n            String skuId = skuIds[i];\n            String skuName = skuNames[i];\n            String skuPrice = skuPrices[i];\n\n            String jsonStr = \"{\" +\n                    \"\\\"skuId\\\":\\\"\"+skuId+\"\\\",\" +\n                    \"\\\"skuName\\\":\\\"\"+skuName+\"\\\",\" +\n                    \"\\\"skuPrice\\\":\\\"\"+skuPrice+\"\\\"\" +\n                    \"}\";\n\n\n            //参数说明： 索引，类型 ，_id；//setSource可以传以上map string  byte[] 几种方式\n            IndexResponse response = client.prepareIndex(index, type, skuId)\n                    .setSource(jsonStr,XContentType.JSON)\n                    .get();\n            boolean created = response.isCreated();\n            System.out.println(\"创建一条记录:\" + created);\n\n            //获取_id为1的类型\n            GetResponse response1 = client.prepareGet(index, type, skuId).get();\n            response1.getSourceAsMap();//获取值转换成map\n            System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n        }\n    }\n\n    /**\n     * 删查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testDelete() throws Exception {\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n        String skuImage = \"jfs/t16450/249/461724533/219792/7f204d7a/5a321ecbN4526f7d3.jpg\";\n\n        //删除_id为1的类型\n        DeleteResponse response2 = client.prepareDelete(index, type, skuId).get();\n        System.out.println(\"删除一条数据：\" + response2.isFound());\n\n        //获取_id为1的类型\n        GetResponse response1 = client.prepareGet(index, type, skuId).get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n    }\n\n    /**\n     * 改查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testUpdate() throws Exception {\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n        String skuName2 = \"华圣 陕西精品红富士苹果 12个装 果径75mm 约2.1kg 新鲜水果\";\n        //更新\n        UpdateResponse updateResponse = client.prepareUpdate(index, type, skuId).setDoc(jsonBuilder()\n                .startObject()\n                .field(\"name\", skuName2)\n                .endObject())\n                .get();\n        System.out.println(\"更新一条数据:\" + updateResponse.isCreated());\n\n        //获取_id为1的类型\n        GetResponse response1 = client.prepareGet(index, type, skuId).get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n    }\n\n    /**\n     * 将对象通过jackson.databind转换成byte[]\n     * 注意一下date类型需要格式化处理  默认是 时间戳\n     *\n     * @return\n     */\n    public byte[] convertByteArray(Object obj) {\n        // create once, reuse\n        ObjectMapper mapper = new ObjectMapper();\n        try {\n            byte[] json = mapper.writeValueAsBytes(obj);\n            return json;\n        } catch (JsonProcessingException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * 将对象通过JSONtoString转换成JSON字符串\n     * 使用fastjson 格式化注解  在属性上加入 @JSONField(format=\"yyyy-MM-dd HH:mm:ss\")\n     *\n     * @return\n     */\n    public String jsonStr(Object obj) {\n        return JSON.toJSONString(obj);\n    }\n\n    /*****************************/\n    /**\n            * 根据文档名、字段名、字段值查询某一条记录的详细信息；query查询\n     * @param type  文档名，相当于oracle中的表名，例如：ql_xz；\n            * @param key 字段名，例如：bdcqzh\n     * @param value  字段值，如：“”\n            * @return  List\n     * @author Lixin\n     */\n    public List getQueryDataBySingleField(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        QueryBuilder qb = QueryBuilders.termQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(qb)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 多条件  文档名、字段名、字段值，查询某一条记录的详细信息\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param map 字段名：字段值 的map\n     * @return List\n     * @author Lixin\n     */\n    public List getBoolDataByMuchField(String index, String type, Map<String,String> map){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String in : map.keySet()) {\n            //map.keySet()返回的是所有key的值\n            String str = map.get(in);//得到每个key多对用value的值\n            boolQueryBuilder.must(QueryBuilders.termQuery(in,str));\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 单条件 通配符查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByWildcard(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        WildcardQueryBuilder wBuilder = QueryBuilders.wildcardQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(wBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n    /**\n     * 多条件 通配符查询\n     * @param type  type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param map   包含key:value 模糊值键值对\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByMuchWildcard(String index, String type, Map<String,String> map){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String in : map.keySet()) {\n            //map.keySet()返回的是所有key的值\n            String str = map.get(in);//得到每个key多对用value的值\n            boolQueryBuilder.must(QueryBuilders.wildcardQuery(in,str));\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n\n        return responseToList(client,response);\n    }\n\n    /**\n     * 单条件 模糊拆分查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByMatch(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        MatchQueryBuilder mBuilder = QueryBuilders.matchQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(mBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    /**\n     * 单条件 中文分词模糊查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByPrefix(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        PrefixQueryBuilder pBuilder = QueryBuilders.prefixQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(pBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n    /**\n     * 中文分词的操作\n     * 1.查询以\"中\"开头的数据，有两条\n     * 2.查询以“中国”开头的数据，有0条\n     * 3.查询包含“烂”的数据，有1条\n     * 4.查询包含“烂摊子”的数据，有0条\n     * 分词：\n     *      为什么我们搜索China is the greatest country~\n     *                 中文：中国最牛逼\n     *\n     *                 ×××\n     *                      中华\n     *                      人民\n     *                      共和国\n     *                      中华人民\n     *                      人民共和国\n     *                      华人\n     *                      共和\n     *      特殊的中文分词法：\n     *          庖丁解牛\n     *          IK分词法\n     *          搜狗分词法\n     */\n    public List testSearchByPrefix(String index, String key, String value) {\n        // 在prepareSearch()的参数为索引库列表，意为要从哪些索引库中进行查询\n        SearchResponse response = client.prepareSearch(index)\n                .setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH\n                //.setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH\n                //.setQuery(QueryBuilders.prefixQuery(\"content\", \"烂摊子\"))// 设置相应的query，用于检索，termQuery的参数说明：name是doc中的具体的field，value就是要找的具体的值\n//                .setQuery(QueryBuilders.regexpQuery(\"content\", \".*烂摊子.*\"))\n                .setQuery(QueryBuilders.prefixQuery(key, value))\n                .get();\n        return responseToList(client,response);\n    }\n\n    public List testFuzzyQuery(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        FuzzyQueryBuilder fBuilder = QueryBuilders.fuzzyQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(fBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    public List testQueryStringQuery(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(fBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    public List testMultiQueryStringQuery(String index, String type, String key, List<String> listAnalysis){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String term : listAnalysis) {\n            boolQueryBuilder.should(QueryBuilders.queryStringQuery(term).field(key));\n            //这里可以用must 或者 should 视情况而定\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 将查询后获得的response转成list\n     * @param client\n     * @param response\n     * @return\n     */\n    public List responseToList(Client client, SearchResponse response){\n        SearchHits hits = response.getHits();\n        List<Map<String, Object>> list = new ArrayList<Map<String,Object>>();\n        System.out.println(\"------------------------\");\n        for (int i = 0; i < hits.getHits().length; i++) {\n            Map<String, Object> map = hits.getAt(i).getSource();\n            System.out.println(map.get(\"name\"));\n            list.add(map);\n        }\n        System.out.println(\"------------------------\");\n        //client.close();\n        return list;\n    }\n\n\n\n    /**\n     * 调用 ES 获取 IK 分词后结果\n     *\n     * @param searchContent\n     * @return\n     */\n    private List<String> getIkAnalyzeSearchTerms(String searchContent) {\n        //调用 IK 分词分词\n        AnalyzeRequestBuilder ikRequest = new AnalyzeRequestBuilder(client,\n                AnalyzeAction.INSTANCE, index, searchContent);\n        //ikRequest.setAnalyzer(\"ik\");\n        ikRequest.setTokenizer(\"ik\");\n        List<AnalyzeResponse.AnalyzeToken> ikTokenList = ikRequest.execute().actionGet().getTokens();\n\n        //循环赋值\n        List<String> searchTermList = new ArrayList<>();\n        //ikTokenList.forEach(ikToken -> { searchTermList.add(ikToken.getTerm()); });\n        for (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) {\n            System.out.println(ikToken.getTerm());\n            searchTermList.add(ikToken.getTerm());\n        }\n\n        return searchTermList;\n    }\n\n    /**\n     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：\n     */\n    @Test\n    public void testFromSize() {\n        System.out.println(\"from size 模式启动！\");\n        long begin = System.currentTimeMillis();\n        long count = client.prepareCount(index).setTypes(type).execute()\n                .actionGet().getCount();\n        //QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        SearchRequestBuilder requestBuilder = client.prepareSearch(index).setTypes(type)\n                .setQuery(QueryBuilders.queryStringQuery(\"进口水果\").field(\"name\"));\n        for (int i=0,sum=0; sum<count; i++) {\n            SearchResponse response = requestBuilder.setFrom(i).setSize(3).execute().actionGet();\n            sum += response.getHits().hits().length;\n            responseToList(client,response);\n            System.out.println(\"总量\"+count+\", 已经查到\"+sum);\n        }\n        System.out.println(\"elapsed<\"+(System.currentTimeMillis()-begin)+\">ms.\");\n    }\n    /**\n     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，\n     * 所以实际返回的数量是：分片的数量*size\n     */\n    @Test\n    public void testScroll() {\n        //String index, String type,String key,String value\n        System.out.println(\"scroll 模式启动！\");\n        long begin = System.currentTimeMillis();\n        //QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        //获取Client对象,设置索引名称,搜索类型(SearchType.SCAN),搜索数量,发送请求\n        SearchResponse scrollResponse = client.prepareSearch(index)\n                .setTypes(type)\n                .setQuery(QueryBuilders.queryStringQuery(\"进口水果\").field(\"name\"))\n                .setSearchType(SearchType.SCAN).setSize(3).setScroll(TimeValue.timeValueMinutes(1))\n                .execute().actionGet();\n        //注意:首次搜索并不包含数据，第一次不返回数据，获取总数量\n        long count = scrollResponse.getHits().getTotalHits();\n        for (int i=0,sum=0; sum<count; i++) {\n            scrollResponse = client.prepareSearchScroll(scrollResponse.getScrollId())\n                    .setScroll(TimeValue.timeValueMinutes(8)).execute().actionGet();\n            sum += scrollResponse.getHits().hits().length;\n            responseToList(client,scrollResponse);\n            System.out.println(\"总量\"+count+\", 已经查到\"+sum);\n        }\n        System.out.println(\"elapsed<\"+(System.currentTimeMillis()-begin)+\">ms.\");\n    }\n}\n```\n\n\n\n## 3. 分页代码\n\n创建TestController类，在上述测试都无问题之后，再进行下面的分页操作。\n\nTestController.java：\n\n```java\npackage com.sun.controller;\n\nimport com.alibaba.fastjson.JSONObject;\nimport org.elasticsearch.action.search.SearchRequestBuilder;\nimport org.elasticsearch.action.search.SearchScrollRequestBuilder;\nimport org.elasticsearch.search.SearchHit;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.action.search.SearchType;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.client.transport.TransportClient;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\nimport org.elasticsearch.common.unit.TimeValue;\nimport org.elasticsearch.index.query.BoolQueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.search.SearchHits;\nimport org.elasticsearch.search.sort.SortOrder;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.ResponseBody;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.net.InetAddress;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.concurrent.atomic.AtomicLong;\n\n/**\n * 类功能描述:\n *\n * @author liu\n * @since 2018/2/22\n */\n@RestController\npublic class TestController {\n    private Logger logger = LoggerFactory.getLogger(this.getClass());\n    public final static String HOST = \"10.10.13.234\";\n\n    /** http请求的端口是9200，客户端是9300 */\n    public final static int PORT = 9300;\n\n    /** 索引库名 */\n    private static String index = \"my_index\";\n    /** 类型名称 */\n    private static String type = \"skuId\";\n    private static String clusterName = \"my-application\";\n\n    private static final String template = \"Hello, %s!\";\n    private final AtomicLong counter = new AtomicLong();\n\n    @ResponseBody\n    @RequestMapping(\"/greeting\")\n    public Greeting greeting(@RequestParam(value=\"name\", defaultValue=\"World\") String name) {\n        return new Greeting(counter.incrementAndGet(),\n                String.format(template, name));\n    }\n\n    public long getTotalRows(String keyword, TransportClient client) {\n        long totalRows;\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                .must(QueryBuilders.termQuery(\"status\", 1))\n                .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n        if (keyword == null || keyword.isEmpty()) {\n            totalRows = client.prepareCount(index).setTypes(type)\n                    .execute()\n                    .actionGet().getCount();\n        } else {\n            QueryBuilder fBuilder = QueryBuilders.queryStringQuery(keyword).field(\"name\");\n            boolQueryBuilder.must(fBuilder);\n            totalRows = client.prepareCount(index).setTypes(type)\n                    .setQuery(boolQueryBuilder)\n                    .execute()\n                    .actionGet().getCount();\n        }\n        return totalRows;\n    }\n\n    @ResponseBody\n    @RequestMapping(\"/searchFromSize\")\n    public Object testSearchByFromSize(@RequestParam(required = false) Integer pageIndex, @RequestParam(required = false) Integer pageSize,\n                               @RequestParam(required = false) String keyword, @RequestParam(required = false) String priceSort){\n        logger.info(\"op<testSearchByFromSize> pageIndex<\"+pageIndex+\"> pageSize<\"+pageSize+\"> \" +\n                \"keyword<\"+keyword+\"> priceSort<\"+priceSort+\">\");\n        JSONObject result = new JSONObject();\n        JSONObject goodsResult = new JSONObject();\n        long begin = System.currentTimeMillis();\n        TransportClient client = getClient();\n        long totalRows = getTotalRows(keyword, client);\n        getIkAnalyzeSearchTerms(client, keyword);\n        int from = (pageIndex - 1) * pageSize;\n        List<Map<String, Object>> goodsExportList = testQueryStringQueryFromSize(client, index, type, \"name\",\n                keyword, from, pageSize, priceSort);\n        goodsResult.put( \"goods\", goodsExportList );\n        goodsResult.put( \"pageIndex\", pageIndex );\n        goodsResult.put( \"pageSize\", pageSize );\n        goodsResult.put( \"totalRows\", totalRows );\n\n        result.put( \"success\", true );\n        result.put( \"resultMessage\", \"\" );\n        result.put( \"resultCode\", \"0000\" );\n        result.put( \"result\", goodsResult );\n        System.out.println(\"---op<searchFromSize> elapsed<\"+(System.currentTimeMillis()-begin)+\">ms\");\n        return result;\n    }\n\n    public String scrollIdTemp = \"\";\n\n    @ResponseBody\n    @RequestMapping(\"/searchScroll\")\n    public Object testSearchByScroll(@RequestParam(required = false) String scrollId, @RequestParam(required = false) Integer pageSize,\n                               @RequestParam(required = false) String keyword, @RequestParam(required = false) String priceSort){\n        logger.info(\"op<testSearchByScroll> scrollId<\"+scrollId+\"> pageSize<\"+pageSize+\"> \" +\n                \"keyword<\"+keyword+\"> priceSort<\"+priceSort+\">\");\n        JSONObject result = new JSONObject();\n        JSONObject goodsResult = new JSONObject();\n        long begin = System.currentTimeMillis();\n        scrollIdTemp = scrollId;\n        TransportClient client = getClient();\n        long totalRows = getTotalRows(keyword, client);\n        getIkAnalyzeSearchTerms(client, keyword);\n        List<Map<String, Object>> goodsExportList = testQueryStringQueryScroll(client, index, type, \"name\",\n                keyword, scrollIdTemp, pageSize, priceSort);\n        client.close();\n\n        goodsResult.put( \"goods\", goodsExportList );\n        goodsResult.put( \"scrollId\", scrollIdTemp );\n        goodsResult.put( \"pageSize\", pageSize );\n        goodsResult.put( \"totalRows\", totalRows );\n\n        result.put( \"success\", true );\n        result.put( \"resultMessage\", \"\" );\n        result.put( \"resultCode\", \"0000\" );\n        result.put( \"result\", goodsResult );\n        System.out.println(\"---op<searchScroll> elapsed<\"+(System.currentTimeMillis()-begin)+\">ms\");\n        return result;\n    }\n\n    /**\n     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：\n     */\n    public List testQueryStringQueryFromSize(TransportClient client, String index, String type, String key,\n                                     String value, Integer pageIndex, Integer pageSize ,String priceSort){\n        SearchResponse response = null;\n        List resultList = null;\n        try {\n            //TransportClient client = getClient();\n            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n            if (value == null || value.isEmpty()) {\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n            } else {\n                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1))\n                        .must(fBuilder);\n            }\n\n            if (priceSort == null || priceSort.isEmpty()) {\n                response = client.prepareSearch(index).setTypes(type)\n                        .setQuery(boolQueryBuilder)\n                        .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                        .execute()\n                        .actionGet();\n            } else {\n                if ((\"desc\").equals(priceSort)) {\n                    response = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                            .addSort(\"price\", SortOrder.DESC)\n                            .execute()\n                            .actionGet();\n                } else {\n                    response = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                            .addSort(\"price\", SortOrder.ASC)\n                            .execute()\n                            .actionGet();\n                }\n            }\n            resultList = responseToList(response);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return resultList;\n    }\n    /**\n     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，\n     * 所以实际返回的数量是：分片的数量*size\n     *\n     * Scroll-Scan 方式与普通 scroll 有几点不同：\n     * 1.Scroll-Scan 结果没有排序，按 index 顺序返回，没有排序，可以提高取数据性能。\n     * 2.初始化时只返回 _scroll_id，没有具体的 hits 结果。\n     * 3.size 控制的是每个分片的返回的数据量而不是整个请求返回的数据量。\n     */\n    public List testQueryStringQueryScroll(TransportClient client, String index, String type, String key,\n                                     String value, String scrollId, Integer pageSize ,String priceSort){\n        if (pageSize != null) {\n            //默认有5个分片，\n            pageSize = pageSize/5;\n        }\n        SearchResponse scrollResponse = null;\n        List resultList = null;\n        try {\n            //TransportClient client = getClient();\n            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n            if (value == null || value.isEmpty()) {\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n            } else {\n                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1))\n                        .must(fBuilder);\n            }\n\n            if (scrollId == null || scrollId.isEmpty()) {\n                if (priceSort == null || priceSort.isEmpty()) {\n                    scrollResponse = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                            .execute()\n                            .actionGet();\n                } else {\n                    if ((\"desc\").equals(priceSort)) {\n                        scrollResponse = client.prepareSearch(index).setTypes(type)\n                                .setQuery(boolQueryBuilder)\n                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                                .addSort(\"price\", SortOrder.DESC)\n                                .execute()\n                                .actionGet();\n                    } else {\n                        scrollResponse = client.prepareSearch(index).setTypes(type)\n                                .setQuery(boolQueryBuilder)\n                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                                .addSort(\"price\", SortOrder.ASC)\n                                .execute()\n                                .actionGet();\n                    }\n                }\n                //注意:首次搜索并不包含数据，第一次不返回数据，所以先查一次获取scrollId，在进行第二次scroll查询\n                scrollId = scrollResponse.getScrollId();\n            }\n\n            scrollResponse = client.prepareSearchScroll(scrollId)\n                    .setScroll(TimeValue.timeValueMinutes(5))\n                    .execute()\n                    .actionGet();\n            \n            //注意:首次搜索并不包含数据，第一次不返回数据，获取总数量\n            long count = scrollResponse.getHits().getTotalHits();\n            System.out.println(\"scrollResponse.getHits().getHits().length:\"+scrollResponse.getHits().hits().length);\n            System.out.println(\"scroll count:\"+count);\n\n            //获取本次查询的scrollId\n            scrollIdTemp = scrollResponse.getScrollId();\n            System.out.println(\"--------- searchByScroll scrollID:\"+scrollIdTemp);\n            logger.info(\"--------- searchByScroll scrollID {}\", scrollIdTemp);\n\n            // 搜索结果\n            SearchHit[] searchHits = scrollResponse.getHits().hits();\n            for (SearchHit searchHit : searchHits) {\n                String source = searchHit.getSource().toString();\n                logger.info(\"--------- searchByScroll source {}\", source);\n            }\n            resultList = responseToList(scrollResponse);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n\n        return resultList;\n    }\n\n    /**\n     * 将查询后获得的response转成list\n     * @param response\n     * @return\n     */\n    public List responseToList(SearchResponse response){\n        SearchHits hits = response.getHits();\n        List<Map<String, Object>> list = new ArrayList<>();\n        System.out.println(\"hits.hits().length:\"+hits.hits().length);\n        System.out.println(\"------------------------\");\n        for (int i = 0; i < hits.hits().length; i++) {\n            Map<String, Object> map = hits.getAt(i).getSource();\n            Map<String, Object> resultMap = new HashMap<>(16);\n            System.out.println(map.get(\"name\"));\n            resultMap.put(\"skuId\", map.get(\"skuId\"));\n            resultMap.put(\"name\", map.get(\"name\"));\n            resultMap.put(\"image\", map.get(\"primaryImage\"));\n            resultMap.put(\"price\", map.get(\"luckyPrice\"));\n            list.add(resultMap);\n        }\n        System.out.println(\"------------------------\");\n        return list;\n    }\n\n    public TransportClient getClient() {\n        /**\n         * 1:通过 setting对象来指定集群配置信息\n         * //指定集群名称\n         * //启动嗅探功能\n         */\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        /**\n         * 2：创建客户端\n         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch\n         * 链接使用tcp协议即9300\n         */\n        TransportClient client = null;\n        try {\n            client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n            System.out.println(\"Elasticsearch connect info:\" + client.toString());\n        } catch (UnknownHostException e) {\n            e.printStackTrace();\n        }\n        /*transportClient = new TransportClient(setting);\n        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);\n        transportClient.addTransportAddresses(transportAddress);*/\n\n        /**\n         * 3：查看集群信息\n         * 注意我的集群结构是：\n         *   131的elasticsearch.yml中指定为主节点不能存储数据，\n         *   128的elasticsearch.yml中指定不为主节点只能存储数据。\n         * 所有控制台只打印了192.168.79.128,只能获取数据节点\n         *\n         */\n        /*ImmutableList<DiscoveryNode> connectedNodes = client.connectedNodes();\n        for(DiscoveryNode node : connectedNodes)\n        {\n            System.out.println(node.getHostAddress());\n        }*/\n        return client;\n    }\n\n    /**\n     * 调用 ES 获取 IK 分词后结果\n     *\n     * @param searchContent\n     * @return\n     */\n    private List<String> getIkAnalyzeSearchTerms(Client client, String searchContent) {\n        //调用 IK 分词分词\n        AnalyzeRequestBuilder ikRequest = new AnalyzeRequestBuilder(client,\n                AnalyzeAction.INSTANCE, index, searchContent);\n        //ikRequest.setAnalyzer(\"ik\");\n        ikRequest.setTokenizer(\"ik\");\n        List<AnalyzeResponse.AnalyzeToken> ikTokenList = ikRequest.execute().actionGet().getTokens();\n\n        //循环赋值\n        List<String> searchTermList = new ArrayList<>();\n        //ikTokenList.forEach(ikToken -> { searchTermList.add(ikToken.getTerm()); });\n        for (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) {\n            System.out.println(ikToken.getTerm());\n            searchTermList.add(ikToken.getTerm());\n        }\n\n        return searchTermList;\n    }\n}\n```\n\n\n\n## 4. 前端数据\n\n为上述的分页的数据可视化，加入前端展示页，可按中文关键词搜索分页等操作。\n\nindex.html，以及js操作部分，data.js，由于篇幅问题，下载可移步至github:\n\nhttps://github.com/wonderomg/elasticsearch-visual下载详细内容，\n\n前后端页编写完之后，启动springboot工程，访问`http://localhost:8080/`该工程端口。\n\n可以看到操作 页面，类似下图：\n\n![search](https://raw.githubusercontent.com/wonderomg/elasticsearch-visual/master/search.png)\n\nfrom size和scroll都可通过该页面进行测试。\n\n## 5. 数据限制问题\n\n测试from size时发现一个问题，当数据超过10000条会报错，提示如下：\n\n```shell\nCaused by: QueryPhaseExecutionException[Result window is too large, \nfrom + size must be less than or equal to: [10000] but was [10001]. \nSee the scroll api for a more efficient way to request large data sets. \nThis limit can be set by changing the [index.max_result_window] index level parameter.]\n```\n\n原因是es索引被限制了可查前10000条数据，参数是`max_result_window`，需要我们手动修改这个限制。\n\n(1)查询index.max_result_window\n\n```shell\ncurl -XGET \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\"\n```\n\n(2)更改index.max_result_window\n\n```shell\ncurl -XPUT \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\" -d '{ \"index\" : { \"max_result_window\" : 100000000}}'\n```\n\n设置max_result_window的时候需要先关闭索引，不然会报错`Can't update non dynamic settings[[index.preserve_existing]] for open indices`的错误，可以通过指令关闭，也可以通过head可视化界面关闭和开启，也可以通过上述步骤1.7和1.8的api关闭和开启。\n\n## 6. 排序\n\n分页的时候我们可以还有排序的场景，java api的话增加代码：\n\n```java\nsearchRequestBuilder.addSort(\"publish_time\", SortOrder.DESC);\n```\n\n按照某个字段排序的话，hit.getScore()将会失效\n如果是scroll分页无法进行排序。","source":"_posts/Elasticsearch实践api分页查询.md","raw":"---\ntitle: Elasticsearch实践(3)-api分页查询\ndate: 2018-5-17\ncategories: \n  - elasticsearch\ntags: \n  - elasticsearch\n  - ik中文分词\n  - 分页查询\nthumbnail: https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png\n---\n\nelasticsearch系列：\n\n(1)[Elasticsearch实践(1)-搭建及IK中文分词](https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/)\n\n(2)[Elasticsearch实践(2)-索引及索引别名alias](https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/)\n\n(3)[Elasticsearch实践(3)-api分页查询](https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/)\n\nes分页有两种，from size浅分页和scroll深分页，这里对这两种分页都做了实现，使用的是es的java api。from size类似于mysql的limit分页，from偏移，默认为0，size为返回的结果数量，默认为10。在数据量不大的情况下一般会使用from size，数据量大的时候效率比较低，而且很费内存，每次会把from*size条记录全部加载到内存中，对结果返回前进行全局排序，然后丢弃掉范围外的结果，重复这样的操作会导致内存占用过大而使es挂掉，并且受数据条数限制，10000条，需修改索引限制。🤔\n\n<!--more-->\n\nscroll分页通俗来说就是滚屏翻页，设置每页查询数量之后，每次查询会返回一个scroll_id，即当前文档的位置，下次查询再传这个scroll_id给es返回下一页的数据以及一个新的scroll_id，类似于按书页码顺序翻书和游标，遗憾的是不支持跳页。🤔适用于不需要跳页持续批量拉取结果、对所有数据分页或一次性查询大量数据的场景，这种记录文档位置的查询方式效率非常高，也就是常说的倒排索引。下面使用java api实现这两种分页效果。\n\n## 1. 使用from size查询\n\n使用 from and size 的深度分页，比如说 `?size=10&from=10000` 是非常低效的，\n因为 100,000 排序的结果必须从每个分片上取出并重新排序最后返回 10 条。这个过程需要对每个请求页重复。\n\n```shell\ncurl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'\n{ \"from\" : 0, \"size\" : 10,\n  \"query\" : { \"match\" : { \"content\" : \"进口水果\" }}}'\n```\n\n## 2. 使用scroll查询\n\n使用scroll查询，需要设置`scroll_id`的失效时间。\n\n```shell\ncurl '10.10.13.234:9200/index/skuId/_search?scroll=1m'  -d '\n{\n  \"query\" : { \"match\" : { \"name\" : \"进口水果\" }}\n}'\n```\n\n会返回`scroll_id`，根据这个`scroll_id`进行下一次查询\n\n```\ncurl -XGET 10.10.13.234:9200/jd_mall_v2/_search?pretty&scroll=2m -d {\"query\":{\"match_all\":{}}}\ncurl -XGET '10.10.13.234:9200/jd_mall_v2/_search?pretty&scroll=2m&search_type=scan' -d '{\"size\":3,\"query\":{\"match_all\":{}}}'\ncurl –XGET '10.10.13.234:9200/_search/scroll?scroll=2m&pretty\n&scroll_id=c2Nhbjs1OzcyNTY6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjYwOjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7NzI1Nzo3VS04THcyaFJBeTZKMWdqbDhuT05ROzcyNTg6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjU5OjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7MTt0b3RhbF9oaXRzOjUxNTM3MDs='\n\n```\n\n\n\n## 1. 使用es的java api操作\n\njava api可查阅https://es.quanke.name/，\n\n创建springboot工程，可以在[http://start.spring.io/](http://start.spring.io/)\n\n下载springboot工程模板，也可在github:[https://github.com/wonderomg/elasticsearch-visual](https://github.com/wonderomg/elasticsearch-visual)下载本工程。\n\n(1)导入es的maven依赖，pom.xml内容：\n\n```xml\n<!-- Elasticsearch核心依赖包 -->\n<!-- https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch -->\n<dependency>\n  <groupId>org.elasticsearch</groupId>\n  <artifactId>elasticsearch</artifactId>\n  <version>2.2.1</version>\n</dependency>\n\t\t\n```\n\n### 1.1  判断索引是否存在\n\n检验索引是否创建成功，是否存在，通过prepareExists查询指定索引；\n\n```java\n/**\n     * 1.判断索引是否存在\n     *\n     * @param client\n     * @param index\n     * @return\n     */\n    public boolean isIndexExists(Client client, String index) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesExistsResponse response = indicesAdminClient.prepareExists(index).get();\n        return response.isExists();\n        /* 另一种方式\n        IndicesExistsRequest indicesExistsRequest = new IndicesExistsRequest(index);\n        IndicesExistsResponse response = client.admin().indices().exists(indicesExistsRequest).actionGet();*/\n    }\n```\n\n### 1.2 判断类型是否存在 \n\n类型存在的检查与索引的检查类似，只不过类型只挂在索引下，所以需要先指定索引名，然后再查询类型是否存在；\n\n```java\n/**\n     * 2.判断类型是否存在\n     *\n     * @param client\n     * @param index\n     * @param type\n     * @return\n     */\n    public boolean isTypeExists(Client client, String index, String type) {\n        if (!isIndexExists(client, index)) {\n            return false;\n        }\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        TypesExistsResponse response = indicesAdminClient.prepareTypesExists(index).setTypes(type).get();\n        return response.isExists();\n    }\n```\n\n### 1.3 创建复杂索引\n\n```java\n/**\n     * 3.创建复杂索引，即有映射\n     *\n     * @param indices\n     * @param type\n     * @param clusterName\n     * @param host\n     * @param port\n     * @return\n     */\n    public boolean createYxMapping(String indices, String type, String clusterName, String host, int port) {\n        try {\n            Settings settings = Settings.settingsBuilder()\n                    .put(\"cluster.name\", clusterName)\n                    .put(\"client.transport.sniff\", true)\n                    .build();\n            Client client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(host), port));\n            client.admin().indices().prepareCreate(indices).execute().actionGet();\n            new XContentFactory();\n            XContentBuilder builder = XContentFactory.jsonBuilder()\n                    .startObject()\n                    .startObject(type)\n                    .startObject(\"properties\")\n                    .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\", \"ik\").field(\"index\", \"analyzed\").endObject()\n                    .startObject(\"num\").field(\"type\", \"long\").endObject()\n                    .startObject(\"sex\").field(\"type\", \"string\").field(\"index\", \"not_analyzed\").endObject()\n                    .endObject()\n                    .endObject()\n                    .endObject();\n            PutMappingRequest mapping = Requests.putMappingRequest(indices).type(type).source(builder);\n\n            client.admin().indices().putMapping(mapping).actionGet();\n            client.close();\n            return true;\n        } catch (Exception e) {\n            logger.error(\"createMapping error \", e);\n        }\n        return false;\n    }\n```\n\n### 1.4 创建空索引\n\n创建一个空索引，无映射mapping，当我们设计好mapping的相关设置再映射即可，空索引创建如下：\n\n```java\n/**\n * 4.创建空索引  默认setting 无mapping\n * @param client\n * @param index\n * @return\n */\npublic boolean createSimpleIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    CreateIndexResponse response = indicesAdminClient.prepareCreate(index).get();\n    return response.isAcknowledged();\n}\n```\n\n### 1.5 为空索引映射mapping\n\n可以为空索引创建或修改索引的映射，需要确保索引存在，否则会报错，使用如下：\n\n```java\n/**\n * 5.设置映射\n * @param client\n * @param index\n * @param type\n * @return\n */\npublic boolean putIndexMapping(Client client, String index, String type){\n    // mapping\n    XContentBuilder mappingBuilder;\n    try {\n        mappingBuilder = XContentFactory.jsonBuilder()\n                .startObject()\n                .startObject(type)\n                .startObject(\"properties\")\n                .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\", \"ik\").field(\"index\", \"analyzed\").endObject()\n                 .startObject(\"num\").field(\"type\", \"long\").endObject()\n                 .startObject(\"sex\").field(\"type\", \"string\").field(\"index\", \"not_analyzed\").endObject()\n                 .endObject()\n                 .endObject()\n                 .endObject();\n    } catch (Exception e) {\n        logger.error(\"--------- createIndex 创建 mapping 失败：\", e);\n        return false;\n    }\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    PutMappingResponse response = indicesAdminClient.preparePutMapping(index).setType(type).setSource(mappingBuilder).get();\n    return response.isAcknowledged();\n}\n```\n\n\n\n### 1.6 删除索引\n\n删除索引api：\n\n```java\n/**\n     * 6.删除索引\n     *\n     * @param client\n     * @param index\n     */\n    public boolean deleteIndex(Client client, String index) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        DeleteIndexResponse response = indicesAdminClient.prepareDelete(index).execute().actionGet();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.7 关闭索引\n\n如果我们不想直接删除索引，而是仅仅短暂停止某个索引的使用，那么我们可以关闭索引的这个功能，只是短暂使用之，后续可能有恢复的需求，关闭使用如下：\n\n```java\n/**\n * 7.关闭索引\n * @param client\n * @param index\n * @return\n */\npublic boolean closeIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    CloseIndexResponse response = indicesAdminClient.prepareClose(index).get();\n    return response.isAcknowledged();\n}\n\n```\n\n### 1.8 打开索引\n\n既然有关闭索引，那么肯定也有重新打开索引的操作，使用如下：\n\n```java\n/**\n * 8.开启索引\n * @param client\n * @param index\n * @return\n */\npublic boolean openIndex(Client client, String index){\n    IndicesAdminClient indicesAdminClient = client.admin().indices();\n    OpenIndexResponse response = indicesAdminClient.prepareOpen(index).get();\n    return response.isAcknowledged();\n}\n```\n\n\n\n### 1.9 判断别名是否存在\n\n上一篇我们学习了索引别名的重要，所以api也不能落下，使用如下：\n\n```java\n/**\n     * 9.判断别名是否存在\n     *\n     * @param\n     * @return\n     */\n    public boolean isAliasExist(Client client, String... aliases) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        AliasesExistResponse response = indicesAdminClient.prepareAliasesExist(aliases).get();\n        return response.isExists();\n    }\n```\n\n### 1.10 添加别名 \n\n别名是映射到实际索引上，所以需要传入实际索引名以及要设置的别名alias，使用如下：\n\n```java\n/**\n     * 10.添加别名\n     *\n     * @param\n     * @return\n     */\n    public boolean addAlias(TransportClient client, String index, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().addAlias(index, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.11 移除别名\n\n当然，添加的别名也可以删除，方便设置新的别名和切换索引别名，使用如下：\n\n```java\n/**\n     * 11.移除别名\n     *\n     * @param\n     * @return\n     */\n    public boolean removeAlias(TransportClient client, String index, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(index, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n### 1.12 删除一个别名后再添加一个别名\n\n这里实际上将删除与添加别名放在一起操作，所以需要传就别名和新别名，使用如下：\n\n```java\n/**\n     * 12.删除一个别名后再添加一个\n     *\n     * @param\n     * @return\n     */\n    @Override\n    public boolean removeAndCreateAlias(TransportClient client, String indexOld, String indexNew, String alias) {\n        IndicesAdminClient indicesAdminClient = client.admin().indices();\n        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(indexOld, alias)\n                .addAlias(indexNew, alias).get();\n        return response.isAcknowledged();\n    }\n```\n\n\n\n\n\n## 2. 创建测试基类连接es\n\n创建test类测试连接、插入、查询数据是否正常。\n\n这里可以模拟一批数据插入es，后面的分页操作对大量数据才看得出效果，我这里有的40万数据加入到es中，方便后面的分页测试。\n\nElasticsearchTest.java:\n\n```java\nimport com.alibaba.fastjson.JSON;\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.sun.controller.DateUtils;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;\nimport org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;\nimport org.elasticsearch.action.delete.DeleteResponse;\nimport org.elasticsearch.action.get.GetResponse;\nimport org.elasticsearch.action.index.IndexResponse;\nimport org.elasticsearch.action.search.SearchRequestBuilder;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.action.search.SearchType;\nimport org.elasticsearch.action.update.UpdateResponse;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.client.Requests;\nimport org.elasticsearch.client.transport.TransportClient;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\nimport org.elasticsearch.common.unit.TimeValue;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.index.query.*;\nimport org.elasticsearch.search.SearchHits;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\nimport java.io.BufferedReader;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.InputStreamReader;\nimport java.net.InetAddress;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\nimport static org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;\n\n/**\n * 类功能描述:Elasticsearch的基本测试\n *\n * @author liu\n * @since 2018/5/24\n */\npublic class ElasticsearchTest {\n\n    private Logger logger = LoggerFactory.getLogger(ElasticsearchTest.class);\n\n    public final static String HOST = \"10.10.13.234\";\n\n    /** http请求的端口是9200，客户端是9300 */\n    public final static int PORT = 9300;\n\n    Client client;\n    /** 索引库名 */\n    private static String index = \"my_index\";\n    /** 类型名称 */\n    private static String type = \"skuId\";\n    private static String clusterName = \"my-application\";\n\n    /**\n     * 创建mapping，注意：每次只能创建一次\n     * 创建mapping(field(\"indexAnalyzer\",\"ik\")该字段分词IK索引 ；field(\"searchAnalyzer\",\"ik\")该字段分词ik查询；具体分词插件请看IK分词插件说明)\n     * 创建mapping(field(\"analyzer\",\"ik\")该字段分词IK索引 ；field(\"index\",\"analyzed\")该字段分词ik查询；具体分词插件请看IK分词插件说明)2.x版\n     * @param indices 索引名称；\n     * @param mappingType 类型\n     * @throws Exception\n     */\n    @Test\n    public void createMapping()throws Exception {\n        String indices = \"jd_mall_v2\";\n        String mappingType = \"goods\";\n\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        Client client = TransportClient.builder().settings(settings).build()\n                .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n\n        client.admin().indices().prepareCreate(indices).execute().actionGet();\n        new XContentFactory();\n        XContentBuilder builder=XContentFactory.jsonBuilder()\n                .startObject()\n                .startObject(mappingType)\n                .startObject(\"properties\")\n                .startObject(\"name\").field(\"type\", \"string\").field(\"store\", \"yes\").field(\"analyzer\",\"ik\").field(\"index\",\"analyzed\").endObject()\n                .startObject(\"price\").field(\"type\", \"long\").endObject()\n                .endObject()\n                .endObject()\n                .endObject();\n        PutMappingRequest mapping = Requests.putMappingRequest(indices).type(mappingType).source(builder);\n\n        client.admin().indices().putMapping(mapping).actionGet();\n        client.close();\n    }\n\n\n\n    @Before\n    public void before()\n    {\n\n        /**\n         * 1:通过 setting对象来指定集群配置信息\n         * //指定集群名称\n         * //启动嗅探功能\n         */\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        /**\n         * 2：创建客户端\n         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch\n         * 链接使用tcp协议即9300\n         */\n        try {\n            client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n            System.out.println(\"Elasticsearch connect info:\" + client.toString());\n        } catch (UnknownHostException e) {\n            e.printStackTrace();\n        }\n        /*transportClient = new TransportClient(setting);\n        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);\n        transportClient.addTransportAddresses(transportAddress);*/\n\n        /**\n         * 3：查看集群信息\n         * 注意我的集群结构是：\n         *   131的elasticsearch.yml中指定为主节点不能存储数据，\n         *   128的elasticsearch.yml中指定不为主节点只能存储数据。\n         * 所有控制台只打印了192.168.79.128,只能获取数据节点\n         *\n         */\n        /*ImmutableList<DiscoveryNode> connectedNodes = client.connectedNodes();\n        for(DiscoveryNode node : connectedNodes)\n        {\n            System.out.println(node.getHostAddress());\n        }*/\n\n    }\n\n    /**\n     * 测试Elasticsearch客户端连接\n     * @Title: test1\n     * @author sunt\n     * @date 2017年11月22日\n     * @return void\n     * @throws UnknownHostException\n     */\n    @SuppressWarnings(\"resource\")\n    @Test\n    public void test1() throws UnknownHostException {\n        //创建客户端\n        /*TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddresses(\n                new InetSocketTransportAddress(InetAddress.getByName(HOST),PORT));*/\n        TransportClient client = TransportClient.builder().build().addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n\n        logger.debug(\"Elasticsearch connect info:\" + client.toString());\n        System.out.println(\"Elasticsearch connect info:\" + client.toString());\n\n        //关闭客户端\n        client.close();\n    }\n\n    /**\n     * 查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testGet() throws Exception {\n\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n\n        //获取_id为1的类型\n        /*GetResponse response1 = client.prepareGet(index, \"person\", \"9\").get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));*/\n\n        //获取分词\n        List<String> listAnalysis = getIkAnalyzeSearchTerms(\"进口水果\");\n\n        //List<Map<String, Object>> resultList6 = testMultiQueryStringQuery(index, type, \"name\", listAnalysis);\n        List<Map<String, Object>> resultList3 = testQueryStringQuery(index, type, \"name\", \"进口水果\");\n        //List<Map<String, Object>> resultList4 = getDataByWildcard(index, type, \"name\", \"*水果*\");\n        //List<Map<String, Object>> resultList5 = getDataByMatch(index, type, \"name\", \"进口 水果\");\n        //List<Map<String, Object>> resultList = getQueryDataBySingleField(index, type, \"name\", \"进口水果\");\n        //List<Map<String, Object>> resultList2 = testSearchByPrefix(index, \"name\", \"进口水果\");\n        //System.out.println();\n\n\n    }\n\n    /**\n     * 增查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testCreate() throws Exception {\n        String[] skuIds = {\"2246904\", \"2138027\", \"3724941\", \"5664705\", \"3711635\"};\n        String[] skuNames = {\"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\",\n                            \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",\n                            \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\",\n                            \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\",\n                            \"江西名牌 杨氏精品脐橙 5kg装 铂金果 水果橙子礼盒 2种包装随机发货\"};\n        String[] skuPrices = {\"500\", \"3800\", \"4990\", \"8500\", \"5880\"};\n\n        for (int i=0; i<skuIds.length; i++) {\n            String skuId = skuIds[i];\n            String skuName = skuNames[i];\n            String skuPrice = skuPrices[i];\n\n            String jsonStr = \"{\" +\n                    \"\\\"skuId\\\":\\\"\"+skuId+\"\\\",\" +\n                    \"\\\"skuName\\\":\\\"\"+skuName+\"\\\",\" +\n                    \"\\\"skuPrice\\\":\\\"\"+skuPrice+\"\\\"\" +\n                    \"}\";\n\n\n            //参数说明： 索引，类型 ，_id；//setSource可以传以上map string  byte[] 几种方式\n            IndexResponse response = client.prepareIndex(index, type, skuId)\n                    .setSource(jsonStr,XContentType.JSON)\n                    .get();\n            boolean created = response.isCreated();\n            System.out.println(\"创建一条记录:\" + created);\n\n            //获取_id为1的类型\n            GetResponse response1 = client.prepareGet(index, type, skuId).get();\n            response1.getSourceAsMap();//获取值转换成map\n            System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n        }\n    }\n\n    /**\n     * 删查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testDelete() throws Exception {\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n        String skuImage = \"jfs/t16450/249/461724533/219792/7f204d7a/5a321ecbN4526f7d3.jpg\";\n\n        //删除_id为1的类型\n        DeleteResponse response2 = client.prepareDelete(index, type, skuId).get();\n        System.out.println(\"删除一条数据：\" + response2.isFound());\n\n        //获取_id为1的类型\n        GetResponse response1 = client.prepareGet(index, type, skuId).get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n    }\n\n    /**\n     * 改查\n     *\n     * @throws Exception\n     */\n    @Test\n    public void testUpdate() throws Exception {\n        String skuId = \"3724941\";\n        String skuName = \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\";\n        String skuPrice = \"4990\";\n        String skuName2 = \"华圣 陕西精品红富士苹果 12个装 果径75mm 约2.1kg 新鲜水果\";\n        //更新\n        UpdateResponse updateResponse = client.prepareUpdate(index, type, skuId).setDoc(jsonBuilder()\n                .startObject()\n                .field(\"name\", skuName2)\n                .endObject())\n                .get();\n        System.out.println(\"更新一条数据:\" + updateResponse.isCreated());\n\n        //获取_id为1的类型\n        GetResponse response1 = client.prepareGet(index, type, skuId).get();\n        response1.getSourceAsMap();//获取值转换成map\n        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));\n    }\n\n    /**\n     * 将对象通过jackson.databind转换成byte[]\n     * 注意一下date类型需要格式化处理  默认是 时间戳\n     *\n     * @return\n     */\n    public byte[] convertByteArray(Object obj) {\n        // create once, reuse\n        ObjectMapper mapper = new ObjectMapper();\n        try {\n            byte[] json = mapper.writeValueAsBytes(obj);\n            return json;\n        } catch (JsonProcessingException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    /**\n     * 将对象通过JSONtoString转换成JSON字符串\n     * 使用fastjson 格式化注解  在属性上加入 @JSONField(format=\"yyyy-MM-dd HH:mm:ss\")\n     *\n     * @return\n     */\n    public String jsonStr(Object obj) {\n        return JSON.toJSONString(obj);\n    }\n\n    /*****************************/\n    /**\n            * 根据文档名、字段名、字段值查询某一条记录的详细信息；query查询\n     * @param type  文档名，相当于oracle中的表名，例如：ql_xz；\n            * @param key 字段名，例如：bdcqzh\n     * @param value  字段值，如：“”\n            * @return  List\n     * @author Lixin\n     */\n    public List getQueryDataBySingleField(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        QueryBuilder qb = QueryBuilders.termQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(qb)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 多条件  文档名、字段名、字段值，查询某一条记录的详细信息\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param map 字段名：字段值 的map\n     * @return List\n     * @author Lixin\n     */\n    public List getBoolDataByMuchField(String index, String type, Map<String,String> map){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String in : map.keySet()) {\n            //map.keySet()返回的是所有key的值\n            String str = map.get(in);//得到每个key多对用value的值\n            boolQueryBuilder.must(QueryBuilders.termQuery(in,str));\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 单条件 通配符查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByWildcard(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        WildcardQueryBuilder wBuilder = QueryBuilders.wildcardQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(wBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n    /**\n     * 多条件 通配符查询\n     * @param type  type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param map   包含key:value 模糊值键值对\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByMuchWildcard(String index, String type, Map<String,String> map){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String in : map.keySet()) {\n            //map.keySet()返回的是所有key的值\n            String str = map.get(in);//得到每个key多对用value的值\n            boolQueryBuilder.must(QueryBuilders.wildcardQuery(in,str));\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n\n        return responseToList(client,response);\n    }\n\n    /**\n     * 单条件 模糊拆分查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByMatch(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        MatchQueryBuilder mBuilder = QueryBuilders.matchQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(mBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    /**\n     * 单条件 中文分词模糊查询\n     * @param type 文档名，相当于oracle中的表名，例如：ql_xz\n     * @param key 字段名，例如：bdcqzh\n     * @param value 字段名模糊值：如 *123* ;?123*;?123?;*123?;\n     * @return List\n     * @author Lixin\n     */\n    public List getDataByPrefix(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        PrefixQueryBuilder pBuilder = QueryBuilders.prefixQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(pBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n    /**\n     * 中文分词的操作\n     * 1.查询以\"中\"开头的数据，有两条\n     * 2.查询以“中国”开头的数据，有0条\n     * 3.查询包含“烂”的数据，有1条\n     * 4.查询包含“烂摊子”的数据，有0条\n     * 分词：\n     *      为什么我们搜索China is the greatest country~\n     *                 中文：中国最牛逼\n     *\n     *                 ×××\n     *                      中华\n     *                      人民\n     *                      共和国\n     *                      中华人民\n     *                      人民共和国\n     *                      华人\n     *                      共和\n     *      特殊的中文分词法：\n     *          庖丁解牛\n     *          IK分词法\n     *          搜狗分词法\n     */\n    public List testSearchByPrefix(String index, String key, String value) {\n        // 在prepareSearch()的参数为索引库列表，意为要从哪些索引库中进行查询\n        SearchResponse response = client.prepareSearch(index)\n                .setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH\n                //.setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH\n                //.setQuery(QueryBuilders.prefixQuery(\"content\", \"烂摊子\"))// 设置相应的query，用于检索，termQuery的参数说明：name是doc中的具体的field，value就是要找的具体的值\n//                .setQuery(QueryBuilders.regexpQuery(\"content\", \".*烂摊子.*\"))\n                .setQuery(QueryBuilders.prefixQuery(key, value))\n                .get();\n        return responseToList(client,response);\n    }\n\n    public List testFuzzyQuery(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        FuzzyQueryBuilder fBuilder = QueryBuilders.fuzzyQuery(key, value);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(fBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    public List testQueryStringQuery(String index, String type, String key, String value){\n        //TransportClient client = getClient();\n        QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(fBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n    public List testMultiQueryStringQuery(String index, String type, String key, List<String> listAnalysis){\n        //TransportClient client = getClient();\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        for (String term : listAnalysis) {\n            boolQueryBuilder.should(QueryBuilders.queryStringQuery(term).field(key));\n            //这里可以用must 或者 should 视情况而定\n        }\n        SearchResponse response = client.prepareSearch(index).setTypes(type)\n                .setQuery(boolQueryBuilder)\n                .setFrom(0).setSize(10000).setExplain(true)\n                .execute()\n                .actionGet();\n        return responseToList(client,response);\n    }\n\n\n    /**\n     * 将查询后获得的response转成list\n     * @param client\n     * @param response\n     * @return\n     */\n    public List responseToList(Client client, SearchResponse response){\n        SearchHits hits = response.getHits();\n        List<Map<String, Object>> list = new ArrayList<Map<String,Object>>();\n        System.out.println(\"------------------------\");\n        for (int i = 0; i < hits.getHits().length; i++) {\n            Map<String, Object> map = hits.getAt(i).getSource();\n            System.out.println(map.get(\"name\"));\n            list.add(map);\n        }\n        System.out.println(\"------------------------\");\n        //client.close();\n        return list;\n    }\n\n\n\n    /**\n     * 调用 ES 获取 IK 分词后结果\n     *\n     * @param searchContent\n     * @return\n     */\n    private List<String> getIkAnalyzeSearchTerms(String searchContent) {\n        //调用 IK 分词分词\n        AnalyzeRequestBuilder ikRequest = new AnalyzeRequestBuilder(client,\n                AnalyzeAction.INSTANCE, index, searchContent);\n        //ikRequest.setAnalyzer(\"ik\");\n        ikRequest.setTokenizer(\"ik\");\n        List<AnalyzeResponse.AnalyzeToken> ikTokenList = ikRequest.execute().actionGet().getTokens();\n\n        //循环赋值\n        List<String> searchTermList = new ArrayList<>();\n        //ikTokenList.forEach(ikToken -> { searchTermList.add(ikToken.getTerm()); });\n        for (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) {\n            System.out.println(ikToken.getTerm());\n            searchTermList.add(ikToken.getTerm());\n        }\n\n        return searchTermList;\n    }\n\n    /**\n     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：\n     */\n    @Test\n    public void testFromSize() {\n        System.out.println(\"from size 模式启动！\");\n        long begin = System.currentTimeMillis();\n        long count = client.prepareCount(index).setTypes(type).execute()\n                .actionGet().getCount();\n        //QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        SearchRequestBuilder requestBuilder = client.prepareSearch(index).setTypes(type)\n                .setQuery(QueryBuilders.queryStringQuery(\"进口水果\").field(\"name\"));\n        for (int i=0,sum=0; sum<count; i++) {\n            SearchResponse response = requestBuilder.setFrom(i).setSize(3).execute().actionGet();\n            sum += response.getHits().hits().length;\n            responseToList(client,response);\n            System.out.println(\"总量\"+count+\", 已经查到\"+sum);\n        }\n        System.out.println(\"elapsed<\"+(System.currentTimeMillis()-begin)+\">ms.\");\n    }\n    /**\n     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，\n     * 所以实际返回的数量是：分片的数量*size\n     */\n    @Test\n    public void testScroll() {\n        //String index, String type,String key,String value\n        System.out.println(\"scroll 模式启动！\");\n        long begin = System.currentTimeMillis();\n        //QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);\n        //获取Client对象,设置索引名称,搜索类型(SearchType.SCAN),搜索数量,发送请求\n        SearchResponse scrollResponse = client.prepareSearch(index)\n                .setTypes(type)\n                .setQuery(QueryBuilders.queryStringQuery(\"进口水果\").field(\"name\"))\n                .setSearchType(SearchType.SCAN).setSize(3).setScroll(TimeValue.timeValueMinutes(1))\n                .execute().actionGet();\n        //注意:首次搜索并不包含数据，第一次不返回数据，获取总数量\n        long count = scrollResponse.getHits().getTotalHits();\n        for (int i=0,sum=0; sum<count; i++) {\n            scrollResponse = client.prepareSearchScroll(scrollResponse.getScrollId())\n                    .setScroll(TimeValue.timeValueMinutes(8)).execute().actionGet();\n            sum += scrollResponse.getHits().hits().length;\n            responseToList(client,scrollResponse);\n            System.out.println(\"总量\"+count+\", 已经查到\"+sum);\n        }\n        System.out.println(\"elapsed<\"+(System.currentTimeMillis()-begin)+\">ms.\");\n    }\n}\n```\n\n\n\n## 3. 分页代码\n\n创建TestController类，在上述测试都无问题之后，再进行下面的分页操作。\n\nTestController.java：\n\n```java\npackage com.sun.controller;\n\nimport com.alibaba.fastjson.JSONObject;\nimport org.elasticsearch.action.search.SearchRequestBuilder;\nimport org.elasticsearch.action.search.SearchScrollRequestBuilder;\nimport org.elasticsearch.search.SearchHit;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;\nimport org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.action.search.SearchType;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.client.transport.TransportClient;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.transport.InetSocketTransportAddress;\nimport org.elasticsearch.common.unit.TimeValue;\nimport org.elasticsearch.index.query.BoolQueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.search.SearchHits;\nimport org.elasticsearch.search.sort.SortOrder;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestParam;\nimport org.springframework.web.bind.annotation.ResponseBody;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.net.InetAddress;\nimport java.net.UnknownHostException;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.concurrent.atomic.AtomicLong;\n\n/**\n * 类功能描述:\n *\n * @author liu\n * @since 2018/2/22\n */\n@RestController\npublic class TestController {\n    private Logger logger = LoggerFactory.getLogger(this.getClass());\n    public final static String HOST = \"10.10.13.234\";\n\n    /** http请求的端口是9200，客户端是9300 */\n    public final static int PORT = 9300;\n\n    /** 索引库名 */\n    private static String index = \"my_index\";\n    /** 类型名称 */\n    private static String type = \"skuId\";\n    private static String clusterName = \"my-application\";\n\n    private static final String template = \"Hello, %s!\";\n    private final AtomicLong counter = new AtomicLong();\n\n    @ResponseBody\n    @RequestMapping(\"/greeting\")\n    public Greeting greeting(@RequestParam(value=\"name\", defaultValue=\"World\") String name) {\n        return new Greeting(counter.incrementAndGet(),\n                String.format(template, name));\n    }\n\n    public long getTotalRows(String keyword, TransportClient client) {\n        long totalRows;\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n        boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                .must(QueryBuilders.termQuery(\"status\", 1))\n                .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n        if (keyword == null || keyword.isEmpty()) {\n            totalRows = client.prepareCount(index).setTypes(type)\n                    .execute()\n                    .actionGet().getCount();\n        } else {\n            QueryBuilder fBuilder = QueryBuilders.queryStringQuery(keyword).field(\"name\");\n            boolQueryBuilder.must(fBuilder);\n            totalRows = client.prepareCount(index).setTypes(type)\n                    .setQuery(boolQueryBuilder)\n                    .execute()\n                    .actionGet().getCount();\n        }\n        return totalRows;\n    }\n\n    @ResponseBody\n    @RequestMapping(\"/searchFromSize\")\n    public Object testSearchByFromSize(@RequestParam(required = false) Integer pageIndex, @RequestParam(required = false) Integer pageSize,\n                               @RequestParam(required = false) String keyword, @RequestParam(required = false) String priceSort){\n        logger.info(\"op<testSearchByFromSize> pageIndex<\"+pageIndex+\"> pageSize<\"+pageSize+\"> \" +\n                \"keyword<\"+keyword+\"> priceSort<\"+priceSort+\">\");\n        JSONObject result = new JSONObject();\n        JSONObject goodsResult = new JSONObject();\n        long begin = System.currentTimeMillis();\n        TransportClient client = getClient();\n        long totalRows = getTotalRows(keyword, client);\n        getIkAnalyzeSearchTerms(client, keyword);\n        int from = (pageIndex - 1) * pageSize;\n        List<Map<String, Object>> goodsExportList = testQueryStringQueryFromSize(client, index, type, \"name\",\n                keyword, from, pageSize, priceSort);\n        goodsResult.put( \"goods\", goodsExportList );\n        goodsResult.put( \"pageIndex\", pageIndex );\n        goodsResult.put( \"pageSize\", pageSize );\n        goodsResult.put( \"totalRows\", totalRows );\n\n        result.put( \"success\", true );\n        result.put( \"resultMessage\", \"\" );\n        result.put( \"resultCode\", \"0000\" );\n        result.put( \"result\", goodsResult );\n        System.out.println(\"---op<searchFromSize> elapsed<\"+(System.currentTimeMillis()-begin)+\">ms\");\n        return result;\n    }\n\n    public String scrollIdTemp = \"\";\n\n    @ResponseBody\n    @RequestMapping(\"/searchScroll\")\n    public Object testSearchByScroll(@RequestParam(required = false) String scrollId, @RequestParam(required = false) Integer pageSize,\n                               @RequestParam(required = false) String keyword, @RequestParam(required = false) String priceSort){\n        logger.info(\"op<testSearchByScroll> scrollId<\"+scrollId+\"> pageSize<\"+pageSize+\"> \" +\n                \"keyword<\"+keyword+\"> priceSort<\"+priceSort+\">\");\n        JSONObject result = new JSONObject();\n        JSONObject goodsResult = new JSONObject();\n        long begin = System.currentTimeMillis();\n        scrollIdTemp = scrollId;\n        TransportClient client = getClient();\n        long totalRows = getTotalRows(keyword, client);\n        getIkAnalyzeSearchTerms(client, keyword);\n        List<Map<String, Object>> goodsExportList = testQueryStringQueryScroll(client, index, type, \"name\",\n                keyword, scrollIdTemp, pageSize, priceSort);\n        client.close();\n\n        goodsResult.put( \"goods\", goodsExportList );\n        goodsResult.put( \"scrollId\", scrollIdTemp );\n        goodsResult.put( \"pageSize\", pageSize );\n        goodsResult.put( \"totalRows\", totalRows );\n\n        result.put( \"success\", true );\n        result.put( \"resultMessage\", \"\" );\n        result.put( \"resultCode\", \"0000\" );\n        result.put( \"result\", goodsResult );\n        System.out.println(\"---op<searchScroll> elapsed<\"+(System.currentTimeMillis()-begin)+\">ms\");\n        return result;\n    }\n\n    /**\n     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：\n     */\n    public List testQueryStringQueryFromSize(TransportClient client, String index, String type, String key,\n                                     String value, Integer pageIndex, Integer pageSize ,String priceSort){\n        SearchResponse response = null;\n        List resultList = null;\n        try {\n            //TransportClient client = getClient();\n            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n            if (value == null || value.isEmpty()) {\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n            } else {\n                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1))\n                        .must(fBuilder);\n            }\n\n            if (priceSort == null || priceSort.isEmpty()) {\n                response = client.prepareSearch(index).setTypes(type)\n                        .setQuery(boolQueryBuilder)\n                        .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                        .execute()\n                        .actionGet();\n            } else {\n                if ((\"desc\").equals(priceSort)) {\n                    response = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                            .addSort(\"price\", SortOrder.DESC)\n                            .execute()\n                            .actionGet();\n                } else {\n                    response = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setFrom(pageIndex).setSize(pageSize).setExplain(true)\n                            .addSort(\"price\", SortOrder.ASC)\n                            .execute()\n                            .actionGet();\n                }\n            }\n            resultList = responseToList(response);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return resultList;\n    }\n    /**\n     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，\n     * 所以实际返回的数量是：分片的数量*size\n     *\n     * Scroll-Scan 方式与普通 scroll 有几点不同：\n     * 1.Scroll-Scan 结果没有排序，按 index 顺序返回，没有排序，可以提高取数据性能。\n     * 2.初始化时只返回 _scroll_id，没有具体的 hits 结果。\n     * 3.size 控制的是每个分片的返回的数据量而不是整个请求返回的数据量。\n     */\n    public List testQueryStringQueryScroll(TransportClient client, String index, String type, String key,\n                                     String value, String scrollId, Integer pageSize ,String priceSort){\n        if (pageSize != null) {\n            //默认有5个分片，\n            pageSize = pageSize/5;\n        }\n        SearchResponse scrollResponse = null;\n        List resultList = null;\n        try {\n            //TransportClient client = getClient();\n            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n            if (value == null || value.isEmpty()) {\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1));\n            } else {\n                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);\n                boolQueryBuilder.must(QueryBuilders.termQuery(\"isShow\", 1))\n                        .must(QueryBuilders.termQuery(\"status\", 1))\n                        .must(QueryBuilders.termQuery(\"deleteStatus\", 1))\n                        .must(QueryBuilders.termQuery(\"salesStatus\", 1))\n                        .must(fBuilder);\n            }\n\n            if (scrollId == null || scrollId.isEmpty()) {\n                if (priceSort == null || priceSort.isEmpty()) {\n                    scrollResponse = client.prepareSearch(index).setTypes(type)\n                            .setQuery(boolQueryBuilder)\n                            .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                            .execute()\n                            .actionGet();\n                } else {\n                    if ((\"desc\").equals(priceSort)) {\n                        scrollResponse = client.prepareSearch(index).setTypes(type)\n                                .setQuery(boolQueryBuilder)\n                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                                .addSort(\"price\", SortOrder.DESC)\n                                .execute()\n                                .actionGet();\n                    } else {\n                        scrollResponse = client.prepareSearch(index).setTypes(type)\n                                .setQuery(boolQueryBuilder)\n                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(5))\n                                .addSort(\"price\", SortOrder.ASC)\n                                .execute()\n                                .actionGet();\n                    }\n                }\n                //注意:首次搜索并不包含数据，第一次不返回数据，所以先查一次获取scrollId，在进行第二次scroll查询\n                scrollId = scrollResponse.getScrollId();\n            }\n\n            scrollResponse = client.prepareSearchScroll(scrollId)\n                    .setScroll(TimeValue.timeValueMinutes(5))\n                    .execute()\n                    .actionGet();\n            \n            //注意:首次搜索并不包含数据，第一次不返回数据，获取总数量\n            long count = scrollResponse.getHits().getTotalHits();\n            System.out.println(\"scrollResponse.getHits().getHits().length:\"+scrollResponse.getHits().hits().length);\n            System.out.println(\"scroll count:\"+count);\n\n            //获取本次查询的scrollId\n            scrollIdTemp = scrollResponse.getScrollId();\n            System.out.println(\"--------- searchByScroll scrollID:\"+scrollIdTemp);\n            logger.info(\"--------- searchByScroll scrollID {}\", scrollIdTemp);\n\n            // 搜索结果\n            SearchHit[] searchHits = scrollResponse.getHits().hits();\n            for (SearchHit searchHit : searchHits) {\n                String source = searchHit.getSource().toString();\n                logger.info(\"--------- searchByScroll source {}\", source);\n            }\n            resultList = responseToList(scrollResponse);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n\n        return resultList;\n    }\n\n    /**\n     * 将查询后获得的response转成list\n     * @param response\n     * @return\n     */\n    public List responseToList(SearchResponse response){\n        SearchHits hits = response.getHits();\n        List<Map<String, Object>> list = new ArrayList<>();\n        System.out.println(\"hits.hits().length:\"+hits.hits().length);\n        System.out.println(\"------------------------\");\n        for (int i = 0; i < hits.hits().length; i++) {\n            Map<String, Object> map = hits.getAt(i).getSource();\n            Map<String, Object> resultMap = new HashMap<>(16);\n            System.out.println(map.get(\"name\"));\n            resultMap.put(\"skuId\", map.get(\"skuId\"));\n            resultMap.put(\"name\", map.get(\"name\"));\n            resultMap.put(\"image\", map.get(\"primaryImage\"));\n            resultMap.put(\"price\", map.get(\"luckyPrice\"));\n            list.add(resultMap);\n        }\n        System.out.println(\"------------------------\");\n        return list;\n    }\n\n    public TransportClient getClient() {\n        /**\n         * 1:通过 setting对象来指定集群配置信息\n         * //指定集群名称\n         * //启动嗅探功能\n         */\n        Settings settings = Settings.settingsBuilder()\n                .put(\"cluster.name\", clusterName)\n                .put(\"client.transport.sniff\", true)\n                .build();\n\n        /**\n         * 2：创建客户端\n         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch\n         * 链接使用tcp协议即9300\n         */\n        TransportClient client = null;\n        try {\n            client = TransportClient.builder().settings(settings).build()\n                    .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));\n            System.out.println(\"Elasticsearch connect info:\" + client.toString());\n        } catch (UnknownHostException e) {\n            e.printStackTrace();\n        }\n        /*transportClient = new TransportClient(setting);\n        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);\n        transportClient.addTransportAddresses(transportAddress);*/\n\n        /**\n         * 3：查看集群信息\n         * 注意我的集群结构是：\n         *   131的elasticsearch.yml中指定为主节点不能存储数据，\n         *   128的elasticsearch.yml中指定不为主节点只能存储数据。\n         * 所有控制台只打印了192.168.79.128,只能获取数据节点\n         *\n         */\n        /*ImmutableList<DiscoveryNode> connectedNodes = client.connectedNodes();\n        for(DiscoveryNode node : connectedNodes)\n        {\n            System.out.println(node.getHostAddress());\n        }*/\n        return client;\n    }\n\n    /**\n     * 调用 ES 获取 IK 分词后结果\n     *\n     * @param searchContent\n     * @return\n     */\n    private List<String> getIkAnalyzeSearchTerms(Client client, String searchContent) {\n        //调用 IK 分词分词\n        AnalyzeRequestBuilder ikRequest = new AnalyzeRequestBuilder(client,\n                AnalyzeAction.INSTANCE, index, searchContent);\n        //ikRequest.setAnalyzer(\"ik\");\n        ikRequest.setTokenizer(\"ik\");\n        List<AnalyzeResponse.AnalyzeToken> ikTokenList = ikRequest.execute().actionGet().getTokens();\n\n        //循环赋值\n        List<String> searchTermList = new ArrayList<>();\n        //ikTokenList.forEach(ikToken -> { searchTermList.add(ikToken.getTerm()); });\n        for (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) {\n            System.out.println(ikToken.getTerm());\n            searchTermList.add(ikToken.getTerm());\n        }\n\n        return searchTermList;\n    }\n}\n```\n\n\n\n## 4. 前端数据\n\n为上述的分页的数据可视化，加入前端展示页，可按中文关键词搜索分页等操作。\n\nindex.html，以及js操作部分，data.js，由于篇幅问题，下载可移步至github:\n\nhttps://github.com/wonderomg/elasticsearch-visual下载详细内容，\n\n前后端页编写完之后，启动springboot工程，访问`http://localhost:8080/`该工程端口。\n\n可以看到操作 页面，类似下图：\n\n![search](https://raw.githubusercontent.com/wonderomg/elasticsearch-visual/master/search.png)\n\nfrom size和scroll都可通过该页面进行测试。\n\n## 5. 数据限制问题\n\n测试from size时发现一个问题，当数据超过10000条会报错，提示如下：\n\n```shell\nCaused by: QueryPhaseExecutionException[Result window is too large, \nfrom + size must be less than or equal to: [10000] but was [10001]. \nSee the scroll api for a more efficient way to request large data sets. \nThis limit can be set by changing the [index.max_result_window] index level parameter.]\n```\n\n原因是es索引被限制了可查前10000条数据，参数是`max_result_window`，需要我们手动修改这个限制。\n\n(1)查询index.max_result_window\n\n```shell\ncurl -XGET \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\"\n```\n\n(2)更改index.max_result_window\n\n```shell\ncurl -XPUT \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\" -d '{ \"index\" : { \"max_result_window\" : 100000000}}'\n```\n\n设置max_result_window的时候需要先关闭索引，不然会报错`Can't update non dynamic settings[[index.preserve_existing]] for open indices`的错误，可以通过指令关闭，也可以通过head可视化界面关闭和开启，也可以通过上述步骤1.7和1.8的api关闭和开启。\n\n## 6. 排序\n\n分页的时候我们可以还有排序的场景，java api的话增加代码：\n\n```java\nsearchRequestBuilder.addSort(\"publish_time\", SortOrder.DESC);\n```\n\n按照某个字段排序的话，hit.getScore()将会失效\n如果是scroll分页无法进行排序。","slug":"Elasticsearch实践api分页查询","published":1,"updated":"2018-09-28T14:09:37.461Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hk8p0000dohguq94qjrn","content":"<p>elasticsearch系列：</p>\n<p>(1)<a href=\"https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/\">Elasticsearch实践(1)-搭建及IK中文分词</a></p>\n<p>(2)<a href=\"https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/\">Elasticsearch实践(2)-索引及索引别名alias</a></p>\n<p>(3)<a href=\"https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/\">Elasticsearch实践(3)-api分页查询</a></p>\n<p>es分页有两种，from size浅分页和scroll深分页，这里对这两种分页都做了实现，使用的是es的java api。from size类似于mysql的limit分页，from偏移，默认为0，size为返回的结果数量，默认为10。在数据量不大的情况下一般会使用from size，数据量大的时候效率比较低，而且很费内存，每次会把from*size条记录全部加载到内存中，对结果返回前进行全局排序，然后丢弃掉范围外的结果，重复这样的操作会导致内存占用过大而使es挂掉，并且受数据条数限制，10000条，需修改索引限制。🤔</p>\n<a id=\"more\"></a>\n<p>scroll分页通俗来说就是滚屏翻页，设置每页查询数量之后，每次查询会返回一个scroll_id，即当前文档的位置，下次查询再传这个scroll_id给es返回下一页的数据以及一个新的scroll_id，类似于按书页码顺序翻书和游标，遗憾的是不支持跳页。🤔适用于不需要跳页持续批量拉取结果、对所有数据分页或一次性查询大量数据的场景，这种记录文档位置的查询方式效率非常高，也就是常说的倒排索引。下面使用java api实现这两种分页效果。</p>\n<h2 id=\"1-使用from-size查询\"><a href=\"#1-使用from-size查询\" class=\"headerlink\" title=\"1. 使用from size查询\"></a>1. 使用from size查询</h2><p>使用 from and size 的深度分页，比如说 <code>?size=10&amp;from=10000</code> 是非常低效的，<br>因为 100,000 排序的结果必须从每个分片上取出并重新排序最后返回 10 条。这个过程需要对每个请求页重复。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'</div><div class=\"line\">&#123; \"from\" : 0, \"size\" : 10,</div><div class=\"line\">  \"query\" : &#123; \"match\" : &#123; \"content\" : \"进口水果\" &#125;&#125;&#125;'</div></pre></td></tr></table></figure>\n<h2 id=\"2-使用scroll查询\"><a href=\"#2-使用scroll查询\" class=\"headerlink\" title=\"2. 使用scroll查询\"></a>2. 使用scroll查询</h2><p>使用scroll查询，需要设置<code>scroll_id</code>的失效时间。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl '10.10.13.234:9200/index/skuId/_search?scroll=1m'  -d '</div><div class=\"line\">&#123;</div><div class=\"line\">  \"query\" : &#123; \"match\" : &#123; \"name\" : \"进口水果\" &#125;&#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>会返回<code>scroll_id</code>，根据这个<code>scroll_id</code>进行下一次查询</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XGET 10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m -d &#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;</div><div class=\"line\">curl -XGET &apos;10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m&amp;search_type=scan&apos; -d &apos;&#123;&quot;size&quot;:3,&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&apos;</div><div class=\"line\">curl –XGET &apos;10.10.13.234:9200/_search/scroll?scroll=2m&amp;pretty</div><div class=\"line\">&amp;scroll_id=c2Nhbjs1OzcyNTY6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjYwOjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7NzI1Nzo3VS04THcyaFJBeTZKMWdqbDhuT05ROzcyNTg6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjU5OjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7MTt0b3RhbF9oaXRzOjUxNTM3MDs=&apos;</div></pre></td></tr></table></figure>\n<h2 id=\"1-使用es的java-api操作\"><a href=\"#1-使用es的java-api操作\" class=\"headerlink\" title=\"1. 使用es的java api操作\"></a>1. 使用es的java api操作</h2><p>java api可查阅<a href=\"https://es.quanke.name/，\" target=\"_blank\" rel=\"external\">https://es.quanke.name/，</a></p>\n<p>创建springboot工程，可以在<a href=\"http://start.spring.io/\" target=\"_blank\" rel=\"external\">http://start.spring.io/</a></p>\n<p>下载springboot工程模板，也可在github:<a href=\"https://github.com/wonderomg/elasticsearch-visual\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/elasticsearch-visual</a>下载本工程。</p>\n<p>(1)导入es的maven依赖，pom.xml内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Elasticsearch核心依赖包 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-1-判断索引是否存在\"><a href=\"#1-1-判断索引是否存在\" class=\"headerlink\" title=\"1.1  判断索引是否存在\"></a>1.1  判断索引是否存在</h3><p>检验索引是否创建成功，是否存在，通过prepareExists查询指定索引；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 1.判断索引是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isIndexExists</span><span class=\"params\">(Client client, String index)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesExistsResponse response = indicesAdminClient.prepareExists(index).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">        <span class=\"comment\">/* 另一种方式</span></div><div class=\"line\">        IndicesExistsRequest indicesExistsRequest = new IndicesExistsRequest(index);</div><div class=\"line\">        IndicesExistsResponse response = client.admin().indices().exists(indicesExistsRequest).actionGet();*/</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-2-判断类型是否存在\"><a href=\"#1-2-判断类型是否存在\" class=\"headerlink\" title=\"1.2 判断类型是否存在\"></a>1.2 判断类型是否存在</h3><p>类型存在的检查与索引的检查类似，只不过类型只挂在索引下，所以需要先指定索引名，然后再查询类型是否存在；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 2.判断类型是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTypeExists</span><span class=\"params\">(Client client, String index, String type)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!isIndexExists(client, index)) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        TypesExistsResponse response = indicesAdminClient.prepareTypesExists(index).setTypes(type).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-创建复杂索引\"><a href=\"#1-3-创建复杂索引\" class=\"headerlink\" title=\"1.3 创建复杂索引\"></a>1.3 创建复杂索引</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 3.创建复杂索引，即有映射</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> indices</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type</div><div class=\"line\">     * <span class=\"doctag\">@param</span> clusterName</div><div class=\"line\">     * <span class=\"doctag\">@param</span> host</div><div class=\"line\">     * <span class=\"doctag\">@param</span> port</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">createYxMapping</span><span class=\"params\">(String indices, String type, String clusterName, String host, <span class=\"keyword\">int</span> port)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                    .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                    .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                    .build();</div><div class=\"line\">            Client client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(host), port));</div><div class=\"line\">            client.admin().indices().prepareCreate(indices).execute().actionGet();</div><div class=\"line\">            <span class=\"keyword\">new</span> XContentFactory();</div><div class=\"line\">            XContentBuilder builder = XContentFactory.jsonBuilder()</div><div class=\"line\">                    .startObject()</div><div class=\"line\">                    .startObject(type)</div><div class=\"line\">                    .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                    .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>, <span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                    .startObject(<span class=\"string\">\"num\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                    .startObject(<span class=\"string\">\"sex\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"not_analyzed\"</span>).endObject()</div><div class=\"line\">                    .endObject()</div><div class=\"line\">                    .endObject()</div><div class=\"line\">                    .endObject();</div><div class=\"line\">            PutMappingRequest mapping = Requests.putMappingRequest(indices).type(type).source(builder);</div><div class=\"line\"></div><div class=\"line\">            client.admin().indices().putMapping(mapping).actionGet();</div><div class=\"line\">            client.close();</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            logger.error(<span class=\"string\">\"createMapping error \"</span>, e);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-4-创建空索引\"><a href=\"#1-4-创建空索引\" class=\"headerlink\" title=\"1.4 创建空索引\"></a>1.4 创建空索引</h3><p>创建一个空索引，无映射mapping，当我们设计好mapping的相关设置再映射即可，空索引创建如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 4.创建空索引  默认setting 无mapping</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">createSimpleIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    CreateIndexResponse response = indicesAdminClient.prepareCreate(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-5-为空索引映射mapping\"><a href=\"#1-5-为空索引映射mapping\" class=\"headerlink\" title=\"1.5 为空索引映射mapping\"></a>1.5 为空索引映射mapping</h3><p>可以为空索引创建或修改索引的映射，需要确保索引存在，否则会报错，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 5.设置映射</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@param</span> type</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">putIndexMapping</span><span class=\"params\">(Client client, String index, String type)</span></span>&#123;</div><div class=\"line\">    <span class=\"comment\">// mapping</span></div><div class=\"line\">    XContentBuilder mappingBuilder;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        mappingBuilder = XContentFactory.jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .startObject(type)</div><div class=\"line\">                .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>, <span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                 .startObject(<span class=\"string\">\"num\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                 .startObject(<span class=\"string\">\"sex\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"not_analyzed\"</span>).endObject()</div><div class=\"line\">                 .endObject()</div><div class=\"line\">                 .endObject()</div><div class=\"line\">                 .endObject();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        logger.error(<span class=\"string\">\"--------- createIndex 创建 mapping 失败：\"</span>, e);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    PutMappingResponse response = indicesAdminClient.preparePutMapping(index).setType(type).setSource(mappingBuilder).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-6-删除索引\"><a href=\"#1-6-删除索引\" class=\"headerlink\" title=\"1.6 删除索引\"></a>1.6 删除索引</h3><p>删除索引api：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 6.删除索引</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">deleteIndex</span><span class=\"params\">(Client client, String index)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        DeleteIndexResponse response = indicesAdminClient.prepareDelete(index).execute().actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-7-关闭索引\"><a href=\"#1-7-关闭索引\" class=\"headerlink\" title=\"1.7 关闭索引\"></a>1.7 关闭索引</h3><p>如果我们不想直接删除索引，而是仅仅短暂停止某个索引的使用，那么我们可以关闭索引的这个功能，只是短暂使用之，后续可能有恢复的需求，关闭使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 7.关闭索引</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">closeIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    CloseIndexResponse response = indicesAdminClient.prepareClose(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-8-打开索引\"><a href=\"#1-8-打开索引\" class=\"headerlink\" title=\"1.8 打开索引\"></a>1.8 打开索引</h3><p>既然有关闭索引，那么肯定也有重新打开索引的操作，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 8.开启索引</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">openIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    OpenIndexResponse response = indicesAdminClient.prepareOpen(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-9-判断别名是否存在\"><a href=\"#1-9-判断别名是否存在\" class=\"headerlink\" title=\"1.9 判断别名是否存在\"></a>1.9 判断别名是否存在</h3><p>上一篇我们学习了索引别名的重要，所以api也不能落下，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 9.判断别名是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isAliasExist</span><span class=\"params\">(Client client, String... aliases)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        AliasesExistResponse response = indicesAdminClient.prepareAliasesExist(aliases).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-10-添加别名\"><a href=\"#1-10-添加别名\" class=\"headerlink\" title=\"1.10 添加别名\"></a>1.10 添加别名</h3><p>别名是映射到实际索引上，所以需要传入实际索引名以及要设置的别名alias，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 10.添加别名</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addAlias</span><span class=\"params\">(TransportClient client, String index, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().addAlias(index, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-11-移除别名\"><a href=\"#1-11-移除别名\" class=\"headerlink\" title=\"1.11 移除别名\"></a>1.11 移除别名</h3><p>当然，添加的别名也可以删除，方便设置新的别名和切换索引别名，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 11.移除别名</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">removeAlias</span><span class=\"params\">(TransportClient client, String index, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(index, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-12-删除一个别名后再添加一个别名\"><a href=\"#1-12-删除一个别名后再添加一个别名\" class=\"headerlink\" title=\"1.12 删除一个别名后再添加一个别名\"></a>1.12 删除一个别名后再添加一个别名</h3><p>这里实际上将删除与添加别名放在一起操作，所以需要传就别名和新别名，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 12.删除一个别名后再添加一个</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">removeAndCreateAlias</span><span class=\"params\">(TransportClient client, String indexOld, String indexNew, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(indexOld, alias)</div><div class=\"line\">                .addAlias(indexNew, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-创建测试基类连接es\"><a href=\"#2-创建测试基类连接es\" class=\"headerlink\" title=\"2. 创建测试基类连接es\"></a>2. 创建测试基类连接es</h2><p>创建test类测试连接、插入、查询数据是否正常。</p>\n<p>这里可以模拟一批数据插入es，后面的分页操作对大量数据才看得出效果，我这里有的40万数据加入到es中，方便后面的分页测试。</p>\n<p>ElasticsearchTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div><div class=\"line\">388</div><div class=\"line\">389</div><div class=\"line\">390</div><div class=\"line\">391</div><div class=\"line\">392</div><div class=\"line\">393</div><div class=\"line\">394</div><div class=\"line\">395</div><div class=\"line\">396</div><div class=\"line\">397</div><div class=\"line\">398</div><div class=\"line\">399</div><div class=\"line\">400</div><div class=\"line\">401</div><div class=\"line\">402</div><div class=\"line\">403</div><div class=\"line\">404</div><div class=\"line\">405</div><div class=\"line\">406</div><div class=\"line\">407</div><div class=\"line\">408</div><div class=\"line\">409</div><div class=\"line\">410</div><div class=\"line\">411</div><div class=\"line\">412</div><div class=\"line\">413</div><div class=\"line\">414</div><div class=\"line\">415</div><div class=\"line\">416</div><div class=\"line\">417</div><div class=\"line\">418</div><div class=\"line\">419</div><div class=\"line\">420</div><div class=\"line\">421</div><div class=\"line\">422</div><div class=\"line\">423</div><div class=\"line\">424</div><div class=\"line\">425</div><div class=\"line\">426</div><div class=\"line\">427</div><div class=\"line\">428</div><div class=\"line\">429</div><div class=\"line\">430</div><div class=\"line\">431</div><div class=\"line\">432</div><div class=\"line\">433</div><div class=\"line\">434</div><div class=\"line\">435</div><div class=\"line\">436</div><div class=\"line\">437</div><div class=\"line\">438</div><div class=\"line\">439</div><div class=\"line\">440</div><div class=\"line\">441</div><div class=\"line\">442</div><div class=\"line\">443</div><div class=\"line\">444</div><div class=\"line\">445</div><div class=\"line\">446</div><div class=\"line\">447</div><div class=\"line\">448</div><div class=\"line\">449</div><div class=\"line\">450</div><div class=\"line\">451</div><div class=\"line\">452</div><div class=\"line\">453</div><div class=\"line\">454</div><div class=\"line\">455</div><div class=\"line\">456</div><div class=\"line\">457</div><div class=\"line\">458</div><div class=\"line\">459</div><div class=\"line\">460</div><div class=\"line\">461</div><div class=\"line\">462</div><div class=\"line\">463</div><div class=\"line\">464</div><div class=\"line\">465</div><div class=\"line\">466</div><div class=\"line\">467</div><div class=\"line\">468</div><div class=\"line\">469</div><div class=\"line\">470</div><div class=\"line\">471</div><div class=\"line\">472</div><div class=\"line\">473</div><div class=\"line\">474</div><div class=\"line\">475</div><div class=\"line\">476</div><div class=\"line\">477</div><div class=\"line\">478</div><div class=\"line\">479</div><div class=\"line\">480</div><div class=\"line\">481</div><div class=\"line\">482</div><div class=\"line\">483</div><div class=\"line\">484</div><div class=\"line\">485</div><div class=\"line\">486</div><div class=\"line\">487</div><div class=\"line\">488</div><div class=\"line\">489</div><div class=\"line\">490</div><div class=\"line\">491</div><div class=\"line\">492</div><div class=\"line\">493</div><div class=\"line\">494</div><div class=\"line\">495</div><div class=\"line\">496</div><div class=\"line\">497</div><div class=\"line\">498</div><div class=\"line\">499</div><div class=\"line\">500</div><div class=\"line\">501</div><div class=\"line\">502</div><div class=\"line\">503</div><div class=\"line\">504</div><div class=\"line\">505</div><div class=\"line\">506</div><div class=\"line\">507</div><div class=\"line\">508</div><div class=\"line\">509</div><div class=\"line\">510</div><div class=\"line\">511</div><div class=\"line\">512</div><div class=\"line\">513</div><div class=\"line\">514</div><div class=\"line\">515</div><div class=\"line\">516</div><div class=\"line\">517</div><div class=\"line\">518</div><div class=\"line\">519</div><div class=\"line\">520</div><div class=\"line\">521</div><div class=\"line\">522</div><div class=\"line\">523</div><div class=\"line\">524</div><div class=\"line\">525</div><div class=\"line\">526</div><div class=\"line\">527</div><div class=\"line\">528</div><div class=\"line\">529</div><div class=\"line\">530</div><div class=\"line\">531</div><div class=\"line\">532</div><div class=\"line\">533</div><div class=\"line\">534</div><div class=\"line\">535</div><div class=\"line\">536</div><div class=\"line\">537</div><div class=\"line\">538</div><div class=\"line\">539</div><div class=\"line\">540</div><div class=\"line\">541</div><div class=\"line\">542</div><div class=\"line\">543</div><div class=\"line\">544</div><div class=\"line\">545</div><div class=\"line\">546</div><div class=\"line\">547</div><div class=\"line\">548</div><div class=\"line\">549</div><div class=\"line\">550</div><div class=\"line\">551</div><div class=\"line\">552</div><div class=\"line\">553</div><div class=\"line\">554</div><div class=\"line\">555</div><div class=\"line\">556</div><div class=\"line\">557</div><div class=\"line\">558</div><div class=\"line\">559</div><div class=\"line\">560</div><div class=\"line\">561</div><div class=\"line\">562</div><div class=\"line\">563</div><div class=\"line\">564</div><div class=\"line\">565</div><div class=\"line\">566</div><div class=\"line\">567</div><div class=\"line\">568</div><div class=\"line\">569</div><div class=\"line\">570</div><div class=\"line\">571</div><div class=\"line\">572</div><div class=\"line\">573</div><div class=\"line\">574</div><div class=\"line\">575</div><div class=\"line\">576</div><div class=\"line\">577</div><div class=\"line\">578</div><div class=\"line\">579</div><div class=\"line\">580</div><div class=\"line\">581</div><div class=\"line\">582</div><div class=\"line\">583</div><div class=\"line\">584</div><div class=\"line\">585</div><div class=\"line\">586</div><div class=\"line\">587</div><div class=\"line\">588</div><div class=\"line\">589</div><div class=\"line\">590</div><div class=\"line\">591</div><div class=\"line\">592</div><div class=\"line\">593</div><div class=\"line\">594</div><div class=\"line\">595</div><div class=\"line\">596</div><div class=\"line\">597</div><div class=\"line\">598</div><div class=\"line\">599</div><div class=\"line\">600</div><div class=\"line\">601</div><div class=\"line\">602</div><div class=\"line\">603</div><div class=\"line\">604</div><div class=\"line\">605</div><div class=\"line\">606</div><div class=\"line\">607</div><div class=\"line\">608</div><div class=\"line\">609</div><div class=\"line\">610</div><div class=\"line\">611</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</div><div class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.core.JsonProcessingException;</div><div class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class=\"line\"><span class=\"keyword\">import</span> com.sun.controller.DateUtils;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.delete.DeleteResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.get.GetResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.index.IndexResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchType;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.update.UpdateResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Client;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Requests;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.transport.TransportClient;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.settings.Settings;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.unit.TimeValue;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.xcontent.XContentFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.*;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHits;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.File;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.UnknownHostException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 类功能描述:Elasticsearch的基本测试</div><div class=\"line\"> *</div><div class=\"line\"> * <span class=\"doctag\">@author</span> liu</div><div class=\"line\"> * <span class=\"doctag\">@since</span> 2018/5/24</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElasticsearchTest</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(ElasticsearchTest.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String HOST = <span class=\"string\">\"10.10.13.234\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** http请求的端口是9200，客户端是9300 */</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> PORT = <span class=\"number\">9300</span>;</div><div class=\"line\"></div><div class=\"line\">    Client client;</div><div class=\"line\">    <span class=\"comment\">/** 索引库名 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String index = <span class=\"string\">\"my_index\"</span>;</div><div class=\"line\">    <span class=\"comment\">/** 类型名称 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String type = <span class=\"string\">\"skuId\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String clusterName = <span class=\"string\">\"my-application\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 创建mapping，注意：每次只能创建一次</div><div class=\"line\">     * 创建mapping(field(\"indexAnalyzer\",\"ik\")该字段分词IK索引 ；field(\"searchAnalyzer\",\"ik\")该字段分词ik查询；具体分词插件请看IK分词插件说明)</div><div class=\"line\">     * 创建mapping(field(\"analyzer\",\"ik\")该字段分词IK索引 ；field(\"index\",\"analyzed\")该字段分词ik查询；具体分词插件请看IK分词插件说明)2.x版</div><div class=\"line\">     * <span class=\"doctag\">@param</span> indices 索引名称；</div><div class=\"line\">     * <span class=\"doctag\">@param</span> mappingType 类型</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createMapping</span><span class=\"params\">()</span><span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String indices = <span class=\"string\">\"jd_mall_v2\"</span>;</div><div class=\"line\">        String mappingType = <span class=\"string\">\"goods\"</span>;</div><div class=\"line\"></div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        Client client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\"></div><div class=\"line\">        client.admin().indices().prepareCreate(indices).execute().actionGet();</div><div class=\"line\">        <span class=\"keyword\">new</span> XContentFactory();</div><div class=\"line\">        XContentBuilder builder=XContentFactory.jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .startObject(mappingType)</div><div class=\"line\">                .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>,<span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>,<span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                .startObject(<span class=\"string\">\"price\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                .endObject()</div><div class=\"line\">                .endObject()</div><div class=\"line\">                .endObject();</div><div class=\"line\">        PutMappingRequest mapping = Requests.putMappingRequest(indices).type(mappingType).source(builder);</div><div class=\"line\"></div><div class=\"line\">        client.admin().indices().putMapping(mapping).actionGet();</div><div class=\"line\">        client.close();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span></span></div><div class=\"line\">    &#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 1:通过 setting对象来指定集群配置信息</div><div class=\"line\">         * //指定集群名称</div><div class=\"line\">         * //启动嗅探功能</div><div class=\"line\">         */</div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 2：创建客户端</div><div class=\"line\">         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch</div><div class=\"line\">         * 链接使用tcp协议即9300</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\">            System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (UnknownHostException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">/*transportClient = new TransportClient(setting);</span></div><div class=\"line\">        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);</div><div class=\"line\">        transportClient.addTransportAddresses(transportAddress);*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 3：查看集群信息</div><div class=\"line\">         * 注意我的集群结构是：</div><div class=\"line\">         *   131的elasticsearch.yml中指定为主节点不能存储数据，</div><div class=\"line\">         *   128的elasticsearch.yml中指定不为主节点只能存储数据。</div><div class=\"line\">         * 所有控制台只打印了192.168.79.128,只能获取数据节点</div><div class=\"line\">         *</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"comment\">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></div><div class=\"line\">        for(DiscoveryNode node : connectedNodes)</div><div class=\"line\">        &#123;</div><div class=\"line\">            System.out.println(node.getHostAddress());</div><div class=\"line\">        &#125;*/</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 测试Elasticsearch客户端连接</div><div class=\"line\">     * <span class=\"doctag\">@Title</span>: test1</div><div class=\"line\">     * <span class=\"doctag\">@author</span> sunt</div><div class=\"line\">     * <span class=\"doctag\">@date</span> 2017年11月22日</div><div class=\"line\">     * <span class=\"doctag\">@return</span> void</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> UnknownHostException</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"resource\"</span>)</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> UnknownHostException </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//创建客户端</span></div><div class=\"line\">        <span class=\"comment\">/*TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddresses(</span></div><div class=\"line\">                new InetSocketTransportAddress(InetAddress.getByName(HOST),PORT));*/</div><div class=\"line\">        TransportClient client = TransportClient.builder().build().addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\"></div><div class=\"line\">        logger.debug(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//关闭客户端</span></div><div class=\"line\">        client.close();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGet</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        <span class=\"comment\">/*GetResponse response1 = client.prepareGet(index, \"person\", \"9\").get();</span></div><div class=\"line\">        response1.getSourceAsMap();//获取值转换成map</div><div class=\"line\">        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取分词</span></div><div class=\"line\">        List&lt;String&gt; listAnalysis = getIkAnalyzeSearchTerms(<span class=\"string\">\"进口水果\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList6 = testMultiQueryStringQuery(index, type, \"name\", listAnalysis);</span></div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; resultList3 = testQueryStringQuery(index, type, <span class=\"string\">\"name\"</span>, <span class=\"string\">\"进口水果\"</span>);</div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList4 = getDataByWildcard(index, type, \"name\", \"*水果*\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList5 = getDataByMatch(index, type, \"name\", \"进口 水果\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList = getQueryDataBySingleField(index, type, \"name\", \"进口水果\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList2 = testSearchByPrefix(index, \"name\", \"进口水果\");</span></div><div class=\"line\">        <span class=\"comment\">//System.out.println();</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 增查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testCreate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String[] skuIds = &#123;<span class=\"string\">\"2246904\"</span>, <span class=\"string\">\"2138027\"</span>, <span class=\"string\">\"3724941\"</span>, <span class=\"string\">\"5664705\"</span>, <span class=\"string\">\"3711635\"</span>&#125;;</div><div class=\"line\">        String[] skuNames = &#123;<span class=\"string\">\"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"江西名牌 杨氏精品脐橙 5kg装 铂金果 水果橙子礼盒 2种包装随机发货\"</span>&#125;;</div><div class=\"line\">        String[] skuPrices = &#123;<span class=\"string\">\"500\"</span>, <span class=\"string\">\"3800\"</span>, <span class=\"string\">\"4990\"</span>, <span class=\"string\">\"8500\"</span>, <span class=\"string\">\"5880\"</span>&#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;skuIds.length; i++) &#123;</div><div class=\"line\">            String skuId = skuIds[i];</div><div class=\"line\">            String skuName = skuNames[i];</div><div class=\"line\">            String skuPrice = skuPrices[i];</div><div class=\"line\"></div><div class=\"line\">            String jsonStr = <span class=\"string\">\"&#123;\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuId\\\":\\\"\"</span>+skuId+<span class=\"string\">\"\\\",\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuName\\\":\\\"\"</span>+skuName+<span class=\"string\">\"\\\",\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuPrice\\\":\\\"\"</span>+skuPrice+<span class=\"string\">\"\\\"\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"&#125;\"</span>;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//参数说明： 索引，类型 ，_id；//setSource可以传以上map string  byte[] 几种方式</span></div><div class=\"line\">            IndexResponse response = client.prepareIndex(index, type, skuId)</div><div class=\"line\">                    .setSource(jsonStr,XContentType.JSON)</div><div class=\"line\">                    .get();</div><div class=\"line\">            <span class=\"keyword\">boolean</span> created = response.isCreated();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"创建一条记录:\"</span> + created);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">            GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">            response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">            System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 删查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testDelete</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\">        String skuImage = <span class=\"string\">\"jfs/t16450/249/461724533/219792/7f204d7a/5a321ecbN4526f7d3.jpg\"</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//删除_id为1的类型</span></div><div class=\"line\">        DeleteResponse response2 = client.prepareDelete(index, type, skuId).get();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除一条数据：\"</span> + response2.isFound());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">        response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 改查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUpdate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\">        String skuName2 = <span class=\"string\">\"华圣 陕西精品红富士苹果 12个装 果径75mm 约2.1kg 新鲜水果\"</span>;</div><div class=\"line\">        <span class=\"comment\">//更新</span></div><div class=\"line\">        UpdateResponse updateResponse = client.prepareUpdate(index, type, skuId).setDoc(jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .field(<span class=\"string\">\"name\"</span>, skuName2)</div><div class=\"line\">                .endObject())</div><div class=\"line\">                .get();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"更新一条数据:\"</span> + updateResponse.isCreated());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">        response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将对象通过jackson.databind转换成byte[]</div><div class=\"line\">     * 注意一下date类型需要格式化处理  默认是 时间戳</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] convertByteArray(Object obj) &#123;</div><div class=\"line\">        <span class=\"comment\">// create once, reuse</span></div><div class=\"line\">        ObjectMapper mapper = <span class=\"keyword\">new</span> ObjectMapper();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">byte</span>[] json = mapper.writeValueAsBytes(obj);</div><div class=\"line\">            <span class=\"keyword\">return</span> json;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JsonProcessingException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将对象通过JSONtoString转换成JSON字符串</div><div class=\"line\">     * 使用fastjson 格式化注解  在属性上加入 <span class=\"doctag\">@JSONField</span>(format=\"yyyy-MM-dd HH:mm:ss\")</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">jsonStr</span><span class=\"params\">(Object obj)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(obj);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/*****************************/</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">            * 根据文档名、字段名、字段值查询某一条记录的详细信息；query查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type  文档名，相当于oracle中的表名，例如：ql_xz；</div><div class=\"line\">            * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value  字段值，如：“”</div><div class=\"line\">            * <span class=\"doctag\">@return</span>  List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getQueryDataBySingleField</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        QueryBuilder qb = QueryBuilders.termQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(qb)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 多条件  文档名、字段名、字段值，查询某一条记录的详细信息</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> map 字段名：字段值 的map</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getBoolDataByMuchField</span><span class=\"params\">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String in : map.keySet()) &#123;</div><div class=\"line\">            <span class=\"comment\">//map.keySet()返回的是所有key的值</span></div><div class=\"line\">            String str = map.get(in);<span class=\"comment\">//得到每个key多对用value的值</span></div><div class=\"line\">            boolQueryBuilder.must(QueryBuilders.termQuery(in,str));</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 通配符查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByWildcard</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        WildcardQueryBuilder wBuilder = QueryBuilders.wildcardQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(wBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 多条件 通配符查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type  type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> map   包含key:value 模糊值键值对</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByMuchWildcard</span><span class=\"params\">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String in : map.keySet()) &#123;</div><div class=\"line\">            <span class=\"comment\">//map.keySet()返回的是所有key的值</span></div><div class=\"line\">            String str = map.get(in);<span class=\"comment\">//得到每个key多对用value的值</span></div><div class=\"line\">            boolQueryBuilder.must(QueryBuilders.wildcardQuery(in,str));</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 模糊拆分查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByMatch</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        MatchQueryBuilder mBuilder = QueryBuilders.matchQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(mBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 中文分词模糊查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByPrefix</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        PrefixQueryBuilder pBuilder = QueryBuilders.prefixQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(pBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 中文分词的操作</div><div class=\"line\">     * 1.查询以\"中\"开头的数据，有两条</div><div class=\"line\">     * 2.查询以“中国”开头的数据，有0条</div><div class=\"line\">     * 3.查询包含“烂”的数据，有1条</div><div class=\"line\">     * 4.查询包含“烂摊子”的数据，有0条</div><div class=\"line\">     * 分词：</div><div class=\"line\">     *      为什么我们搜索China is the greatest country~</div><div class=\"line\">     *                 中文：中国最牛逼</div><div class=\"line\">     *</div><div class=\"line\">     *                 ×××</div><div class=\"line\">     *                      中华</div><div class=\"line\">     *                      人民</div><div class=\"line\">     *                      共和国</div><div class=\"line\">     *                      中华人民</div><div class=\"line\">     *                      人民共和国</div><div class=\"line\">     *                      华人</div><div class=\"line\">     *                      共和</div><div class=\"line\">     *      特殊的中文分词法：</div><div class=\"line\">     *          庖丁解牛</div><div class=\"line\">     *          IK分词法</div><div class=\"line\">     *          搜狗分词法</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testSearchByPrefix</span><span class=\"params\">(String index, String key, String value)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 在prepareSearch()的参数为索引库列表，意为要从哪些索引库中进行查询</span></div><div class=\"line\">        SearchResponse response = client.prepareSearch(index)</div><div class=\"line\">                .setSearchType(SearchType.DEFAULT)  <span class=\"comment\">// 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></div><div class=\"line\">                <span class=\"comment\">//.setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></div><div class=\"line\">                <span class=\"comment\">//.setQuery(QueryBuilders.prefixQuery(\"content\", \"烂摊子\"))// 设置相应的query，用于检索，termQuery的参数说明：name是doc中的具体的field，value就是要找的具体的值</span></div><div class=\"line\"><span class=\"comment\">//                .setQuery(QueryBuilders.regexpQuery(\"content\", \".*烂摊子.*\"))</span></div><div class=\"line\">                .setQuery(QueryBuilders.prefixQuery(key, value))</div><div class=\"line\">                .get();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testFuzzyQuery</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        FuzzyQueryBuilder fBuilder = QueryBuilders.fuzzyQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(fBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQuery</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(fBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testMultiQueryStringQuery</span><span class=\"params\">(String index, String type, String key, List&lt;String&gt; listAnalysis)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String term : listAnalysis) &#123;</div><div class=\"line\">            boolQueryBuilder.should(QueryBuilders.queryStringQuery(term).field(key));</div><div class=\"line\">            <span class=\"comment\">//这里可以用must 或者 should 视情况而定</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将查询后获得的response转成list</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> response</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">responseToList</span><span class=\"params\">(Client client, SearchResponse response)</span></span>&#123;</div><div class=\"line\">        SearchHits hits = response.getHits();</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; hits.getHits().length; i++) &#123;</div><div class=\"line\">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</div><div class=\"line\">            System.out.println(map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            list.add(map);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"comment\">//client.close();</span></div><div class=\"line\">        <span class=\"keyword\">return</span> list;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 调用 ES 获取 IK 分词后结果</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> searchContent</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;String&gt; <span class=\"title\">getIkAnalyzeSearchTerms</span><span class=\"params\">(String searchContent)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//调用 IK 分词分词</span></div><div class=\"line\">        AnalyzeRequestBuilder ikRequest = <span class=\"keyword\">new</span> AnalyzeRequestBuilder(client,</div><div class=\"line\">                AnalyzeAction.INSTANCE, index, searchContent);</div><div class=\"line\">        <span class=\"comment\">//ikRequest.setAnalyzer(\"ik\");</span></div><div class=\"line\">        ikRequest.setTokenizer(<span class=\"string\">\"ik\"</span>);</div><div class=\"line\">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//循环赋值</span></div><div class=\"line\">        List&lt;String&gt; searchTermList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        <span class=\"comment\">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></div><div class=\"line\">        <span class=\"keyword\">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</div><div class=\"line\">            System.out.println(ikToken.getTerm());</div><div class=\"line\">            searchTermList.add(ikToken.getTerm());</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> searchTermList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFromSize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"from size 模式启动！\"</span>);</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"keyword\">long</span> count = client.prepareCount(index).setTypes(type).execute()</div><div class=\"line\">                .actionGet().getCount();</div><div class=\"line\">        <span class=\"comment\">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></div><div class=\"line\">        SearchRequestBuilder requestBuilder = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(QueryBuilders.queryStringQuery(<span class=\"string\">\"进口水果\"</span>).field(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>,sum=<span class=\"number\">0</span>; sum&lt;count; i++) &#123;</div><div class=\"line\">            SearchResponse response = requestBuilder.setFrom(i).setSize(<span class=\"number\">3</span>).execute().actionGet();</div><div class=\"line\">            sum += response.getHits().hits().length;</div><div class=\"line\">            responseToList(client,response);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"总量\"</span>+count+<span class=\"string\">\", 已经查到\"</span>+sum);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，</div><div class=\"line\">     * 所以实际返回的数量是：分片的数量*size</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testScroll</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//String index, String type,String key,String value</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"scroll 模式启动！\"</span>);</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"comment\">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></div><div class=\"line\">        <span class=\"comment\">//获取Client对象,设置索引名称,搜索类型(SearchType.SCAN),搜索数量,发送请求</span></div><div class=\"line\">        SearchResponse scrollResponse = client.prepareSearch(index)</div><div class=\"line\">                .setTypes(type)</div><div class=\"line\">                .setQuery(QueryBuilders.queryStringQuery(<span class=\"string\">\"进口水果\"</span>).field(<span class=\"string\">\"name\"</span>))</div><div class=\"line\">                .setSearchType(SearchType.SCAN).setSize(<span class=\"number\">3</span>).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">1</span>))</div><div class=\"line\">                .execute().actionGet();</div><div class=\"line\">        <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，获取总数量</span></div><div class=\"line\">        <span class=\"keyword\">long</span> count = scrollResponse.getHits().getTotalHits();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>,sum=<span class=\"number\">0</span>; sum&lt;count; i++) &#123;</div><div class=\"line\">            scrollResponse = client.prepareSearchScroll(scrollResponse.getScrollId())</div><div class=\"line\">                    .setScroll(TimeValue.timeValueMinutes(<span class=\"number\">8</span>)).execute().actionGet();</div><div class=\"line\">            sum += scrollResponse.getHits().hits().length;</div><div class=\"line\">            responseToList(client,scrollResponse);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"总量\"</span>+count+<span class=\"string\">\", 已经查到\"</span>+sum);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-分页代码\"><a href=\"#3-分页代码\" class=\"headerlink\" title=\"3. 分页代码\"></a>3. 分页代码</h2><p>创建TestController类，在上述测试都无问题之后，再进行下面的分页操作。</p>\n<p>TestController.java：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.sun.controller;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSONObject;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchScrollRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHit;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchType;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Client;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.transport.TransportClient;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.settings.Settings;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.unit.TimeValue;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.QueryBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.QueryBuilders;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHits;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.sort.SortOrder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.UnknownHostException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicLong;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 类功能描述:</div><div class=\"line\"> *</div><div class=\"line\"> * <span class=\"doctag\">@author</span> liu</div><div class=\"line\"> * <span class=\"doctag\">@since</span> 2018/2/22</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RestController</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(<span class=\"keyword\">this</span>.getClass());</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String HOST = <span class=\"string\">\"10.10.13.234\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** http请求的端口是9200，客户端是9300 */</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> PORT = <span class=\"number\">9300</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 索引库名 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String index = <span class=\"string\">\"my_index\"</span>;</div><div class=\"line\">    <span class=\"comment\">/** 类型名称 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String type = <span class=\"string\">\"skuId\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String clusterName = <span class=\"string\">\"my-application\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String template = <span class=\"string\">\"Hello, %s!\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicLong counter = <span class=\"keyword\">new</span> AtomicLong();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/greeting\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Greeting <span class=\"title\">greeting</span><span class=\"params\">(@RequestParam(value=<span class=\"string\">\"name\"</span>, defaultValue=<span class=\"string\">\"World\"</span>)</span> String name) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Greeting(counter.incrementAndGet(),</div><div class=\"line\">                String.format(template, name));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getTotalRows</span><span class=\"params\">(String keyword, TransportClient client)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows;</div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">        <span class=\"keyword\">if</span> (keyword == <span class=\"keyword\">null</span> || keyword.isEmpty()) &#123;</div><div class=\"line\">            totalRows = client.prepareCount(index).setTypes(type)</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet().getCount();</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            QueryBuilder fBuilder = QueryBuilders.queryStringQuery(keyword).field(<span class=\"string\">\"name\"</span>);</div><div class=\"line\">            boolQueryBuilder.must(fBuilder);</div><div class=\"line\">            totalRows = client.prepareCount(index).setTypes(type)</div><div class=\"line\">                    .setQuery(boolQueryBuilder)</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet().getCount();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> totalRows;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/searchFromSize\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">testSearchByFromSize</span><span class=\"params\">(@RequestParam(required = <span class=\"keyword\">false</span>)</span> Integer pageIndex, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> Integer pageSize,</span></div><div class=\"line\">                               @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String keyword, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String priceSort)&#123;</div><div class=\"line\">        logger.info(<span class=\"string\">\"op&lt;testSearchByFromSize&gt; pageIndex&lt;\"</span>+pageIndex+<span class=\"string\">\"&gt; pageSize&lt;\"</span>+pageSize+<span class=\"string\">\"&gt; \"</span> +</div><div class=\"line\">                <span class=\"string\">\"keyword&lt;\"</span>+keyword+<span class=\"string\">\"&gt; priceSort&lt;\"</span>+priceSort+<span class=\"string\">\"&gt;\"</span>);</div><div class=\"line\">        JSONObject result = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        JSONObject goodsResult = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        TransportClient client = getClient();</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows = getTotalRows(keyword, client);</div><div class=\"line\">        getIkAnalyzeSearchTerms(client, keyword);</div><div class=\"line\">        <span class=\"keyword\">int</span> from = (pageIndex - <span class=\"number\">1</span>) * pageSize;</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryFromSize(client, index, type, <span class=\"string\">\"name\"</span>,</div><div class=\"line\">                keyword, from, pageSize, priceSort);</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"goods\"</span>, goodsExportList );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageIndex\"</span>, pageIndex );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageSize\"</span>, pageSize );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"totalRows\"</span>, totalRows );</div><div class=\"line\"></div><div class=\"line\">        result.put( <span class=\"string\">\"success\"</span>, <span class=\"keyword\">true</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultMessage\"</span>, <span class=\"string\">\"\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultCode\"</span>, <span class=\"string\">\"0000\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"result\"</span>, goodsResult );</div><div class=\"line\">        System.out.println(<span class=\"string\">\"---op&lt;searchFromSize&gt; elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> result;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> String scrollIdTemp = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/searchScroll\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">testSearchByScroll</span><span class=\"params\">(@RequestParam(required = <span class=\"keyword\">false</span>)</span> String scrollId, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> Integer pageSize,</span></div><div class=\"line\">                               @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String keyword, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String priceSort)&#123;</div><div class=\"line\">        logger.info(<span class=\"string\">\"op&lt;testSearchByScroll&gt; scrollId&lt;\"</span>+scrollId+<span class=\"string\">\"&gt; pageSize&lt;\"</span>+pageSize+<span class=\"string\">\"&gt; \"</span> +</div><div class=\"line\">                <span class=\"string\">\"keyword&lt;\"</span>+keyword+<span class=\"string\">\"&gt; priceSort&lt;\"</span>+priceSort+<span class=\"string\">\"&gt;\"</span>);</div><div class=\"line\">        JSONObject result = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        JSONObject goodsResult = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        scrollIdTemp = scrollId;</div><div class=\"line\">        TransportClient client = getClient();</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows = getTotalRows(keyword, client);</div><div class=\"line\">        getIkAnalyzeSearchTerms(client, keyword);</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryScroll(client, index, type, <span class=\"string\">\"name\"</span>,</div><div class=\"line\">                keyword, scrollIdTemp, pageSize, priceSort);</div><div class=\"line\">        client.close();</div><div class=\"line\"></div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"goods\"</span>, goodsExportList );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"scrollId\"</span>, scrollIdTemp );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageSize\"</span>, pageSize );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"totalRows\"</span>, totalRows );</div><div class=\"line\"></div><div class=\"line\">        result.put( <span class=\"string\">\"success\"</span>, <span class=\"keyword\">true</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultMessage\"</span>, <span class=\"string\">\"\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultCode\"</span>, <span class=\"string\">\"0000\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"result\"</span>, goodsResult );</div><div class=\"line\">        System.out.println(<span class=\"string\">\"---op&lt;searchScroll&gt; elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> result;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQueryFromSize</span><span class=\"params\">(TransportClient client, String index, String type, String key,</span></span></div><div class=\"line\">                                     String value, Integer pageIndex, Integer pageSize ,String priceSort)&#123;</div><div class=\"line\">        SearchResponse response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        List resultList = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"keyword\">null</span> || value.isEmpty()) &#123;</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(fBuilder);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> (priceSort == <span class=\"keyword\">null</span> || priceSort.isEmpty()) &#123;</div><div class=\"line\">                response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                        .setQuery(boolQueryBuilder)</div><div class=\"line\">                        .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                        .execute()</div><div class=\"line\">                        .actionGet();</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> ((<span class=\"string\">\"desc\"</span>).equals(priceSort)) &#123;</div><div class=\"line\">                    response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                            .addSort(<span class=\"string\">\"price\"</span>, SortOrder.DESC)</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                            .addSort(<span class=\"string\">\"price\"</span>, SortOrder.ASC)</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            resultList = responseToList(response);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> resultList;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，</div><div class=\"line\">     * 所以实际返回的数量是：分片的数量*size</div><div class=\"line\">     *</div><div class=\"line\">     * Scroll-Scan 方式与普通 scroll 有几点不同：</div><div class=\"line\">     * 1.Scroll-Scan 结果没有排序，按 index 顺序返回，没有排序，可以提高取数据性能。</div><div class=\"line\">     * 2.初始化时只返回 _scroll_id，没有具体的 hits 结果。</div><div class=\"line\">     * 3.size 控制的是每个分片的返回的数据量而不是整个请求返回的数据量。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQueryScroll</span><span class=\"params\">(TransportClient client, String index, String type, String key,</span></span></div><div class=\"line\">                                     String value, String scrollId, Integer pageSize ,String priceSort)&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (pageSize != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//默认有5个分片，</span></div><div class=\"line\">            pageSize = pageSize/<span class=\"number\">5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse scrollResponse = <span class=\"keyword\">null</span>;</div><div class=\"line\">        List resultList = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"keyword\">null</span> || value.isEmpty()) &#123;</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(fBuilder);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> (scrollId == <span class=\"keyword\">null</span> || scrollId.isEmpty()) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (priceSort == <span class=\"keyword\">null</span> || priceSort.isEmpty()) &#123;</div><div class=\"line\">                    scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">if</span> ((<span class=\"string\">\"desc\"</span>).equals(priceSort)) &#123;</div><div class=\"line\">                        scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                                .setQuery(boolQueryBuilder)</div><div class=\"line\">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                                .addSort(<span class=\"string\">\"price\"</span>, SortOrder.DESC)</div><div class=\"line\">                                .execute()</div><div class=\"line\">                                .actionGet();</div><div class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                        scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                                .setQuery(boolQueryBuilder)</div><div class=\"line\">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                                .addSort(<span class=\"string\">\"price\"</span>, SortOrder.ASC)</div><div class=\"line\">                                .execute()</div><div class=\"line\">                                .actionGet();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，所以先查一次获取scrollId，在进行第二次scroll查询</span></div><div class=\"line\">                scrollId = scrollResponse.getScrollId();</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            scrollResponse = client.prepareSearchScroll(scrollId)</div><div class=\"line\">                    .setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet();</div><div class=\"line\">            </div><div class=\"line\">            <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，获取总数量</span></div><div class=\"line\">            <span class=\"keyword\">long</span> count = scrollResponse.getHits().getTotalHits();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"scrollResponse.getHits().getHits().length:\"</span>+scrollResponse.getHits().hits().length);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"scroll count:\"</span>+count);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//获取本次查询的scrollId</span></div><div class=\"line\">            scrollIdTemp = scrollResponse.getScrollId();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"--------- searchByScroll scrollID:\"</span>+scrollIdTemp);</div><div class=\"line\">            logger.info(<span class=\"string\">\"--------- searchByScroll scrollID &#123;&#125;\"</span>, scrollIdTemp);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">// 搜索结果</span></div><div class=\"line\">            SearchHit[] searchHits = scrollResponse.getHits().hits();</div><div class=\"line\">            <span class=\"keyword\">for</span> (SearchHit searchHit : searchHits) &#123;</div><div class=\"line\">                String source = searchHit.getSource().toString();</div><div class=\"line\">                logger.info(<span class=\"string\">\"--------- searchByScroll source &#123;&#125;\"</span>, source);</div><div class=\"line\">            &#125;</div><div class=\"line\">            resultList = responseToList(scrollResponse);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> resultList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将查询后获得的response转成list</div><div class=\"line\">     * <span class=\"doctag\">@param</span> response</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">responseToList</span><span class=\"params\">(SearchResponse response)</span></span>&#123;</div><div class=\"line\">        SearchHits hits = response.getHits();</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"hits.hits().length:\"</span>+hits.hits().length);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; hits.hits().length; i++) &#123;</div><div class=\"line\">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</div><div class=\"line\">            Map&lt;String, Object&gt; resultMap = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">16</span>);</div><div class=\"line\">            System.out.println(map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"skuId\"</span>, map.get(<span class=\"string\">\"skuId\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"name\"</span>, map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"image\"</span>, map.get(<span class=\"string\">\"primaryImage\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"price\"</span>, map.get(<span class=\"string\">\"luckyPrice\"</span>));</div><div class=\"line\">            list.add(resultMap);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> list;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> TransportClient <span class=\"title\">getClient</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 1:通过 setting对象来指定集群配置信息</div><div class=\"line\">         * //指定集群名称</div><div class=\"line\">         * //启动嗅探功能</div><div class=\"line\">         */</div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 2：创建客户端</div><div class=\"line\">         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch</div><div class=\"line\">         * 链接使用tcp协议即9300</div><div class=\"line\">         */</div><div class=\"line\">        TransportClient client = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\">            System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (UnknownHostException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">/*transportClient = new TransportClient(setting);</span></div><div class=\"line\">        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);</div><div class=\"line\">        transportClient.addTransportAddresses(transportAddress);*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 3：查看集群信息</div><div class=\"line\">         * 注意我的集群结构是：</div><div class=\"line\">         *   131的elasticsearch.yml中指定为主节点不能存储数据，</div><div class=\"line\">         *   128的elasticsearch.yml中指定不为主节点只能存储数据。</div><div class=\"line\">         * 所有控制台只打印了192.168.79.128,只能获取数据节点</div><div class=\"line\">         *</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"comment\">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></div><div class=\"line\">        for(DiscoveryNode node : connectedNodes)</div><div class=\"line\">        &#123;</div><div class=\"line\">            System.out.println(node.getHostAddress());</div><div class=\"line\">        &#125;*/</div><div class=\"line\">        <span class=\"keyword\">return</span> client;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 调用 ES 获取 IK 分词后结果</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> searchContent</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;String&gt; <span class=\"title\">getIkAnalyzeSearchTerms</span><span class=\"params\">(Client client, String searchContent)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//调用 IK 分词分词</span></div><div class=\"line\">        AnalyzeRequestBuilder ikRequest = <span class=\"keyword\">new</span> AnalyzeRequestBuilder(client,</div><div class=\"line\">                AnalyzeAction.INSTANCE, index, searchContent);</div><div class=\"line\">        <span class=\"comment\">//ikRequest.setAnalyzer(\"ik\");</span></div><div class=\"line\">        ikRequest.setTokenizer(<span class=\"string\">\"ik\"</span>);</div><div class=\"line\">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//循环赋值</span></div><div class=\"line\">        List&lt;String&gt; searchTermList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        <span class=\"comment\">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></div><div class=\"line\">        <span class=\"keyword\">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</div><div class=\"line\">            System.out.println(ikToken.getTerm());</div><div class=\"line\">            searchTermList.add(ikToken.getTerm());</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> searchTermList;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-前端数据\"><a href=\"#4-前端数据\" class=\"headerlink\" title=\"4. 前端数据\"></a>4. 前端数据</h2><p>为上述的分页的数据可视化，加入前端展示页，可按中文关键词搜索分页等操作。</p>\n<p>index.html，以及js操作部分，data.js，由于篇幅问题，下载可移步至github:</p>\n<p><a href=\"https://github.com/wonderomg/elasticsearch-visual下载详细内容，\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/elasticsearch-visual下载详细内容，</a></p>\n<p>前后端页编写完之后，启动springboot工程，访问<code>http://localhost:8080/</code>该工程端口。</p>\n<p>可以看到操作 页面，类似下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/elasticsearch-visual/master/search.png\" alt=\"search\"></p>\n<p>from size和scroll都可通过该页面进行测试。</p>\n<h2 id=\"5-数据限制问题\"><a href=\"#5-数据限制问题\" class=\"headerlink\" title=\"5. 数据限制问题\"></a>5. 数据限制问题</h2><p>测试from size时发现一个问题，当数据超过10000条会报错，提示如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">Caused by: QueryPhaseExecutionException[Result window is too large, </div><div class=\"line\">from + size must be less than or equal to: [10000] but was [10001]. </div><div class=\"line\">See the scroll api for a more efficient way to request large data sets. </div><div class=\"line\">This limit can be set by changing the [index.max_result_window] index level parameter.]</div></pre></td></tr></table></figure>\n<p>原因是es索引被限制了可查前10000条数据，参数是<code>max_result_window</code>，需要我们手动修改这个限制。</p>\n<p>(1)查询index.max_result_window</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XGET \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\"</div></pre></td></tr></table></figure>\n<p>(2)更改index.max_result_window</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XPUT \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\" -d '&#123; \"index\" : &#123; \"max_result_window\" : 100000000&#125;&#125;'</div></pre></td></tr></table></figure>\n<p>设置max_result_window的时候需要先关闭索引，不然会报错<code>Can&#39;t update non dynamic settings[[index.preserve_existing]] for open indices</code>的错误，可以通过指令关闭，也可以通过head可视化界面关闭和开启，也可以通过上述步骤1.7和1.8的api关闭和开启。</p>\n<h2 id=\"6-排序\"><a href=\"#6-排序\" class=\"headerlink\" title=\"6. 排序\"></a>6. 排序</h2><p>分页的时候我们可以还有排序的场景，java api的话增加代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">searchRequestBuilder.addSort(<span class=\"string\">\"publish_time\"</span>, SortOrder.DESC);</div></pre></td></tr></table></figure>\n<p>按照某个字段排序的话，hit.getScore()将会失效<br>如果是scroll分页无法进行排序。</p>\n","site":{"data":{}},"excerpt":"<p>elasticsearch系列：</p>\n<p>(1)<a href=\"https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/\">Elasticsearch实践(1)-搭建及IK中文分词</a></p>\n<p>(2)<a href=\"https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/\">Elasticsearch实践(2)-索引及索引别名alias</a></p>\n<p>(3)<a href=\"https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/\">Elasticsearch实践(3)-api分页查询</a></p>\n<p>es分页有两种，from size浅分页和scroll深分页，这里对这两种分页都做了实现，使用的是es的java api。from size类似于mysql的limit分页，from偏移，默认为0，size为返回的结果数量，默认为10。在数据量不大的情况下一般会使用from size，数据量大的时候效率比较低，而且很费内存，每次会把from*size条记录全部加载到内存中，对结果返回前进行全局排序，然后丢弃掉范围外的结果，重复这样的操作会导致内存占用过大而使es挂掉，并且受数据条数限制，10000条，需修改索引限制。🤔</p>","more":"<p>scroll分页通俗来说就是滚屏翻页，设置每页查询数量之后，每次查询会返回一个scroll_id，即当前文档的位置，下次查询再传这个scroll_id给es返回下一页的数据以及一个新的scroll_id，类似于按书页码顺序翻书和游标，遗憾的是不支持跳页。🤔适用于不需要跳页持续批量拉取结果、对所有数据分页或一次性查询大量数据的场景，这种记录文档位置的查询方式效率非常高，也就是常说的倒排索引。下面使用java api实现这两种分页效果。</p>\n<h2 id=\"1-使用from-size查询\"><a href=\"#1-使用from-size查询\" class=\"headerlink\" title=\"1. 使用from size查询\"></a>1. 使用from size查询</h2><p>使用 from and size 的深度分页，比如说 <code>?size=10&amp;from=10000</code> 是非常低效的，<br>因为 100,000 排序的结果必须从每个分片上取出并重新排序最后返回 10 条。这个过程需要对每个请求页重复。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'</div><div class=\"line\">&#123; \"from\" : 0, \"size\" : 10,</div><div class=\"line\">  \"query\" : &#123; \"match\" : &#123; \"content\" : \"进口水果\" &#125;&#125;&#125;'</div></pre></td></tr></table></figure>\n<h2 id=\"2-使用scroll查询\"><a href=\"#2-使用scroll查询\" class=\"headerlink\" title=\"2. 使用scroll查询\"></a>2. 使用scroll查询</h2><p>使用scroll查询，需要设置<code>scroll_id</code>的失效时间。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl '10.10.13.234:9200/index/skuId/_search?scroll=1m'  -d '</div><div class=\"line\">&#123;</div><div class=\"line\">  \"query\" : &#123; \"match\" : &#123; \"name\" : \"进口水果\" &#125;&#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>会返回<code>scroll_id</code>，根据这个<code>scroll_id</code>进行下一次查询</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XGET 10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m -d &#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;</div><div class=\"line\">curl -XGET &apos;10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m&amp;search_type=scan&apos; -d &apos;&#123;&quot;size&quot;:3,&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&apos;</div><div class=\"line\">curl –XGET &apos;10.10.13.234:9200/_search/scroll?scroll=2m&amp;pretty</div><div class=\"line\">&amp;scroll_id=c2Nhbjs1OzcyNTY6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjYwOjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7NzI1Nzo3VS04THcyaFJBeTZKMWdqbDhuT05ROzcyNTg6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjU5OjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7MTt0b3RhbF9oaXRzOjUxNTM3MDs=&apos;</div></pre></td></tr></table></figure>\n<h2 id=\"1-使用es的java-api操作\"><a href=\"#1-使用es的java-api操作\" class=\"headerlink\" title=\"1. 使用es的java api操作\"></a>1. 使用es的java api操作</h2><p>java api可查阅<a href=\"https://es.quanke.name/，\" target=\"_blank\" rel=\"external\">https://es.quanke.name/，</a></p>\n<p>创建springboot工程，可以在<a href=\"http://start.spring.io/\" target=\"_blank\" rel=\"external\">http://start.spring.io/</a></p>\n<p>下载springboot工程模板，也可在github:<a href=\"https://github.com/wonderomg/elasticsearch-visual\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/elasticsearch-visual</a>下载本工程。</p>\n<p>(1)导入es的maven依赖，pom.xml内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Elasticsearch核心依赖包 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-1-判断索引是否存在\"><a href=\"#1-1-判断索引是否存在\" class=\"headerlink\" title=\"1.1  判断索引是否存在\"></a>1.1  判断索引是否存在</h3><p>检验索引是否创建成功，是否存在，通过prepareExists查询指定索引；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 1.判断索引是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isIndexExists</span><span class=\"params\">(Client client, String index)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesExistsResponse response = indicesAdminClient.prepareExists(index).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">        <span class=\"comment\">/* 另一种方式</span></div><div class=\"line\">        IndicesExistsRequest indicesExistsRequest = new IndicesExistsRequest(index);</div><div class=\"line\">        IndicesExistsResponse response = client.admin().indices().exists(indicesExistsRequest).actionGet();*/</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-2-判断类型是否存在\"><a href=\"#1-2-判断类型是否存在\" class=\"headerlink\" title=\"1.2 判断类型是否存在\"></a>1.2 判断类型是否存在</h3><p>类型存在的检查与索引的检查类似，只不过类型只挂在索引下，所以需要先指定索引名，然后再查询类型是否存在；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 2.判断类型是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTypeExists</span><span class=\"params\">(Client client, String index, String type)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!isIndexExists(client, index)) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        TypesExistsResponse response = indicesAdminClient.prepareTypesExists(index).setTypes(type).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-创建复杂索引\"><a href=\"#1-3-创建复杂索引\" class=\"headerlink\" title=\"1.3 创建复杂索引\"></a>1.3 创建复杂索引</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 3.创建复杂索引，即有映射</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> indices</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type</div><div class=\"line\">     * <span class=\"doctag\">@param</span> clusterName</div><div class=\"line\">     * <span class=\"doctag\">@param</span> host</div><div class=\"line\">     * <span class=\"doctag\">@param</span> port</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">createYxMapping</span><span class=\"params\">(String indices, String type, String clusterName, String host, <span class=\"keyword\">int</span> port)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                    .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                    .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                    .build();</div><div class=\"line\">            Client client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(host), port));</div><div class=\"line\">            client.admin().indices().prepareCreate(indices).execute().actionGet();</div><div class=\"line\">            <span class=\"keyword\">new</span> XContentFactory();</div><div class=\"line\">            XContentBuilder builder = XContentFactory.jsonBuilder()</div><div class=\"line\">                    .startObject()</div><div class=\"line\">                    .startObject(type)</div><div class=\"line\">                    .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                    .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>, <span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                    .startObject(<span class=\"string\">\"num\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                    .startObject(<span class=\"string\">\"sex\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"not_analyzed\"</span>).endObject()</div><div class=\"line\">                    .endObject()</div><div class=\"line\">                    .endObject()</div><div class=\"line\">                    .endObject();</div><div class=\"line\">            PutMappingRequest mapping = Requests.putMappingRequest(indices).type(type).source(builder);</div><div class=\"line\"></div><div class=\"line\">            client.admin().indices().putMapping(mapping).actionGet();</div><div class=\"line\">            client.close();</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            logger.error(<span class=\"string\">\"createMapping error \"</span>, e);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-4-创建空索引\"><a href=\"#1-4-创建空索引\" class=\"headerlink\" title=\"1.4 创建空索引\"></a>1.4 创建空索引</h3><p>创建一个空索引，无映射mapping，当我们设计好mapping的相关设置再映射即可，空索引创建如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 4.创建空索引  默认setting 无mapping</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">createSimpleIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    CreateIndexResponse response = indicesAdminClient.prepareCreate(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-5-为空索引映射mapping\"><a href=\"#1-5-为空索引映射mapping\" class=\"headerlink\" title=\"1.5 为空索引映射mapping\"></a>1.5 为空索引映射mapping</h3><p>可以为空索引创建或修改索引的映射，需要确保索引存在，否则会报错，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 5.设置映射</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@param</span> type</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">putIndexMapping</span><span class=\"params\">(Client client, String index, String type)</span></span>&#123;</div><div class=\"line\">    <span class=\"comment\">// mapping</span></div><div class=\"line\">    XContentBuilder mappingBuilder;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        mappingBuilder = XContentFactory.jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .startObject(type)</div><div class=\"line\">                .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>, <span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                 .startObject(<span class=\"string\">\"num\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                 .startObject(<span class=\"string\">\"sex\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"index\"</span>, <span class=\"string\">\"not_analyzed\"</span>).endObject()</div><div class=\"line\">                 .endObject()</div><div class=\"line\">                 .endObject()</div><div class=\"line\">                 .endObject();</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        logger.error(<span class=\"string\">\"--------- createIndex 创建 mapping 失败：\"</span>, e);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    PutMappingResponse response = indicesAdminClient.preparePutMapping(index).setType(type).setSource(mappingBuilder).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-6-删除索引\"><a href=\"#1-6-删除索引\" class=\"headerlink\" title=\"1.6 删除索引\"></a>1.6 删除索引</h3><p>删除索引api：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 6.删除索引</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> index</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">deleteIndex</span><span class=\"params\">(Client client, String index)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        DeleteIndexResponse response = indicesAdminClient.prepareDelete(index).execute().actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-7-关闭索引\"><a href=\"#1-7-关闭索引\" class=\"headerlink\" title=\"1.7 关闭索引\"></a>1.7 关闭索引</h3><p>如果我们不想直接删除索引，而是仅仅短暂停止某个索引的使用，那么我们可以关闭索引的这个功能，只是短暂使用之，后续可能有恢复的需求，关闭使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 7.关闭索引</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">closeIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    CloseIndexResponse response = indicesAdminClient.prepareClose(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-8-打开索引\"><a href=\"#1-8-打开索引\" class=\"headerlink\" title=\"1.8 打开索引\"></a>1.8 打开索引</h3><p>既然有关闭索引，那么肯定也有重新打开索引的操作，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 8.开启索引</div><div class=\"line\"> * <span class=\"doctag\">@param</span> client</div><div class=\"line\"> * <span class=\"doctag\">@param</span> index</div><div class=\"line\"> * <span class=\"doctag\">@return</span></div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">openIndex</span><span class=\"params\">(Client client, String index)</span></span>&#123;</div><div class=\"line\">    IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">    OpenIndexResponse response = indicesAdminClient.prepareOpen(index).get();</div><div class=\"line\">    <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-9-判断别名是否存在\"><a href=\"#1-9-判断别名是否存在\" class=\"headerlink\" title=\"1.9 判断别名是否存在\"></a>1.9 判断别名是否存在</h3><p>上一篇我们学习了索引别名的重要，所以api也不能落下，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 9.判断别名是否存在</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isAliasExist</span><span class=\"params\">(Client client, String... aliases)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        AliasesExistResponse response = indicesAdminClient.prepareAliasesExist(aliases).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isExists();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-10-添加别名\"><a href=\"#1-10-添加别名\" class=\"headerlink\" title=\"1.10 添加别名\"></a>1.10 添加别名</h3><p>别名是映射到实际索引上，所以需要传入实际索引名以及要设置的别名alias，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 10.添加别名</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addAlias</span><span class=\"params\">(TransportClient client, String index, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().addAlias(index, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-11-移除别名\"><a href=\"#1-11-移除别名\" class=\"headerlink\" title=\"1.11 移除别名\"></a>1.11 移除别名</h3><p>当然，添加的别名也可以删除，方便设置新的别名和切换索引别名，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 11.移除别名</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">removeAlias</span><span class=\"params\">(TransportClient client, String index, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(index, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-12-删除一个别名后再添加一个别名\"><a href=\"#1-12-删除一个别名后再添加一个别名\" class=\"headerlink\" title=\"1.12 删除一个别名后再添加一个别名\"></a>1.12 删除一个别名后再添加一个别名</h3><p>这里实际上将删除与添加别名放在一起操作，所以需要传就别名和新别名，使用如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\">     * 12.删除一个别名后再添加一个</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span></div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">removeAndCreateAlias</span><span class=\"params\">(TransportClient client, String indexOld, String indexNew, String alias)</span> </span>&#123;</div><div class=\"line\">        IndicesAdminClient indicesAdminClient = client.admin().indices();</div><div class=\"line\">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(indexOld, alias)</div><div class=\"line\">                .addAlias(indexNew, alias).get();</div><div class=\"line\">        <span class=\"keyword\">return</span> response.isAcknowledged();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-创建测试基类连接es\"><a href=\"#2-创建测试基类连接es\" class=\"headerlink\" title=\"2. 创建测试基类连接es\"></a>2. 创建测试基类连接es</h2><p>创建test类测试连接、插入、查询数据是否正常。</p>\n<p>这里可以模拟一批数据插入es，后面的分页操作对大量数据才看得出效果，我这里有的40万数据加入到es中，方便后面的分页测试。</p>\n<p>ElasticsearchTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div><div class=\"line\">388</div><div class=\"line\">389</div><div class=\"line\">390</div><div class=\"line\">391</div><div class=\"line\">392</div><div class=\"line\">393</div><div class=\"line\">394</div><div class=\"line\">395</div><div class=\"line\">396</div><div class=\"line\">397</div><div class=\"line\">398</div><div class=\"line\">399</div><div class=\"line\">400</div><div class=\"line\">401</div><div class=\"line\">402</div><div class=\"line\">403</div><div class=\"line\">404</div><div class=\"line\">405</div><div class=\"line\">406</div><div class=\"line\">407</div><div class=\"line\">408</div><div class=\"line\">409</div><div class=\"line\">410</div><div class=\"line\">411</div><div class=\"line\">412</div><div class=\"line\">413</div><div class=\"line\">414</div><div class=\"line\">415</div><div class=\"line\">416</div><div class=\"line\">417</div><div class=\"line\">418</div><div class=\"line\">419</div><div class=\"line\">420</div><div class=\"line\">421</div><div class=\"line\">422</div><div class=\"line\">423</div><div class=\"line\">424</div><div class=\"line\">425</div><div class=\"line\">426</div><div class=\"line\">427</div><div class=\"line\">428</div><div class=\"line\">429</div><div class=\"line\">430</div><div class=\"line\">431</div><div class=\"line\">432</div><div class=\"line\">433</div><div class=\"line\">434</div><div class=\"line\">435</div><div class=\"line\">436</div><div class=\"line\">437</div><div class=\"line\">438</div><div class=\"line\">439</div><div class=\"line\">440</div><div class=\"line\">441</div><div class=\"line\">442</div><div class=\"line\">443</div><div class=\"line\">444</div><div class=\"line\">445</div><div class=\"line\">446</div><div class=\"line\">447</div><div class=\"line\">448</div><div class=\"line\">449</div><div class=\"line\">450</div><div class=\"line\">451</div><div class=\"line\">452</div><div class=\"line\">453</div><div class=\"line\">454</div><div class=\"line\">455</div><div class=\"line\">456</div><div class=\"line\">457</div><div class=\"line\">458</div><div class=\"line\">459</div><div class=\"line\">460</div><div class=\"line\">461</div><div class=\"line\">462</div><div class=\"line\">463</div><div class=\"line\">464</div><div class=\"line\">465</div><div class=\"line\">466</div><div class=\"line\">467</div><div class=\"line\">468</div><div class=\"line\">469</div><div class=\"line\">470</div><div class=\"line\">471</div><div class=\"line\">472</div><div class=\"line\">473</div><div class=\"line\">474</div><div class=\"line\">475</div><div class=\"line\">476</div><div class=\"line\">477</div><div class=\"line\">478</div><div class=\"line\">479</div><div class=\"line\">480</div><div class=\"line\">481</div><div class=\"line\">482</div><div class=\"line\">483</div><div class=\"line\">484</div><div class=\"line\">485</div><div class=\"line\">486</div><div class=\"line\">487</div><div class=\"line\">488</div><div class=\"line\">489</div><div class=\"line\">490</div><div class=\"line\">491</div><div class=\"line\">492</div><div class=\"line\">493</div><div class=\"line\">494</div><div class=\"line\">495</div><div class=\"line\">496</div><div class=\"line\">497</div><div class=\"line\">498</div><div class=\"line\">499</div><div class=\"line\">500</div><div class=\"line\">501</div><div class=\"line\">502</div><div class=\"line\">503</div><div class=\"line\">504</div><div class=\"line\">505</div><div class=\"line\">506</div><div class=\"line\">507</div><div class=\"line\">508</div><div class=\"line\">509</div><div class=\"line\">510</div><div class=\"line\">511</div><div class=\"line\">512</div><div class=\"line\">513</div><div class=\"line\">514</div><div class=\"line\">515</div><div class=\"line\">516</div><div class=\"line\">517</div><div class=\"line\">518</div><div class=\"line\">519</div><div class=\"line\">520</div><div class=\"line\">521</div><div class=\"line\">522</div><div class=\"line\">523</div><div class=\"line\">524</div><div class=\"line\">525</div><div class=\"line\">526</div><div class=\"line\">527</div><div class=\"line\">528</div><div class=\"line\">529</div><div class=\"line\">530</div><div class=\"line\">531</div><div class=\"line\">532</div><div class=\"line\">533</div><div class=\"line\">534</div><div class=\"line\">535</div><div class=\"line\">536</div><div class=\"line\">537</div><div class=\"line\">538</div><div class=\"line\">539</div><div class=\"line\">540</div><div class=\"line\">541</div><div class=\"line\">542</div><div class=\"line\">543</div><div class=\"line\">544</div><div class=\"line\">545</div><div class=\"line\">546</div><div class=\"line\">547</div><div class=\"line\">548</div><div class=\"line\">549</div><div class=\"line\">550</div><div class=\"line\">551</div><div class=\"line\">552</div><div class=\"line\">553</div><div class=\"line\">554</div><div class=\"line\">555</div><div class=\"line\">556</div><div class=\"line\">557</div><div class=\"line\">558</div><div class=\"line\">559</div><div class=\"line\">560</div><div class=\"line\">561</div><div class=\"line\">562</div><div class=\"line\">563</div><div class=\"line\">564</div><div class=\"line\">565</div><div class=\"line\">566</div><div class=\"line\">567</div><div class=\"line\">568</div><div class=\"line\">569</div><div class=\"line\">570</div><div class=\"line\">571</div><div class=\"line\">572</div><div class=\"line\">573</div><div class=\"line\">574</div><div class=\"line\">575</div><div class=\"line\">576</div><div class=\"line\">577</div><div class=\"line\">578</div><div class=\"line\">579</div><div class=\"line\">580</div><div class=\"line\">581</div><div class=\"line\">582</div><div class=\"line\">583</div><div class=\"line\">584</div><div class=\"line\">585</div><div class=\"line\">586</div><div class=\"line\">587</div><div class=\"line\">588</div><div class=\"line\">589</div><div class=\"line\">590</div><div class=\"line\">591</div><div class=\"line\">592</div><div class=\"line\">593</div><div class=\"line\">594</div><div class=\"line\">595</div><div class=\"line\">596</div><div class=\"line\">597</div><div class=\"line\">598</div><div class=\"line\">599</div><div class=\"line\">600</div><div class=\"line\">601</div><div class=\"line\">602</div><div class=\"line\">603</div><div class=\"line\">604</div><div class=\"line\">605</div><div class=\"line\">606</div><div class=\"line\">607</div><div class=\"line\">608</div><div class=\"line\">609</div><div class=\"line\">610</div><div class=\"line\">611</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</div><div class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.core.JsonProcessingException;</div><div class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</div><div class=\"line\"><span class=\"keyword\">import</span> com.sun.controller.DateUtils;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.delete.DeleteResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.get.GetResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.index.IndexResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchType;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.update.UpdateResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Client;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Requests;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.transport.TransportClient;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.settings.Settings;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.unit.TimeValue;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.xcontent.XContentFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.*;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHits;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.File;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.FileInputStream;</div><div class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.UnknownHostException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 类功能描述:Elasticsearch的基本测试</div><div class=\"line\"> *</div><div class=\"line\"> * <span class=\"doctag\">@author</span> liu</div><div class=\"line\"> * <span class=\"doctag\">@since</span> 2018/5/24</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ElasticsearchTest</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(ElasticsearchTest.class);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String HOST = <span class=\"string\">\"10.10.13.234\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** http请求的端口是9200，客户端是9300 */</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> PORT = <span class=\"number\">9300</span>;</div><div class=\"line\"></div><div class=\"line\">    Client client;</div><div class=\"line\">    <span class=\"comment\">/** 索引库名 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String index = <span class=\"string\">\"my_index\"</span>;</div><div class=\"line\">    <span class=\"comment\">/** 类型名称 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String type = <span class=\"string\">\"skuId\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String clusterName = <span class=\"string\">\"my-application\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 创建mapping，注意：每次只能创建一次</div><div class=\"line\">     * 创建mapping(field(\"indexAnalyzer\",\"ik\")该字段分词IK索引 ；field(\"searchAnalyzer\",\"ik\")该字段分词ik查询；具体分词插件请看IK分词插件说明)</div><div class=\"line\">     * 创建mapping(field(\"analyzer\",\"ik\")该字段分词IK索引 ；field(\"index\",\"analyzed\")该字段分词ik查询；具体分词插件请看IK分词插件说明)2.x版</div><div class=\"line\">     * <span class=\"doctag\">@param</span> indices 索引名称；</div><div class=\"line\">     * <span class=\"doctag\">@param</span> mappingType 类型</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createMapping</span><span class=\"params\">()</span><span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String indices = <span class=\"string\">\"jd_mall_v2\"</span>;</div><div class=\"line\">        String mappingType = <span class=\"string\">\"goods\"</span>;</div><div class=\"line\"></div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        Client client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\"></div><div class=\"line\">        client.admin().indices().prepareCreate(indices).execute().actionGet();</div><div class=\"line\">        <span class=\"keyword\">new</span> XContentFactory();</div><div class=\"line\">        XContentBuilder builder=XContentFactory.jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .startObject(mappingType)</div><div class=\"line\">                .startObject(<span class=\"string\">\"properties\"</span>)</div><div class=\"line\">                .startObject(<span class=\"string\">\"name\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"string\"</span>).field(<span class=\"string\">\"store\"</span>, <span class=\"string\">\"yes\"</span>).field(<span class=\"string\">\"analyzer\"</span>,<span class=\"string\">\"ik\"</span>).field(<span class=\"string\">\"index\"</span>,<span class=\"string\">\"analyzed\"</span>).endObject()</div><div class=\"line\">                .startObject(<span class=\"string\">\"price\"</span>).field(<span class=\"string\">\"type\"</span>, <span class=\"string\">\"long\"</span>).endObject()</div><div class=\"line\">                .endObject()</div><div class=\"line\">                .endObject()</div><div class=\"line\">                .endObject();</div><div class=\"line\">        PutMappingRequest mapping = Requests.putMappingRequest(indices).type(mappingType).source(builder);</div><div class=\"line\"></div><div class=\"line\">        client.admin().indices().putMapping(mapping).actionGet();</div><div class=\"line\">        client.close();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">()</span></span></div><div class=\"line\">    &#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 1:通过 setting对象来指定集群配置信息</div><div class=\"line\">         * //指定集群名称</div><div class=\"line\">         * //启动嗅探功能</div><div class=\"line\">         */</div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 2：创建客户端</div><div class=\"line\">         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch</div><div class=\"line\">         * 链接使用tcp协议即9300</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\">            System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (UnknownHostException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">/*transportClient = new TransportClient(setting);</span></div><div class=\"line\">        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);</div><div class=\"line\">        transportClient.addTransportAddresses(transportAddress);*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 3：查看集群信息</div><div class=\"line\">         * 注意我的集群结构是：</div><div class=\"line\">         *   131的elasticsearch.yml中指定为主节点不能存储数据，</div><div class=\"line\">         *   128的elasticsearch.yml中指定不为主节点只能存储数据。</div><div class=\"line\">         * 所有控制台只打印了192.168.79.128,只能获取数据节点</div><div class=\"line\">         *</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"comment\">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></div><div class=\"line\">        for(DiscoveryNode node : connectedNodes)</div><div class=\"line\">        &#123;</div><div class=\"line\">            System.out.println(node.getHostAddress());</div><div class=\"line\">        &#125;*/</div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 测试Elasticsearch客户端连接</div><div class=\"line\">     * <span class=\"doctag\">@Title</span>: test1</div><div class=\"line\">     * <span class=\"doctag\">@author</span> sunt</div><div class=\"line\">     * <span class=\"doctag\">@date</span> 2017年11月22日</div><div class=\"line\">     * <span class=\"doctag\">@return</span> void</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> UnknownHostException</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"resource\"</span>)</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> UnknownHostException </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//创建客户端</span></div><div class=\"line\">        <span class=\"comment\">/*TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddresses(</span></div><div class=\"line\">                new InetSocketTransportAddress(InetAddress.getByName(HOST),PORT));*/</div><div class=\"line\">        TransportClient client = TransportClient.builder().build().addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\"></div><div class=\"line\">        logger.debug(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//关闭客户端</span></div><div class=\"line\">        client.close();</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGet</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        <span class=\"comment\">/*GetResponse response1 = client.prepareGet(index, \"person\", \"9\").get();</span></div><div class=\"line\">        response1.getSourceAsMap();//获取值转换成map</div><div class=\"line\">        System.out.println(\"查询一条数据:\" + JSON.toJSON(response1.getSourceAsMap()));*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取分词</span></div><div class=\"line\">        List&lt;String&gt; listAnalysis = getIkAnalyzeSearchTerms(<span class=\"string\">\"进口水果\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList6 = testMultiQueryStringQuery(index, type, \"name\", listAnalysis);</span></div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; resultList3 = testQueryStringQuery(index, type, <span class=\"string\">\"name\"</span>, <span class=\"string\">\"进口水果\"</span>);</div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList4 = getDataByWildcard(index, type, \"name\", \"*水果*\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList5 = getDataByMatch(index, type, \"name\", \"进口 水果\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList = getQueryDataBySingleField(index, type, \"name\", \"进口水果\");</span></div><div class=\"line\">        <span class=\"comment\">//List&lt;Map&lt;String, Object&gt;&gt; resultList2 = testSearchByPrefix(index, \"name\", \"进口水果\");</span></div><div class=\"line\">        <span class=\"comment\">//System.out.println();</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 增查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testCreate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String[] skuIds = &#123;<span class=\"string\">\"2246904\"</span>, <span class=\"string\">\"2138027\"</span>, <span class=\"string\">\"3724941\"</span>, <span class=\"string\">\"5664705\"</span>, <span class=\"string\">\"3711635\"</span>&#125;;</div><div class=\"line\">        String[] skuNames = &#123;<span class=\"string\">\"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\"</span>,</div><div class=\"line\">                            <span class=\"string\">\"江西名牌 杨氏精品脐橙 5kg装 铂金果 水果橙子礼盒 2种包装随机发货\"</span>&#125;;</div><div class=\"line\">        String[] skuPrices = &#123;<span class=\"string\">\"500\"</span>, <span class=\"string\">\"3800\"</span>, <span class=\"string\">\"4990\"</span>, <span class=\"string\">\"8500\"</span>, <span class=\"string\">\"5880\"</span>&#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;skuIds.length; i++) &#123;</div><div class=\"line\">            String skuId = skuIds[i];</div><div class=\"line\">            String skuName = skuNames[i];</div><div class=\"line\">            String skuPrice = skuPrices[i];</div><div class=\"line\"></div><div class=\"line\">            String jsonStr = <span class=\"string\">\"&#123;\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuId\\\":\\\"\"</span>+skuId+<span class=\"string\">\"\\\",\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuName\\\":\\\"\"</span>+skuName+<span class=\"string\">\"\\\",\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"\\\"skuPrice\\\":\\\"\"</span>+skuPrice+<span class=\"string\">\"\\\"\"</span> +</div><div class=\"line\">                    <span class=\"string\">\"&#125;\"</span>;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//参数说明： 索引，类型 ，_id；//setSource可以传以上map string  byte[] 几种方式</span></div><div class=\"line\">            IndexResponse response = client.prepareIndex(index, type, skuId)</div><div class=\"line\">                    .setSource(jsonStr,XContentType.JSON)</div><div class=\"line\">                    .get();</div><div class=\"line\">            <span class=\"keyword\">boolean</span> created = response.isCreated();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"创建一条记录:\"</span> + created);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">            GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">            response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">            System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 删查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testDelete</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\">        String skuImage = <span class=\"string\">\"jfs/t16450/249/461724533/219792/7f204d7a/5a321ecbN4526f7d3.jpg\"</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//删除_id为1的类型</span></div><div class=\"line\">        DeleteResponse response2 = client.prepareDelete(index, type, skuId).get();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除一条数据：\"</span> + response2.isFound());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">        response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 改查</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@throws</span> Exception</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUpdate</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        String skuId = <span class=\"string\">\"3724941\"</span>;</div><div class=\"line\">        String skuName = <span class=\"string\">\"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\"</span>;</div><div class=\"line\">        String skuPrice = <span class=\"string\">\"4990\"</span>;</div><div class=\"line\">        String skuName2 = <span class=\"string\">\"华圣 陕西精品红富士苹果 12个装 果径75mm 约2.1kg 新鲜水果\"</span>;</div><div class=\"line\">        <span class=\"comment\">//更新</span></div><div class=\"line\">        UpdateResponse updateResponse = client.prepareUpdate(index, type, skuId).setDoc(jsonBuilder()</div><div class=\"line\">                .startObject()</div><div class=\"line\">                .field(<span class=\"string\">\"name\"</span>, skuName2)</div><div class=\"line\">                .endObject())</div><div class=\"line\">                .get();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"更新一条数据:\"</span> + updateResponse.isCreated());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//获取_id为1的类型</span></div><div class=\"line\">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</div><div class=\"line\">        response1.getSourceAsMap();<span class=\"comment\">//获取值转换成map</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"查询一条数据:\"</span> + JSON.toJSON(response1.getSourceAsMap()));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将对象通过jackson.databind转换成byte[]</div><div class=\"line\">     * 注意一下date类型需要格式化处理  默认是 时间戳</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] convertByteArray(Object obj) &#123;</div><div class=\"line\">        <span class=\"comment\">// create once, reuse</span></div><div class=\"line\">        ObjectMapper mapper = <span class=\"keyword\">new</span> ObjectMapper();</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">byte</span>[] json = mapper.writeValueAsBytes(obj);</div><div class=\"line\">            <span class=\"keyword\">return</span> json;</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (JsonProcessingException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将对象通过JSONtoString转换成JSON字符串</div><div class=\"line\">     * 使用fastjson 格式化注解  在属性上加入 <span class=\"doctag\">@JSONField</span>(format=\"yyyy-MM-dd HH:mm:ss\")</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">jsonStr</span><span class=\"params\">(Object obj)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(obj);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/*****************************/</span></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">            * 根据文档名、字段名、字段值查询某一条记录的详细信息；query查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type  文档名，相当于oracle中的表名，例如：ql_xz；</div><div class=\"line\">            * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value  字段值，如：“”</div><div class=\"line\">            * <span class=\"doctag\">@return</span>  List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getQueryDataBySingleField</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        QueryBuilder qb = QueryBuilders.termQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(qb)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 多条件  文档名、字段名、字段值，查询某一条记录的详细信息</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> map 字段名：字段值 的map</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getBoolDataByMuchField</span><span class=\"params\">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String in : map.keySet()) &#123;</div><div class=\"line\">            <span class=\"comment\">//map.keySet()返回的是所有key的值</span></div><div class=\"line\">            String str = map.get(in);<span class=\"comment\">//得到每个key多对用value的值</span></div><div class=\"line\">            boolQueryBuilder.must(QueryBuilders.termQuery(in,str));</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 通配符查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByWildcard</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        WildcardQueryBuilder wBuilder = QueryBuilders.wildcardQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(wBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 多条件 通配符查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type  type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> map   包含key:value 模糊值键值对</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByMuchWildcard</span><span class=\"params\">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String in : map.keySet()) &#123;</div><div class=\"line\">            <span class=\"comment\">//map.keySet()返回的是所有key的值</span></div><div class=\"line\">            String str = map.get(in);<span class=\"comment\">//得到每个key多对用value的值</span></div><div class=\"line\">            boolQueryBuilder.must(QueryBuilders.wildcardQuery(in,str));</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 模糊拆分查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByMatch</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        MatchQueryBuilder mBuilder = QueryBuilders.matchQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(mBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 单条件 中文分词模糊查询</div><div class=\"line\">     * <span class=\"doctag\">@param</span> type 文档名，相当于oracle中的表名，例如：ql_xz</div><div class=\"line\">     * <span class=\"doctag\">@param</span> key 字段名，例如：bdcqzh</div><div class=\"line\">     * <span class=\"doctag\">@param</span> value 字段名模糊值：如 *123* ;?123*;?123?;*123?;</div><div class=\"line\">     * <span class=\"doctag\">@return</span> List</div><div class=\"line\">     * <span class=\"doctag\">@author</span> Lixin</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">getDataByPrefix</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        PrefixQueryBuilder pBuilder = QueryBuilders.prefixQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(pBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 中文分词的操作</div><div class=\"line\">     * 1.查询以\"中\"开头的数据，有两条</div><div class=\"line\">     * 2.查询以“中国”开头的数据，有0条</div><div class=\"line\">     * 3.查询包含“烂”的数据，有1条</div><div class=\"line\">     * 4.查询包含“烂摊子”的数据，有0条</div><div class=\"line\">     * 分词：</div><div class=\"line\">     *      为什么我们搜索China is the greatest country~</div><div class=\"line\">     *                 中文：中国最牛逼</div><div class=\"line\">     *</div><div class=\"line\">     *                 ×××</div><div class=\"line\">     *                      中华</div><div class=\"line\">     *                      人民</div><div class=\"line\">     *                      共和国</div><div class=\"line\">     *                      中华人民</div><div class=\"line\">     *                      人民共和国</div><div class=\"line\">     *                      华人</div><div class=\"line\">     *                      共和</div><div class=\"line\">     *      特殊的中文分词法：</div><div class=\"line\">     *          庖丁解牛</div><div class=\"line\">     *          IK分词法</div><div class=\"line\">     *          搜狗分词法</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testSearchByPrefix</span><span class=\"params\">(String index, String key, String value)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 在prepareSearch()的参数为索引库列表，意为要从哪些索引库中进行查询</span></div><div class=\"line\">        SearchResponse response = client.prepareSearch(index)</div><div class=\"line\">                .setSearchType(SearchType.DEFAULT)  <span class=\"comment\">// 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></div><div class=\"line\">                <span class=\"comment\">//.setSearchType(SearchType.DEFAULT)  // 设置查询类型，有QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></div><div class=\"line\">                <span class=\"comment\">//.setQuery(QueryBuilders.prefixQuery(\"content\", \"烂摊子\"))// 设置相应的query，用于检索，termQuery的参数说明：name是doc中的具体的field，value就是要找的具体的值</span></div><div class=\"line\"><span class=\"comment\">//                .setQuery(QueryBuilders.regexpQuery(\"content\", \".*烂摊子.*\"))</span></div><div class=\"line\">                .setQuery(QueryBuilders.prefixQuery(key, value))</div><div class=\"line\">                .get();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testFuzzyQuery</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        FuzzyQueryBuilder fBuilder = QueryBuilders.fuzzyQuery(key, value);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(fBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQuery</span><span class=\"params\">(String index, String type, String key, String value)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(fBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testMultiQueryStringQuery</span><span class=\"params\">(String index, String type, String key, List&lt;String&gt; listAnalysis)</span></span>&#123;</div><div class=\"line\">        <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        <span class=\"keyword\">for</span> (String term : listAnalysis) &#123;</div><div class=\"line\">            boolQueryBuilder.should(QueryBuilders.queryStringQuery(term).field(key));</div><div class=\"line\">            <span class=\"comment\">//这里可以用must 或者 should 视情况而定</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(boolQueryBuilder)</div><div class=\"line\">                .setFrom(<span class=\"number\">0</span>).setSize(<span class=\"number\">10000</span>).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                .execute()</div><div class=\"line\">                .actionGet();</div><div class=\"line\">        <span class=\"keyword\">return</span> responseToList(client,response);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将查询后获得的response转成list</div><div class=\"line\">     * <span class=\"doctag\">@param</span> client</div><div class=\"line\">     * <span class=\"doctag\">@param</span> response</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">responseToList</span><span class=\"params\">(Client client, SearchResponse response)</span></span>&#123;</div><div class=\"line\">        SearchHits hits = response.getHits();</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; hits.getHits().length; i++) &#123;</div><div class=\"line\">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</div><div class=\"line\">            System.out.println(map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            list.add(map);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"comment\">//client.close();</span></div><div class=\"line\">        <span class=\"keyword\">return</span> list;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 调用 ES 获取 IK 分词后结果</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> searchContent</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;String&gt; <span class=\"title\">getIkAnalyzeSearchTerms</span><span class=\"params\">(String searchContent)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//调用 IK 分词分词</span></div><div class=\"line\">        AnalyzeRequestBuilder ikRequest = <span class=\"keyword\">new</span> AnalyzeRequestBuilder(client,</div><div class=\"line\">                AnalyzeAction.INSTANCE, index, searchContent);</div><div class=\"line\">        <span class=\"comment\">//ikRequest.setAnalyzer(\"ik\");</span></div><div class=\"line\">        ikRequest.setTokenizer(<span class=\"string\">\"ik\"</span>);</div><div class=\"line\">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//循环赋值</span></div><div class=\"line\">        List&lt;String&gt; searchTermList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        <span class=\"comment\">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></div><div class=\"line\">        <span class=\"keyword\">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</div><div class=\"line\">            System.out.println(ikToken.getTerm());</div><div class=\"line\">            searchTermList.add(ikToken.getTerm());</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> searchTermList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testFromSize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"from size 模式启动！\"</span>);</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"keyword\">long</span> count = client.prepareCount(index).setTypes(type).execute()</div><div class=\"line\">                .actionGet().getCount();</div><div class=\"line\">        <span class=\"comment\">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></div><div class=\"line\">        SearchRequestBuilder requestBuilder = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                .setQuery(QueryBuilders.queryStringQuery(<span class=\"string\">\"进口水果\"</span>).field(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>,sum=<span class=\"number\">0</span>; sum&lt;count; i++) &#123;</div><div class=\"line\">            SearchResponse response = requestBuilder.setFrom(i).setSize(<span class=\"number\">3</span>).execute().actionGet();</div><div class=\"line\">            sum += response.getHits().hits().length;</div><div class=\"line\">            responseToList(client,response);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"总量\"</span>+count+<span class=\"string\">\", 已经查到\"</span>+sum);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，</div><div class=\"line\">     * 所以实际返回的数量是：分片的数量*size</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testScroll</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//String index, String type,String key,String value</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"scroll 模式启动！\"</span>);</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        <span class=\"comment\">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></div><div class=\"line\">        <span class=\"comment\">//获取Client对象,设置索引名称,搜索类型(SearchType.SCAN),搜索数量,发送请求</span></div><div class=\"line\">        SearchResponse scrollResponse = client.prepareSearch(index)</div><div class=\"line\">                .setTypes(type)</div><div class=\"line\">                .setQuery(QueryBuilders.queryStringQuery(<span class=\"string\">\"进口水果\"</span>).field(<span class=\"string\">\"name\"</span>))</div><div class=\"line\">                .setSearchType(SearchType.SCAN).setSize(<span class=\"number\">3</span>).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">1</span>))</div><div class=\"line\">                .execute().actionGet();</div><div class=\"line\">        <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，获取总数量</span></div><div class=\"line\">        <span class=\"keyword\">long</span> count = scrollResponse.getHits().getTotalHits();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>,sum=<span class=\"number\">0</span>; sum&lt;count; i++) &#123;</div><div class=\"line\">            scrollResponse = client.prepareSearchScroll(scrollResponse.getScrollId())</div><div class=\"line\">                    .setScroll(TimeValue.timeValueMinutes(<span class=\"number\">8</span>)).execute().actionGet();</div><div class=\"line\">            sum += scrollResponse.getHits().hits().length;</div><div class=\"line\">            responseToList(client,scrollResponse);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"总量\"</span>+count+<span class=\"string\">\", 已经查到\"</span>+sum);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms.\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-分页代码\"><a href=\"#3-分页代码\" class=\"headerlink\" title=\"3. 分页代码\"></a>3. 分页代码</h2><p>创建TestController类，在上述测试都无问题之后，再进行下面的分页操作。</p>\n<p>TestController.java：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.sun.controller;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSONObject;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchScrollRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHit;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</div><div class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.action.search.SearchType;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.Client;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.transport.TransportClient;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.settings.Settings;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.common.unit.TimeValue;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.QueryBuilder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.index.query.QueryBuilders;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.SearchHits;</div><div class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.search.sort.SortOrder;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestParam;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.net.InetAddress;</div><div class=\"line\"><span class=\"keyword\">import</span> java.net.UnknownHostException;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicLong;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 类功能描述:</div><div class=\"line\"> *</div><div class=\"line\"> * <span class=\"doctag\">@author</span> liu</div><div class=\"line\"> * <span class=\"doctag\">@since</span> 2018/2/22</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RestController</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestController</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> Logger logger = LoggerFactory.getLogger(<span class=\"keyword\">this</span>.getClass());</div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String HOST = <span class=\"string\">\"10.10.13.234\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** http请求的端口是9200，客户端是9300 */</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> PORT = <span class=\"number\">9300</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/** 索引库名 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String index = <span class=\"string\">\"my_index\"</span>;</div><div class=\"line\">    <span class=\"comment\">/** 类型名称 */</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String type = <span class=\"string\">\"skuId\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String clusterName = <span class=\"string\">\"my-application\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String template = <span class=\"string\">\"Hello, %s!\"</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicLong counter = <span class=\"keyword\">new</span> AtomicLong();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/greeting\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Greeting <span class=\"title\">greeting</span><span class=\"params\">(@RequestParam(value=<span class=\"string\">\"name\"</span>, defaultValue=<span class=\"string\">\"World\"</span>)</span> String name) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Greeting(counter.incrementAndGet(),</div><div class=\"line\">                String.format(template, name));</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">long</span> <span class=\"title\">getTotalRows</span><span class=\"params\">(String keyword, TransportClient client)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows;</div><div class=\"line\">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">        boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">        <span class=\"keyword\">if</span> (keyword == <span class=\"keyword\">null</span> || keyword.isEmpty()) &#123;</div><div class=\"line\">            totalRows = client.prepareCount(index).setTypes(type)</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet().getCount();</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            QueryBuilder fBuilder = QueryBuilders.queryStringQuery(keyword).field(<span class=\"string\">\"name\"</span>);</div><div class=\"line\">            boolQueryBuilder.must(fBuilder);</div><div class=\"line\">            totalRows = client.prepareCount(index).setTypes(type)</div><div class=\"line\">                    .setQuery(boolQueryBuilder)</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet().getCount();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> totalRows;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/searchFromSize\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">testSearchByFromSize</span><span class=\"params\">(@RequestParam(required = <span class=\"keyword\">false</span>)</span> Integer pageIndex, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> Integer pageSize,</span></div><div class=\"line\">                               @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String keyword, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String priceSort)&#123;</div><div class=\"line\">        logger.info(<span class=\"string\">\"op&lt;testSearchByFromSize&gt; pageIndex&lt;\"</span>+pageIndex+<span class=\"string\">\"&gt; pageSize&lt;\"</span>+pageSize+<span class=\"string\">\"&gt; \"</span> +</div><div class=\"line\">                <span class=\"string\">\"keyword&lt;\"</span>+keyword+<span class=\"string\">\"&gt; priceSort&lt;\"</span>+priceSort+<span class=\"string\">\"&gt;\"</span>);</div><div class=\"line\">        JSONObject result = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        JSONObject goodsResult = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        TransportClient client = getClient();</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows = getTotalRows(keyword, client);</div><div class=\"line\">        getIkAnalyzeSearchTerms(client, keyword);</div><div class=\"line\">        <span class=\"keyword\">int</span> from = (pageIndex - <span class=\"number\">1</span>) * pageSize;</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryFromSize(client, index, type, <span class=\"string\">\"name\"</span>,</div><div class=\"line\">                keyword, from, pageSize, priceSort);</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"goods\"</span>, goodsExportList );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageIndex\"</span>, pageIndex );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageSize\"</span>, pageSize );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"totalRows\"</span>, totalRows );</div><div class=\"line\"></div><div class=\"line\">        result.put( <span class=\"string\">\"success\"</span>, <span class=\"keyword\">true</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultMessage\"</span>, <span class=\"string\">\"\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultCode\"</span>, <span class=\"string\">\"0000\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"result\"</span>, goodsResult );</div><div class=\"line\">        System.out.println(<span class=\"string\">\"---op&lt;searchFromSize&gt; elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> result;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> String scrollIdTemp = <span class=\"string\">\"\"</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@ResponseBody</span></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/searchScroll\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">testSearchByScroll</span><span class=\"params\">(@RequestParam(required = <span class=\"keyword\">false</span>)</span> String scrollId, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> Integer pageSize,</span></div><div class=\"line\">                               @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String keyword, @<span class=\"title\">RequestParam</span><span class=\"params\">(required = <span class=\"keyword\">false</span>)</span> String priceSort)&#123;</div><div class=\"line\">        logger.info(<span class=\"string\">\"op&lt;testSearchByScroll&gt; scrollId&lt;\"</span>+scrollId+<span class=\"string\">\"&gt; pageSize&lt;\"</span>+pageSize+<span class=\"string\">\"&gt; \"</span> +</div><div class=\"line\">                <span class=\"string\">\"keyword&lt;\"</span>+keyword+<span class=\"string\">\"&gt; priceSort&lt;\"</span>+priceSort+<span class=\"string\">\"&gt;\"</span>);</div><div class=\"line\">        JSONObject result = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        JSONObject goodsResult = <span class=\"keyword\">new</span> JSONObject();</div><div class=\"line\">        <span class=\"keyword\">long</span> begin = System.currentTimeMillis();</div><div class=\"line\">        scrollIdTemp = scrollId;</div><div class=\"line\">        TransportClient client = getClient();</div><div class=\"line\">        <span class=\"keyword\">long</span> totalRows = getTotalRows(keyword, client);</div><div class=\"line\">        getIkAnalyzeSearchTerms(client, keyword);</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryScroll(client, index, type, <span class=\"string\">\"name\"</span>,</div><div class=\"line\">                keyword, scrollIdTemp, pageSize, priceSort);</div><div class=\"line\">        client.close();</div><div class=\"line\"></div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"goods\"</span>, goodsExportList );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"scrollId\"</span>, scrollIdTemp );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"pageSize\"</span>, pageSize );</div><div class=\"line\">        goodsResult.put( <span class=\"string\">\"totalRows\"</span>, totalRows );</div><div class=\"line\"></div><div class=\"line\">        result.put( <span class=\"string\">\"success\"</span>, <span class=\"keyword\">true</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultMessage\"</span>, <span class=\"string\">\"\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"resultCode\"</span>, <span class=\"string\">\"0000\"</span> );</div><div class=\"line\">        result.put( <span class=\"string\">\"result\"</span>, goodsResult );</div><div class=\"line\">        System.out.println(<span class=\"string\">\"---op&lt;searchScroll&gt; elapsed&lt;\"</span>+(System.currentTimeMillis()-begin)+<span class=\"string\">\"&gt;ms\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> result;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 然后就是创建两个查询过程了 ，下面是from-size分页的执行代码：</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQueryFromSize</span><span class=\"params\">(TransportClient client, String index, String type, String key,</span></span></div><div class=\"line\">                                     String value, Integer pageIndex, Integer pageSize ,String priceSort)&#123;</div><div class=\"line\">        SearchResponse response = <span class=\"keyword\">null</span>;</div><div class=\"line\">        List resultList = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"keyword\">null</span> || value.isEmpty()) &#123;</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(fBuilder);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> (priceSort == <span class=\"keyword\">null</span> || priceSort.isEmpty()) &#123;</div><div class=\"line\">                response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                        .setQuery(boolQueryBuilder)</div><div class=\"line\">                        .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                        .execute()</div><div class=\"line\">                        .actionGet();</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> ((<span class=\"string\">\"desc\"</span>).equals(priceSort)) &#123;</div><div class=\"line\">                    response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                            .addSort(<span class=\"string\">\"price\"</span>, SortOrder.DESC)</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    response = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class=\"keyword\">true</span>)</div><div class=\"line\">                            .addSort(<span class=\"string\">\"price\"</span>, SortOrder.ASC)</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            resultList = responseToList(response);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> resultList;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 下面是scroll分页的执行代码，注意啊！scroll里面的size是相对于每个分片来说的，</div><div class=\"line\">     * 所以实际返回的数量是：分片的数量*size</div><div class=\"line\">     *</div><div class=\"line\">     * Scroll-Scan 方式与普通 scroll 有几点不同：</div><div class=\"line\">     * 1.Scroll-Scan 结果没有排序，按 index 顺序返回，没有排序，可以提高取数据性能。</div><div class=\"line\">     * 2.初始化时只返回 _scroll_id，没有具体的 hits 结果。</div><div class=\"line\">     * 3.size 控制的是每个分片的返回的数据量而不是整个请求返回的数据量。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">testQueryStringQueryScroll</span><span class=\"params\">(TransportClient client, String index, String type, String key,</span></span></div><div class=\"line\">                                     String value, String scrollId, Integer pageSize ,String priceSort)&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (pageSize != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//默认有5个分片，</span></div><div class=\"line\">            pageSize = pageSize/<span class=\"number\">5</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        SearchResponse scrollResponse = <span class=\"keyword\">null</span>;</div><div class=\"line\">        List resultList = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//TransportClient client = getClient();</span></div><div class=\"line\">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</div><div class=\"line\">            <span class=\"keyword\">if</span> (value == <span class=\"keyword\">null</span> || value.isEmpty()) &#123;</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</div><div class=\"line\">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class=\"string\">\"isShow\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"status\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"deleteStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(QueryBuilders.termQuery(<span class=\"string\">\"salesStatus\"</span>, <span class=\"number\">1</span>))</div><div class=\"line\">                        .must(fBuilder);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">if</span> (scrollId == <span class=\"keyword\">null</span> || scrollId.isEmpty()) &#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (priceSort == <span class=\"keyword\">null</span> || priceSort.isEmpty()) &#123;</div><div class=\"line\">                    scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                            .setQuery(boolQueryBuilder)</div><div class=\"line\">                            .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                            .execute()</div><div class=\"line\">                            .actionGet();</div><div class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">if</span> ((<span class=\"string\">\"desc\"</span>).equals(priceSort)) &#123;</div><div class=\"line\">                        scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                                .setQuery(boolQueryBuilder)</div><div class=\"line\">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                                .addSort(<span class=\"string\">\"price\"</span>, SortOrder.DESC)</div><div class=\"line\">                                .execute()</div><div class=\"line\">                                .actionGet();</div><div class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                        scrollResponse = client.prepareSearch(index).setTypes(type)</div><div class=\"line\">                                .setQuery(boolQueryBuilder)</div><div class=\"line\">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                                .addSort(<span class=\"string\">\"price\"</span>, SortOrder.ASC)</div><div class=\"line\">                                .execute()</div><div class=\"line\">                                .actionGet();</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\">                <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，所以先查一次获取scrollId，在进行第二次scroll查询</span></div><div class=\"line\">                scrollId = scrollResponse.getScrollId();</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            scrollResponse = client.prepareSearchScroll(scrollId)</div><div class=\"line\">                    .setScroll(TimeValue.timeValueMinutes(<span class=\"number\">5</span>))</div><div class=\"line\">                    .execute()</div><div class=\"line\">                    .actionGet();</div><div class=\"line\">            </div><div class=\"line\">            <span class=\"comment\">//注意:首次搜索并不包含数据，第一次不返回数据，获取总数量</span></div><div class=\"line\">            <span class=\"keyword\">long</span> count = scrollResponse.getHits().getTotalHits();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"scrollResponse.getHits().getHits().length:\"</span>+scrollResponse.getHits().hits().length);</div><div class=\"line\">            System.out.println(<span class=\"string\">\"scroll count:\"</span>+count);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">//获取本次查询的scrollId</span></div><div class=\"line\">            scrollIdTemp = scrollResponse.getScrollId();</div><div class=\"line\">            System.out.println(<span class=\"string\">\"--------- searchByScroll scrollID:\"</span>+scrollIdTemp);</div><div class=\"line\">            logger.info(<span class=\"string\">\"--------- searchByScroll scrollID &#123;&#125;\"</span>, scrollIdTemp);</div><div class=\"line\"></div><div class=\"line\">            <span class=\"comment\">// 搜索结果</span></div><div class=\"line\">            SearchHit[] searchHits = scrollResponse.getHits().hits();</div><div class=\"line\">            <span class=\"keyword\">for</span> (SearchHit searchHit : searchHits) &#123;</div><div class=\"line\">                String source = searchHit.getSource().toString();</div><div class=\"line\">                logger.info(<span class=\"string\">\"--------- searchByScroll source &#123;&#125;\"</span>, source);</div><div class=\"line\">            &#125;</div><div class=\"line\">            resultList = responseToList(scrollResponse);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> resultList;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 将查询后获得的response转成list</div><div class=\"line\">     * <span class=\"doctag\">@param</span> response</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List <span class=\"title\">responseToList</span><span class=\"params\">(SearchResponse response)</span></span>&#123;</div><div class=\"line\">        SearchHits hits = response.getHits();</div><div class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        System.out.println(<span class=\"string\">\"hits.hits().length:\"</span>+hits.hits().length);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; hits.hits().length; i++) &#123;</div><div class=\"line\">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</div><div class=\"line\">            Map&lt;String, Object&gt; resultMap = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">16</span>);</div><div class=\"line\">            System.out.println(map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"skuId\"</span>, map.get(<span class=\"string\">\"skuId\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"name\"</span>, map.get(<span class=\"string\">\"name\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"image\"</span>, map.get(<span class=\"string\">\"primaryImage\"</span>));</div><div class=\"line\">            resultMap.put(<span class=\"string\">\"price\"</span>, map.get(<span class=\"string\">\"luckyPrice\"</span>));</div><div class=\"line\">            list.add(resultMap);</div><div class=\"line\">        &#125;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"------------------------\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> list;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> TransportClient <span class=\"title\">getClient</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 1:通过 setting对象来指定集群配置信息</div><div class=\"line\">         * //指定集群名称</div><div class=\"line\">         * //启动嗅探功能</div><div class=\"line\">         */</div><div class=\"line\">        Settings settings = Settings.settingsBuilder()</div><div class=\"line\">                .put(<span class=\"string\">\"cluster.name\"</span>, clusterName)</div><div class=\"line\">                .put(<span class=\"string\">\"client.transport.sniff\"</span>, <span class=\"keyword\">true</span>)</div><div class=\"line\">                .build();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 2：创建客户端</div><div class=\"line\">         * 通过setting来创建，若不指定则默认链接的集群名为elasticsearch</div><div class=\"line\">         * 链接使用tcp协议即9300</div><div class=\"line\">         */</div><div class=\"line\">        TransportClient client = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            client = TransportClient.builder().settings(settings).build()</div><div class=\"line\">                    .addTransportAddress(<span class=\"keyword\">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</div><div class=\"line\">            System.out.println(<span class=\"string\">\"Elasticsearch connect info:\"</span> + client.toString());</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (UnknownHostException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"comment\">/*transportClient = new TransportClient(setting);</span></div><div class=\"line\">        TransportAddress transportAddress = new InetSocketTransportAddress(\"192.168.79.131\", 9300);</div><div class=\"line\">        transportClient.addTransportAddresses(transportAddress);*/</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/**</span></div><div class=\"line\">         * 3：查看集群信息</div><div class=\"line\">         * 注意我的集群结构是：</div><div class=\"line\">         *   131的elasticsearch.yml中指定为主节点不能存储数据，</div><div class=\"line\">         *   128的elasticsearch.yml中指定不为主节点只能存储数据。</div><div class=\"line\">         * 所有控制台只打印了192.168.79.128,只能获取数据节点</div><div class=\"line\">         *</div><div class=\"line\">         */</div><div class=\"line\">        <span class=\"comment\">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></div><div class=\"line\">        for(DiscoveryNode node : connectedNodes)</div><div class=\"line\">        &#123;</div><div class=\"line\">            System.out.println(node.getHostAddress());</div><div class=\"line\">        &#125;*/</div><div class=\"line\">        <span class=\"keyword\">return</span> client;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 调用 ES 获取 IK 分词后结果</div><div class=\"line\">     *</div><div class=\"line\">     * <span class=\"doctag\">@param</span> searchContent</div><div class=\"line\">     * <span class=\"doctag\">@return</span></div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;String&gt; <span class=\"title\">getIkAnalyzeSearchTerms</span><span class=\"params\">(Client client, String searchContent)</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//调用 IK 分词分词</span></div><div class=\"line\">        AnalyzeRequestBuilder ikRequest = <span class=\"keyword\">new</span> AnalyzeRequestBuilder(client,</div><div class=\"line\">                AnalyzeAction.INSTANCE, index, searchContent);</div><div class=\"line\">        <span class=\"comment\">//ikRequest.setAnalyzer(\"ik\");</span></div><div class=\"line\">        ikRequest.setTokenizer(<span class=\"string\">\"ik\"</span>);</div><div class=\"line\">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//循环赋值</span></div><div class=\"line\">        List&lt;String&gt; searchTermList = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</div><div class=\"line\">        <span class=\"comment\">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></div><div class=\"line\">        <span class=\"keyword\">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</div><div class=\"line\">            System.out.println(ikToken.getTerm());</div><div class=\"line\">            searchTermList.add(ikToken.getTerm());</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> searchTermList;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-前端数据\"><a href=\"#4-前端数据\" class=\"headerlink\" title=\"4. 前端数据\"></a>4. 前端数据</h2><p>为上述的分页的数据可视化，加入前端展示页，可按中文关键词搜索分页等操作。</p>\n<p>index.html，以及js操作部分，data.js，由于篇幅问题，下载可移步至github:</p>\n<p><a href=\"https://github.com/wonderomg/elasticsearch-visual下载详细内容，\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/elasticsearch-visual下载详细内容，</a></p>\n<p>前后端页编写完之后，启动springboot工程，访问<code>http://localhost:8080/</code>该工程端口。</p>\n<p>可以看到操作 页面，类似下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/elasticsearch-visual/master/search.png\" alt=\"search\"></p>\n<p>from size和scroll都可通过该页面进行测试。</p>\n<h2 id=\"5-数据限制问题\"><a href=\"#5-数据限制问题\" class=\"headerlink\" title=\"5. 数据限制问题\"></a>5. 数据限制问题</h2><p>测试from size时发现一个问题，当数据超过10000条会报错，提示如下：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">Caused by: QueryPhaseExecutionException[Result window is too large, </div><div class=\"line\">from + size must be less than or equal to: [10000] but was [10001]. </div><div class=\"line\">See the scroll api for a more efficient way to request large data sets. </div><div class=\"line\">This limit can be set by changing the [index.max_result_window] index level parameter.]</div></pre></td></tr></table></figure>\n<p>原因是es索引被限制了可查前10000条数据，参数是<code>max_result_window</code>，需要我们手动修改这个限制。</p>\n<p>(1)查询index.max_result_window</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XGET \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\"</div></pre></td></tr></table></figure>\n<p>(2)更改index.max_result_window</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl -XPUT \"10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true\" -d '&#123; \"index\" : &#123; \"max_result_window\" : 100000000&#125;&#125;'</div></pre></td></tr></table></figure>\n<p>设置max_result_window的时候需要先关闭索引，不然会报错<code>Can&#39;t update non dynamic settings[[index.preserve_existing]] for open indices</code>的错误，可以通过指令关闭，也可以通过head可视化界面关闭和开启，也可以通过上述步骤1.7和1.8的api关闭和开启。</p>\n<h2 id=\"6-排序\"><a href=\"#6-排序\" class=\"headerlink\" title=\"6. 排序\"></a>6. 排序</h2><p>分页的时候我们可以还有排序的场景，java api的话增加代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">searchRequestBuilder.addSort(<span class=\"string\">\"publish_time\"</span>, SortOrder.DESC);</div></pre></td></tr></table></figure>\n<p>按照某个字段排序的话，hit.getScore()将会失效<br>如果是scroll分页无法进行排序。</p>"},{"title":"Elasticsearch实践(1)-搭建及IK中文分词","date":"2018-05-14T16:00:00.000Z","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png","_content":"\n\n\n🔍近期在做商品搜索优化，对比了Solr与Elasticsearch的区别，两者都是基于Lucene实现的封装，但es在数据量越大的情况下实时检索性能优于solr，更适用于实时商品搜索，于是选用了es，下面介绍elasticsearch搜索引擎的搭建及使用，这里使用的是2.2.1的es版本，以及1.8.1的ik分词版本。\n\n<!--more-->\n\n# 安装es及IK中文分词\n\n##  1. 下载安装包\n\n```properties\n##我的环境是Redhat6.4，此处使用的是es2.2.1版本\n##（1）可以使用指令安装\n$ yum install https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.1/elasticsearch-2.2.1.rpm\n##（2）也可以直接下载文件，然后上传至linux目录下\nhttps://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.2.1/elasticsearch-2.2.1.tar.gz\n```\n\n## 2. 上传安装文件到linux目录并解压\n\n我这里将`elasticsearch-2.2.1.tar.gz`文件放至`/opt/elasticsearch`目录下。\n\n解压：\n\n```shell\n$ cd /opt/elasticsearch\n$ tar -zxvf elasticsearch-2.2.1.tar.gz\n```\n\n**此时切记不能用 `./bin/elasticsearch`启动，因为在root权限下会提示错误**：\n\n```shell\nException in thread \"main\" java.lang.RuntimeException: don't run elasticsearch as root.\n```\n\n## 3. 新添加一个elasticsearch用户\n\n\n\n```sh\n#添加elasticsearch用户：\n$ useradd elasticsearch\n#给用户elasticsearch设置密码，连续输入2次：\n$ passwd elasticsearch\n#创建一个用户组es:\n$ groupadd es\n#分配elasticsearch到es组:\n$ usermod -G es elasticsearch\n#在elasticsearch 根目录下，给定用户权限。-R表示逐级（N层目录） ， * 表示 任何文件:\n$ chown -R elasticsearch:es *\n#切换到elasticsearch用户:\n$ su elasticsearch\n```\n\n## 4. 修改配置文件\n\n```shell\n$ vi config/elasticsearch.yml\n```\n\n修改以下内容：\n\n```properties\n#cluster name\ncluster.name: my-application\n#节点名称\nnode.name: node-1\npath.data: /opt/elasticsearch/elasticsearch-2.2.1/data\npath.logs: /opt/elasticsearch/elasticsearch-2.2.1/logs\n#绑定IP和端口\nnetwork.host: 0.0.0.0\nhttp.port: 9200\n```\n\n## 5. 安装head\n\nhead是elasticsearch的可视化工具，可以不用安装head，如果不需要安装，跳过此步骤。\n\n需要注意的是，es2.x的版本head可直接安装，es5.x以上的版本需要先安装nodejs。\n\n### 5.1. ES2.x.x版本安装head\n\n在`/opt/elasticsearch/elasticsearch-2.2.1/`目录下新建文件夹：plugins\n\n```shell\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/\n$ mkdir plugins\n$ cd elasticsearch/bin\n$ ./plugin install mobz/elasticsearch-head\n```\n\n安装成功即可。启动es之后，访问`http://ip:9200/_plugin/head/`即可看到可视化界面。\n\n### 5.2 ES5.x.x版本安装head\n\nES5.x版本暂时不支持直接安装，但是head作者提供了另一种安装方法。\n\n```shell\n$ git clone git://github.com/mobz/elasticsearch-head.git\n$ cd elasticsearch-head\n$ npm install\n$ npm run start\n```\n\n然后打开`http://localhost:9100/`访问即可。\n\n如果提示未安装node.js，先安装node.js，\n\nnode.js官网：[http://nodejs.cn/download/](http://nodejs.cn/download/)\n\n选择安装包，我这边是64位linux，下载的是[https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz](https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz)\n\n解压（注：如果是虚拟机，不要在共享文件夹中解压，会报`Cannot create symlink to`创建软链的错，请放至linux下解压）：\n\n```shell\n$ xz -d node-v8.11.3-linux-x64.tar.xz\n$ tar -xvf node-v8.11.3-linux-x64.tar\n$ mv node-v8.11.3-linux-x64 nodejs\n#确认一下nodejs下bin目录是否有node 和npm文件，如果有执行软连接，如果没有重新下载执行上边步骤；建立软连接，变为全局:\n$ ln -s /opt/nodejs/bin/npm /usr/local/bin/\n$ ln -s /opt/nodejs/bin/node /usr/local/bin/\n#检查是否安装成功\n$ node -v\n```\n\n\n\n## 6. 启动ES\n\n```shell\n$ cd /opt/elasticsearch/elasticsearch-2.2.1\n$ su elasticsearch\n$ ./bin/elasticsearch\n```\n\n再访问`http://ip:9200/_plugin/head/`即可。\n\n## 7. 安装IK分词器\n\n在[https://github.com/medcl/elasticsearch-analysis-ik](https://github.com/medcl/elasticsearch-analysis-ik)\n\n此处选择与es版本对应的ik分词版本，我这里下载的是[elasticsearch-analysis-ik-1.8.1.zip](https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v1.8.1/elasticsearch-analysis-ik-1.8.1.zip)，在 `/opt/elasticsearch/elasticsearch-2.2.1/plugins`目录下新建文件夹：`ik`;将`elasticsearch-analysis-ik-1.8.1.zip`的解压文件放入`ik`目录下，并将解压后的`config`下的`ik`文件夹放入 `/opt/elasticsearch/elasticsearch-2.2.1/config`下面;\n\n```shell\n$ unzip elasticsearch-analysis-ik-1.8.1.zip\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/plugins\n$ mkdir ik\n$ cp -rf /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/ ik/\n$ mv /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/config/ik /opt/elasticsearch/elasticsearch-2.2.1/config\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/config\n```\n\n在`/config/elasticsearch.yml`文件的最后加上一句话：\n\n```properties\nindex.analysis.analyzer.ik.type : \"ik\"\n```\n\n\n\n然后启动es，测试分词效果：\n\n```shell\ncurl '10.10.13.234:9200/index/_analyze?analyzer=ik&pretty=true' -d '\n{\n\"text\":\"世界如此之大 进口水果\"\n}'\n```\n\n\n\n或者浏览器访问`http://ip:9200/_analyze?analyzer=ik&pretty=true&text=sojson在线工具测试分词`，即可看到中文分词效果。\n\n至此，elasticsearch搭建完成，下一篇我们来说下**索引的创建**。\n\n","source":"_posts/Elasticsearch实践搭建及IK中文分词.md","raw":"---\ntitle: Elasticsearch实践(1)-搭建及IK中文分词\ndate: 2018-5-15\ncategories: \n  - elasticsearch\ntags: \n  - elasticsearch\n  - ik中文分词\nthumbnail: https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png\n---\n\n\n\n🔍近期在做商品搜索优化，对比了Solr与Elasticsearch的区别，两者都是基于Lucene实现的封装，但es在数据量越大的情况下实时检索性能优于solr，更适用于实时商品搜索，于是选用了es，下面介绍elasticsearch搜索引擎的搭建及使用，这里使用的是2.2.1的es版本，以及1.8.1的ik分词版本。\n\n<!--more-->\n\n# 安装es及IK中文分词\n\n##  1. 下载安装包\n\n```properties\n##我的环境是Redhat6.4，此处使用的是es2.2.1版本\n##（1）可以使用指令安装\n$ yum install https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.1/elasticsearch-2.2.1.rpm\n##（2）也可以直接下载文件，然后上传至linux目录下\nhttps://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.2.1/elasticsearch-2.2.1.tar.gz\n```\n\n## 2. 上传安装文件到linux目录并解压\n\n我这里将`elasticsearch-2.2.1.tar.gz`文件放至`/opt/elasticsearch`目录下。\n\n解压：\n\n```shell\n$ cd /opt/elasticsearch\n$ tar -zxvf elasticsearch-2.2.1.tar.gz\n```\n\n**此时切记不能用 `./bin/elasticsearch`启动，因为在root权限下会提示错误**：\n\n```shell\nException in thread \"main\" java.lang.RuntimeException: don't run elasticsearch as root.\n```\n\n## 3. 新添加一个elasticsearch用户\n\n\n\n```sh\n#添加elasticsearch用户：\n$ useradd elasticsearch\n#给用户elasticsearch设置密码，连续输入2次：\n$ passwd elasticsearch\n#创建一个用户组es:\n$ groupadd es\n#分配elasticsearch到es组:\n$ usermod -G es elasticsearch\n#在elasticsearch 根目录下，给定用户权限。-R表示逐级（N层目录） ， * 表示 任何文件:\n$ chown -R elasticsearch:es *\n#切换到elasticsearch用户:\n$ su elasticsearch\n```\n\n## 4. 修改配置文件\n\n```shell\n$ vi config/elasticsearch.yml\n```\n\n修改以下内容：\n\n```properties\n#cluster name\ncluster.name: my-application\n#节点名称\nnode.name: node-1\npath.data: /opt/elasticsearch/elasticsearch-2.2.1/data\npath.logs: /opt/elasticsearch/elasticsearch-2.2.1/logs\n#绑定IP和端口\nnetwork.host: 0.0.0.0\nhttp.port: 9200\n```\n\n## 5. 安装head\n\nhead是elasticsearch的可视化工具，可以不用安装head，如果不需要安装，跳过此步骤。\n\n需要注意的是，es2.x的版本head可直接安装，es5.x以上的版本需要先安装nodejs。\n\n### 5.1. ES2.x.x版本安装head\n\n在`/opt/elasticsearch/elasticsearch-2.2.1/`目录下新建文件夹：plugins\n\n```shell\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/\n$ mkdir plugins\n$ cd elasticsearch/bin\n$ ./plugin install mobz/elasticsearch-head\n```\n\n安装成功即可。启动es之后，访问`http://ip:9200/_plugin/head/`即可看到可视化界面。\n\n### 5.2 ES5.x.x版本安装head\n\nES5.x版本暂时不支持直接安装，但是head作者提供了另一种安装方法。\n\n```shell\n$ git clone git://github.com/mobz/elasticsearch-head.git\n$ cd elasticsearch-head\n$ npm install\n$ npm run start\n```\n\n然后打开`http://localhost:9100/`访问即可。\n\n如果提示未安装node.js，先安装node.js，\n\nnode.js官网：[http://nodejs.cn/download/](http://nodejs.cn/download/)\n\n选择安装包，我这边是64位linux，下载的是[https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz](https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz)\n\n解压（注：如果是虚拟机，不要在共享文件夹中解压，会报`Cannot create symlink to`创建软链的错，请放至linux下解压）：\n\n```shell\n$ xz -d node-v8.11.3-linux-x64.tar.xz\n$ tar -xvf node-v8.11.3-linux-x64.tar\n$ mv node-v8.11.3-linux-x64 nodejs\n#确认一下nodejs下bin目录是否有node 和npm文件，如果有执行软连接，如果没有重新下载执行上边步骤；建立软连接，变为全局:\n$ ln -s /opt/nodejs/bin/npm /usr/local/bin/\n$ ln -s /opt/nodejs/bin/node /usr/local/bin/\n#检查是否安装成功\n$ node -v\n```\n\n\n\n## 6. 启动ES\n\n```shell\n$ cd /opt/elasticsearch/elasticsearch-2.2.1\n$ su elasticsearch\n$ ./bin/elasticsearch\n```\n\n再访问`http://ip:9200/_plugin/head/`即可。\n\n## 7. 安装IK分词器\n\n在[https://github.com/medcl/elasticsearch-analysis-ik](https://github.com/medcl/elasticsearch-analysis-ik)\n\n此处选择与es版本对应的ik分词版本，我这里下载的是[elasticsearch-analysis-ik-1.8.1.zip](https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v1.8.1/elasticsearch-analysis-ik-1.8.1.zip)，在 `/opt/elasticsearch/elasticsearch-2.2.1/plugins`目录下新建文件夹：`ik`;将`elasticsearch-analysis-ik-1.8.1.zip`的解压文件放入`ik`目录下，并将解压后的`config`下的`ik`文件夹放入 `/opt/elasticsearch/elasticsearch-2.2.1/config`下面;\n\n```shell\n$ unzip elasticsearch-analysis-ik-1.8.1.zip\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/plugins\n$ mkdir ik\n$ cp -rf /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/ ik/\n$ mv /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/config/ik /opt/elasticsearch/elasticsearch-2.2.1/config\n$ cd /opt/elasticsearch/elasticsearch-2.2.1/config\n```\n\n在`/config/elasticsearch.yml`文件的最后加上一句话：\n\n```properties\nindex.analysis.analyzer.ik.type : \"ik\"\n```\n\n\n\n然后启动es，测试分词效果：\n\n```shell\ncurl '10.10.13.234:9200/index/_analyze?analyzer=ik&pretty=true' -d '\n{\n\"text\":\"世界如此之大 进口水果\"\n}'\n```\n\n\n\n或者浏览器访问`http://ip:9200/_analyze?analyzer=ik&pretty=true&text=sojson在线工具测试分词`，即可看到中文分词效果。\n\n至此，elasticsearch搭建完成，下一篇我们来说下**索引的创建**。\n\n","slug":"Elasticsearch实践搭建及IK中文分词","published":1,"updated":"2018-10-10T12:48:25.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkan0002dohgrdufgl6z","content":"<p>🔍近期在做商品搜索优化，对比了Solr与Elasticsearch的区别，两者都是基于Lucene实现的封装，但es在数据量越大的情况下实时检索性能优于solr，更适用于实时商品搜索，于是选用了es，下面介绍elasticsearch搜索引擎的搭建及使用，这里使用的是2.2.1的es版本，以及1.8.1的ik分词版本。</p>\n<a id=\"more\"></a>\n<h1 id=\"安装es及IK中文分词\"><a href=\"#安装es及IK中文分词\" class=\"headerlink\" title=\"安装es及IK中文分词\"></a>安装es及IK中文分词</h1><h2 id=\"1-下载安装包\"><a href=\"#1-下载安装包\" class=\"headerlink\" title=\"1. 下载安装包\"></a>1. 下载安装包</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">##我的环境是Redhat6.4，此处使用的是es2.2.1版本</div><div class=\"line\">##（1）可以使用指令安装</div><div class=\"line\">$ yum install https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.1/elasticsearch-2.2.1.rpm</div><div class=\"line\">##（2）也可以直接下载文件，然后上传至linux目录下</div><div class=\"line\">https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.2.1/elasticsearch-2.2.1.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"2-上传安装文件到linux目录并解压\"><a href=\"#2-上传安装文件到linux目录并解压\" class=\"headerlink\" title=\"2. 上传安装文件到linux目录并解压\"></a>2. 上传安装文件到linux目录并解压</h2><p>我这里将<code>elasticsearch-2.2.1.tar.gz</code>文件放至<code>/opt/elasticsearch</code>目录下。</p>\n<p>解压：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span> cd /opt/elasticsearch</div><div class=\"line\"><span class=\"meta\">$</span> tar -zxvf elasticsearch-2.2.1.tar.gz</div></pre></td></tr></table></figure>\n<p><strong>此时切记不能用 <code>./bin/elasticsearch</code>启动，因为在root权限下会提示错误</strong>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Exception in thread \"main\" java.lang.RuntimeException: don't run elasticsearch as root.</div></pre></td></tr></table></figure>\n<h2 id=\"3-新添加一个elasticsearch用户\"><a href=\"#3-新添加一个elasticsearch用户\" class=\"headerlink\" title=\"3. 新添加一个elasticsearch用户\"></a>3. 新添加一个elasticsearch用户</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#添加elasticsearch用户：</span></div><div class=\"line\">$ useradd elasticsearch</div><div class=\"line\"><span class=\"comment\">#给用户elasticsearch设置密码，连续输入2次：</span></div><div class=\"line\">$ passwd elasticsearch</div><div class=\"line\"><span class=\"comment\">#创建一个用户组es:</span></div><div class=\"line\">$ groupadd es</div><div class=\"line\"><span class=\"comment\">#分配elasticsearch到es组:</span></div><div class=\"line\">$ usermod -G es elasticsearch</div><div class=\"line\"><span class=\"comment\">#在elasticsearch 根目录下，给定用户权限。-R表示逐级（N层目录） ， * 表示 任何文件:</span></div><div class=\"line\">$ chown -R elasticsearch:es *</div><div class=\"line\"><span class=\"comment\">#切换到elasticsearch用户:</span></div><div class=\"line\">$ su elasticsearch</div></pre></td></tr></table></figure>\n<h2 id=\"4-修改配置文件\"><a href=\"#4-修改配置文件\" class=\"headerlink\" title=\"4. 修改配置文件\"></a>4. 修改配置文件</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> vi config/elasticsearch.yml</span></div></pre></td></tr></table></figure>\n<p>修改以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cluster name</div><div class=\"line\">cluster.name: my-application</div><div class=\"line\">#节点名称</div><div class=\"line\">node.name: node-1</div><div class=\"line\">path.data: /opt/elasticsearch/elasticsearch-2.2.1/data</div><div class=\"line\">path.logs: /opt/elasticsearch/elasticsearch-2.2.1/logs</div><div class=\"line\">#绑定IP和端口</div><div class=\"line\">network.host: 0.0.0.0</div><div class=\"line\">http.port: 9200</div></pre></td></tr></table></figure>\n<h2 id=\"5-安装head\"><a href=\"#5-安装head\" class=\"headerlink\" title=\"5. 安装head\"></a>5. 安装head</h2><p>head是elasticsearch的可视化工具，可以不用安装head，如果不需要安装，跳过此步骤。</p>\n<p>需要注意的是，es2.x的版本head可直接安装，es5.x以上的版本需要先安装nodejs。</p>\n<h3 id=\"5-1-ES2-x-x版本安装head\"><a href=\"#5-1-ES2-x-x版本安装head\" class=\"headerlink\" title=\"5.1. ES2.x.x版本安装head\"></a>5.1. ES2.x.x版本安装head</h3><p>在<code>/opt/elasticsearch/elasticsearch-2.2.1/</code>目录下新建文件夹：plugins</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mkdir plugins</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> elasticsearch/bin</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ./plugin install mobz/elasticsearch-head</span></div></pre></td></tr></table></figure>\n<p>安装成功即可。启动es之后，访问<code>http://ip:9200/_plugin/head/</code>即可看到可视化界面。</p>\n<h3 id=\"5-2-ES5-x-x版本安装head\"><a href=\"#5-2-ES5-x-x版本安装head\" class=\"headerlink\" title=\"5.2 ES5.x.x版本安装head\"></a>5.2 ES5.x.x版本安装head</h3><p>ES5.x版本暂时不支持直接安装，但是head作者提供了另一种安装方法。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> git <span class=\"built_in\">clone</span> git://github.com/mobz/elasticsearch-head.git</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> elasticsearch-head</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> npm install</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> npm run start</span></div></pre></td></tr></table></figure>\n<p>然后打开<code>http://localhost:9100/</code>访问即可。</p>\n<p>如果提示未安装node.js，先安装node.js，</p>\n<p>node.js官网：<a href=\"http://nodejs.cn/download/\" target=\"_blank\" rel=\"external\">http://nodejs.cn/download/</a></p>\n<p>选择安装包，我这边是64位linux，下载的是<a href=\"https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz\" target=\"_blank\" rel=\"external\">https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz</a></p>\n<p>解压（注：如果是虚拟机，不要在共享文件夹中解压，会报<code>Cannot create symlink to</code>创建软链的错，请放至linux下解压）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> xz <span class=\"_\">-d</span> node-v8.11.3-linux-x64.tar.xz</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> tar -xvf node-v8.11.3-linux-x64.tar</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mv node-v8.11.3-linux-x64 nodejs</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">确认一下nodejs下bin目录是否有node 和npm文件，如果有执行软连接，如果没有重新下载执行上边步骤；建立软连接，变为全局:</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ln <span class=\"_\">-s</span> /opt/nodejs/bin/npm /usr/<span class=\"built_in\">local</span>/bin/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ln <span class=\"_\">-s</span> /opt/nodejs/bin/node /usr/<span class=\"built_in\">local</span>/bin/</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">检查是否安装成功</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> node -v</span></div></pre></td></tr></table></figure>\n<h2 id=\"6-启动ES\"><a href=\"#6-启动ES\" class=\"headerlink\" title=\"6. 启动ES\"></a>6. 启动ES</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> su elasticsearch</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ./bin/elasticsearch</span></div></pre></td></tr></table></figure>\n<p>再访问<code>http://ip:9200/_plugin/head/</code>即可。</p>\n<h2 id=\"7-安装IK分词器\"><a href=\"#7-安装IK分词器\" class=\"headerlink\" title=\"7. 安装IK分词器\"></a>7. 安装IK分词器</h2><p>在<a href=\"https://github.com/medcl/elasticsearch-analysis-ik\" target=\"_blank\" rel=\"external\">https://github.com/medcl/elasticsearch-analysis-ik</a></p>\n<p>此处选择与es版本对应的ik分词版本，我这里下载的是<a href=\"https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v1.8.1/elasticsearch-analysis-ik-1.8.1.zip\" target=\"_blank\" rel=\"external\">elasticsearch-analysis-ik-1.8.1.zip</a>，在 <code>/opt/elasticsearch/elasticsearch-2.2.1/plugins</code>目录下新建文件夹：<code>ik</code>;将<code>elasticsearch-analysis-ik-1.8.1.zip</code>的解压文件放入<code>ik</code>目录下，并将解压后的<code>config</code>下的<code>ik</code>文件夹放入 <code>/opt/elasticsearch/elasticsearch-2.2.1/config</code>下面;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> unzip elasticsearch-analysis-ik-1.8.1.zip</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/plugins</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mkdir ik</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> cp -rf /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/ ik/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mv /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/config/ik /opt/elasticsearch/elasticsearch-2.2.1/config</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/config</span></div></pre></td></tr></table></figure>\n<p>在<code>/config/elasticsearch.yml</code>文件的最后加上一句话：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">index.analysis.analyzer.ik.type : &quot;ik&quot;</div></pre></td></tr></table></figure>\n<p>然后启动es，测试分词效果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl '10.10.13.234:9200/index/_analyze?analyzer=ik&amp;pretty=true' -d '</div><div class=\"line\">&#123;</div><div class=\"line\">\"text\":\"世界如此之大 进口水果\"</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>或者浏览器访问<code>http://ip:9200/_analyze?analyzer=ik&amp;pretty=true&amp;text=sojson在线工具测试分词</code>，即可看到中文分词效果。</p>\n<p>至此，elasticsearch搭建完成，下一篇我们来说下<strong>索引的创建</strong>。</p>\n","site":{"data":{}},"excerpt":"<p>🔍近期在做商品搜索优化，对比了Solr与Elasticsearch的区别，两者都是基于Lucene实现的封装，但es在数据量越大的情况下实时检索性能优于solr，更适用于实时商品搜索，于是选用了es，下面介绍elasticsearch搜索引擎的搭建及使用，这里使用的是2.2.1的es版本，以及1.8.1的ik分词版本。</p>","more":"<h1 id=\"安装es及IK中文分词\"><a href=\"#安装es及IK中文分词\" class=\"headerlink\" title=\"安装es及IK中文分词\"></a>安装es及IK中文分词</h1><h2 id=\"1-下载安装包\"><a href=\"#1-下载安装包\" class=\"headerlink\" title=\"1. 下载安装包\"></a>1. 下载安装包</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">##我的环境是Redhat6.4，此处使用的是es2.2.1版本</div><div class=\"line\">##（1）可以使用指令安装</div><div class=\"line\">$ yum install https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.1/elasticsearch-2.2.1.rpm</div><div class=\"line\">##（2）也可以直接下载文件，然后上传至linux目录下</div><div class=\"line\">https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.2.1/elasticsearch-2.2.1.tar.gz</div></pre></td></tr></table></figure>\n<h2 id=\"2-上传安装文件到linux目录并解压\"><a href=\"#2-上传安装文件到linux目录并解压\" class=\"headerlink\" title=\"2. 上传安装文件到linux目录并解压\"></a>2. 上传安装文件到linux目录并解压</h2><p>我这里将<code>elasticsearch-2.2.1.tar.gz</code>文件放至<code>/opt/elasticsearch</code>目录下。</p>\n<p>解压：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span> cd /opt/elasticsearch</div><div class=\"line\"><span class=\"meta\">$</span> tar -zxvf elasticsearch-2.2.1.tar.gz</div></pre></td></tr></table></figure>\n<p><strong>此时切记不能用 <code>./bin/elasticsearch</code>启动，因为在root权限下会提示错误</strong>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Exception in thread \"main\" java.lang.RuntimeException: don't run elasticsearch as root.</div></pre></td></tr></table></figure>\n<h2 id=\"3-新添加一个elasticsearch用户\"><a href=\"#3-新添加一个elasticsearch用户\" class=\"headerlink\" title=\"3. 新添加一个elasticsearch用户\"></a>3. 新添加一个elasticsearch用户</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#添加elasticsearch用户：</span></div><div class=\"line\">$ useradd elasticsearch</div><div class=\"line\"><span class=\"comment\">#给用户elasticsearch设置密码，连续输入2次：</span></div><div class=\"line\">$ passwd elasticsearch</div><div class=\"line\"><span class=\"comment\">#创建一个用户组es:</span></div><div class=\"line\">$ groupadd es</div><div class=\"line\"><span class=\"comment\">#分配elasticsearch到es组:</span></div><div class=\"line\">$ usermod -G es elasticsearch</div><div class=\"line\"><span class=\"comment\">#在elasticsearch 根目录下，给定用户权限。-R表示逐级（N层目录） ， * 表示 任何文件:</span></div><div class=\"line\">$ chown -R elasticsearch:es *</div><div class=\"line\"><span class=\"comment\">#切换到elasticsearch用户:</span></div><div class=\"line\">$ su elasticsearch</div></pre></td></tr></table></figure>\n<h2 id=\"4-修改配置文件\"><a href=\"#4-修改配置文件\" class=\"headerlink\" title=\"4. 修改配置文件\"></a>4. 修改配置文件</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> vi config/elasticsearch.yml</span></div></pre></td></tr></table></figure>\n<p>修改以下内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">#cluster name</div><div class=\"line\">cluster.name: my-application</div><div class=\"line\">#节点名称</div><div class=\"line\">node.name: node-1</div><div class=\"line\">path.data: /opt/elasticsearch/elasticsearch-2.2.1/data</div><div class=\"line\">path.logs: /opt/elasticsearch/elasticsearch-2.2.1/logs</div><div class=\"line\">#绑定IP和端口</div><div class=\"line\">network.host: 0.0.0.0</div><div class=\"line\">http.port: 9200</div></pre></td></tr></table></figure>\n<h2 id=\"5-安装head\"><a href=\"#5-安装head\" class=\"headerlink\" title=\"5. 安装head\"></a>5. 安装head</h2><p>head是elasticsearch的可视化工具，可以不用安装head，如果不需要安装，跳过此步骤。</p>\n<p>需要注意的是，es2.x的版本head可直接安装，es5.x以上的版本需要先安装nodejs。</p>\n<h3 id=\"5-1-ES2-x-x版本安装head\"><a href=\"#5-1-ES2-x-x版本安装head\" class=\"headerlink\" title=\"5.1. ES2.x.x版本安装head\"></a>5.1. ES2.x.x版本安装head</h3><p>在<code>/opt/elasticsearch/elasticsearch-2.2.1/</code>目录下新建文件夹：plugins</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mkdir plugins</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> elasticsearch/bin</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ./plugin install mobz/elasticsearch-head</span></div></pre></td></tr></table></figure>\n<p>安装成功即可。启动es之后，访问<code>http://ip:9200/_plugin/head/</code>即可看到可视化界面。</p>\n<h3 id=\"5-2-ES5-x-x版本安装head\"><a href=\"#5-2-ES5-x-x版本安装head\" class=\"headerlink\" title=\"5.2 ES5.x.x版本安装head\"></a>5.2 ES5.x.x版本安装head</h3><p>ES5.x版本暂时不支持直接安装，但是head作者提供了另一种安装方法。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> git <span class=\"built_in\">clone</span> git://github.com/mobz/elasticsearch-head.git</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> elasticsearch-head</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> npm install</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> npm run start</span></div></pre></td></tr></table></figure>\n<p>然后打开<code>http://localhost:9100/</code>访问即可。</p>\n<p>如果提示未安装node.js，先安装node.js，</p>\n<p>node.js官网：<a href=\"http://nodejs.cn/download/\" target=\"_blank\" rel=\"external\">http://nodejs.cn/download/</a></p>\n<p>选择安装包，我这边是64位linux，下载的是<a href=\"https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz\" target=\"_blank\" rel=\"external\">https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz</a></p>\n<p>解压（注：如果是虚拟机，不要在共享文件夹中解压，会报<code>Cannot create symlink to</code>创建软链的错，请放至linux下解压）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> xz <span class=\"_\">-d</span> node-v8.11.3-linux-x64.tar.xz</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> tar -xvf node-v8.11.3-linux-x64.tar</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mv node-v8.11.3-linux-x64 nodejs</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">确认一下nodejs下bin目录是否有node 和npm文件，如果有执行软连接，如果没有重新下载执行上边步骤；建立软连接，变为全局:</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ln <span class=\"_\">-s</span> /opt/nodejs/bin/npm /usr/<span class=\"built_in\">local</span>/bin/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ln <span class=\"_\">-s</span> /opt/nodejs/bin/node /usr/<span class=\"built_in\">local</span>/bin/</span></div><div class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">检查是否安装成功</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> node -v</span></div></pre></td></tr></table></figure>\n<h2 id=\"6-启动ES\"><a href=\"#6-启动ES\" class=\"headerlink\" title=\"6. 启动ES\"></a>6. 启动ES</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> su elasticsearch</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ./bin/elasticsearch</span></div></pre></td></tr></table></figure>\n<p>再访问<code>http://ip:9200/_plugin/head/</code>即可。</p>\n<h2 id=\"7-安装IK分词器\"><a href=\"#7-安装IK分词器\" class=\"headerlink\" title=\"7. 安装IK分词器\"></a>7. 安装IK分词器</h2><p>在<a href=\"https://github.com/medcl/elasticsearch-analysis-ik\" target=\"_blank\" rel=\"external\">https://github.com/medcl/elasticsearch-analysis-ik</a></p>\n<p>此处选择与es版本对应的ik分词版本，我这里下载的是<a href=\"https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v1.8.1/elasticsearch-analysis-ik-1.8.1.zip\" target=\"_blank\" rel=\"external\">elasticsearch-analysis-ik-1.8.1.zip</a>，在 <code>/opt/elasticsearch/elasticsearch-2.2.1/plugins</code>目录下新建文件夹：<code>ik</code>;将<code>elasticsearch-analysis-ik-1.8.1.zip</code>的解压文件放入<code>ik</code>目录下，并将解压后的<code>config</code>下的<code>ik</code>文件夹放入 <code>/opt/elasticsearch/elasticsearch-2.2.1/config</code>下面;</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> unzip elasticsearch-analysis-ik-1.8.1.zip</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/plugins</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mkdir ik</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> cp -rf /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/ ik/</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> mv /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/config/ik /opt/elasticsearch/elasticsearch-2.2.1/config</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> <span class=\"built_in\">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/config</span></div></pre></td></tr></table></figure>\n<p>在<code>/config/elasticsearch.yml</code>文件的最后加上一句话：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">index.analysis.analyzer.ik.type : &quot;ik&quot;</div></pre></td></tr></table></figure>\n<p>然后启动es，测试分词效果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">curl '10.10.13.234:9200/index/_analyze?analyzer=ik&amp;pretty=true' -d '</div><div class=\"line\">&#123;</div><div class=\"line\">\"text\":\"世界如此之大 进口水果\"</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>或者浏览器访问<code>http://ip:9200/_analyze?analyzer=ik&amp;pretty=true&amp;text=sojson在线工具测试分词</code>，即可看到中文分词效果。</p>\n<p>至此，elasticsearch搭建完成，下一篇我们来说下<strong>索引的创建</strong>。</p>"},{"title":"C++中sprintf函数的用法","date":"2015-07-20T16:00:00.000Z","thumbnail":"http://pic1.win4000.com/wallpaper/5/56eb942607643.jpg","_content":"\n## **1.常用方式**\n\n　　 ``sprintf``函数的功能与``printf``函数的功能基本一样，只是它把结果输出到指定的字符串中了，看个例子就明白了：\n\n<!--more-->\n\n例：将``\"test,1,2\"``写入数组s中\n\n``` c++\n#include<stdio.h>\nint main(int argc, char *avgv[])\n{\n    char s[40];\n    sprintf(s,\"%s%d%c\",\"test\",1,'2');\n    /*第一个参数就是指向要写入的那个字符串的指针，剩下的就和printf()一样了\n    你可以比较一下，这是向屏幕输入*/\n    printf(\"%s%d%c\",\"test\",1,'2');\n    return 0;\n}\n```\n编译：\n>g++ sprinftest.cpp -o sprinftest && ./sprinftest\n\n输出结果：\n>sprintftest12\n>sprintftest12\n\n## **2.若\"%s\"等输出符在字符串中**\n\n例：补全字符串str的缺省内容\n``` c++\n#include <iostream>\n#include <stdio.h>\n#include <cstring>\n\nint main(int argc, char *avgv[])\n{\n    char str[] = \"hel%co wo%sd! sp%stf test%d\";\n    char buf[strlen(str)];\n    sprintf(buf, str, 'l', \"rl\", \"rin\", 1);\n    std::cout << \"str = \"<< buf << \"\\nlen = \" <<  strlen(buf) << std::endl;\n    return 0;\n}\n```\n编译：\n>g++ sprinftest.cpp -o sprinftest && ./sprinftest\n\n输出结果：\n>str = hello world! sprintf test1\n>len = 27\n\n这种形式也可以将多个字符值或字符串值赋值到字符串str中，有多少个输出符就后面就加多少个参数。\n\n","source":"_posts/C++中sprintf函数的用法.md","raw":"---\ntitle: C++中sprintf函数的用法\ndate: 2015-07-21\ncategories: \n  - C++\ntags: \n  - sprintf\nthumbnail: http://pic1.win4000.com/wallpaper/5/56eb942607643.jpg\n---\n\n## **1.常用方式**\n\n　　 ``sprintf``函数的功能与``printf``函数的功能基本一样，只是它把结果输出到指定的字符串中了，看个例子就明白了：\n\n<!--more-->\n\n例：将``\"test,1,2\"``写入数组s中\n\n``` c++\n#include<stdio.h>\nint main(int argc, char *avgv[])\n{\n    char s[40];\n    sprintf(s,\"%s%d%c\",\"test\",1,'2');\n    /*第一个参数就是指向要写入的那个字符串的指针，剩下的就和printf()一样了\n    你可以比较一下，这是向屏幕输入*/\n    printf(\"%s%d%c\",\"test\",1,'2');\n    return 0;\n}\n```\n编译：\n>g++ sprinftest.cpp -o sprinftest && ./sprinftest\n\n输出结果：\n>sprintftest12\n>sprintftest12\n\n## **2.若\"%s\"等输出符在字符串中**\n\n例：补全字符串str的缺省内容\n``` c++\n#include <iostream>\n#include <stdio.h>\n#include <cstring>\n\nint main(int argc, char *avgv[])\n{\n    char str[] = \"hel%co wo%sd! sp%stf test%d\";\n    char buf[strlen(str)];\n    sprintf(buf, str, 'l', \"rl\", \"rin\", 1);\n    std::cout << \"str = \"<< buf << \"\\nlen = \" <<  strlen(buf) << std::endl;\n    return 0;\n}\n```\n编译：\n>g++ sprinftest.cpp -o sprinftest && ./sprinftest\n\n输出结果：\n>str = hello world! sprintf test1\n>len = 27\n\n这种形式也可以将多个字符值或字符串值赋值到字符串str中，有多少个输出符就后面就加多少个参数。\n\n","slug":"C++中sprintf函数的用法","published":1,"updated":"2017-07-19T13:51:59.644Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkd10006dohgip8k49j2","content":"<h2 id=\"1-常用方式\"><a href=\"#1-常用方式\" class=\"headerlink\" title=\"1.常用方式\"></a><strong>1.常用方式</strong></h2><p>　　 <code>sprintf</code>函数的功能与<code>printf</code>函数的功能基本一样，只是它把结果输出到指定的字符串中了，看个例子就明白了：</p>\n<a id=\"more\"></a>\n<p>例：将<code>&quot;test,1,2&quot;</code>写入数组s中</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *avgv[])</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">char</span> s[<span class=\"number\">40</span>];</div><div class=\"line\">    <span class=\"built_in\">sprintf</span>(s,<span class=\"string\">\"%s%d%c\"</span>,<span class=\"string\">\"test\"</span>,<span class=\"number\">1</span>,<span class=\"string\">'2'</span>);</div><div class=\"line\">    <span class=\"comment\">/*第一个参数就是指向要写入的那个字符串的指针，剩下的就和printf()一样了</span></div><div class=\"line\">    你可以比较一下，这是向屏幕输入*/</div><div class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">\"%s%d%c\"</span>,<span class=\"string\">\"test\"</span>,<span class=\"number\">1</span>,<span class=\"string\">'2'</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>编译：</p>\n<blockquote>\n<p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p>\n</blockquote>\n<p>输出结果：</p>\n<blockquote>\n<p>sprintftest12<br>sprintftest12</p>\n</blockquote>\n<h2 id=\"2-若”-s”等输出符在字符串中\"><a href=\"#2-若”-s”等输出符在字符串中\" class=\"headerlink\" title=\"2.若”%s”等输出符在字符串中\"></a><strong>2.若”%s”等输出符在字符串中</strong></h2><p>例：补全字符串str的缺省内容<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstring&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *avgv[])</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">char</span> str[] = <span class=\"string\">\"hel%co wo%sd! sp%stf test%d\"</span>;</div><div class=\"line\">    <span class=\"keyword\">char</span> buf[<span class=\"built_in\">strlen</span>(str)];</div><div class=\"line\">    <span class=\"built_in\">sprintf</span>(buf, str, <span class=\"string\">'l'</span>, <span class=\"string\">\"rl\"</span>, <span class=\"string\">\"rin\"</span>, <span class=\"number\">1</span>);</div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"str = \"</span>&lt;&lt; buf &lt;&lt; <span class=\"string\">\"\\nlen = \"</span> &lt;&lt;  <span class=\"built_in\">strlen</span>(buf) &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>编译：</p>\n<blockquote>\n<p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p>\n</blockquote>\n<p>输出结果：</p>\n<blockquote>\n<p>str = hello world! sprintf test1<br>len = 27</p>\n</blockquote>\n<p>这种形式也可以将多个字符值或字符串值赋值到字符串str中，有多少个输出符就后面就加多少个参数。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-常用方式\"><a href=\"#1-常用方式\" class=\"headerlink\" title=\"1.常用方式\"></a><strong>1.常用方式</strong></h2><p>　　 <code>sprintf</code>函数的功能与<code>printf</code>函数的功能基本一样，只是它把结果输出到指定的字符串中了，看个例子就明白了：</p>","more":"<p>例：将<code>&quot;test,1,2&quot;</code>写入数组s中</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *avgv[])</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">char</span> s[<span class=\"number\">40</span>];</div><div class=\"line\">    <span class=\"built_in\">sprintf</span>(s,<span class=\"string\">\"%s%d%c\"</span>,<span class=\"string\">\"test\"</span>,<span class=\"number\">1</span>,<span class=\"string\">'2'</span>);</div><div class=\"line\">    <span class=\"comment\">/*第一个参数就是指向要写入的那个字符串的指针，剩下的就和printf()一样了</span></div><div class=\"line\">    你可以比较一下，这是向屏幕输入*/</div><div class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">\"%s%d%c\"</span>,<span class=\"string\">\"test\"</span>,<span class=\"number\">1</span>,<span class=\"string\">'2'</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>编译：</p>\n<blockquote>\n<p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p>\n</blockquote>\n<p>输出结果：</p>\n<blockquote>\n<p>sprintftest12<br>sprintftest12</p>\n</blockquote>\n<h2 id=\"2-若”-s”等输出符在字符串中\"><a href=\"#2-若”-s”等输出符在字符串中\" class=\"headerlink\" title=\"2.若”%s”等输出符在字符串中\"></a><strong>2.若”%s”等输出符在字符串中</strong></h2><p>例：补全字符串str的缺省内容<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstring&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *avgv[])</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"keyword\">char</span> str[] = <span class=\"string\">\"hel%co wo%sd! sp%stf test%d\"</span>;</div><div class=\"line\">    <span class=\"keyword\">char</span> buf[<span class=\"built_in\">strlen</span>(str)];</div><div class=\"line\">    <span class=\"built_in\">sprintf</span>(buf, str, <span class=\"string\">'l'</span>, <span class=\"string\">\"rl\"</span>, <span class=\"string\">\"rin\"</span>, <span class=\"number\">1</span>);</div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"str = \"</span>&lt;&lt; buf &lt;&lt; <span class=\"string\">\"\\nlen = \"</span> &lt;&lt;  <span class=\"built_in\">strlen</span>(buf) &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>编译：</p>\n<blockquote>\n<p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p>\n</blockquote>\n<p>输出结果：</p>\n<blockquote>\n<p>str = hello world! sprintf test1<br>len = 27</p>\n</blockquote>\n<p>这种形式也可以将多个字符值或字符串值赋值到字符串str中，有多少个输出符就后面就加多少个参数。</p>"},{"title":"Elasticsearch实践(2)-索引及索引别名alias","date":"2018-05-15T16:00:00.000Z","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png","_content":"\n我们都知道es效率如此高主要和索引是分不开的，需要将每一条数据建立索引，创建索引时数据字段也是你插入时的样子，索引中包含了数据的属性字段。而且创建索引也比较耗时（当然了，肯定比插入关系型数据库中更快😁），但是毕竟每一条数据都要建一次，数据量到达千万级亿级时，时间不是很乐观。🤔\n\n💡想像这样一个场景，产品上线一段时间后，由于产品需要，要将某个字段类型改变，比如需要将某个long型字段改成string类型，直接改会类型报错，查阅官方文档可知，es是不支持索引的更新操作的，需要对所有已有数据的所有field进行reindex，这意味着，需要停止服务进行重建索引操作，停服是最不想看到😭，这时如果你当初建了索引别名，你会感谢你当初使用别名的决定，为何要用别名alias？🤷\n\n<!--more-->\n\nElasticsearch的索引别名alias，类似于数据库的视图。因为索引别名alias是映射到之前已创建的索引上的，对你要创建新的索引毫无影响。在创建好新索引之后，我们只需将这别名alias映射到新创建的别名上即可，这些操作只需要在服务器上通过指令操作即可，完全不影响线上服务，实现无缝切换索引。然后再将老的索引删掉即可，以节省空间。\n\n\n\n##  1. 创建一个索引\n\n创建一个索引，名为`goods`：\n\n```shell\n$ curl -XPUT 10.10.13.234:9200/goods\n```\n\n## 2. 为索引创建mapping\n\n为索引`goods`创建`mapping`，这里制定`content`字段属性使用ik中文分词器，只要制定搜索`content`内容就会查询出分词之后的关联结果：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/_mapping -d'\n{\n    \"fulltext\": {\n             \"_all\": {\n            \"analyzer\": \"ik\"\n        },\n        \"properties\": {\n            \"content\": {\n                \"type\" : \"string\",\n                \"boost\" : 8.0,\n                \"term_vector\" : \"with_positions_offsets\",\n                \"analyzer\" : \"ik\",\n                \"include_in_all\" : true\n            }\n        }\n    }\n}'\n```\n\n这里创建的索引`goods`，如果未使用别名，程序中也是用`goods`这个索引名，如果建了新的索引，那么程序也要用新的索引名称，这是不友好的，如果用了索引别名alias就可以解决这个问题，继续看后面的操作。\n\n## 3. 插入数据\n\n插入一些测试数据：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/1 -H 'Content-Type:application/json' -d'\n{ \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/2 -H 'Content-Type:application/json' -d'\n{ \"content\": \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/4 -H 'Content-Type:application/json' -d'\n{ \"content\": \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/5 -H 'Content-Type:application/json' -d'\n{ \"content\": \"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\" }'\n\n#查看goods的mpping，后面需要与索引别名的mapping对比\n$ curl -XGET \"10.10.13.234:9200/goods/_mapping?pretty\" \n```\n\n## 4. 测试分词高亮\n\n测试命中分词高亮：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'\n{ \"query\" : { \"match\" : { \"content\" : \"进口水果\" }},\n    \"highlight\" : {\n        \"pre_tags\" : [\"<tag1>\", \"<tag2>\"],\n        \"post_tags\" : [\"</tag1>\", \"</tag2>\"],\n        \"fields\" : {\n            \"content\" : {}\n        }\n    }\n}'\n```\n\n## 5. 创建索引别名\n\n新建同义词mapping：\n\n(1) 创建一个索引，这个索引的名称最好带上版本号，比如my_index_v1,my_index_v2等;\n\n(2) 创建一个指向本索引的同义词。为的是以后不停服更新mapping。\n\n步骤(1)的索引我们以刚刚创建的`goods`所以为例，创建别名映射到`goods`所以上：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/_aliases -d '  \n{  \n    \"actions\": [  \n        { \"add\": {  \n            \"alias\": \"my_index\",  \n            \"index\": \"goods\"  \n        }}  \n    ]  \n}'\n```\n\n然后查看索引`my_index`的mapping：\n\n```shell\n$ curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\" \n```\n\n索引`my_index`与`goods`的`mapping`一致。\n\n## 6. 切换索引\n\n再创建一个索引`goods_v2`，重复步骤1、2，名称换成`goods_v2`\n\n```shell\n$ curl -XPUT 10.10.13.234:9200/goods_v2\n$ curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/_mapping -d'\n{\n    \"fulltext\": {\n             \"_all\": {\n            \"analyzer\": \"ik\"\n        },\n        \"properties\": {\n            \"content\": {\n                \"type\" : \"string\",\n                \"boost\" : 8.0,\n                \"term_vector\" : \"with_positions_offsets\",\n                \"analyzer\" : \"ik\",\n                \"include_in_all\" : true\n            }\n        }\n    }\n}'\n```\n\n插入测试数：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/1 -H 'Content-Type:application/json' -d'\n{ \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",\n\"number\": 21}'\n\n#查看goods_v2的mpping，后面需要与索引别名的mapping对比\n$ curl -XGET \"10.10.13.234:9200/goods_v2/_mapping?pretty\"\n```\n\n**重点是更换索引的操作**，将`my_index`别名切换映射到`goods_v2`上：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/_aliases -d '\n{\n    \"actions\": [\n        { \"remove\": {\n            \"alias\": \"my_index\",\n            \"index\": \"goods\"\n        }},\n        { \"add\": {\n            \"alias\": \"my_index\",\n            \"index\": \"goods_v2\"\n        }}\n    ]\n}'\n\n#查看my_index的mpping，与前面goods_v2的mapping对比\n$ curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\" \n```\n\n我们可以对比索引`my_index`与`goods_v2`的`mapping`是一致的，索引切换成功。\n\n创建了索引别名alias的话，程序中制定这个`my_index`这个别名即可，后需要创建新索引，只需切换索引映射到新索引上即可，实现不停服更新mapping。\n\n下一篇我们来说下通过**创建spring boot工程，通过es的java api操作es，实现分页查询和中文分词检索**的功能。","source":"_posts/Elasticsearch实践索引及索引别名alias.md","raw":"---\ntitle: Elasticsearch实践(2)-索引及索引别名alias\ndate: 2018-5-16\ncategories: \n  - elasticsearch\ntags: \n  - elasticsearch\n  - ik中文分词\n  - alias\nthumbnail: https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1529643264225&di=cb242c448c2a3bab04ce1acab4135689&imgtype=0&src=http%3A%2F%2Fjbcdn2.b0.upaiyun.com%2F2017%2F10%2Fc6cf4b2000277c64f55e00cf6d2f294f.png\n---\n\n我们都知道es效率如此高主要和索引是分不开的，需要将每一条数据建立索引，创建索引时数据字段也是你插入时的样子，索引中包含了数据的属性字段。而且创建索引也比较耗时（当然了，肯定比插入关系型数据库中更快😁），但是毕竟每一条数据都要建一次，数据量到达千万级亿级时，时间不是很乐观。🤔\n\n💡想像这样一个场景，产品上线一段时间后，由于产品需要，要将某个字段类型改变，比如需要将某个long型字段改成string类型，直接改会类型报错，查阅官方文档可知，es是不支持索引的更新操作的，需要对所有已有数据的所有field进行reindex，这意味着，需要停止服务进行重建索引操作，停服是最不想看到😭，这时如果你当初建了索引别名，你会感谢你当初使用别名的决定，为何要用别名alias？🤷\n\n<!--more-->\n\nElasticsearch的索引别名alias，类似于数据库的视图。因为索引别名alias是映射到之前已创建的索引上的，对你要创建新的索引毫无影响。在创建好新索引之后，我们只需将这别名alias映射到新创建的别名上即可，这些操作只需要在服务器上通过指令操作即可，完全不影响线上服务，实现无缝切换索引。然后再将老的索引删掉即可，以节省空间。\n\n\n\n##  1. 创建一个索引\n\n创建一个索引，名为`goods`：\n\n```shell\n$ curl -XPUT 10.10.13.234:9200/goods\n```\n\n## 2. 为索引创建mapping\n\n为索引`goods`创建`mapping`，这里制定`content`字段属性使用ik中文分词器，只要制定搜索`content`内容就会查询出分词之后的关联结果：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/_mapping -d'\n{\n    \"fulltext\": {\n             \"_all\": {\n            \"analyzer\": \"ik\"\n        },\n        \"properties\": {\n            \"content\": {\n                \"type\" : \"string\",\n                \"boost\" : 8.0,\n                \"term_vector\" : \"with_positions_offsets\",\n                \"analyzer\" : \"ik\",\n                \"include_in_all\" : true\n            }\n        }\n    }\n}'\n```\n\n这里创建的索引`goods`，如果未使用别名，程序中也是用`goods`这个索引名，如果建了新的索引，那么程序也要用新的索引名称，这是不友好的，如果用了索引别名alias就可以解决这个问题，继续看后面的操作。\n\n## 3. 插入数据\n\n插入一些测试数据：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/1 -H 'Content-Type:application/json' -d'\n{ \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/2 -H 'Content-Type:application/json' -d'\n{ \"content\": \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/4 -H 'Content-Type:application/json' -d'\n{ \"content\": \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\" }'\n\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/5 -H 'Content-Type:application/json' -d'\n{ \"content\": \"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\" }'\n\n#查看goods的mpping，后面需要与索引别名的mapping对比\n$ curl -XGET \"10.10.13.234:9200/goods/_mapping?pretty\" \n```\n\n## 4. 测试分词高亮\n\n测试命中分词高亮：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H 'Content-Type:application/json' -d'\n{ \"query\" : { \"match\" : { \"content\" : \"进口水果\" }},\n    \"highlight\" : {\n        \"pre_tags\" : [\"<tag1>\", \"<tag2>\"],\n        \"post_tags\" : [\"</tag1>\", \"</tag2>\"],\n        \"fields\" : {\n            \"content\" : {}\n        }\n    }\n}'\n```\n\n## 5. 创建索引别名\n\n新建同义词mapping：\n\n(1) 创建一个索引，这个索引的名称最好带上版本号，比如my_index_v1,my_index_v2等;\n\n(2) 创建一个指向本索引的同义词。为的是以后不停服更新mapping。\n\n步骤(1)的索引我们以刚刚创建的`goods`所以为例，创建别名映射到`goods`所以上：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/_aliases -d '  \n{  \n    \"actions\": [  \n        { \"add\": {  \n            \"alias\": \"my_index\",  \n            \"index\": \"goods\"  \n        }}  \n    ]  \n}'\n```\n\n然后查看索引`my_index`的mapping：\n\n```shell\n$ curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\" \n```\n\n索引`my_index`与`goods`的`mapping`一致。\n\n## 6. 切换索引\n\n再创建一个索引`goods_v2`，重复步骤1、2，名称换成`goods_v2`\n\n```shell\n$ curl -XPUT 10.10.13.234:9200/goods_v2\n$ curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/_mapping -d'\n{\n    \"fulltext\": {\n             \"_all\": {\n            \"analyzer\": \"ik\"\n        },\n        \"properties\": {\n            \"content\": {\n                \"type\" : \"string\",\n                \"boost\" : 8.0,\n                \"term_vector\" : \"with_positions_offsets\",\n                \"analyzer\" : \"ik\",\n                \"include_in_all\" : true\n            }\n        }\n    }\n}'\n```\n\n插入测试数：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/1 -H 'Content-Type:application/json' -d'\n{ \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",\n\"number\": 21}'\n\n#查看goods_v2的mpping，后面需要与索引别名的mapping对比\n$ curl -XGET \"10.10.13.234:9200/goods_v2/_mapping?pretty\"\n```\n\n**重点是更换索引的操作**，将`my_index`别名切换映射到`goods_v2`上：\n\n```shell\n$ curl -XPOST 10.10.13.234:9200/_aliases -d '\n{\n    \"actions\": [\n        { \"remove\": {\n            \"alias\": \"my_index\",\n            \"index\": \"goods\"\n        }},\n        { \"add\": {\n            \"alias\": \"my_index\",\n            \"index\": \"goods_v2\"\n        }}\n    ]\n}'\n\n#查看my_index的mpping，与前面goods_v2的mapping对比\n$ curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\" \n```\n\n我们可以对比索引`my_index`与`goods_v2`的`mapping`是一致的，索引切换成功。\n\n创建了索引别名alias的话，程序中制定这个`my_index`这个别名即可，后需要创建新索引，只需切换索引映射到新索引上即可，实现不停服更新mapping。\n\n下一篇我们来说下通过**创建spring boot工程，通过es的java api操作es，实现分页查询和中文分词检索**的功能。","slug":"Elasticsearch实践索引及索引别名alias","published":1,"updated":"2018-06-22T14:18:46.247Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkdp0008dohgsi1k203s","content":"<p>我们都知道es效率如此高主要和索引是分不开的，需要将每一条数据建立索引，创建索引时数据字段也是你插入时的样子，索引中包含了数据的属性字段。而且创建索引也比较耗时（当然了，肯定比插入关系型数据库中更快😁），但是毕竟每一条数据都要建一次，数据量到达千万级亿级时，时间不是很乐观。🤔</p>\n<p>💡想像这样一个场景，产品上线一段时间后，由于产品需要，要将某个字段类型改变，比如需要将某个long型字段改成string类型，直接改会类型报错，查阅官方文档可知，es是不支持索引的更新操作的，需要对所有已有数据的所有field进行reindex，这意味着，需要停止服务进行重建索引操作，停服是最不想看到😭，这时如果你当初建了索引别名，你会感谢你当初使用别名的决定，为何要用别名alias？🤷</p>\n<a id=\"more\"></a>\n<p>Elasticsearch的索引别名alias，类似于数据库的视图。因为索引别名alias是映射到之前已创建的索引上的，对你要创建新的索引毫无影响。在创建好新索引之后，我们只需将这别名alias映射到新创建的别名上即可，这些操作只需要在服务器上通过指令操作即可，完全不影响线上服务，实现无缝切换索引。然后再将老的索引删掉即可，以节省空间。</p>\n<h2 id=\"1-创建一个索引\"><a href=\"#1-创建一个索引\" class=\"headerlink\" title=\"1. 创建一个索引\"></a>1. 创建一个索引</h2><p>创建一个索引，名为<code>goods</code>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPUT 10.10.13.234:9200/goods</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-为索引创建mapping\"><a href=\"#2-为索引创建mapping\" class=\"headerlink\" title=\"2. 为索引创建mapping\"></a>2. 为索引创建mapping</h2><p>为索引<code>goods</code>创建<code>mapping</code>，这里制定<code>content</code>字段属性使用ik中文分词器，只要制定搜索<code>content</code>内容就会查询出分词之后的关联结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_mapping <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"fulltext\": &#123;</div><div class=\"line\">             \"_all\": &#123;</div><div class=\"line\">            \"analyzer\": \"ik\"</div><div class=\"line\">        &#125;,</div><div class=\"line\">        \"properties\": &#123;</div><div class=\"line\">            \"content\": &#123;</div><div class=\"line\">                \"type\" : \"string\",</div><div class=\"line\">                \"boost\" : 8.0,</div><div class=\"line\">                \"term_vector\" : \"with_positions_offsets\",</div><div class=\"line\">                \"analyzer\" : \"ik\",</div><div class=\"line\">                \"include_in_all\" : true</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>这里创建的索引<code>goods</code>，如果未使用别名，程序中也是用<code>goods</code>这个索引名，如果建了新的索引，那么程序也要用新的索引名称，这是不友好的，如果用了索引别名alias就可以解决这个问题，继续看后面的操作。</p>\n<h2 id=\"3-插入数据\"><a href=\"#3-插入数据\" class=\"headerlink\" title=\"3. 插入数据\"></a>3. 插入数据</h2><p>插入一些测试数据：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/1 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"><span class=\"string\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/2 -H '</span>Content-Type:application/json<span class=\"string\">' -d'</span></span></div><div class=\"line\">&#123; \"content\": \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/4 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"><span class=\"string\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/5 -H '</span>Content-Type:application/json<span class=\"string\">' -d'</span></span></div><div class=\"line\">&#123; \"content\": \"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\">查看goods的mpping，后面需要与索引别名的mapping对比</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XGET <span class=\"string\">\"10.10.13.234:9200/goods/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<h2 id=\"4-测试分词高亮\"><a href=\"#4-测试分词高亮\" class=\"headerlink\" title=\"4. 测试分词高亮\"></a>4. 测试分词高亮</h2><p>测试命中分词高亮：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"query\" : &#123; \"match\" : &#123; \"content\" : \"进口水果\" &#125;&#125;,</div><div class=\"line\">    \"highlight\" : &#123;</div><div class=\"line\">        \"pre_tags\" : [\"&lt;tag1&gt;\", \"&lt;tag2&gt;\"],</div><div class=\"line\">        \"post_tags\" : [\"&lt;/tag1&gt;\", \"&lt;/tag2&gt;\"],</div><div class=\"line\">        \"fields\" : &#123;</div><div class=\"line\">            \"content\" : &#123;&#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<h2 id=\"5-创建索引别名\"><a href=\"#5-创建索引别名\" class=\"headerlink\" title=\"5. 创建索引别名\"></a>5. 创建索引别名</h2><p>新建同义词mapping：</p>\n<p>(1) 创建一个索引，这个索引的名称最好带上版本号，比如my_index_v1,my_index_v2等;</p>\n<p>(2) 创建一个指向本索引的同义词。为的是以后不停服更新mapping。</p>\n<p>步骤(1)的索引我们以刚刚创建的<code>goods</code>所以为例，创建别名映射到<code>goods</code>所以上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/_aliases <span class=\"_\">-d</span> <span class=\"string\">'  </span></span></div><div class=\"line\">&#123;  </div><div class=\"line\">    \"actions\": [  </div><div class=\"line\">        &#123; \"add\": &#123;  </div><div class=\"line\">            \"alias\": \"my_index\",  </div><div class=\"line\">            \"index\": \"goods\"  </div><div class=\"line\">        &#125;&#125;  </div><div class=\"line\">    ]  </div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>然后查看索引<code>my_index</code>的mapping：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XGET <span class=\"string\">\"10.10.13.234:9200/my_index/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p>索引<code>my_index</code>与<code>goods</code>的<code>mapping</code>一致。</p>\n<h2 id=\"6-切换索引\"><a href=\"#6-切换索引\" class=\"headerlink\" title=\"6. 切换索引\"></a>6. 切换索引</h2><p>再创建一个索引<code>goods_v2</code>，重复步骤1、2，名称换成<code>goods_v2</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPUT 10.10.13.234:9200/goods_v2</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/_mapping <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"fulltext\": &#123;</div><div class=\"line\">             \"_all\": &#123;</div><div class=\"line\">            \"analyzer\": \"ik\"</div><div class=\"line\">        &#125;,</div><div class=\"line\">        \"properties\": &#123;</div><div class=\"line\">            \"content\": &#123;</div><div class=\"line\">                \"type\" : \"string\",</div><div class=\"line\">                \"boost\" : 8.0,</div><div class=\"line\">                \"term_vector\" : \"with_positions_offsets\",</div><div class=\"line\">                \"analyzer\" : \"ik\",</div><div class=\"line\">                \"include_in_all\" : true</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>插入测试数：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/1 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",</div><div class=\"line\">\"number\": 21&#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\"><span class=\"string\">查看goods_v2的mpping，后面需要与索引别名的mapping对比</span></span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"><span class=\"string\"> curl -XGET \"10.10.13.234:9200/goods_v2/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p><strong>重点是更换索引的操作</strong>，将<code>my_index</code>别名切换映射到<code>goods_v2</code>上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/_aliases <span class=\"_\">-d</span> <span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"actions\": [</div><div class=\"line\">        &#123; \"remove\": &#123;</div><div class=\"line\">            \"alias\": \"my_index\",</div><div class=\"line\">            \"index\": \"goods\"</div><div class=\"line\">        &#125;&#125;,</div><div class=\"line\">        &#123; \"add\": &#123;</div><div class=\"line\">            \"alias\": \"my_index\",</div><div class=\"line\">            \"index\": \"goods_v2\"</div><div class=\"line\">        &#125;&#125;</div><div class=\"line\">    ]</div><div class=\"line\">&#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\"><span class=\"string\">查看my_index的mpping，与前面goods_v2的mapping对比</span></span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"><span class=\"string\"> curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p>我们可以对比索引<code>my_index</code>与<code>goods_v2</code>的<code>mapping</code>是一致的，索引切换成功。</p>\n<p>创建了索引别名alias的话，程序中制定这个<code>my_index</code>这个别名即可，后需要创建新索引，只需切换索引映射到新索引上即可，实现不停服更新mapping。</p>\n<p>下一篇我们来说下通过<strong>创建spring boot工程，通过es的java api操作es，实现分页查询和中文分词检索</strong>的功能。</p>\n","site":{"data":{}},"excerpt":"<p>我们都知道es效率如此高主要和索引是分不开的，需要将每一条数据建立索引，创建索引时数据字段也是你插入时的样子，索引中包含了数据的属性字段。而且创建索引也比较耗时（当然了，肯定比插入关系型数据库中更快😁），但是毕竟每一条数据都要建一次，数据量到达千万级亿级时，时间不是很乐观。🤔</p>\n<p>💡想像这样一个场景，产品上线一段时间后，由于产品需要，要将某个字段类型改变，比如需要将某个long型字段改成string类型，直接改会类型报错，查阅官方文档可知，es是不支持索引的更新操作的，需要对所有已有数据的所有field进行reindex，这意味着，需要停止服务进行重建索引操作，停服是最不想看到😭，这时如果你当初建了索引别名，你会感谢你当初使用别名的决定，为何要用别名alias？🤷</p>","more":"<p>Elasticsearch的索引别名alias，类似于数据库的视图。因为索引别名alias是映射到之前已创建的索引上的，对你要创建新的索引毫无影响。在创建好新索引之后，我们只需将这别名alias映射到新创建的别名上即可，这些操作只需要在服务器上通过指令操作即可，完全不影响线上服务，实现无缝切换索引。然后再将老的索引删掉即可，以节省空间。</p>\n<h2 id=\"1-创建一个索引\"><a href=\"#1-创建一个索引\" class=\"headerlink\" title=\"1. 创建一个索引\"></a>1. 创建一个索引</h2><p>创建一个索引，名为<code>goods</code>：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPUT 10.10.13.234:9200/goods</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-为索引创建mapping\"><a href=\"#2-为索引创建mapping\" class=\"headerlink\" title=\"2. 为索引创建mapping\"></a>2. 为索引创建mapping</h2><p>为索引<code>goods</code>创建<code>mapping</code>，这里制定<code>content</code>字段属性使用ik中文分词器，只要制定搜索<code>content</code>内容就会查询出分词之后的关联结果：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_mapping <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"fulltext\": &#123;</div><div class=\"line\">             \"_all\": &#123;</div><div class=\"line\">            \"analyzer\": \"ik\"</div><div class=\"line\">        &#125;,</div><div class=\"line\">        \"properties\": &#123;</div><div class=\"line\">            \"content\": &#123;</div><div class=\"line\">                \"type\" : \"string\",</div><div class=\"line\">                \"boost\" : 8.0,</div><div class=\"line\">                \"term_vector\" : \"with_positions_offsets\",</div><div class=\"line\">                \"analyzer\" : \"ik\",</div><div class=\"line\">                \"include_in_all\" : true</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>这里创建的索引<code>goods</code>，如果未使用别名，程序中也是用<code>goods</code>这个索引名，如果建了新的索引，那么程序也要用新的索引名称，这是不友好的，如果用了索引别名alias就可以解决这个问题，继续看后面的操作。</p>\n<h2 id=\"3-插入数据\"><a href=\"#3-插入数据\" class=\"headerlink\" title=\"3. 插入数据\"></a>3. 插入数据</h2><p>插入一些测试数据：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/1 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"><span class=\"string\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/2 -H '</span>Content-Type:application/json<span class=\"string\">' -d'</span></span></div><div class=\"line\">&#123; \"content\": \"华盛顿苹果礼盒 8个装（4个红蛇果+4个青苹果）单果重约145g-180g 新鲜水果礼盒\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/4 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"新疆阿克苏冰糖心 约5kg 单果200-250g（7Fresh 专供）\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">$<span class=\"bash\"><span class=\"string\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/5 -H '</span>Content-Type:application/json<span class=\"string\">' -d'</span></span></div><div class=\"line\">&#123; \"content\": \"果花 珍珠岩 无土栽培基质 颗粒状 保温性能好 园艺用品\" &#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\">查看goods的mpping，后面需要与索引别名的mapping对比</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XGET <span class=\"string\">\"10.10.13.234:9200/goods/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<h2 id=\"4-测试分词高亮\"><a href=\"#4-测试分词高亮\" class=\"headerlink\" title=\"4. 测试分词高亮\"></a>4. 测试分词高亮</h2><p>测试命中分词高亮：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"query\" : &#123; \"match\" : &#123; \"content\" : \"进口水果\" &#125;&#125;,</div><div class=\"line\">    \"highlight\" : &#123;</div><div class=\"line\">        \"pre_tags\" : [\"&lt;tag1&gt;\", \"&lt;tag2&gt;\"],</div><div class=\"line\">        \"post_tags\" : [\"&lt;/tag1&gt;\", \"&lt;/tag2&gt;\"],</div><div class=\"line\">        \"fields\" : &#123;</div><div class=\"line\">            \"content\" : &#123;&#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<h2 id=\"5-创建索引别名\"><a href=\"#5-创建索引别名\" class=\"headerlink\" title=\"5. 创建索引别名\"></a>5. 创建索引别名</h2><p>新建同义词mapping：</p>\n<p>(1) 创建一个索引，这个索引的名称最好带上版本号，比如my_index_v1,my_index_v2等;</p>\n<p>(2) 创建一个指向本索引的同义词。为的是以后不停服更新mapping。</p>\n<p>步骤(1)的索引我们以刚刚创建的<code>goods</code>所以为例，创建别名映射到<code>goods</code>所以上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/_aliases <span class=\"_\">-d</span> <span class=\"string\">'  </span></span></div><div class=\"line\">&#123;  </div><div class=\"line\">    \"actions\": [  </div><div class=\"line\">        &#123; \"add\": &#123;  </div><div class=\"line\">            \"alias\": \"my_index\",  </div><div class=\"line\">            \"index\": \"goods\"  </div><div class=\"line\">        &#125;&#125;  </div><div class=\"line\">    ]  </div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>然后查看索引<code>my_index</code>的mapping：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XGET <span class=\"string\">\"10.10.13.234:9200/my_index/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p>索引<code>my_index</code>与<code>goods</code>的<code>mapping</code>一致。</p>\n<h2 id=\"6-切换索引\"><a href=\"#6-切换索引\" class=\"headerlink\" title=\"6. 切换索引\"></a>6. 切换索引</h2><p>再创建一个索引<code>goods_v2</code>，重复步骤1、2，名称换成<code>goods_v2</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPUT 10.10.13.234:9200/goods_v2</span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/_mapping <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"fulltext\": &#123;</div><div class=\"line\">             \"_all\": &#123;</div><div class=\"line\">            \"analyzer\": \"ik\"</div><div class=\"line\">        &#125;,</div><div class=\"line\">        \"properties\": &#123;</div><div class=\"line\">            \"content\": &#123;</div><div class=\"line\">                \"type\" : \"string\",</div><div class=\"line\">                \"boost\" : 8.0,</div><div class=\"line\">                \"term_vector\" : \"with_positions_offsets\",</div><div class=\"line\">                \"analyzer\" : \"ik\",</div><div class=\"line\">                \"include_in_all\" : true</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;'</div></pre></td></tr></table></figure>\n<p>插入测试数：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/1 -H <span class=\"string\">'Content-Type:application/json'</span> <span class=\"_\">-d</span><span class=\"string\">'</span></span></div><div class=\"line\">&#123; \"content\": \"进口华盛顿红蛇果 苹果4个装 单果重约180g 新鲜水果\",</div><div class=\"line\">\"number\": 21&#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\"><span class=\"string\">查看goods_v2的mpping，后面需要与索引别名的mapping对比</span></span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"><span class=\"string\"> curl -XGET \"10.10.13.234:9200/goods_v2/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p><strong>重点是更换索引的操作</strong>，将<code>my_index</code>别名切换映射到<code>goods_v2</code>上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> curl -XPOST 10.10.13.234:9200/_aliases <span class=\"_\">-d</span> <span class=\"string\">'</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">    \"actions\": [</div><div class=\"line\">        &#123; \"remove\": &#123;</div><div class=\"line\">            \"alias\": \"my_index\",</div><div class=\"line\">            \"index\": \"goods\"</div><div class=\"line\">        &#125;&#125;,</div><div class=\"line\">        &#123; \"add\": &#123;</div><div class=\"line\">            \"alias\": \"my_index\",</div><div class=\"line\">            \"index\": \"goods_v2\"</div><div class=\"line\">        &#125;&#125;</div><div class=\"line\">    ]</div><div class=\"line\">&#125;'</div><div class=\"line\"><span class=\"meta\"></span></div><div class=\"line\">#<span class=\"bash\"><span class=\"string\">查看my_index的mpping，与前面goods_v2的mapping对比</span></span></div><div class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"><span class=\"string\"> curl -XGET \"10.10.13.234:9200/my_index/_mapping?pretty\"</span></span></div></pre></td></tr></table></figure>\n<p>我们可以对比索引<code>my_index</code>与<code>goods_v2</code>的<code>mapping</code>是一致的，索引切换成功。</p>\n<p>创建了索引别名alias的话，程序中制定这个<code>my_index</code>这个别名即可，后需要创建新索引，只需切换索引映射到新索引上即可，实现不停服更新mapping。</p>\n<p>下一篇我们来说下通过<strong>创建spring boot工程，通过es的java api操作es，实现分页查询和中文分词检索</strong>的功能。</p>"},{"title":"Packet for query is too large (84 > -1).","date":"2018-03-14T16:00:00.000Z","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1522683004066&di=e2500c85d9aa9d7c8b6c1329e31d50b0&imgtype=0&src=http%3A%2F%2Fmedia.fashiongroup.com%2Ffashionmag%2Fnewsletters%2Fimages%2F20110928%2Fefu_12386fac-2e69-4d75-83b6-486dc6c0600e.jpg","_content":"\nibatis工程使用resin配置mysql出现`Packet for query is too large (84 > -1).`错误。\n\nwindows下的resin配置连接mysql，常用的安全的做法是将数据库信息配置到conf目录下的resin.xml文件中。<!--more-->\n\n因为resin连接mysql不是必须的，所以resin本身没有提供mysql-connector的jar包，需要自己加到resin目录下的lib里面，我加了个`mysql-connector-java-5.1.45-bin.jar`进去，然而在运行工程执行数据库查询操作的时候，却出现了问题，报如下错误：\n\n```\norg.springframework.dao.TransientDataAccessResourceException: SqlMapClient operation; SQL [];   \n--- The error occurred while applying a parameter map.  \n--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  \n--- Check the statement (query failed).  \n--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 > -1). You can change this value on the server by setting the max_allowed_packet' variable.; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException:   \n--- The error occurred while applying a parameter map.  \n--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  \n--- Check the statement (query failed).  \n--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 > -1). You can change this value on the server by setting the max_allowed_packet' variable.\n```\n\n只进行查询却出现`Packet for query is too large`，而且查询的条件只有几个字母，网上搜了很多解答，都是说需要把mysql的`max_allowed_packet`参数调大，但是我通过`show VARIABLES like '%max_allowed_packet%';`查询的结果也很大，如果是参数过小，应该是提示大于数据库中设置的packet的值，而不应该报-1。\n\n最后发现有个帖子说是`mysql-connector-java`jar包的版本问题，版本不能太高，随后我将`mysql-connector-java-5.1.45-bin.jar`换成`mysql-connector-java-5.1.26-bin.jar`，不再出现packet错误，问题解决。\n\n可能是因为我**用的是`ibatis2.0`版本的缘故，不支持太高的mysql连接jar版本**，换成`mysql-connector-java-5.1.40`以下版本即可解决`Packet for query is too large (84 > -1)`问题。","source":"_posts/Packet for query is too large.md","raw":"---\ntitle: Packet for query is too large (84 > -1).\ndate: 2018-3-15\ncategories: \n  - ibatis\n  - mysql\n  - resin\ntags: \n  - zookeeper\n  - mysql\n  - ibatis\n  - resin\nthumbnail: https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1522683004066&di=e2500c85d9aa9d7c8b6c1329e31d50b0&imgtype=0&src=http%3A%2F%2Fmedia.fashiongroup.com%2Ffashionmag%2Fnewsletters%2Fimages%2F20110928%2Fefu_12386fac-2e69-4d75-83b6-486dc6c0600e.jpg\n---\n\nibatis工程使用resin配置mysql出现`Packet for query is too large (84 > -1).`错误。\n\nwindows下的resin配置连接mysql，常用的安全的做法是将数据库信息配置到conf目录下的resin.xml文件中。<!--more-->\n\n因为resin连接mysql不是必须的，所以resin本身没有提供mysql-connector的jar包，需要自己加到resin目录下的lib里面，我加了个`mysql-connector-java-5.1.45-bin.jar`进去，然而在运行工程执行数据库查询操作的时候，却出现了问题，报如下错误：\n\n```\norg.springframework.dao.TransientDataAccessResourceException: SqlMapClient operation; SQL [];   \n--- The error occurred while applying a parameter map.  \n--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  \n--- Check the statement (query failed).  \n--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 > -1). You can change this value on the server by setting the max_allowed_packet' variable.; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException:   \n--- The error occurred while applying a parameter map.  \n--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  \n--- Check the statement (query failed).  \n--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 > -1). You can change this value on the server by setting the max_allowed_packet' variable.\n```\n\n只进行查询却出现`Packet for query is too large`，而且查询的条件只有几个字母，网上搜了很多解答，都是说需要把mysql的`max_allowed_packet`参数调大，但是我通过`show VARIABLES like '%max_allowed_packet%';`查询的结果也很大，如果是参数过小，应该是提示大于数据库中设置的packet的值，而不应该报-1。\n\n最后发现有个帖子说是`mysql-connector-java`jar包的版本问题，版本不能太高，随后我将`mysql-connector-java-5.1.45-bin.jar`换成`mysql-connector-java-5.1.26-bin.jar`，不再出现packet错误，问题解决。\n\n可能是因为我**用的是`ibatis2.0`版本的缘故，不支持太高的mysql连接jar版本**，换成`mysql-connector-java-5.1.40`以下版本即可解决`Packet for query is too large (84 > -1)`问题。","slug":"Packet for query is too large","published":1,"updated":"2018-04-02T14:49:00.580Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hke60009dohg6vtkg8s8","content":"<p>ibatis工程使用resin配置mysql出现<code>Packet for query is too large (84 &gt; -1).</code>错误。</p>\n<p>windows下的resin配置连接mysql，常用的安全的做法是将数据库信息配置到conf目录下的resin.xml文件中。<a id=\"more\"></a></p>\n<p>因为resin连接mysql不是必须的，所以resin本身没有提供mysql-connector的jar包，需要自己加到resin目录下的lib里面，我加了个<code>mysql-connector-java-5.1.45-bin.jar</code>进去，然而在运行工程执行数据库查询操作的时候，却出现了问题，报如下错误：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.springframework.dao.TransientDataAccessResourceException: SqlMapClient operation; SQL [];   </div><div class=\"line\">--- The error occurred while applying a parameter map.  </div><div class=\"line\">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </div><div class=\"line\">--- Check the statement (query failed).  </div><div class=\"line\">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&apos; variable.; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException:   </div><div class=\"line\">--- The error occurred while applying a parameter map.  </div><div class=\"line\">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </div><div class=\"line\">--- Check the statement (query failed).  </div><div class=\"line\">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&apos; variable.</div></pre></td></tr></table></figure>\n<p>只进行查询却出现<code>Packet for query is too large</code>，而且查询的条件只有几个字母，网上搜了很多解答，都是说需要把mysql的<code>max_allowed_packet</code>参数调大，但是我通过<code>show VARIABLES like &#39;%max_allowed_packet%&#39;;</code>查询的结果也很大，如果是参数过小，应该是提示大于数据库中设置的packet的值，而不应该报-1。</p>\n<p>最后发现有个帖子说是<code>mysql-connector-java</code>jar包的版本问题，版本不能太高，随后我将<code>mysql-connector-java-5.1.45-bin.jar</code>换成<code>mysql-connector-java-5.1.26-bin.jar</code>，不再出现packet错误，问题解决。</p>\n<p>可能是因为我<strong>用的是<code>ibatis2.0</code>版本的缘故，不支持太高的mysql连接jar版本</strong>，换成<code>mysql-connector-java-5.1.40</code>以下版本即可解决<code>Packet for query is too large (84 &gt; -1)</code>问题。</p>\n","site":{"data":{}},"excerpt":"<p>ibatis工程使用resin配置mysql出现<code>Packet for query is too large (84 &gt; -1).</code>错误。</p>\n<p>windows下的resin配置连接mysql，常用的安全的做法是将数据库信息配置到conf目录下的resin.xml文件中。","more":"</p>\n<p>因为resin连接mysql不是必须的，所以resin本身没有提供mysql-connector的jar包，需要自己加到resin目录下的lib里面，我加了个<code>mysql-connector-java-5.1.45-bin.jar</code>进去，然而在运行工程执行数据库查询操作的时候，却出现了问题，报如下错误：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">org.springframework.dao.TransientDataAccessResourceException: SqlMapClient operation; SQL [];   </div><div class=\"line\">--- The error occurred while applying a parameter map.  </div><div class=\"line\">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </div><div class=\"line\">--- Check the statement (query failed).  </div><div class=\"line\">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&apos; variable.; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException:   </div><div class=\"line\">--- The error occurred while applying a parameter map.  </div><div class=\"line\">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </div><div class=\"line\">--- Check the statement (query failed).  </div><div class=\"line\">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&apos; variable.</div></pre></td></tr></table></figure>\n<p>只进行查询却出现<code>Packet for query is too large</code>，而且查询的条件只有几个字母，网上搜了很多解答，都是说需要把mysql的<code>max_allowed_packet</code>参数调大，但是我通过<code>show VARIABLES like &#39;%max_allowed_packet%&#39;;</code>查询的结果也很大，如果是参数过小，应该是提示大于数据库中设置的packet的值，而不应该报-1。</p>\n<p>最后发现有个帖子说是<code>mysql-connector-java</code>jar包的版本问题，版本不能太高，随后我将<code>mysql-connector-java-5.1.45-bin.jar</code>换成<code>mysql-connector-java-5.1.26-bin.jar</code>，不再出现packet错误，问题解决。</p>\n<p>可能是因为我<strong>用的是<code>ibatis2.0</code>版本的缘故，不支持太高的mysql连接jar版本</strong>，换成<code>mysql-connector-java-5.1.40</code>以下版本即可解决<code>Packet for query is too large (84 &gt; -1)</code>问题。</p>"},{"title":"Socket send函数和recv函数详解","date":"2017-01-09T16:00:00.000Z","thumbnail":"http://img2.91.com/uploads/allimg/140623/705-1406231J408-52.jpg","_content":"\n\n\n----------\n\n\n## **1. send 函数**\n\n**int send( SOCKET s, const char FAR \\*buf, int len, int flags ); ** \n\n<!--more-->\n\n不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。\n\n​    该函数的第一个参数指定发送端套接字描述符；\n\n​    第二个参数指明一个存放应用程序要发送数据的缓冲区；\n\n​    第三个参数指明实际要发送的数据的字节数；\n\n​    第四个参数一般置0。 \n\n​    这里只描述**同步Socket的send函数的执行流程**。当调用该函数时，\n\n   （1）send先比较待发送数据的长度len和套接字s的发送缓冲的长度， 如果len大于s的发送缓冲区的长度，该函数返回`SOCKET_ERROR`；\n\n   （2）如果len小于或者等于s的发送缓冲区的长度，那么send先检查协议是否正在发送s的发送缓冲中的数据，如果是就等待协议把数据发送完，如果协议还没有开始发送s的发送缓冲中的数据或者s的发送缓冲中没有数据，那么send就比较s的发送缓冲区的剩余空间和len\n\n   （3）如果len大于剩余空间大小，send就一直等待协议把s的发送缓冲中的数据发送完\n\n   （4）如果len小于剩余 空间大小，send就仅仅把buf中的数据copy到剩余空间里（**注意并不是send把s的发送缓冲中的数据传到连接的另一端的，而是协议传的，send仅仅是把buf中的数据copy到s的发送缓冲区的剩余空间里**）。\n\n​        如果send函数copy数据成功，就返回实际copy的字节数，如果send在copy数据时出现错误，那么send就返回SOCKET_ERROR；如果send在等待协议传送数据时网络断开的话，那么send函数也返回SOCKET_ERROR。\n\n​       **要注意send函数把buf中的数据成功copy到s的发送缓冲的剩余空间里后它就返回了，但是此时这些数据并不一定马上被传到连接的另一端**。如果协议在后续的传送过程中出现网络错误的话，那么下一个Socket函数就会返回SOCKET_ERROR。（每一个除send外的Socket函数在执 行的最开始总要先等待套接字的发送缓冲中的数据被协议传送完毕才能继续，如果在等待时出现网络错误，那么该Socket函数就返回 SOCKET_ERROR）\n\n> **注意：在Unix系统下，如果send在等待协议传送数据时网络断开的话，调用send的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。**\n\n通过测试发现，异步socket的send函数在网络刚刚断开时还能发送返回相应的字节数，同时使用select检测也是可写的，但是过几秒钟之后，再send就会出错了，返回-1。select也不能检测出可写了。\n\n\n\n## **2. recv函数**\n> **int recv( SOCKET s, char FAR \\*buf, int len, int flags);**\n\n不论是客户还是服务器应用程序都用recv函数从TCP连接的另一端接收数据。该函数的第一个参数指定接收端套接字描述符；\n\n​    第二个参数指明一个缓冲区，该缓冲区用来存放recv函数接收到的数据；\n\n​    第三个参数指明buf的长度；\n\n​    第四个参数一般置0。\n\n​    这里只描述**同步Socket的recv函数的执行流程**。当应用程序调用recv函数时，\n\n​    （1）recv先等待s的发送缓冲中的数据被协议传送完毕，如果协议在传送s的发送缓冲中的数据时出现网络错误，那么recv函数返回`SOCKET_ERROR` ；\n\n​    （2）如果s的发送缓冲中没有数据或者数据被协议成功发送完毕后，recv先检查套接字s的接收缓冲区，如果s接收缓冲区中没有数据或者协议正在接收数据，那么recv就一直等待，直到协议把数据接收完毕。当协议把数据接收完毕，recv函数就把s的接收缓冲中的数据copy到buf中（**注意协议接收到的数据可能大于buf的长度，所以 在这种情况下要调用几次recv函数才能把s的接收缓冲中的数据copy完。recv函数仅仅是copy数据，真正的接收数据是协议来完成的**）；\n\n​    recv函数返回其实际copy的字节数。如果recv在copy时出错，那么它返回`SOCKET_ERROR`；如果recv函数在等待协议接收数据时网络中断了，那么它返回0。\n\n> **注意：在Unix系统下，如果recv函数在等待协议接收数据时网络断开了，那么调用recv的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。**","source":"_posts/Socket_send函数和recv函数详解.md","raw":"---\ntitle: Socket send函数和recv函数详解\ndate: 2017-1-10\ncategories: \n  - C++\n  - Socket\ntags: \n  - socket\n  - C++\nthumbnail: http://img2.91.com/uploads/allimg/140623/705-1406231J408-52.jpg\n---\n\n\n\n----------\n\n\n## **1. send 函数**\n\n**int send( SOCKET s, const char FAR \\*buf, int len, int flags ); ** \n\n<!--more-->\n\n不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。\n\n​    该函数的第一个参数指定发送端套接字描述符；\n\n​    第二个参数指明一个存放应用程序要发送数据的缓冲区；\n\n​    第三个参数指明实际要发送的数据的字节数；\n\n​    第四个参数一般置0。 \n\n​    这里只描述**同步Socket的send函数的执行流程**。当调用该函数时，\n\n   （1）send先比较待发送数据的长度len和套接字s的发送缓冲的长度， 如果len大于s的发送缓冲区的长度，该函数返回`SOCKET_ERROR`；\n\n   （2）如果len小于或者等于s的发送缓冲区的长度，那么send先检查协议是否正在发送s的发送缓冲中的数据，如果是就等待协议把数据发送完，如果协议还没有开始发送s的发送缓冲中的数据或者s的发送缓冲中没有数据，那么send就比较s的发送缓冲区的剩余空间和len\n\n   （3）如果len大于剩余空间大小，send就一直等待协议把s的发送缓冲中的数据发送完\n\n   （4）如果len小于剩余 空间大小，send就仅仅把buf中的数据copy到剩余空间里（**注意并不是send把s的发送缓冲中的数据传到连接的另一端的，而是协议传的，send仅仅是把buf中的数据copy到s的发送缓冲区的剩余空间里**）。\n\n​        如果send函数copy数据成功，就返回实际copy的字节数，如果send在copy数据时出现错误，那么send就返回SOCKET_ERROR；如果send在等待协议传送数据时网络断开的话，那么send函数也返回SOCKET_ERROR。\n\n​       **要注意send函数把buf中的数据成功copy到s的发送缓冲的剩余空间里后它就返回了，但是此时这些数据并不一定马上被传到连接的另一端**。如果协议在后续的传送过程中出现网络错误的话，那么下一个Socket函数就会返回SOCKET_ERROR。（每一个除send外的Socket函数在执 行的最开始总要先等待套接字的发送缓冲中的数据被协议传送完毕才能继续，如果在等待时出现网络错误，那么该Socket函数就返回 SOCKET_ERROR）\n\n> **注意：在Unix系统下，如果send在等待协议传送数据时网络断开的话，调用send的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。**\n\n通过测试发现，异步socket的send函数在网络刚刚断开时还能发送返回相应的字节数，同时使用select检测也是可写的，但是过几秒钟之后，再send就会出错了，返回-1。select也不能检测出可写了。\n\n\n\n## **2. recv函数**\n> **int recv( SOCKET s, char FAR \\*buf, int len, int flags);**\n\n不论是客户还是服务器应用程序都用recv函数从TCP连接的另一端接收数据。该函数的第一个参数指定接收端套接字描述符；\n\n​    第二个参数指明一个缓冲区，该缓冲区用来存放recv函数接收到的数据；\n\n​    第三个参数指明buf的长度；\n\n​    第四个参数一般置0。\n\n​    这里只描述**同步Socket的recv函数的执行流程**。当应用程序调用recv函数时，\n\n​    （1）recv先等待s的发送缓冲中的数据被协议传送完毕，如果协议在传送s的发送缓冲中的数据时出现网络错误，那么recv函数返回`SOCKET_ERROR` ；\n\n​    （2）如果s的发送缓冲中没有数据或者数据被协议成功发送完毕后，recv先检查套接字s的接收缓冲区，如果s接收缓冲区中没有数据或者协议正在接收数据，那么recv就一直等待，直到协议把数据接收完毕。当协议把数据接收完毕，recv函数就把s的接收缓冲中的数据copy到buf中（**注意协议接收到的数据可能大于buf的长度，所以 在这种情况下要调用几次recv函数才能把s的接收缓冲中的数据copy完。recv函数仅仅是copy数据，真正的接收数据是协议来完成的**）；\n\n​    recv函数返回其实际copy的字节数。如果recv在copy时出错，那么它返回`SOCKET_ERROR`；如果recv函数在等待协议接收数据时网络中断了，那么它返回0。\n\n> **注意：在Unix系统下，如果recv函数在等待协议接收数据时网络断开了，那么调用recv的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。**","slug":"Socket_send函数和recv函数详解","published":1,"updated":"2017-08-01T14:03:28.443Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkep000cdohgj01xyqgo","content":"<hr>\n<h2 id=\"1-send-函数\"><a href=\"#1-send-函数\" class=\"headerlink\" title=\"1. send 函数\"></a><strong>1. send 函数</strong></h2><p><strong>int send( SOCKET s, const char FAR *buf, int len, int flags ); </strong> </p>\n<a id=\"more\"></a>\n<p>不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。</p>\n<p>​    该函数的第一个参数指定发送端套接字描述符；</p>\n<p>​    第二个参数指明一个存放应用程序要发送数据的缓冲区；</p>\n<p>​    第三个参数指明实际要发送的数据的字节数；</p>\n<p>​    第四个参数一般置0。 </p>\n<p>​    这里只描述<strong>同步Socket的send函数的执行流程</strong>。当调用该函数时，</p>\n<p>   （1）send先比较待发送数据的长度len和套接字s的发送缓冲的长度， 如果len大于s的发送缓冲区的长度，该函数返回<code>SOCKET_ERROR</code>；</p>\n<p>   （2）如果len小于或者等于s的发送缓冲区的长度，那么send先检查协议是否正在发送s的发送缓冲中的数据，如果是就等待协议把数据发送完，如果协议还没有开始发送s的发送缓冲中的数据或者s的发送缓冲中没有数据，那么send就比较s的发送缓冲区的剩余空间和len</p>\n<p>   （3）如果len大于剩余空间大小，send就一直等待协议把s的发送缓冲中的数据发送完</p>\n<p>   （4）如果len小于剩余 空间大小，send就仅仅把buf中的数据copy到剩余空间里（<strong>注意并不是send把s的发送缓冲中的数据传到连接的另一端的，而是协议传的，send仅仅是把buf中的数据copy到s的发送缓冲区的剩余空间里</strong>）。</p>\n<p>​        如果send函数copy数据成功，就返回实际copy的字节数，如果send在copy数据时出现错误，那么send就返回SOCKET_ERROR；如果send在等待协议传送数据时网络断开的话，那么send函数也返回SOCKET_ERROR。</p>\n<p>​       <strong>要注意send函数把buf中的数据成功copy到s的发送缓冲的剩余空间里后它就返回了，但是此时这些数据并不一定马上被传到连接的另一端</strong>。如果协议在后续的传送过程中出现网络错误的话，那么下一个Socket函数就会返回SOCKET_ERROR。（每一个除send外的Socket函数在执 行的最开始总要先等待套接字的发送缓冲中的数据被协议传送完毕才能继续，如果在等待时出现网络错误，那么该Socket函数就返回 SOCKET_ERROR）</p>\n<blockquote>\n<p><strong>注意：在Unix系统下，如果send在等待协议传送数据时网络断开的话，调用send的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。</strong></p>\n</blockquote>\n<p>通过测试发现，异步socket的send函数在网络刚刚断开时还能发送返回相应的字节数，同时使用select检测也是可写的，但是过几秒钟之后，再send就会出错了，返回-1。select也不能检测出可写了。</p>\n<h2 id=\"2-recv函数\"><a href=\"#2-recv函数\" class=\"headerlink\" title=\"2. recv函数\"></a><strong>2. recv函数</strong></h2><blockquote>\n<p><strong>int recv( SOCKET s, char FAR *buf, int len, int flags);</strong></p>\n</blockquote>\n<p>不论是客户还是服务器应用程序都用recv函数从TCP连接的另一端接收数据。该函数的第一个参数指定接收端套接字描述符；</p>\n<p>​    第二个参数指明一个缓冲区，该缓冲区用来存放recv函数接收到的数据；</p>\n<p>​    第三个参数指明buf的长度；</p>\n<p>​    第四个参数一般置0。</p>\n<p>​    这里只描述<strong>同步Socket的recv函数的执行流程</strong>。当应用程序调用recv函数时，</p>\n<p>​    （1）recv先等待s的发送缓冲中的数据被协议传送完毕，如果协议在传送s的发送缓冲中的数据时出现网络错误，那么recv函数返回<code>SOCKET_ERROR</code> ；</p>\n<p>​    （2）如果s的发送缓冲中没有数据或者数据被协议成功发送完毕后，recv先检查套接字s的接收缓冲区，如果s接收缓冲区中没有数据或者协议正在接收数据，那么recv就一直等待，直到协议把数据接收完毕。当协议把数据接收完毕，recv函数就把s的接收缓冲中的数据copy到buf中（<strong>注意协议接收到的数据可能大于buf的长度，所以 在这种情况下要调用几次recv函数才能把s的接收缓冲中的数据copy完。recv函数仅仅是copy数据，真正的接收数据是协议来完成的</strong>）；</p>\n<p>​    recv函数返回其实际copy的字节数。如果recv在copy时出错，那么它返回<code>SOCKET_ERROR</code>；如果recv函数在等待协议接收数据时网络中断了，那么它返回0。</p>\n<blockquote>\n<p><strong>注意：在Unix系统下，如果recv函数在等待协议接收数据时网络断开了，那么调用recv的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。</strong></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<hr>\n<h2 id=\"1-send-函数\"><a href=\"#1-send-函数\" class=\"headerlink\" title=\"1. send 函数\"></a><strong>1. send 函数</strong></h2><p><strong>int send( SOCKET s, const char FAR *buf, int len, int flags ); </strong> </p>","more":"<p>不论是客户还是服务器应用程序都用send函数来向TCP连接的另一端发送数据。客户程序一般用send函数向服务器发送请求，而服务器则通常用send函数来向客户程序发送应答。</p>\n<p>​    该函数的第一个参数指定发送端套接字描述符；</p>\n<p>​    第二个参数指明一个存放应用程序要发送数据的缓冲区；</p>\n<p>​    第三个参数指明实际要发送的数据的字节数；</p>\n<p>​    第四个参数一般置0。 </p>\n<p>​    这里只描述<strong>同步Socket的send函数的执行流程</strong>。当调用该函数时，</p>\n<p>   （1）send先比较待发送数据的长度len和套接字s的发送缓冲的长度， 如果len大于s的发送缓冲区的长度，该函数返回<code>SOCKET_ERROR</code>；</p>\n<p>   （2）如果len小于或者等于s的发送缓冲区的长度，那么send先检查协议是否正在发送s的发送缓冲中的数据，如果是就等待协议把数据发送完，如果协议还没有开始发送s的发送缓冲中的数据或者s的发送缓冲中没有数据，那么send就比较s的发送缓冲区的剩余空间和len</p>\n<p>   （3）如果len大于剩余空间大小，send就一直等待协议把s的发送缓冲中的数据发送完</p>\n<p>   （4）如果len小于剩余 空间大小，send就仅仅把buf中的数据copy到剩余空间里（<strong>注意并不是send把s的发送缓冲中的数据传到连接的另一端的，而是协议传的，send仅仅是把buf中的数据copy到s的发送缓冲区的剩余空间里</strong>）。</p>\n<p>​        如果send函数copy数据成功，就返回实际copy的字节数，如果send在copy数据时出现错误，那么send就返回SOCKET_ERROR；如果send在等待协议传送数据时网络断开的话，那么send函数也返回SOCKET_ERROR。</p>\n<p>​       <strong>要注意send函数把buf中的数据成功copy到s的发送缓冲的剩余空间里后它就返回了，但是此时这些数据并不一定马上被传到连接的另一端</strong>。如果协议在后续的传送过程中出现网络错误的话，那么下一个Socket函数就会返回SOCKET_ERROR。（每一个除send外的Socket函数在执 行的最开始总要先等待套接字的发送缓冲中的数据被协议传送完毕才能继续，如果在等待时出现网络错误，那么该Socket函数就返回 SOCKET_ERROR）</p>\n<blockquote>\n<p><strong>注意：在Unix系统下，如果send在等待协议传送数据时网络断开的话，调用send的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。</strong></p>\n</blockquote>\n<p>通过测试发现，异步socket的send函数在网络刚刚断开时还能发送返回相应的字节数，同时使用select检测也是可写的，但是过几秒钟之后，再send就会出错了，返回-1。select也不能检测出可写了。</p>\n<h2 id=\"2-recv函数\"><a href=\"#2-recv函数\" class=\"headerlink\" title=\"2. recv函数\"></a><strong>2. recv函数</strong></h2><blockquote>\n<p><strong>int recv( SOCKET s, char FAR *buf, int len, int flags);</strong></p>\n</blockquote>\n<p>不论是客户还是服务器应用程序都用recv函数从TCP连接的另一端接收数据。该函数的第一个参数指定接收端套接字描述符；</p>\n<p>​    第二个参数指明一个缓冲区，该缓冲区用来存放recv函数接收到的数据；</p>\n<p>​    第三个参数指明buf的长度；</p>\n<p>​    第四个参数一般置0。</p>\n<p>​    这里只描述<strong>同步Socket的recv函数的执行流程</strong>。当应用程序调用recv函数时，</p>\n<p>​    （1）recv先等待s的发送缓冲中的数据被协议传送完毕，如果协议在传送s的发送缓冲中的数据时出现网络错误，那么recv函数返回<code>SOCKET_ERROR</code> ；</p>\n<p>​    （2）如果s的发送缓冲中没有数据或者数据被协议成功发送完毕后，recv先检查套接字s的接收缓冲区，如果s接收缓冲区中没有数据或者协议正在接收数据，那么recv就一直等待，直到协议把数据接收完毕。当协议把数据接收完毕，recv函数就把s的接收缓冲中的数据copy到buf中（<strong>注意协议接收到的数据可能大于buf的长度，所以 在这种情况下要调用几次recv函数才能把s的接收缓冲中的数据copy完。recv函数仅仅是copy数据，真正的接收数据是协议来完成的</strong>）；</p>\n<p>​    recv函数返回其实际copy的字节数。如果recv在copy时出错，那么它返回<code>SOCKET_ERROR</code>；如果recv函数在等待协议接收数据时网络中断了，那么它返回0。</p>\n<blockquote>\n<p><strong>注意：在Unix系统下，如果recv函数在等待协议接收数据时网络断开了，那么调用recv的进程会接收到一个SIGPIPE信号，进程对该信号的默认处理是进程终止。</strong></p>\n</blockquote>"},{"title":"TCP长连接与短连接的区别","date":"2015-02-19T16:00:00.000Z","thumbnail":"http://dl.bizhi.sogou.com/images/2014/01/07/482848.jpg","_content":"\n\n## **1. TCP连接**\n\n​        当网络通信时采用TCP协议时，在真正的读写操作之前，`server`与`client`之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。\n\n<!--more-->\n\n经典的三次握手示意图：\n\n![三次握手](http://pic002.cnblogs.com/images/2011/305779/2011062613192683.jpg)\n\n经典的四次握手关闭图：\n\n![四次握手](http://pic002.cnblogs.com/images/2011/305779/2011062613210341.jpg)\n\n## **2. TCP短连接**\n​        我们模拟一下TCP短连接的情况，**client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。**\n\n**为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。**\n\n从上面的描述看，短连接一般只会在`client/server`间传递一次读写操作。\n\n> **短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段。**\n\n## **3. TCP长连接**\n\n​       接下来我们再模拟一下长连接的情况，**client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。**\n\n​       首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。\n\n> 如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：\n>\n> 1. 客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。\n> 2. 客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。\n> 3. 客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。\n> 4. 客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。\n\n​        从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。\n\n> **在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，**\n>\n> 1. 如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；\n> 2. 如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服。\n\n> 长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。","source":"_posts/TCP长连接与短连接的区别.md","raw":"---\ntitle: TCP长连接与短连接的区别\ndate: 2015-02-20 \ncategories: \n  - tcp \ntags: \n  - tcp \nthumbnail: http://dl.bizhi.sogou.com/images/2014/01/07/482848.jpg\n---\n\n\n## **1. TCP连接**\n\n​        当网络通信时采用TCP协议时，在真正的读写操作之前，`server`与`client`之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。\n\n<!--more-->\n\n经典的三次握手示意图：\n\n![三次握手](http://pic002.cnblogs.com/images/2011/305779/2011062613192683.jpg)\n\n经典的四次握手关闭图：\n\n![四次握手](http://pic002.cnblogs.com/images/2011/305779/2011062613210341.jpg)\n\n## **2. TCP短连接**\n​        我们模拟一下TCP短连接的情况，**client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。**\n\n**为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。**\n\n从上面的描述看，短连接一般只会在`client/server`间传递一次读写操作。\n\n> **短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段。**\n\n## **3. TCP长连接**\n\n​       接下来我们再模拟一下长连接的情况，**client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。**\n\n​       首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。\n\n> 如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：\n>\n> 1. 客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。\n> 2. 客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。\n> 3. 客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。\n> 4. 客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。\n\n​        从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。\n\n> **在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，**\n>\n> 1. 如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；\n> 2. 如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服。\n\n> 长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。","slug":"TCP长连接与短连接的区别","published":1,"updated":"2017-09-07T14:25:23.988Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkf2000edohgwzc2ertl","content":"<h2 id=\"1-TCP连接\"><a href=\"#1-TCP连接\" class=\"headerlink\" title=\"1. TCP连接\"></a><strong>1. TCP连接</strong></h2><p>​        当网络通信时采用TCP协议时，在真正的读写操作之前，<code>server</code>与<code>client</code>之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。</p>\n<a id=\"more\"></a>\n<p>经典的三次握手示意图：</p>\n<p><img src=\"http://pic002.cnblogs.com/images/2011/305779/2011062613192683.jpg\" alt=\"三次握手\"></p>\n<p>经典的四次握手关闭图：</p>\n<p><img src=\"http://pic002.cnblogs.com/images/2011/305779/2011062613210341.jpg\" alt=\"四次握手\"></p>\n<h2 id=\"2-TCP短连接\"><a href=\"#2-TCP短连接\" class=\"headerlink\" title=\"2. TCP短连接\"></a><strong>2. TCP短连接</strong></h2><p>​        我们模拟一下TCP短连接的情况，<strong>client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。</strong></p>\n<p><strong>为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。</strong></p>\n<p>从上面的描述看，短连接一般只会在<code>client/server</code>间传递一次读写操作。</p>\n<blockquote>\n<p><strong>短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段。</strong></p>\n</blockquote>\n<h2 id=\"3-TCP长连接\"><a href=\"#3-TCP长连接\" class=\"headerlink\" title=\"3. TCP长连接\"></a><strong>3. TCP长连接</strong></h2><p>​       接下来我们再模拟一下长连接的情况，<strong>client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。</strong></p>\n<p>​       首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。</p>\n<blockquote>\n<p>如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：</p>\n<ol>\n<li>客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。</li>\n<li>客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。</li>\n<li>客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。</li>\n<li>客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。</li>\n</ol>\n</blockquote>\n<p>​        从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。</p>\n<blockquote>\n<p><strong>在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，</strong></p>\n<ol>\n<li>如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；</li>\n<li>如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服。</li>\n</ol>\n<p>长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-TCP连接\"><a href=\"#1-TCP连接\" class=\"headerlink\" title=\"1. TCP连接\"></a><strong>1. TCP连接</strong></h2><p>​        当网络通信时采用TCP协议时，在真正的读写操作之前，<code>server</code>与<code>client</code>之间必须建立一个连接，当读写操作完成后，双方不再需要这个连接时它们可以释放这个连接，连接的建立是需要三次握手的，而释放则需要4次握手，所以说每个连接的建立都是需要资源消耗和时间消耗的。</p>","more":"<p>经典的三次握手示意图：</p>\n<p><img src=\"http://pic002.cnblogs.com/images/2011/305779/2011062613192683.jpg\" alt=\"三次握手\"></p>\n<p>经典的四次握手关闭图：</p>\n<p><img src=\"http://pic002.cnblogs.com/images/2011/305779/2011062613210341.jpg\" alt=\"四次握手\"></p>\n<h2 id=\"2-TCP短连接\"><a href=\"#2-TCP短连接\" class=\"headerlink\" title=\"2. TCP短连接\"></a><strong>2. TCP短连接</strong></h2><p>​        我们模拟一下TCP短连接的情况，<strong>client向server发起连接请求，server接到请求，然后双方建立连接。client向server发送消息，server回应client，然后一次读写就完成了，这时候双方任何一个都可以发起close操作，不过一般都是client先发起close操作。</strong></p>\n<p><strong>为什么呢，一般的server不会回复完client后立即关闭连接的，当然不排除有特殊的情况。</strong></p>\n<p>从上面的描述看，短连接一般只会在<code>client/server</code>间传递一次读写操作。</p>\n<blockquote>\n<p><strong>短连接的优点是：管理起来比较简单，存在的连接都是有用的连接，不需要额外的控制手段。</strong></p>\n</blockquote>\n<h2 id=\"3-TCP长连接\"><a href=\"#3-TCP长连接\" class=\"headerlink\" title=\"3. TCP长连接\"></a><strong>3. TCP长连接</strong></h2><p>​       接下来我们再模拟一下长连接的情况，<strong>client向server发起连接，server接受client连接，双方建立连接。Client与server完成一次读写之后，它们之间的连接并不会主动关闭，后续的读写操作会继续使用这个连接。</strong></p>\n<p>​       首先说一下TCP/IP详解上讲到的TCP保活功能，保活功能主要为服务器应用提供，服务器应用希望知道客户主机是否崩溃，从而可以代表客户使用资源。如果客户已经消失，使得服务器上保留一个半开放的连接，而服务器又在等待来自客户端的数据，则服务器将应远等待客户端的数据，保活功能就是试图在服务器端检测到这种半开放的连接。</p>\n<blockquote>\n<p>如果一个给定的连接在两小时内没有任何的动作，则服务器就向客户发一个探测报文段，客户主机必须处于以下4个状态之一：</p>\n<ol>\n<li>客户主机依然正常运行，并从服务器可达。客户的TCP响应正常，而服务器也知道对方是正常的，服务器在两小时后将保活定时器复位。</li>\n<li>客户主机已经崩溃，并且关闭或者正在重新启动。在任何一种情况下，客户的TCP都没有响应。服务端将不能收到对探测的响应，并在75秒后超时。服务器总共发送10个这样的探测 ，每个间隔75秒。如果服务器没有收到一个响应，它就认为客户主机已经关闭并终止连接。</li>\n<li>客户主机崩溃并已经重新启动。服务器将收到一个对其保活探测的响应，这个响应是一个复位，使得服务器终止这个连接。</li>\n<li>客户机正常运行，但是服务器不可达，这种情况与2类似，TCP能发现的就是没有收到探查的响应。</li>\n</ol>\n</blockquote>\n<p>​        从上面可以看出，TCP保活功能主要为探测长连接的存活状况，不过这里存在一个问题，存活功能的探测周期太长，还有就是它只是探测TCP连接的存活，属于比较斯文的做法，遇到恶意的连接时，保活功能就不够使了。</p>\n<blockquote>\n<p><strong>在长连接的应用场景下，client端一般不会主动关闭它们之间的连接，client与server之间的连接如果一直不关闭的话，会存在一个问题，随着客户端连接越来越多，server早晚有扛不住的时候，这时候server端需要采取一些策略，</strong></p>\n<ol>\n<li>如关闭一些长时间没有读写事件发生的连接，这样可以避免一些恶意连接导致server端服务受损；</li>\n<li>如果条件再允许就可以以客户端机器为颗粒度，限制每个客户端的最大长连接数，这样可以完全避免某个蛋疼的客户端连累后端服。</li>\n</ol>\n<p>长连接和短连接的产生在于client和server采取的关闭策略，具体的应用场景采用具体的策略，没有十全十美的选择，只有合适的选择。</p>\n</blockquote>"},{"title":"idea搭建springdata+mongodb+maven+springmvc","date":"2017-06-05T16:00:00.000Z","thumbnail":"http://pic1.win4000.com/wallpaper/5/5486631edd8b3.jpg","_content":"\n今天我们来学习一下SpringData操作MongoDB。\n项目环境：IntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8 <!--more-->\n\n推荐网站（适合学习各种知识的基础）：[http://www.runoob.com/](http://www.runoob.com/)\n\nmongo安装请参考：http://www.runoob.com/mongodb/mongodb-window-install.html\n\n\n\n## **1. 创建maven工程**\n\n首相创建maven工程，New project:\n![创建maven工程](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-1.png)\n\n![自行填写](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-2.png)\n\n这里不使用idea自带maven插件，改用下载好的3.5.0版maven；\n\n由于最近osChina的maven仓库挂掉，推荐大家使用阿里的镜像，速度快的飞起\n`maven`配置：`D:\\apache-maven-3.5.0\\conf\\setting.xml`中找到`mirrors`:\n\n```xml\n<mirrors>\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>http://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorOf>central</mirrorOf>        \n    </mirror>\n</mirrors>\n```\n\n![选择下好的本地maven3.5.0](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-3.png)\n\n![next](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-4.png)\n\n项目结构如下图，手动创建相关文件夹及文件，并设置文件夹的对应属性：\n\n![工程目录](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-5.png)\n\n![目录结构](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-6.png)\n\n至此，maven工程创建完毕。\n\n## **2. 访问mongodb数据方式**\n\n这里`dao`与`mongoDao`分别为`mongoDB`的两种查询方式：\n\n> (1) `dao`为`JPA`的查询方式（请参考`springdataJPA`）；\n>\n> (2) `mongoDao`使用`mongoTemplate`，类似于关系型数据库使用的`jdbcTemplate`。\n\n## **3. 详细代码**\n\n先看配置文件\nspring-context.xml为最基本的`spring`配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context.xsd\">\n    <!-- 开启注解 -->\n    <context:annotation-config/>\n    <!--扫描service包嗲所有使用注解的类型-->\n    <context:component-scan base-package=\"com.lewis.mongo\">\n        <context:include-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\"/>\n    </context:component-scan>\n\n    <!-- 导入mongodb的配置文件 -->\n    <import resource=\"spring-mongo.xml\"/>\n</beans>\n```\n\nspring-web.xml为`springmvc`的基本配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/mvc\n       http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context-4.0.xsd\">\n    <!--配置springmvc-->\n    <!--1.开启springmvc注解模式-->\n    <context:annotation-config/>\n    <!--简化配置：\n        (1)主动注册DefaultAnnotationHandlerMapping,AnnotationMethodHandlerAdapter\n        (2)提供一系列功能：数据绑定，数字和日期的format @NumberFormt @DataTimeFormat，xml json默认的读写支持-->\n    <mvc:annotation-driven/>\n    <!--servlet-mapping-->\n    <!--2静态资源默认的servlet配置，\n        （1）允许对静态资源的处理：js，gif\n        （2）允许使用“/”做整体映射-->\n    <!-- 容器默认的DefaultServletHandler处理 所有静态内容与无RequestMapping处理的URL-->\n    <mvc:default-servlet-handler/>\n    <!--3:配置jsp 显示viewResolver-->\n    <bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n        <property name=\"viewClass\" value=\"org.springframework.web.servlet.view.JstlView\"/>\n        <property name=\"prefix\" value=\"/WEB-INF/views/\"/>\n        <property name=\"suffix\" value=\".jsp\"/>\n    </bean>\n\n    <!-- 4自动扫描且只扫描@Controller -->\n    <context:component-scan base-package=\"com.lewis.mongo.controller\"/>\n\n    <!-- 定义无需Controller的url<->view直接映射 -->\n    <mvc:view-controller path=\"/\" view-name=\"redirect:/hi/hello\"/>\n</beans>\n```\n\nspring-mongo.xml为mongo配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:mongo=\"http://www.springframework.org/schema/data/mongo\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context.xsd\n       http://www.springframework.org/schema/data/mongo\n       http://www.springframework.org/schema/data/mongo/spring-mongo.xsd\">\n\n    <!-- 加载mongodb的属性配置文件 -->\n    <context:property-placeholder location=\"classpath*:mongo.properties\"/>\n    <!-- spring连接mongodb数据库的配置 -->\n    <mongo:mongo-client replica-set=\"${mongo.hostport}\" id=\"mongo\">\n        <mongo:client-options connections-per-host=\"${mongo.connectionsPerHost}\"\n                              threads-allowed-to-block-for-connection-multiplier=\"${mongo.threadsAllowedToBlockForConnectionMultiplier}\"\n                              connect-timeout=\"${mongo.connectTimeout}\" max-wait-time=\"${mongo.maxWaitTime}\"\n                              socket-timeout=\"${mongo.socketTimeout}\"/>\n    </mongo:mongo-client>\n    <!-- mongo的工厂，通过它来取得mongo实例,dbname为mongodb的数据库名，没有的话会自动创建 -->\n    <mongo:db-factory id=\"mongoDbFactory\" dbname=\"mongoLewis\" mongo-ref=\"mongo\"/>\n\n    <!-- 只要使用这个调用相应的方法操作 -->\n    <bean id=\"mongoTemplate\" class=\"org.springframework.data.mongodb.core.MongoTemplate\">\n        <constructor-arg name=\"mongoDbFactory\" ref=\"mongoDbFactory\"/>\n    </bean>\n    <!-- mongodb bean的仓库目录，会自动扫描扩展了MongoRepository接口的接口进行注入 -->\n    <mongo:repositories base-package=\"com.lewis.mongo\"/>\n</beans>\n```\n\nmongo.properties:\n\n```properties\nmongo.hostport=10.10.16.234:27017  \nmongo.connectionsPerHost=8  \nmongo.threadsAllowedToBlockForConnectionMultiplier=4  \n#连接超时时间\nmongo.connectTimeout=1000  \n#等待时间\nmongo.maxWaitTime=1500  \nmongo.autoConnectRetry=true  \nmongo.socketKeepAlive=true  \n#Socket超时时间\nmongo.socketTimeout=1500  \nmongo.slaveOk=true\n```\n\npom.xml，这里要注意的是`junit`版本需要4.12以上，不然idea会报错；`spring-data-mongodb`版本要1.10.1以上；\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <properties>\n        <!-- spring-framework-bom 版本号-->\n        <spring.version>4.3.8.RELEASE</spring.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    </properties>\n\n    <groupId>com.liu</groupId>\n    <artifactId>mongo</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <packaging>war</packaging>\n\n    <name>mongo Maven Webapp</name>\n    <url>http://maven.apache.org</url>\n    <dependencies>\n        <!--使用junit4，注解的方式测试-->\n        <!--<dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.11</version>\n            <scope>test</scope>\n        </dependency>-->\n        <!-- https://mvnrepository.com/artifact/junit/junit -->\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.12</version>\n            <scope>test</scope>\n        </dependency>\n\n        <!--日志-->\n        <!--日志 slf4j,log4j,logback,common-logging-->\n        <!--slf4j是规范/接口-->\n        <!--log4j,logback,common-logging是日志实现 本项目使用slf4j + logback -->\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-api</artifactId>\n            <version>1.7.12</version>\n        </dependency>\n        <!--实现slf4j并整合-->\n        <dependency>\n            <groupId>ch.qos.logback</groupId>\n            <artifactId>logback-core</artifactId>\n            <version>1.1.1</version>\n        </dependency>\n        <dependency>\n            <groupId>ch.qos.logback</groupId>\n            <artifactId>logback-classic</artifactId>\n            <version>1.1.1</version>\n        </dependency>\n        <!--数据库相关-->\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <version>5.1.22</version>\n            <!--maven工作范围 驱动在真正工作的时候使用，故生命周期改为runtime-->\n            <scope>runtime</scope>\n        </dependency>\n\n        <!--servlet web相关 jstl1.2以上版本就不需要standard这个包了，\n        不然会报错： TLD skipped. URI: http://java.sun.com/jstl/core_rt is already defined-->\n        <!--<dependency>\n            <groupId>taglibs</groupId>\n            <artifactId>standard</artifactId>\n            <version>1.1.2</version>\n        </dependency>-->\n        <dependency>\n            <groupId>jstl</groupId>\n            <artifactId>jstl</artifactId>\n            <version>1.2</version>\n        </dependency>\n        <dependency>\n            <groupId>com.fasterxml.jackson.core</groupId>\n            <artifactId>jackson-databind</artifactId>\n            <version>2.5.4</version>\n        </dependency>\n\n        <!--spring-->\n        <!--spring核心-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework/spring-asm -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-asm</artifactId>\n            <version>3.1.4.RELEASE</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-context</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring dao-->\n        <!--<dependency>\n            <groupId>org.springframework.data</groupId>\n            <artifactId>spring-data-mongodb</artifactId>\n            <version>1.8.0.RELEASE</version>\n        </dependency>-->\n        <!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-mongodb -->\n        <dependency>\n            <groupId>org.springframework.data</groupId>\n            <artifactId>spring-data-mongodb</artifactId>\n            <version>1.10.1.RELEASE</version>\n        </dependency>\n\n\n        <dependency>\n            <groupId>org.mongodb</groupId>\n            <artifactId>mongo-java-driver</artifactId>\n            <version>3.2.2</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-tx</artifactId>\n            <version>${spring.version}</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework/spring-aop -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-aop</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring web-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-web</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring test-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-test</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-collections</groupId>\n            <artifactId>commons-collections</artifactId>\n            <version>3.2.2</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-fileupload</groupId>\n            <artifactId>commons-fileupload</artifactId>\n            <version>1.3.2</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-codec</groupId>\n            <artifactId>commons-codec</artifactId>\n            <version>1.10</version>\n        </dependency>\n\n        <!-- https://mvnrepository.com/artifact/javax/javaee-api -->\n        <dependency>\n            <groupId>javax</groupId>\n            <artifactId>javaee-api</artifactId>\n            <version>7.0</version>\n            <scope>provided</scope>\n        </dependency>\n\n    </dependencies>\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework</groupId>\n                <artifactId>spring-framework-bom</artifactId>\n                <version>${spring.version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n            <dependency>\n                <groupId>net.sf.ehcache</groupId>\n                <artifactId>ehcache-core</artifactId>\n                <version>2.6.9</version>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n    <build>\n        <finalName>mongo</finalName>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <version>3.3</version>\n                <configuration>\n                    <source>1.6</source>\n                    <target>1.6</target>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n两个实体类：\n\nAddress.java:\n\n```java\npackage com.lewis.mongo.entity;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic class Address {\n\n    private String city;\n    private String street;\n    private int num;\n\n    public Address() {\n    }\n\n    public Address(String city, String street, int num) {\n        this.city = city;\n        this.street = street;\n        this.num = num;\n    }\n\n    public String getCity() {\n        return city;\n    }\n\n    public void setCity(String city) {\n        this.city = city;\n    }\n\n    public String getStreet() {\n        return street;\n    }\n\n    public void setStreet(String street) {\n        this.street = street;\n    }\n\n    public int getNum() {\n        return num;\n    }\n\n    public void setNum(int num) {\n        this.num = num;\n    }\n\n    @Override\n    public String toString() {\n        return \"Address{\" +\n                \"city='\" + city + '\\'' +\n                \", street='\" + street + '\\'' +\n                \", num=\" + num + '}';\n    }\n}\n```\n\nPerson.java:\n\n```java\npackage com.lewis.mongo.entity;\n\nimport java.io.Serializable;\n\nimport org.bson.types.ObjectId;\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@Document(collection = \"person\")\npublic class Person implements Serializable {\n\n    @Id\n    private ObjectId id;\n    private String name;\n    private int age;\n    private Address address;\n\n    public Person() {\n    }\n\n    public Person(String name, int age, Address address) {\n        this.name = name;\n        this.age = age;\n        this.address = address;\n    }\n\n    public ObjectId getId() {\n        return id;\n    }\n\n    public void setId(ObjectId id) {\n        this.id = id;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    public Address getAddress() {\n        return address;\n    }\n\n    public void setAddress(Address address) {\n        this.address = address;\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" + \"id=\" + id +\n                \", name='\" + name + '\\'' +\n                \", age=\" + age +\n                \", address=\" + address + '}';\n    }\n}\n```\n\nJPA的dao，注意这里只要继承MongoRepository不用写注解spring就能认识这是个Repository，MongoRepository提供了基本的增删改查，不用实现便可直接调用，例如testMongo的personDao.save(persons);\n\nPersonDao.java:\n\n```java\npackage com.lewis.mongo.dao;\n\nimport com.lewis.mongo.entity.Person;\nimport org.bson.types.ObjectId;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.data.mongodb.repository.Query;\n\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic interface PersonDao extends MongoRepository<Person, ObjectId> {\n\n    @Query(value = \"{'age' : {'$gte' : ?0, '$lte' : ?1}, 'name' : ?2}\", fields = \"{'name' : 1, 'age' : 1}\")\n    List<Person> findByAge(int age1, int age2, String name);\n}\n\n```\n\nmongoTemplate的dao，PersonMongoDao.java:\n\n```java\npackage com.lewis.mongo.mongoDao;\n\nimport com.lewis.mongo.entity.Person;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic interface PersonMongoDao {\n    List<Person> findAll();\n    void insertPerson(Person user);\n    void removePerson(String userName);\n    void updatePerson();\n    List<Person> findForRequery(String userName);\n}\n```\n\nPersonMongoImpl.java:\n\n```java\npackage com.lewis.mongo.mongoDao;\n\nimport com.lewis.mongo.entity.Person;\nimport org.springframework.data.mongodb.core.MongoTemplate;\nimport org.springframework.data.mongodb.core.query.Query;\nimport org.springframework.data.mongodb.core.query.Update;\nimport org.springframework.data.mongodb.core.query.Criteria;\n\nimport org.springframework.stereotype.Repository;\n\nimport javax.annotation.Resource;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@Repository(\"personMongoImpl\")\npublic class PersonMongoImpl implements PersonMongoDao {\n\n    @Resource\n    private MongoTemplate mongoTemplate;\n\n    @Override\n    public List<Person> findAll() {\n        return mongoTemplate.findAll(Person.class, \"person\");\n    }\n\n    @Override\n    public void insertPerson(Person person) {\n        mongoTemplate.insert(person, \"person\");\n    }\n\n    @Override\n    public void removePerson(String userName) {\n        mongoTemplate.remove(Query.query(Criteria.where(\"name\").is(userName)), \"person\");\n    }\n\n    @Override\n    public void updatePerson() {\n        mongoTemplate.updateMulti(Query.query(Criteria.where(\"age\").gt(3).lte(5)), Update.update(\"age\", 3), \"person\");\n    }\n\n    @Override\n    public List<Person> findForRequery(String userName) {\n        return mongoTemplate.find(Query.query(Criteria.where(\"name\").is(userName)), Person.class);\n    }\n}\n```\n\nJPA查询的测试类，PersonDaoTest.java:\n\n```java\nimport com.lewis.mongo.dao.PersonDao;\nimport com.lewis.mongo.entity.Address;\nimport com.lewis.mongo.entity.Person;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport javax.annotation.Resource;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n//告诉junit spring配置文件\n@ContextConfiguration({\"classpath:spring/spring-context.xml\", \"classpath:spring/spring-mongo.xml\"})\npublic class PersonDaoTest {\n\n    @Resource\n    private PersonDao personDao;\n\n    /*先往数据库中插入10个person*/\n    @Test\n    public void testMongo() {\n        List<Person> persons = new ArrayList<Person>();\n        for (int i = 0; i < 10; i++) {\n            persons.add(new Person(\"name\" + i, i, new Address(\"广州市\", \"天河区\", i)));\n        }\n        personDao.save(persons);\n    }\n\n    @Test\n    public void findMongo() {\n        System.out.println(personDao.findByAge(2, 8, \"name6\"));\n    }\n}\n```\n\nmongoTemplate查询的测试类，MongoTemplateTest.java:\n\n```java\nimport com.lewis.mongo.entity.Address;\nimport com.lewis.mongo.entity.Person;\nimport com.lewis.mongo.mongoDao.PersonMongoImpl;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport javax.annotation.Resource;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n//告诉junit spring配置文件\n@ContextConfiguration({\"classpath:spring/spring-context.xml\", \"classpath:spring/spring-mongo.xml\"})\npublic class MongoTemplateTest {\n    @Resource\n    private PersonMongoImpl personMongo;\n\n    @Test\n    public void testMongoTemplate() {\n\n        //personMongo.insertPerson(new Person(\"Lewis\",24,new Address(\"广州\",\"天河\",20)));\n        personMongo.removePerson(\"name3\");\n        personMongo.updatePerson();\n        System.out.println(personMongo.findAll());\n        System.out.println(personMongo.findForRequery(\"Lewis\"));\n    }\n}\n```\n\n> **注意测试前请先通过`PersonDaoTest.java`中的`testMongo()`方法向数据库中插入数据。**\n\n- **项目源码Git地址，仅供学习使用**：[https://github.com/wonderomg/SpringData-mongdb](https://github.com/wonderomg/SpringData-mongdb)\n- 参考资料：http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/\n- 参考文章：[http://www.imooc.com/article/13777](http://www.imooc.com/article/13777)","source":"_posts/idea搭建springdata+mongodb+maven+springmvc.md","raw":"---\ntitle: idea搭建springdata+mongodb+maven+springmvc\ndate: 2017-6-6\ncategories: \n  - Java\ntags: \n  - SpingMvc\n  - MongoDB\n  - SpringData\n  - idea\n  - maven\nthumbnail: http://pic1.win4000.com/wallpaper/5/5486631edd8b3.jpg\n---\n\n今天我们来学习一下SpringData操作MongoDB。\n项目环境：IntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8 <!--more-->\n\n推荐网站（适合学习各种知识的基础）：[http://www.runoob.com/](http://www.runoob.com/)\n\nmongo安装请参考：http://www.runoob.com/mongodb/mongodb-window-install.html\n\n\n\n## **1. 创建maven工程**\n\n首相创建maven工程，New project:\n![创建maven工程](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-1.png)\n\n![自行填写](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-2.png)\n\n这里不使用idea自带maven插件，改用下载好的3.5.0版maven；\n\n由于最近osChina的maven仓库挂掉，推荐大家使用阿里的镜像，速度快的飞起\n`maven`配置：`D:\\apache-maven-3.5.0\\conf\\setting.xml`中找到`mirrors`:\n\n```xml\n<mirrors>\n    <mirror>\n      <id>alimaven</id>\n      <name>aliyun maven</name>\n      <url>http://maven.aliyun.com/nexus/content/groups/public/</url>\n      <mirrorOf>central</mirrorOf>        \n    </mirror>\n</mirrors>\n```\n\n![选择下好的本地maven3.5.0](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-3.png)\n\n![next](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-4.png)\n\n项目结构如下图，手动创建相关文件夹及文件，并设置文件夹的对应属性：\n\n![工程目录](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-5.png)\n\n![目录结构](https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-6.png)\n\n至此，maven工程创建完毕。\n\n## **2. 访问mongodb数据方式**\n\n这里`dao`与`mongoDao`分别为`mongoDB`的两种查询方式：\n\n> (1) `dao`为`JPA`的查询方式（请参考`springdataJPA`）；\n>\n> (2) `mongoDao`使用`mongoTemplate`，类似于关系型数据库使用的`jdbcTemplate`。\n\n## **3. 详细代码**\n\n先看配置文件\nspring-context.xml为最基本的`spring`配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context.xsd\">\n    <!-- 开启注解 -->\n    <context:annotation-config/>\n    <!--扫描service包嗲所有使用注解的类型-->\n    <context:component-scan base-package=\"com.lewis.mongo\">\n        <context:include-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\"/>\n    </context:component-scan>\n\n    <!-- 导入mongodb的配置文件 -->\n    <import resource=\"spring-mongo.xml\"/>\n</beans>\n```\n\nspring-web.xml为`springmvc`的基本配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans.xsd\n       http://www.springframework.org/schema/mvc\n       http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context-4.0.xsd\">\n    <!--配置springmvc-->\n    <!--1.开启springmvc注解模式-->\n    <context:annotation-config/>\n    <!--简化配置：\n        (1)主动注册DefaultAnnotationHandlerMapping,AnnotationMethodHandlerAdapter\n        (2)提供一系列功能：数据绑定，数字和日期的format @NumberFormt @DataTimeFormat，xml json默认的读写支持-->\n    <mvc:annotation-driven/>\n    <!--servlet-mapping-->\n    <!--2静态资源默认的servlet配置，\n        （1）允许对静态资源的处理：js，gif\n        （2）允许使用“/”做整体映射-->\n    <!-- 容器默认的DefaultServletHandler处理 所有静态内容与无RequestMapping处理的URL-->\n    <mvc:default-servlet-handler/>\n    <!--3:配置jsp 显示viewResolver-->\n    <bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n        <property name=\"viewClass\" value=\"org.springframework.web.servlet.view.JstlView\"/>\n        <property name=\"prefix\" value=\"/WEB-INF/views/\"/>\n        <property name=\"suffix\" value=\".jsp\"/>\n    </bean>\n\n    <!-- 4自动扫描且只扫描@Controller -->\n    <context:component-scan base-package=\"com.lewis.mongo.controller\"/>\n\n    <!-- 定义无需Controller的url<->view直接映射 -->\n    <mvc:view-controller path=\"/\" view-name=\"redirect:/hi/hello\"/>\n</beans>\n```\n\nspring-mongo.xml为mongo配置:\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:mongo=\"http://www.springframework.org/schema/data/mongo\"\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n       http://www.springframework.org/schema/context\n       http://www.springframework.org/schema/context/spring-context.xsd\n       http://www.springframework.org/schema/data/mongo\n       http://www.springframework.org/schema/data/mongo/spring-mongo.xsd\">\n\n    <!-- 加载mongodb的属性配置文件 -->\n    <context:property-placeholder location=\"classpath*:mongo.properties\"/>\n    <!-- spring连接mongodb数据库的配置 -->\n    <mongo:mongo-client replica-set=\"${mongo.hostport}\" id=\"mongo\">\n        <mongo:client-options connections-per-host=\"${mongo.connectionsPerHost}\"\n                              threads-allowed-to-block-for-connection-multiplier=\"${mongo.threadsAllowedToBlockForConnectionMultiplier}\"\n                              connect-timeout=\"${mongo.connectTimeout}\" max-wait-time=\"${mongo.maxWaitTime}\"\n                              socket-timeout=\"${mongo.socketTimeout}\"/>\n    </mongo:mongo-client>\n    <!-- mongo的工厂，通过它来取得mongo实例,dbname为mongodb的数据库名，没有的话会自动创建 -->\n    <mongo:db-factory id=\"mongoDbFactory\" dbname=\"mongoLewis\" mongo-ref=\"mongo\"/>\n\n    <!-- 只要使用这个调用相应的方法操作 -->\n    <bean id=\"mongoTemplate\" class=\"org.springframework.data.mongodb.core.MongoTemplate\">\n        <constructor-arg name=\"mongoDbFactory\" ref=\"mongoDbFactory\"/>\n    </bean>\n    <!-- mongodb bean的仓库目录，会自动扫描扩展了MongoRepository接口的接口进行注入 -->\n    <mongo:repositories base-package=\"com.lewis.mongo\"/>\n</beans>\n```\n\nmongo.properties:\n\n```properties\nmongo.hostport=10.10.16.234:27017  \nmongo.connectionsPerHost=8  \nmongo.threadsAllowedToBlockForConnectionMultiplier=4  \n#连接超时时间\nmongo.connectTimeout=1000  \n#等待时间\nmongo.maxWaitTime=1500  \nmongo.autoConnectRetry=true  \nmongo.socketKeepAlive=true  \n#Socket超时时间\nmongo.socketTimeout=1500  \nmongo.slaveOk=true\n```\n\npom.xml，这里要注意的是`junit`版本需要4.12以上，不然idea会报错；`spring-data-mongodb`版本要1.10.1以上；\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <properties>\n        <!-- spring-framework-bom 版本号-->\n        <spring.version>4.3.8.RELEASE</spring.version>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n    </properties>\n\n    <groupId>com.liu</groupId>\n    <artifactId>mongo</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <packaging>war</packaging>\n\n    <name>mongo Maven Webapp</name>\n    <url>http://maven.apache.org</url>\n    <dependencies>\n        <!--使用junit4，注解的方式测试-->\n        <!--<dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.11</version>\n            <scope>test</scope>\n        </dependency>-->\n        <!-- https://mvnrepository.com/artifact/junit/junit -->\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.12</version>\n            <scope>test</scope>\n        </dependency>\n\n        <!--日志-->\n        <!--日志 slf4j,log4j,logback,common-logging-->\n        <!--slf4j是规范/接口-->\n        <!--log4j,logback,common-logging是日志实现 本项目使用slf4j + logback -->\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-api</artifactId>\n            <version>1.7.12</version>\n        </dependency>\n        <!--实现slf4j并整合-->\n        <dependency>\n            <groupId>ch.qos.logback</groupId>\n            <artifactId>logback-core</artifactId>\n            <version>1.1.1</version>\n        </dependency>\n        <dependency>\n            <groupId>ch.qos.logback</groupId>\n            <artifactId>logback-classic</artifactId>\n            <version>1.1.1</version>\n        </dependency>\n        <!--数据库相关-->\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <version>5.1.22</version>\n            <!--maven工作范围 驱动在真正工作的时候使用，故生命周期改为runtime-->\n            <scope>runtime</scope>\n        </dependency>\n\n        <!--servlet web相关 jstl1.2以上版本就不需要standard这个包了，\n        不然会报错： TLD skipped. URI: http://java.sun.com/jstl/core_rt is already defined-->\n        <!--<dependency>\n            <groupId>taglibs</groupId>\n            <artifactId>standard</artifactId>\n            <version>1.1.2</version>\n        </dependency>-->\n        <dependency>\n            <groupId>jstl</groupId>\n            <artifactId>jstl</artifactId>\n            <version>1.2</version>\n        </dependency>\n        <dependency>\n            <groupId>com.fasterxml.jackson.core</groupId>\n            <artifactId>jackson-databind</artifactId>\n            <version>2.5.4</version>\n        </dependency>\n\n        <!--spring-->\n        <!--spring核心-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-core</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework/spring-asm -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-asm</artifactId>\n            <version>3.1.4.RELEASE</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-beans</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-context</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring dao-->\n        <!--<dependency>\n            <groupId>org.springframework.data</groupId>\n            <artifactId>spring-data-mongodb</artifactId>\n            <version>1.8.0.RELEASE</version>\n        </dependency>-->\n        <!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-mongodb -->\n        <dependency>\n            <groupId>org.springframework.data</groupId>\n            <artifactId>spring-data-mongodb</artifactId>\n            <version>1.10.1.RELEASE</version>\n        </dependency>\n\n\n        <dependency>\n            <groupId>org.mongodb</groupId>\n            <artifactId>mongo-java-driver</artifactId>\n            <version>3.2.2</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-tx</artifactId>\n            <version>${spring.version}</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework/spring-aop -->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-aop</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring web-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-web</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <!--spring test-->\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-test</artifactId>\n            <version>4.3.8.RELEASE</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-collections</groupId>\n            <artifactId>commons-collections</artifactId>\n            <version>3.2.2</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-fileupload</groupId>\n            <artifactId>commons-fileupload</artifactId>\n            <version>1.3.2</version>\n        </dependency>\n        <dependency>\n            <groupId>commons-codec</groupId>\n            <artifactId>commons-codec</artifactId>\n            <version>1.10</version>\n        </dependency>\n\n        <!-- https://mvnrepository.com/artifact/javax/javaee-api -->\n        <dependency>\n            <groupId>javax</groupId>\n            <artifactId>javaee-api</artifactId>\n            <version>7.0</version>\n            <scope>provided</scope>\n        </dependency>\n\n    </dependencies>\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.springframework</groupId>\n                <artifactId>spring-framework-bom</artifactId>\n                <version>${spring.version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n            <dependency>\n                <groupId>net.sf.ehcache</groupId>\n                <artifactId>ehcache-core</artifactId>\n                <version>2.6.9</version>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n    <build>\n        <finalName>mongo</finalName>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <version>3.3</version>\n                <configuration>\n                    <source>1.6</source>\n                    <target>1.6</target>\n                </configuration>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n两个实体类：\n\nAddress.java:\n\n```java\npackage com.lewis.mongo.entity;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic class Address {\n\n    private String city;\n    private String street;\n    private int num;\n\n    public Address() {\n    }\n\n    public Address(String city, String street, int num) {\n        this.city = city;\n        this.street = street;\n        this.num = num;\n    }\n\n    public String getCity() {\n        return city;\n    }\n\n    public void setCity(String city) {\n        this.city = city;\n    }\n\n    public String getStreet() {\n        return street;\n    }\n\n    public void setStreet(String street) {\n        this.street = street;\n    }\n\n    public int getNum() {\n        return num;\n    }\n\n    public void setNum(int num) {\n        this.num = num;\n    }\n\n    @Override\n    public String toString() {\n        return \"Address{\" +\n                \"city='\" + city + '\\'' +\n                \", street='\" + street + '\\'' +\n                \", num=\" + num + '}';\n    }\n}\n```\n\nPerson.java:\n\n```java\npackage com.lewis.mongo.entity;\n\nimport java.io.Serializable;\n\nimport org.bson.types.ObjectId;\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.mongodb.core.mapping.Document;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@Document(collection = \"person\")\npublic class Person implements Serializable {\n\n    @Id\n    private ObjectId id;\n    private String name;\n    private int age;\n    private Address address;\n\n    public Person() {\n    }\n\n    public Person(String name, int age, Address address) {\n        this.name = name;\n        this.age = age;\n        this.address = address;\n    }\n\n    public ObjectId getId() {\n        return id;\n    }\n\n    public void setId(ObjectId id) {\n        this.id = id;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n\n    public int getAge() {\n        return age;\n    }\n\n    public void setAge(int age) {\n        this.age = age;\n    }\n\n    public Address getAddress() {\n        return address;\n    }\n\n    public void setAddress(Address address) {\n        this.address = address;\n    }\n\n    @Override\n    public String toString() {\n        return \"Person{\" + \"id=\" + id +\n                \", name='\" + name + '\\'' +\n                \", age=\" + age +\n                \", address=\" + address + '}';\n    }\n}\n```\n\nJPA的dao，注意这里只要继承MongoRepository不用写注解spring就能认识这是个Repository，MongoRepository提供了基本的增删改查，不用实现便可直接调用，例如testMongo的personDao.save(persons);\n\nPersonDao.java:\n\n```java\npackage com.lewis.mongo.dao;\n\nimport com.lewis.mongo.entity.Person;\nimport org.bson.types.ObjectId;\nimport org.springframework.data.mongodb.repository.MongoRepository;\nimport org.springframework.data.mongodb.repository.Query;\n\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic interface PersonDao extends MongoRepository<Person, ObjectId> {\n\n    @Query(value = \"{'age' : {'$gte' : ?0, '$lte' : ?1}, 'name' : ?2}\", fields = \"{'name' : 1, 'age' : 1}\")\n    List<Person> findByAge(int age1, int age2, String name);\n}\n\n```\n\nmongoTemplate的dao，PersonMongoDao.java:\n\n```java\npackage com.lewis.mongo.mongoDao;\n\nimport com.lewis.mongo.entity.Person;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\npublic interface PersonMongoDao {\n    List<Person> findAll();\n    void insertPerson(Person user);\n    void removePerson(String userName);\n    void updatePerson();\n    List<Person> findForRequery(String userName);\n}\n```\n\nPersonMongoImpl.java:\n\n```java\npackage com.lewis.mongo.mongoDao;\n\nimport com.lewis.mongo.entity.Person;\nimport org.springframework.data.mongodb.core.MongoTemplate;\nimport org.springframework.data.mongodb.core.query.Query;\nimport org.springframework.data.mongodb.core.query.Update;\nimport org.springframework.data.mongodb.core.query.Criteria;\n\nimport org.springframework.stereotype.Repository;\n\nimport javax.annotation.Resource;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@Repository(\"personMongoImpl\")\npublic class PersonMongoImpl implements PersonMongoDao {\n\n    @Resource\n    private MongoTemplate mongoTemplate;\n\n    @Override\n    public List<Person> findAll() {\n        return mongoTemplate.findAll(Person.class, \"person\");\n    }\n\n    @Override\n    public void insertPerson(Person person) {\n        mongoTemplate.insert(person, \"person\");\n    }\n\n    @Override\n    public void removePerson(String userName) {\n        mongoTemplate.remove(Query.query(Criteria.where(\"name\").is(userName)), \"person\");\n    }\n\n    @Override\n    public void updatePerson() {\n        mongoTemplate.updateMulti(Query.query(Criteria.where(\"age\").gt(3).lte(5)), Update.update(\"age\", 3), \"person\");\n    }\n\n    @Override\n    public List<Person> findForRequery(String userName) {\n        return mongoTemplate.find(Query.query(Criteria.where(\"name\").is(userName)), Person.class);\n    }\n}\n```\n\nJPA查询的测试类，PersonDaoTest.java:\n\n```java\nimport com.lewis.mongo.dao.PersonDao;\nimport com.lewis.mongo.entity.Address;\nimport com.lewis.mongo.entity.Person;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport javax.annotation.Resource;\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n//告诉junit spring配置文件\n@ContextConfiguration({\"classpath:spring/spring-context.xml\", \"classpath:spring/spring-mongo.xml\"})\npublic class PersonDaoTest {\n\n    @Resource\n    private PersonDao personDao;\n\n    /*先往数据库中插入10个person*/\n    @Test\n    public void testMongo() {\n        List<Person> persons = new ArrayList<Person>();\n        for (int i = 0; i < 10; i++) {\n            persons.add(new Person(\"name\" + i, i, new Address(\"广州市\", \"天河区\", i)));\n        }\n        personDao.save(persons);\n    }\n\n    @Test\n    public void findMongo() {\n        System.out.println(personDao.findByAge(2, 8, \"name6\"));\n    }\n}\n```\n\nmongoTemplate查询的测试类，MongoTemplateTest.java:\n\n```java\nimport com.lewis.mongo.entity.Address;\nimport com.lewis.mongo.entity.Person;\nimport com.lewis.mongo.mongoDao.PersonMongoImpl;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.test.context.ContextConfiguration;\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\n\nimport javax.annotation.Resource;\n\n/**\n * Created by liu on 2017/6/7.\n */\n@RunWith(SpringJUnit4ClassRunner.class)\n//告诉junit spring配置文件\n@ContextConfiguration({\"classpath:spring/spring-context.xml\", \"classpath:spring/spring-mongo.xml\"})\npublic class MongoTemplateTest {\n    @Resource\n    private PersonMongoImpl personMongo;\n\n    @Test\n    public void testMongoTemplate() {\n\n        //personMongo.insertPerson(new Person(\"Lewis\",24,new Address(\"广州\",\"天河\",20)));\n        personMongo.removePerson(\"name3\");\n        personMongo.updatePerson();\n        System.out.println(personMongo.findAll());\n        System.out.println(personMongo.findForRequery(\"Lewis\"));\n    }\n}\n```\n\n> **注意测试前请先通过`PersonDaoTest.java`中的`testMongo()`方法向数据库中插入数据。**\n\n- **项目源码Git地址，仅供学习使用**：[https://github.com/wonderomg/SpringData-mongdb](https://github.com/wonderomg/SpringData-mongdb)\n- 参考资料：http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/\n- 参考文章：[http://www.imooc.com/article/13777](http://www.imooc.com/article/13777)","slug":"idea搭建springdata+mongodb+maven+springmvc","published":1,"updated":"2018-07-03T14:12:04.322Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkfh000idohg9wccqasi","content":"<p>今天我们来学习一下SpringData操作MongoDB。<br>项目环境：IntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8 <a id=\"more\"></a></p>\n<p>推荐网站（适合学习各种知识的基础）：<a href=\"http://www.runoob.com/\" target=\"_blank\" rel=\"external\">http://www.runoob.com/</a></p>\n<p>mongo安装请参考：<a href=\"http://www.runoob.com/mongodb/mongodb-window-install.html\" target=\"_blank\" rel=\"external\">http://www.runoob.com/mongodb/mongodb-window-install.html</a></p>\n<h2 id=\"1-创建maven工程\"><a href=\"#1-创建maven工程\" class=\"headerlink\" title=\"1. 创建maven工程\"></a><strong>1. 创建maven工程</strong></h2><p>首相创建maven工程，New project:<br><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-1.png\" alt=\"创建maven工程\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-2.png\" alt=\"自行填写\"></p>\n<p>这里不使用idea自带maven插件，改用下载好的3.5.0版maven；</p>\n<p>由于最近osChina的maven仓库挂掉，推荐大家使用阿里的镜像，速度快的飞起<br><code>maven</code>配置：<code>D:\\apache-maven-3.5.0\\conf\\setting.xml</code>中找到<code>mirrors</code>:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mirrors</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mirror</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">mirrorOf</span>&gt;</span>central<span class=\"tag\">&lt;/<span class=\"name\">mirrorOf</span>&gt;</span>        </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mirror</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mirrors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-3.png\" alt=\"选择下好的本地maven3.5.0\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-4.png\" alt=\"next\"></p>\n<p>项目结构如下图，手动创建相关文件夹及文件，并设置文件夹的对应属性：</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-5.png\" alt=\"工程目录\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-6.png\" alt=\"目录结构\"></p>\n<p>至此，maven工程创建完毕。</p>\n<h2 id=\"2-访问mongodb数据方式\"><a href=\"#2-访问mongodb数据方式\" class=\"headerlink\" title=\"2. 访问mongodb数据方式\"></a><strong>2. 访问mongodb数据方式</strong></h2><p>这里<code>dao</code>与<code>mongoDao</code>分别为<code>mongoDB</code>的两种查询方式：</p>\n<blockquote>\n<p>(1) <code>dao</code>为<code>JPA</code>的查询方式（请参考<code>springdataJPA</code>）；</p>\n<p>(2) <code>mongoDao</code>使用<code>mongoTemplate</code>，类似于关系型数据库使用的<code>jdbcTemplate</code>。</p>\n</blockquote>\n<h2 id=\"3-详细代码\"><a href=\"#3-详细代码\" class=\"headerlink\" title=\"3. 详细代码\"></a><strong>3. 详细代码</strong></h2><p>先看配置文件<br>spring-context.xml为最基本的<code>spring</code>配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 开启注解 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--扫描service包嗲所有使用注解的类型--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">context:include-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 导入mongodb的配置文件 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">import</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"spring-mongo.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>spring-web.xml为<code>springmvc</code>的基本配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">       http://www.springframework.org/schema/mvc</div><div class=\"line\">       http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context-4.0.xsd\"&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!--配置springmvc--&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--1.开启springmvc注解模式--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--简化配置：</span></div><div class=\"line\">        (1)主动注册DefaultAnnotationHandlerMapping,AnnotationMethodHandlerAdapter</div><div class=\"line\">        (2)提供一系列功能：数据绑定，数字和日期的format @NumberFormt @DataTimeFormat，xml json默认的读写支持--&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--servlet-mapping--&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--2静态资源默认的servlet配置，</span></div><div class=\"line\">        （1）允许对静态资源的处理：js，gif</div><div class=\"line\">        （2）允许使用“/”做整体映射--&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 容器默认的DefaultServletHandler处理 所有静态内容与无RequestMapping处理的URL--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:default-servlet-handler</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--3:配置jsp 显示viewResolver--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"org.springframework.web.servlet.view.JstlView\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/views/\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 4自动扫描且只扫描@Controller --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo.controller\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 定义无需Controller的url&lt;-&gt;view直接映射 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:view-controller</span> <span class=\"attr\">path</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">view-name</span>=<span class=\"string\">\"redirect:/hi/hello\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>spring-mongo.xml为mongo配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:mongo</span>=<span class=\"string\">\"http://www.springframework.org/schema/data/mongo\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">       http://www.springframework.org/schema/data/mongo</div><div class=\"line\">       http://www.springframework.org/schema/data/mongo/spring-mongo.xsd\"&gt;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 加载mongodb的属性配置文件 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath*:mongo.properties\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- spring连接mongodb数据库的配置 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:mongo-client</span> <span class=\"attr\">replica-set</span>=<span class=\"string\">\"$&#123;mongo.hostport&#125;\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongo\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mongo:client-options</span> <span class=\"attr\">connections-per-host</span>=<span class=\"string\">\"$&#123;mongo.connectionsPerHost&#125;\"</span></span></div><div class=\"line\">                              <span class=\"attr\">threads-allowed-to-block-for-connection-multiplier</span>=<span class=\"string\">\"$&#123;mongo.threadsAllowedToBlockForConnectionMultiplier&#125;\"</span></div><div class=\"line\">                              <span class=\"attr\">connect-timeout</span>=<span class=\"string\">\"$&#123;mongo.connectTimeout&#125;\"</span> <span class=\"attr\">max-wait-time</span>=<span class=\"string\">\"$&#123;mongo.maxWaitTime&#125;\"</span></div><div class=\"line\">                              <span class=\"attr\">socket-timeout</span>=<span class=\"string\">\"$&#123;mongo.socketTimeout&#125;\"</span>/&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mongo:mongo-client</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- mongo的工厂，通过它来取得mongo实例,dbname为mongodb的数据库名，没有的话会自动创建 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:db-factory</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongoDbFactory\"</span> <span class=\"attr\">dbname</span>=<span class=\"string\">\"mongoLewis\"</span> <span class=\"attr\">mongo-ref</span>=<span class=\"string\">\"mongo\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 只要使用这个调用相应的方法操作 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongoTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.data.mongodb.core.MongoTemplate\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mongoDbFactory\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mongoDbFactory\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- mongodb bean的仓库目录，会自动扫描扩展了MongoRepository接口的接口进行注入 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:repositories</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>mongo.properties:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo.hostport=10.10.16.234:27017  </div><div class=\"line\">mongo.connectionsPerHost=8  </div><div class=\"line\">mongo.threadsAllowedToBlockForConnectionMultiplier=4  </div><div class=\"line\">#连接超时时间</div><div class=\"line\">mongo.connectTimeout=1000  </div><div class=\"line\">#等待时间</div><div class=\"line\">mongo.maxWaitTime=1500  </div><div class=\"line\">mongo.autoConnectRetry=true  </div><div class=\"line\">mongo.socketKeepAlive=true  </div><div class=\"line\">#Socket超时时间</div><div class=\"line\">mongo.socketTimeout=1500  </div><div class=\"line\">mongo.slaveOk=true</div></pre></td></tr></table></figure>\n<p>pom.xml，这里要注意的是<code>junit</code>版本需要4.12以上，不然idea会报错；<code>spring-data-mongodb</code>版本要1.10.1以上；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span></span></div><div class=\"line\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- spring-framework-bom 版本号--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.liu<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mongo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mongo Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--使用junit4，注解的方式测试--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;4.11&lt;/version&gt;</div><div class=\"line\">            &lt;scope&gt;test&lt;/scope&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--日志--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--日志 slf4j,log4j,logback,common-logging--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--slf4j是规范/接口--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--log4j,logback,common-logging是日志实现 本项目使用slf4j + logback --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--实现slf4j并整合--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--数据库相关--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.22<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"comment\">&lt;!--maven工作范围 驱动在真正工作的时候使用，故生命周期改为runtime--&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--servlet web相关 jstl1.2以上版本就不需要standard这个包了，</span></div><div class=\"line\">        不然会报错： TLD skipped. URI: http://java.sun.com/jstl/core_rt is already defined--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;taglibs&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;standard&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;1.1.2&lt;/version&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring核心--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-asm --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-asm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring dao--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;1.8.0.RELEASE&lt;/version&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-mongodb --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.data<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.10.1.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mongodb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mongo-java-driver<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-tx<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aop --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aop<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring web--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring test--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/javax/javaee-api --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javaee-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-framework-bom<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.sf.ehcache<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ehcache-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mongo<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>两个实体类：</p>\n<p>Address.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Address</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> String city;</div><div class=\"line\">    <span class=\"keyword\">private</span> String street;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> num;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Address</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Address</span><span class=\"params\">(String city, String street, <span class=\"keyword\">int</span> num)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.city = city;</div><div class=\"line\">        <span class=\"keyword\">this</span>.street = street;</div><div class=\"line\">        <span class=\"keyword\">this</span>.num = num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getCity</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> city;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCity</span><span class=\"params\">(String city)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.city = city;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getStreet</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> street;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setStreet</span><span class=\"params\">(String street)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.street = street;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getNum</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setNum</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.num = num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Address&#123;\"</span> +</div><div class=\"line\">                <span class=\"string\">\"city='\"</span> + city + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", street='\"</span> + street + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", num=\"</span> + num + <span class=\"string\">'&#125;'</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Person.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.bson.types.ObjectId;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.annotation.Id;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.mapping.Document;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Document</span>(collection = <span class=\"string\">\"person\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Id</span></div><div class=\"line\">    <span class=\"keyword\">private</span> ObjectId id;</div><div class=\"line\">    <span class=\"keyword\">private</span> String name;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"keyword\">private</span> Address address;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Person</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Person</span><span class=\"params\">(String name, <span class=\"keyword\">int</span> age, Address address)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ObjectId <span class=\"title\">getId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> id;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setId</span><span class=\"params\">(ObjectId id)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.id = id;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> name;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">(String name)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Address <span class=\"title\">getAddress</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAddress</span><span class=\"params\">(Address address)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Person&#123;\"</span> + <span class=\"string\">\"id=\"</span> + id +</div><div class=\"line\">                <span class=\"string\">\", name='\"</span> + name + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", age=\"</span> + age +</div><div class=\"line\">                <span class=\"string\">\", address=\"</span> + address + <span class=\"string\">'&#125;'</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>JPA的dao，注意这里只要继承MongoRepository不用写注解spring就能认识这是个Repository，MongoRepository提供了基本的增删改查，不用实现便可直接调用，例如testMongo的personDao.save(persons);</p>\n<p>PersonDao.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.dao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.bson.types.ObjectId;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.repository.MongoRepository;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.repository.Query;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonDao</span> <span class=\"keyword\">extends</span> <span class=\"title\">MongoRepository</span>&lt;<span class=\"title\">Person</span>, <span class=\"title\">ObjectId</span>&gt; </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Query</span>(value = <span class=\"string\">\"&#123;'age' : &#123;'$gte' : ?0, '$lte' : ?1&#125;, 'name' : ?2&#125;\"</span>, fields = <span class=\"string\">\"&#123;'name' : 1, 'age' : 1&#125;\"</span>)</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findByAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age1, <span class=\"keyword\">int</span> age2, String name)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>mongoTemplate的dao，PersonMongoDao.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.mongoDao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonMongoDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findAll</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insertPerson</span><span class=\"params\">(Person user)</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">removePerson</span><span class=\"params\">(String userName)</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">updatePerson</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findForRequery</span><span class=\"params\">(String userName)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>PersonMongoImpl.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.mongoDao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Query;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Update;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Criteria;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Repository</span>(<span class=\"string\">\"personMongoImpl\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonMongoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">PersonMongoDao</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Person&gt; <span class=\"title\">findAll</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mongoTemplate.findAll(Person.class, <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertPerson</span><span class=\"params\">(Person person)</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.insert(person, <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removePerson</span><span class=\"params\">(String userName)</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.remove(Query.query(Criteria.where(<span class=\"string\">\"name\"</span>).is(userName)), <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updatePerson</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.updateMulti(Query.query(Criteria.where(<span class=\"string\">\"age\"</span>).gt(<span class=\"number\">3</span>).lte(<span class=\"number\">5</span>)), Update.update(<span class=\"string\">\"age\"</span>, <span class=\"number\">3</span>), <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Person&gt; <span class=\"title\">findForRequery</span><span class=\"params\">(String userName)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mongoTemplate.find(Query.query(Criteria.where(<span class=\"string\">\"name\"</span>).is(userName)), Person.class);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>JPA查询的测试类，PersonDaoTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.dao.PersonDao;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Address;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.ContextConfiguration;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"comment\">//告诉junit spring配置文件</span></div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(&#123;<span class=\"string\">\"classpath:spring/spring-context.xml\"</span>, <span class=\"string\">\"classpath:spring/spring-mongo.xml\"</span>&#125;)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonDaoTest</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> PersonDao personDao;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/*先往数据库中插入10个person*/</span></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMongo</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        List&lt;Person&gt; persons = <span class=\"keyword\">new</span> ArrayList&lt;Person&gt;();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">            persons.add(<span class=\"keyword\">new</span> Person(<span class=\"string\">\"name\"</span> + i, i, <span class=\"keyword\">new</span> Address(<span class=\"string\">\"广州市\"</span>, <span class=\"string\">\"天河区\"</span>, i)));</div><div class=\"line\">        &#125;</div><div class=\"line\">        personDao.save(persons);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">findMongo</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(personDao.findByAge(<span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"string\">\"name6\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>mongoTemplate查询的测试类，MongoTemplateTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Address;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.mongoDao.PersonMongoImpl;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.ContextConfiguration;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"comment\">//告诉junit spring配置文件</span></div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(&#123;<span class=\"string\">\"classpath:spring/spring-context.xml\"</span>, <span class=\"string\">\"classpath:spring/spring-mongo.xml\"</span>&#125;)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MongoTemplateTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> PersonMongoImpl personMongo;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMongoTemplate</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//personMongo.insertPerson(new Person(\"Lewis\",24,new Address(\"广州\",\"天河\",20)));</span></div><div class=\"line\">        personMongo.removePerson(<span class=\"string\">\"name3\"</span>);</div><div class=\"line\">        personMongo.updatePerson();</div><div class=\"line\">        System.out.println(personMongo.findAll());</div><div class=\"line\">        System.out.println(personMongo.findForRequery(<span class=\"string\">\"Lewis\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>注意测试前请先通过<code>PersonDaoTest.java</code>中的<code>testMongo()</code>方法向数据库中插入数据。</strong></p>\n</blockquote>\n<ul>\n<li><strong>项目源码Git地址，仅供学习使用</strong>：<a href=\"https://github.com/wonderomg/SpringData-mongdb\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/SpringData-mongdb</a></li>\n<li>参考资料：<a href=\"http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/\" target=\"_blank\" rel=\"external\">http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/</a></li>\n<li>参考文章：<a href=\"http://www.imooc.com/article/13777\" target=\"_blank\" rel=\"external\">http://www.imooc.com/article/13777</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>今天我们来学习一下SpringData操作MongoDB。<br>项目环境：IntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8","more":"</p>\n<p>推荐网站（适合学习各种知识的基础）：<a href=\"http://www.runoob.com/\" target=\"_blank\" rel=\"external\">http://www.runoob.com/</a></p>\n<p>mongo安装请参考：<a href=\"http://www.runoob.com/mongodb/mongodb-window-install.html\" target=\"_blank\" rel=\"external\">http://www.runoob.com/mongodb/mongodb-window-install.html</a></p>\n<h2 id=\"1-创建maven工程\"><a href=\"#1-创建maven工程\" class=\"headerlink\" title=\"1. 创建maven工程\"></a><strong>1. 创建maven工程</strong></h2><p>首相创建maven工程，New project:<br><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-1.png\" alt=\"创建maven工程\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-2.png\" alt=\"自行填写\"></p>\n<p>这里不使用idea自带maven插件，改用下载好的3.5.0版maven；</p>\n<p>由于最近osChina的maven仓库挂掉，推荐大家使用阿里的镜像，速度快的飞起<br><code>maven</code>配置：<code>D:\\apache-maven-3.5.0\\conf\\setting.xml</code>中找到<code>mirrors</code>:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mirrors</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mirror</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>alimaven<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>aliyun maven<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">mirrorOf</span>&gt;</span>central<span class=\"tag\">&lt;/<span class=\"name\">mirrorOf</span>&gt;</span>        </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mirror</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mirrors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-3.png\" alt=\"选择下好的本地maven3.5.0\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-4.png\" alt=\"next\"></p>\n<p>项目结构如下图，手动创建相关文件夹及文件，并设置文件夹的对应属性：</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-5.png\" alt=\"工程目录\"></p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-6.png\" alt=\"目录结构\"></p>\n<p>至此，maven工程创建完毕。</p>\n<h2 id=\"2-访问mongodb数据方式\"><a href=\"#2-访问mongodb数据方式\" class=\"headerlink\" title=\"2. 访问mongodb数据方式\"></a><strong>2. 访问mongodb数据方式</strong></h2><p>这里<code>dao</code>与<code>mongoDao</code>分别为<code>mongoDB</code>的两种查询方式：</p>\n<blockquote>\n<p>(1) <code>dao</code>为<code>JPA</code>的查询方式（请参考<code>springdataJPA</code>）；</p>\n<p>(2) <code>mongoDao</code>使用<code>mongoTemplate</code>，类似于关系型数据库使用的<code>jdbcTemplate</code>。</p>\n</blockquote>\n<h2 id=\"3-详细代码\"><a href=\"#3-详细代码\" class=\"headerlink\" title=\"3. 详细代码\"></a><strong>3. 详细代码</strong></h2><p>先看配置文件<br>spring-context.xml为最基本的<code>spring</code>配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 开启注解 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--扫描service包嗲所有使用注解的类型--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">context:include-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 导入mongodb的配置文件 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">import</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"spring-mongo.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>spring-web.xml为<code>springmvc</code>的基本配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">       http://www.springframework.org/schema/mvc</div><div class=\"line\">       http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context-4.0.xsd\"&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!--配置springmvc--&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--1.开启springmvc注解模式--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--简化配置：</span></div><div class=\"line\">        (1)主动注册DefaultAnnotationHandlerMapping,AnnotationMethodHandlerAdapter</div><div class=\"line\">        (2)提供一系列功能：数据绑定，数字和日期的format @NumberFormt @DataTimeFormat，xml json默认的读写支持--&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--servlet-mapping--&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--2静态资源默认的servlet配置，</span></div><div class=\"line\">        （1）允许对静态资源的处理：js，gif</div><div class=\"line\">        （2）允许使用“/”做整体映射--&gt;</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 容器默认的DefaultServletHandler处理 所有静态内容与无RequestMapping处理的URL--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:default-servlet-handler</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!--3:配置jsp 显示viewResolver--&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"org.springframework.web.servlet.view.JstlView\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/views/\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 4自动扫描且只扫描@Controller --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo.controller\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 定义无需Controller的url&lt;-&gt;view直接映射 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:view-controller</span> <span class=\"attr\">path</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">view-name</span>=<span class=\"string\">\"redirect:/hi/hello\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>spring-mongo.xml为mongo配置:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:mongo</span>=<span class=\"string\">\"http://www.springframework.org/schema/data/mongo\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></div><div class=\"line\">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</div><div class=\"line\">       http://www.springframework.org/schema/context</div><div class=\"line\">       http://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">       http://www.springframework.org/schema/data/mongo</div><div class=\"line\">       http://www.springframework.org/schema/data/mongo/spring-mongo.xsd\"&gt;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 加载mongodb的属性配置文件 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath*:mongo.properties\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- spring连接mongodb数据库的配置 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:mongo-client</span> <span class=\"attr\">replica-set</span>=<span class=\"string\">\"$&#123;mongo.hostport&#125;\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongo\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mongo:client-options</span> <span class=\"attr\">connections-per-host</span>=<span class=\"string\">\"$&#123;mongo.connectionsPerHost&#125;\"</span></span></div><div class=\"line\">                              <span class=\"attr\">threads-allowed-to-block-for-connection-multiplier</span>=<span class=\"string\">\"$&#123;mongo.threadsAllowedToBlockForConnectionMultiplier&#125;\"</span></div><div class=\"line\">                              <span class=\"attr\">connect-timeout</span>=<span class=\"string\">\"$&#123;mongo.connectTimeout&#125;\"</span> <span class=\"attr\">max-wait-time</span>=<span class=\"string\">\"$&#123;mongo.maxWaitTime&#125;\"</span></div><div class=\"line\">                              <span class=\"attr\">socket-timeout</span>=<span class=\"string\">\"$&#123;mongo.socketTimeout&#125;\"</span>/&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mongo:mongo-client</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- mongo的工厂，通过它来取得mongo实例,dbname为mongodb的数据库名，没有的话会自动创建 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:db-factory</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongoDbFactory\"</span> <span class=\"attr\">dbname</span>=<span class=\"string\">\"mongoLewis\"</span> <span class=\"attr\">mongo-ref</span>=<span class=\"string\">\"mongo\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 只要使用这个调用相应的方法操作 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"mongoTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.data.mongodb.core.MongoTemplate\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mongoDbFactory\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"mongoDbFactory\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- mongodb bean的仓库目录，会自动扫描扩展了MongoRepository接口的接口进行注入 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mongo:repositories</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.lewis.mongo\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>mongo.properties:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo.hostport=10.10.16.234:27017  </div><div class=\"line\">mongo.connectionsPerHost=8  </div><div class=\"line\">mongo.threadsAllowedToBlockForConnectionMultiplier=4  </div><div class=\"line\">#连接超时时间</div><div class=\"line\">mongo.connectTimeout=1000  </div><div class=\"line\">#等待时间</div><div class=\"line\">mongo.maxWaitTime=1500  </div><div class=\"line\">mongo.autoConnectRetry=true  </div><div class=\"line\">mongo.socketKeepAlive=true  </div><div class=\"line\">#Socket超时时间</div><div class=\"line\">mongo.socketTimeout=1500  </div><div class=\"line\">mongo.slaveOk=true</div></pre></td></tr></table></figure>\n<p>pom.xml，这里要注意的是<code>junit</code>版本需要4.12以上，不然idea会报错；<code>spring-data-mongodb</code>版本要1.10.1以上；</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span></span></div><div class=\"line\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- spring-framework-bom 版本号--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.liu<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mongo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mongo Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--使用junit4，注解的方式测试--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;4.11&lt;/version&gt;</div><div class=\"line\">            &lt;scope&gt;test&lt;/scope&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--日志--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--日志 slf4j,log4j,logback,common-logging--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--slf4j是规范/接口--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--log4j,logback,common-logging是日志实现 本项目使用slf4j + logback --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--实现slf4j并整合--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--数据库相关--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.22<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"comment\">&lt;!--maven工作范围 驱动在真正工作的时候使用，故生命周期改为runtime--&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--servlet web相关 jstl1.2以上版本就不需要standard这个包了，</span></div><div class=\"line\">        不然会报错： TLD skipped. URI: http://java.sun.com/jstl/core_rt is already defined--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;taglibs&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;standard&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;1.1.2&lt;/version&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring核心--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-asm --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-asm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring dao--&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--&lt;dependency&gt;</span></div><div class=\"line\">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</div><div class=\"line\">            &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;</div><div class=\"line\">            &lt;version&gt;1.8.0.RELEASE&lt;/version&gt;</div><div class=\"line\">        &lt;/dependency&gt;--&gt;</div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-mongodb --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.data<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.10.1.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mongodb<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mongo-java-driver<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-tx<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aop --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aop<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring web--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!--spring test--&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-codec<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.10<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/javax/javaee-api --&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javaee-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-framework-bom<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>import<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.sf.ehcache<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ehcache-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mongo<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.6<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>两个实体类：</p>\n<p>Address.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Address</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> String city;</div><div class=\"line\">    <span class=\"keyword\">private</span> String street;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> num;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Address</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Address</span><span class=\"params\">(String city, String street, <span class=\"keyword\">int</span> num)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.city = city;</div><div class=\"line\">        <span class=\"keyword\">this</span>.street = street;</div><div class=\"line\">        <span class=\"keyword\">this</span>.num = num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getCity</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> city;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setCity</span><span class=\"params\">(String city)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.city = city;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getStreet</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> street;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setStreet</span><span class=\"params\">(String street)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.street = street;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getNum</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setNum</span><span class=\"params\">(<span class=\"keyword\">int</span> num)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.num = num;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Address&#123;\"</span> +</div><div class=\"line\">                <span class=\"string\">\"city='\"</span> + city + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", street='\"</span> + street + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", num=\"</span> + num + <span class=\"string\">'&#125;'</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Person.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.entity;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.io.Serializable;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.bson.types.ObjectId;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.annotation.Id;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.mapping.Document;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Document</span>(collection = <span class=\"string\">\"person\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Id</span></div><div class=\"line\">    <span class=\"keyword\">private</span> ObjectId id;</div><div class=\"line\">    <span class=\"keyword\">private</span> String name;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"keyword\">private</span> Address address;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Person</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Person</span><span class=\"params\">(String name, <span class=\"keyword\">int</span> age, Address address)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ObjectId <span class=\"title\">getId</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> id;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setId</span><span class=\"params\">(ObjectId id)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.id = id;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> name;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setName</span><span class=\"params\">(String name)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.name = name;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Address <span class=\"title\">getAddress</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAddress</span><span class=\"params\">(Address address)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.address = address;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Person&#123;\"</span> + <span class=\"string\">\"id=\"</span> + id +</div><div class=\"line\">                <span class=\"string\">\", name='\"</span> + name + <span class=\"string\">'\\''</span> +</div><div class=\"line\">                <span class=\"string\">\", age=\"</span> + age +</div><div class=\"line\">                <span class=\"string\">\", address=\"</span> + address + <span class=\"string\">'&#125;'</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>JPA的dao，注意这里只要继承MongoRepository不用写注解spring就能认识这是个Repository，MongoRepository提供了基本的增删改查，不用实现便可直接调用，例如testMongo的personDao.save(persons);</p>\n<p>PersonDao.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.dao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.bson.types.ObjectId;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.repository.MongoRepository;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.repository.Query;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonDao</span> <span class=\"keyword\">extends</span> <span class=\"title\">MongoRepository</span>&lt;<span class=\"title\">Person</span>, <span class=\"title\">ObjectId</span>&gt; </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Query</span>(value = <span class=\"string\">\"&#123;'age' : &#123;'$gte' : ?0, '$lte' : ?1&#125;, 'name' : ?2&#125;\"</span>, fields = <span class=\"string\">\"&#123;'name' : 1, 'age' : 1&#125;\"</span>)</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findByAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age1, <span class=\"keyword\">int</span> age2, String name)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>mongoTemplate的dao，PersonMongoDao.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.mongoDao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonMongoDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findAll</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">insertPerson</span><span class=\"params\">(Person user)</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">removePerson</span><span class=\"params\">(String userName)</span></span>;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">updatePerson</span><span class=\"params\">()</span></span>;</div><div class=\"line\">    <span class=\"function\">List&lt;Person&gt; <span class=\"title\">findForRequery</span><span class=\"params\">(String userName)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>PersonMongoImpl.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.lewis.mongo.mongoDao;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Query;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Update;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.mongodb.core.query.Criteria;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Repository;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Repository</span>(<span class=\"string\">\"personMongoImpl\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonMongoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">PersonMongoDao</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Person&gt; <span class=\"title\">findAll</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mongoTemplate.findAll(Person.class, <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertPerson</span><span class=\"params\">(Person person)</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.insert(person, <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">removePerson</span><span class=\"params\">(String userName)</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.remove(Query.query(Criteria.where(<span class=\"string\">\"name\"</span>).is(userName)), <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updatePerson</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        mongoTemplate.updateMulti(Query.query(Criteria.where(<span class=\"string\">\"age\"</span>).gt(<span class=\"number\">3</span>).lte(<span class=\"number\">5</span>)), Update.update(<span class=\"string\">\"age\"</span>, <span class=\"number\">3</span>), <span class=\"string\">\"person\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Person&gt; <span class=\"title\">findForRequery</span><span class=\"params\">(String userName)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mongoTemplate.find(Query.query(Criteria.where(<span class=\"string\">\"name\"</span>).is(userName)), Person.class);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>JPA查询的测试类，PersonDaoTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.dao.PersonDao;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Address;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.ContextConfiguration;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</div><div class=\"line\"><span class=\"keyword\">import</span> java.util.List;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"comment\">//告诉junit spring配置文件</span></div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(&#123;<span class=\"string\">\"classpath:spring/spring-context.xml\"</span>, <span class=\"string\">\"classpath:spring/spring-mongo.xml\"</span>&#125;)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonDaoTest</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> PersonDao personDao;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/*先往数据库中插入10个person*/</span></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMongo</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        List&lt;Person&gt; persons = <span class=\"keyword\">new</span> ArrayList&lt;Person&gt;();</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">            persons.add(<span class=\"keyword\">new</span> Person(<span class=\"string\">\"name\"</span> + i, i, <span class=\"keyword\">new</span> Address(<span class=\"string\">\"广州市\"</span>, <span class=\"string\">\"天河区\"</span>, i)));</div><div class=\"line\">        &#125;</div><div class=\"line\">        personDao.save(persons);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">findMongo</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(personDao.findByAge(<span class=\"number\">2</span>, <span class=\"number\">8</span>, <span class=\"string\">\"name6\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>mongoTemplate查询的测试类，MongoTemplateTest.java:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Address;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.entity.Person;</div><div class=\"line\"><span class=\"keyword\">import</span> com.lewis.mongo.mongoDao.PersonMongoImpl;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</div><div class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.ContextConfiguration;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * Created by liu on 2017/6/7.</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"comment\">//告诉junit spring配置文件</span></div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(&#123;<span class=\"string\">\"classpath:spring/spring-context.xml\"</span>, <span class=\"string\">\"classpath:spring/spring-mongo.xml\"</span>&#125;)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MongoTemplateTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"meta\">@Resource</span></div><div class=\"line\">    <span class=\"keyword\">private</span> PersonMongoImpl personMongo;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMongoTemplate</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//personMongo.insertPerson(new Person(\"Lewis\",24,new Address(\"广州\",\"天河\",20)));</span></div><div class=\"line\">        personMongo.removePerson(<span class=\"string\">\"name3\"</span>);</div><div class=\"line\">        personMongo.updatePerson();</div><div class=\"line\">        System.out.println(personMongo.findAll());</div><div class=\"line\">        System.out.println(personMongo.findForRequery(<span class=\"string\">\"Lewis\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>注意测试前请先通过<code>PersonDaoTest.java</code>中的<code>testMongo()</code>方法向数据库中插入数据。</strong></p>\n</blockquote>\n<ul>\n<li><strong>项目源码Git地址，仅供学习使用</strong>：<a href=\"https://github.com/wonderomg/SpringData-mongdb\" target=\"_blank\" rel=\"external\">https://github.com/wonderomg/SpringData-mongdb</a></li>\n<li>参考资料：<a href=\"http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/\" target=\"_blank\" rel=\"external\">http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/</a></li>\n<li>参考文章：<a href=\"http://www.imooc.com/article/13777\" target=\"_blank\" rel=\"external\">http://www.imooc.com/article/13777</a></li>\n</ul>"},{"title":"linux-crontab定时执行任务","date":"2017-07-24T16:00:00.000Z","thumbnail":"https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1504806839463&di=ed2ff5d6124b81c51ddfba817b3bc75e&imgtype=0&src=http%3A%2F%2Fimg.25pp.com%2Fuploadfile%2Fapp%2Ficon%2F20160410%2F1460238053403981.jpg","_content":"\n\n\n　　⏱️最近碰到一个关于`crontab`的问题。\n\n<!--more-->\n\n## **1. 事因**\n\n服务器部署了一个`C++`查询数据库词库的服务，以及`Java`发送目标词的服务，`Java`服务通过`soket`长连接向`C++`服务发送目标单词，然后`C++`服务返回数据库中是否存在的结果。\n\n期间，由于数据库有时增加单词需要重启服务，手写了个定时脚本来重启该`C++`服务。\n\n某一次为了调试，把改定时脚本关了，通过`ps -ef |grep xxx`命令查看服务父子进程情况，发现父进程还是每隔十分钟退出，服务会重启，想了许久不知道哪出了问题。\n\n最后询问运维才想起，之前还用了`linux`自带的`crontab`设置过每隔十分钟重启服务，没有删除`crontab`里面的那条设置。\n\n所以我们就来学习一下`linux`自带的可设置定时指定任务的`crontab`。\n\n## **2. 初识crontab**\n`cron`是一个服务进程，`cron`服务提供`crontab`命令来设定`cron`服务的，以下是这个命令的一些参数与说明：\n\n+ `crontab -u  //设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数 `\n+ `crontab -l  //列出某个用户cron服务的详细内容 `\n+ `crontab -r  //删除某个用户的cron服务 `\n+ `crontab -e  //编辑某个用户的cron服务 `\n\n\n\n## **3. 基本用法**\n\n基本格式 :\n\n```shell\n *   *   *   *   *   command\n```\n\n​    **分　时　日　月　周　命令 **\n\n第1列表示分钟1～59 每分钟用*或者 */1表示 ；\n第2列表示小时1～23（0表示0点） ；\n第3列表示日期1～31 ；\n第4列表示月份1～12 ；\n第5列标识号星期0～6（0表示星期天） ；\n第6列要运行的命令 。\n\n`crontab`的一些使用例子:\n\n`*/10 * * * * (cd /opt/resin/bin; ./resin.sh restart)`\n\n表示每隔10分重启`resin`服务；\n\n`30 1 * * * (cd /opt/resin/bin; ./resin.sh restart)`\n\n表示每天1点30分重启`resin`服务；\n\n```* 23-5/1 * * * (cd /opt/resin/bin; ./resin.sh restart)```\n\n表示每天23点到次日5点之间每隔1小时重启`resin`服务；","source":"_posts/linux-crontab定时执行任务.md","raw":"---\ntitle: linux-crontab定时执行任务\ndate: 2017-7-25\ncategories: \n   - linux\ntags:\n   - crontab\nthumbnail: https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1504806839463&di=ed2ff5d6124b81c51ddfba817b3bc75e&imgtype=0&src=http%3A%2F%2Fimg.25pp.com%2Fuploadfile%2Fapp%2Ficon%2F20160410%2F1460238053403981.jpg\n---\n\n\n\n　　⏱️最近碰到一个关于`crontab`的问题。\n\n<!--more-->\n\n## **1. 事因**\n\n服务器部署了一个`C++`查询数据库词库的服务，以及`Java`发送目标词的服务，`Java`服务通过`soket`长连接向`C++`服务发送目标单词，然后`C++`服务返回数据库中是否存在的结果。\n\n期间，由于数据库有时增加单词需要重启服务，手写了个定时脚本来重启该`C++`服务。\n\n某一次为了调试，把改定时脚本关了，通过`ps -ef |grep xxx`命令查看服务父子进程情况，发现父进程还是每隔十分钟退出，服务会重启，想了许久不知道哪出了问题。\n\n最后询问运维才想起，之前还用了`linux`自带的`crontab`设置过每隔十分钟重启服务，没有删除`crontab`里面的那条设置。\n\n所以我们就来学习一下`linux`自带的可设置定时指定任务的`crontab`。\n\n## **2. 初识crontab**\n`cron`是一个服务进程，`cron`服务提供`crontab`命令来设定`cron`服务的，以下是这个命令的一些参数与说明：\n\n+ `crontab -u  //设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数 `\n+ `crontab -l  //列出某个用户cron服务的详细内容 `\n+ `crontab -r  //删除某个用户的cron服务 `\n+ `crontab -e  //编辑某个用户的cron服务 `\n\n\n\n## **3. 基本用法**\n\n基本格式 :\n\n```shell\n *   *   *   *   *   command\n```\n\n​    **分　时　日　月　周　命令 **\n\n第1列表示分钟1～59 每分钟用*或者 */1表示 ；\n第2列表示小时1～23（0表示0点） ；\n第3列表示日期1～31 ；\n第4列表示月份1～12 ；\n第5列标识号星期0～6（0表示星期天） ；\n第6列要运行的命令 。\n\n`crontab`的一些使用例子:\n\n`*/10 * * * * (cd /opt/resin/bin; ./resin.sh restart)`\n\n表示每隔10分重启`resin`服务；\n\n`30 1 * * * (cd /opt/resin/bin; ./resin.sh restart)`\n\n表示每天1点30分重启`resin`服务；\n\n```* 23-5/1 * * * (cd /opt/resin/bin; ./resin.sh restart)```\n\n表示每天23点到次日5点之间每隔1小时重启`resin`服务；","slug":"linux-crontab定时执行任务","published":1,"updated":"2018-06-22T14:09:01.940Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkft000kdohgd0snkvbs","content":"<p>　　⏱️最近碰到一个关于<code>crontab</code>的问题。</p>\n<a id=\"more\"></a>\n<h2 id=\"1-事因\"><a href=\"#1-事因\" class=\"headerlink\" title=\"1. 事因\"></a><strong>1. 事因</strong></h2><p>服务器部署了一个<code>C++</code>查询数据库词库的服务，以及<code>Java</code>发送目标词的服务，<code>Java</code>服务通过<code>soket</code>长连接向<code>C++</code>服务发送目标单词，然后<code>C++</code>服务返回数据库中是否存在的结果。</p>\n<p>期间，由于数据库有时增加单词需要重启服务，手写了个定时脚本来重启该<code>C++</code>服务。</p>\n<p>某一次为了调试，把改定时脚本关了，通过<code>ps -ef |grep xxx</code>命令查看服务父子进程情况，发现父进程还是每隔十分钟退出，服务会重启，想了许久不知道哪出了问题。</p>\n<p>最后询问运维才想起，之前还用了<code>linux</code>自带的<code>crontab</code>设置过每隔十分钟重启服务，没有删除<code>crontab</code>里面的那条设置。</p>\n<p>所以我们就来学习一下<code>linux</code>自带的可设置定时指定任务的<code>crontab</code>。</p>\n<h2 id=\"2-初识crontab\"><a href=\"#2-初识crontab\" class=\"headerlink\" title=\"2. 初识crontab\"></a><strong>2. 初识crontab</strong></h2><p><code>cron</code>是一个服务进程，<code>cron</code>服务提供<code>crontab</code>命令来设定<code>cron</code>服务的，以下是这个命令的一些参数与说明：</p>\n<ul>\n<li><code>crontab -u  //设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数</code></li>\n<li><code>crontab -l  //列出某个用户cron服务的详细内容</code></li>\n<li><code>crontab -r  //删除某个用户的cron服务</code></li>\n<li><code>crontab -e  //编辑某个用户的cron服务</code></li>\n</ul>\n<h2 id=\"3-基本用法\"><a href=\"#3-基本用法\" class=\"headerlink\" title=\"3. 基本用法\"></a><strong>3. 基本用法</strong></h2><p>基本格式 :</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">*   *   *   *   *   command</div></pre></td></tr></table></figure>\n<p>​    <strong>分　时　日　月　周　命令 </strong></p>\n<p>第1列表示分钟1～59 每分钟用<em>或者 </em>/1表示 ；<br>第2列表示小时1～23（0表示0点） ；<br>第3列表示日期1～31 ；<br>第4列表示月份1～12 ；<br>第5列标识号星期0～6（0表示星期天） ；<br>第6列要运行的命令 。</p>\n<p><code>crontab</code>的一些使用例子:</p>\n<p><code>*/10 * * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每隔10分重启<code>resin</code>服务；</p>\n<p><code>30 1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每天1点30分重启<code>resin</code>服务；</p>\n<p><code>* 23-5/1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每天23点到次日5点之间每隔1小时重启<code>resin</code>服务；</p>\n","site":{"data":{}},"excerpt":"<p>　　⏱️最近碰到一个关于<code>crontab</code>的问题。</p>","more":"<h2 id=\"1-事因\"><a href=\"#1-事因\" class=\"headerlink\" title=\"1. 事因\"></a><strong>1. 事因</strong></h2><p>服务器部署了一个<code>C++</code>查询数据库词库的服务，以及<code>Java</code>发送目标词的服务，<code>Java</code>服务通过<code>soket</code>长连接向<code>C++</code>服务发送目标单词，然后<code>C++</code>服务返回数据库中是否存在的结果。</p>\n<p>期间，由于数据库有时增加单词需要重启服务，手写了个定时脚本来重启该<code>C++</code>服务。</p>\n<p>某一次为了调试，把改定时脚本关了，通过<code>ps -ef |grep xxx</code>命令查看服务父子进程情况，发现父进程还是每隔十分钟退出，服务会重启，想了许久不知道哪出了问题。</p>\n<p>最后询问运维才想起，之前还用了<code>linux</code>自带的<code>crontab</code>设置过每隔十分钟重启服务，没有删除<code>crontab</code>里面的那条设置。</p>\n<p>所以我们就来学习一下<code>linux</code>自带的可设置定时指定任务的<code>crontab</code>。</p>\n<h2 id=\"2-初识crontab\"><a href=\"#2-初识crontab\" class=\"headerlink\" title=\"2. 初识crontab\"></a><strong>2. 初识crontab</strong></h2><p><code>cron</code>是一个服务进程，<code>cron</code>服务提供<code>crontab</code>命令来设定<code>cron</code>服务的，以下是这个命令的一些参数与说明：</p>\n<ul>\n<li><code>crontab -u  //设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数</code></li>\n<li><code>crontab -l  //列出某个用户cron服务的详细内容</code></li>\n<li><code>crontab -r  //删除某个用户的cron服务</code></li>\n<li><code>crontab -e  //编辑某个用户的cron服务</code></li>\n</ul>\n<h2 id=\"3-基本用法\"><a href=\"#3-基本用法\" class=\"headerlink\" title=\"3. 基本用法\"></a><strong>3. 基本用法</strong></h2><p>基本格式 :</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">*   *   *   *   *   command</div></pre></td></tr></table></figure>\n<p>​    <strong>分　时　日　月　周　命令 </strong></p>\n<p>第1列表示分钟1～59 每分钟用<em>或者 </em>/1表示 ；<br>第2列表示小时1～23（0表示0点） ；<br>第3列表示日期1～31 ；<br>第4列表示月份1～12 ；<br>第5列标识号星期0～6（0表示星期天） ；<br>第6列要运行的命令 。</p>\n<p><code>crontab</code>的一些使用例子:</p>\n<p><code>*/10 * * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每隔10分重启<code>resin</code>服务；</p>\n<p><code>30 1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每天1点30分重启<code>resin</code>服务；</p>\n<p><code>* 23-5/1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p>\n<p>表示每天23点到次日5点之间每隔1小时重启<code>resin</code>服务；</p>"},{"title":"mongodb学习笔记--$elemMatch操作符的使用","date":"2017-02-20T16:00:00.000Z","thumbnail":"http://www.bigdata-research.org/uploadfile/2014/1113/20141113053033429.jpg?1437154270828","_content":"\n　　mongodb提供了很多操作符以便更加方便快捷地操作数据，下面我们来认识一下查询操作符``$elemMatch``，``$elemMatch``投影操作符将限制查询返回的数组字段的内容只包含匹配``$elemMatch``条件的数组元素。\n\n<!-- more -->\n\n> 注意：\n>\n> * 数组中元素是内嵌文档。\n> * 如果多个元素匹配``$elemMatch``条件，操作符返回数组中第一个匹配条件的元素。\n\n## **1.首先创建一个简单文档**\n\n```javascript\ndb.test.insert({\"id\":1, \"members\":[{\"name\":\"BuleRiver1\", \"age\":27, \"gender\":\"M\"}, {\"name\":\"BuleRiver2\", \"age\":23, \"gender\":\"F\"}, {\"name\":\"BuleRiver3\", \"age\":21, \"gender\":\"M\"}]});\n```\n\n## **2.使用多种方式尝试查询**\n\n(1) 使用``db.test.find({\"members\":{\"name\":\"BuleRiver1\"}});``进行查询：\n\n```javascript\ndb.test.find({\"members\":{\"name\":\"BuleRiver1\"}});\n```\n\n查询的结果是空集。\n\n(2) 只有完全匹配一个的时候才能获取到结果，因此：\n\n```javascript\ndb.test.find({\"members\":{\"name\":\"BuleRiver1\", \"age\":27, \"gender\":\"M\"}});\n```\n\n可以得到结果。\n\n(3) 如果把键值进行颠倒,也得不到结果：\n\n```javascript\ndb.test.find({\"members\":{\"age\":27, \"name\":\"BuleRiver1\", \"gender\":\"M\"}});\n```\n\n得到的结果是空集。\n\n(4) 我们这样查询：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\"});\n```\n\n是可以查询出结果的。\n\n(5) 如果需要两个属性：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\", \"members.age\":27});\n```\n\n也可以查询出结果。\n\n(6) 我们再进行破坏性尝试：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\", \"members.age\":23});\n```\n\n也可以查询出结果。\n\n不过我们应该注意到：``BuleRiver1``是数组中第一个元素的键值，而23是数组中第二个元素的键值，这样也可以查询出结果。\n\n## **3.使用$elemMatch操作符查询**\n\n　　对于我们的一些应用来说，以上结果显然不是我们想要的结果。所以我们应该使用``$elemMatch``操作符:\n\n(1)``$elemMatch+同一个元素中的键值组合\n\n```javascript\ndb.test.find({\"members\":{\"$elemMatch\":{\"name\":\"BuleRiver1\", \"age\":27}}});\n```\n\n可以查询出结果；\n\n(2)``$elemMatch``+不同元素的键值组合\n\n```javascript\ndb.test.find({\"members\":{\"$elemMatch\":{\"name\":\"BuleRiver1\", \"age\":23}}});\n```\n\n查询不出结果。\n\n因此，(1)展示的嵌套查询正是我们想要的查询方式。","source":"_posts/mongodb学习笔记--$elemMatch操作符的使用.md","raw":"---\ntitle: mongodb学习笔记--$elemMatch操作符的使用\ndate: 2017-02-21\ncategories: \n  - mongodb\ntags: \n  - elemMatch条件操作符\nthumbnail: http://www.bigdata-research.org/uploadfile/2014/1113/20141113053033429.jpg?1437154270828\n---\n\n　　mongodb提供了很多操作符以便更加方便快捷地操作数据，下面我们来认识一下查询操作符``$elemMatch``，``$elemMatch``投影操作符将限制查询返回的数组字段的内容只包含匹配``$elemMatch``条件的数组元素。\n\n<!-- more -->\n\n> 注意：\n>\n> * 数组中元素是内嵌文档。\n> * 如果多个元素匹配``$elemMatch``条件，操作符返回数组中第一个匹配条件的元素。\n\n## **1.首先创建一个简单文档**\n\n```javascript\ndb.test.insert({\"id\":1, \"members\":[{\"name\":\"BuleRiver1\", \"age\":27, \"gender\":\"M\"}, {\"name\":\"BuleRiver2\", \"age\":23, \"gender\":\"F\"}, {\"name\":\"BuleRiver3\", \"age\":21, \"gender\":\"M\"}]});\n```\n\n## **2.使用多种方式尝试查询**\n\n(1) 使用``db.test.find({\"members\":{\"name\":\"BuleRiver1\"}});``进行查询：\n\n```javascript\ndb.test.find({\"members\":{\"name\":\"BuleRiver1\"}});\n```\n\n查询的结果是空集。\n\n(2) 只有完全匹配一个的时候才能获取到结果，因此：\n\n```javascript\ndb.test.find({\"members\":{\"name\":\"BuleRiver1\", \"age\":27, \"gender\":\"M\"}});\n```\n\n可以得到结果。\n\n(3) 如果把键值进行颠倒,也得不到结果：\n\n```javascript\ndb.test.find({\"members\":{\"age\":27, \"name\":\"BuleRiver1\", \"gender\":\"M\"}});\n```\n\n得到的结果是空集。\n\n(4) 我们这样查询：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\"});\n```\n\n是可以查询出结果的。\n\n(5) 如果需要两个属性：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\", \"members.age\":27});\n```\n\n也可以查询出结果。\n\n(6) 我们再进行破坏性尝试：\n\n```javascript\ndb.test.find({\"members.name\":\"BuleRiver1\", \"members.age\":23});\n```\n\n也可以查询出结果。\n\n不过我们应该注意到：``BuleRiver1``是数组中第一个元素的键值，而23是数组中第二个元素的键值，这样也可以查询出结果。\n\n## **3.使用$elemMatch操作符查询**\n\n　　对于我们的一些应用来说，以上结果显然不是我们想要的结果。所以我们应该使用``$elemMatch``操作符:\n\n(1)``$elemMatch+同一个元素中的键值组合\n\n```javascript\ndb.test.find({\"members\":{\"$elemMatch\":{\"name\":\"BuleRiver1\", \"age\":27}}});\n```\n\n可以查询出结果；\n\n(2)``$elemMatch``+不同元素的键值组合\n\n```javascript\ndb.test.find({\"members\":{\"$elemMatch\":{\"name\":\"BuleRiver1\", \"age\":23}}});\n```\n\n查询不出结果。\n\n因此，(1)展示的嵌套查询正是我们想要的查询方式。","slug":"mongodb学习笔记--$elemMatch操作符的使用","published":1,"updated":"2017-07-13T14:34:42.732Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkg8000ndohgkopkjltk","content":"<p>　　mongodb提供了很多操作符以便更加方便快捷地操作数据，下面我们来认识一下查询操作符<code>$elemMatch</code>，<code>$elemMatch</code>投影操作符将限制查询返回的数组字段的内容只包含匹配<code>$elemMatch</code>条件的数组元素。</p>\n<a id=\"more\"></a>\n<blockquote>\n<p>注意：</p>\n<ul>\n<li>数组中元素是内嵌文档。</li>\n<li>如果多个元素匹配<code>$elemMatch</code>条件，操作符返回数组中第一个匹配条件的元素。</li>\n</ul>\n</blockquote>\n<h2 id=\"1-首先创建一个简单文档\"><a href=\"#1-首先创建一个简单文档\" class=\"headerlink\" title=\"1.首先创建一个简单文档\"></a><strong>1.首先创建一个简单文档</strong></h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.insert(&#123;<span class=\"string\">\"id\"</span>:<span class=\"number\">1</span>, <span class=\"string\">\"members\"</span>:[&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;, &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver2\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">23</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"F\"</span>&#125;, &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver3\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">21</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;]&#125;);</div></pre></td></tr></table></figure>\n<h2 id=\"2-使用多种方式尝试查询\"><a href=\"#2-使用多种方式尝试查询\" class=\"headerlink\" title=\"2.使用多种方式尝试查询\"></a><strong>2.使用多种方式尝试查询</strong></h2><p>(1) 使用<code>db.test.find({&quot;members&quot;:{&quot;name&quot;:&quot;BuleRiver1&quot;}});</code>进行查询：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>查询的结果是空集。</p>\n<p>(2) 只有完全匹配一个的时候才能获取到结果，因此：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>可以得到结果。</p>\n<p>(3) 如果把键值进行颠倒,也得不到结果：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>得到的结果是空集。</p>\n<p>(4) 我们这样查询：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>&#125;);</div></pre></td></tr></table></figure>\n<p>是可以查询出结果的。</p>\n<p>(5) 如果需要两个属性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"members.age\"</span>:<span class=\"number\">27</span>&#125;);</div></pre></td></tr></table></figure>\n<p>也可以查询出结果。</p>\n<p>(6) 我们再进行破坏性尝试：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"members.age\"</span>:<span class=\"number\">23</span>&#125;);</div></pre></td></tr></table></figure>\n<p>也可以查询出结果。</p>\n<p>不过我们应该注意到：<code>BuleRiver1</code>是数组中第一个元素的键值，而23是数组中第二个元素的键值，这样也可以查询出结果。</p>\n<h2 id=\"3-使用-elemMatch操作符查询\"><a href=\"#3-使用-elemMatch操作符查询\" class=\"headerlink\" title=\"3.使用$elemMatch操作符查询\"></a><strong>3.使用$elemMatch操作符查询</strong></h2><p>　　对于我们的一些应用来说，以上结果显然不是我们想要的结果。所以我们应该使用<code>$elemMatch</code>操作符:</p>\n<p>(1)``$elemMatch+同一个元素中的键值组合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"$elemMatch\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>&#125;&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>可以查询出结果；</p>\n<p>(2)<code>$elemMatch</code>+不同元素的键值组合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"$elemMatch\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">23</span>&#125;&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>查询不出结果。</p>\n<p>因此，(1)展示的嵌套查询正是我们想要的查询方式。</p>\n","site":{"data":{}},"excerpt":"<p>　　mongodb提供了很多操作符以便更加方便快捷地操作数据，下面我们来认识一下查询操作符<code>$elemMatch</code>，<code>$elemMatch</code>投影操作符将限制查询返回的数组字段的内容只包含匹配<code>$elemMatch</code>条件的数组元素。</p>","more":"<blockquote>\n<p>注意：</p>\n<ul>\n<li>数组中元素是内嵌文档。</li>\n<li>如果多个元素匹配<code>$elemMatch</code>条件，操作符返回数组中第一个匹配条件的元素。</li>\n</ul>\n</blockquote>\n<h2 id=\"1-首先创建一个简单文档\"><a href=\"#1-首先创建一个简单文档\" class=\"headerlink\" title=\"1.首先创建一个简单文档\"></a><strong>1.首先创建一个简单文档</strong></h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.insert(&#123;<span class=\"string\">\"id\"</span>:<span class=\"number\">1</span>, <span class=\"string\">\"members\"</span>:[&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;, &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver2\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">23</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"F\"</span>&#125;, &#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver3\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">21</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;]&#125;);</div></pre></td></tr></table></figure>\n<h2 id=\"2-使用多种方式尝试查询\"><a href=\"#2-使用多种方式尝试查询\" class=\"headerlink\" title=\"2.使用多种方式尝试查询\"></a><strong>2.使用多种方式尝试查询</strong></h2><p>(1) 使用<code>db.test.find({&quot;members&quot;:{&quot;name&quot;:&quot;BuleRiver1&quot;}});</code>进行查询：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>查询的结果是空集。</p>\n<p>(2) 只有完全匹配一个的时候才能获取到结果，因此：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>可以得到结果。</p>\n<p>(3) 如果把键值进行颠倒,也得不到结果：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>, <span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"gender\"</span>:<span class=\"string\">\"M\"</span>&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>得到的结果是空集。</p>\n<p>(4) 我们这样查询：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>&#125;);</div></pre></td></tr></table></figure>\n<p>是可以查询出结果的。</p>\n<p>(5) 如果需要两个属性：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"members.age\"</span>:<span class=\"number\">27</span>&#125;);</div></pre></td></tr></table></figure>\n<p>也可以查询出结果。</p>\n<p>(6) 我们再进行破坏性尝试：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members.name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"members.age\"</span>:<span class=\"number\">23</span>&#125;);</div></pre></td></tr></table></figure>\n<p>也可以查询出结果。</p>\n<p>不过我们应该注意到：<code>BuleRiver1</code>是数组中第一个元素的键值，而23是数组中第二个元素的键值，这样也可以查询出结果。</p>\n<h2 id=\"3-使用-elemMatch操作符查询\"><a href=\"#3-使用-elemMatch操作符查询\" class=\"headerlink\" title=\"3.使用$elemMatch操作符查询\"></a><strong>3.使用$elemMatch操作符查询</strong></h2><p>　　对于我们的一些应用来说，以上结果显然不是我们想要的结果。所以我们应该使用<code>$elemMatch</code>操作符:</p>\n<p>(1)``$elemMatch+同一个元素中的键值组合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"$elemMatch\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">27</span>&#125;&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>可以查询出结果；</p>\n<p>(2)<code>$elemMatch</code>+不同元素的键值组合</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">db.test.find(&#123;<span class=\"string\">\"members\"</span>:&#123;<span class=\"string\">\"$elemMatch\"</span>:&#123;<span class=\"string\">\"name\"</span>:<span class=\"string\">\"BuleRiver1\"</span>, <span class=\"string\">\"age\"</span>:<span class=\"number\">23</span>&#125;&#125;&#125;);</div></pre></td></tr></table></figure>\n<p>查询不出结果。</p>\n<p>因此，(1)展示的嵌套查询正是我们想要的查询方式。</p>"},{"title":"mongodb学习笔记--C++操作mongodb","date":"2016-11-09T16:00:00.000Z","thumbnail":"http://bizhi.zhuoku.com/2015/04/29/zhuoku/ZHUOKU005.jpg","_content":"\n　　在学习mongodb过程当中，必须学习的就是用C++（Java、PHP、C#等）操作mongodb，这里讲述C++操作mongodb，在官方提供的mongo-cxx-driver驱动中有相关的操作例子，可以结合例子学习，目录是``mongo-cxx-driver-legacy-1.0.0-rc0\\src\\mongo\\client\\examples``，这里针对几个重要的点讲述。\n\n<!-- more -->\n\n##  **1. C++连接mongodb**\n\n**（1）<font color=#0000FF>有无密码都适用</font>**\n```C++\nmongo::client::GlobalInstance instance;\nif (!instance.initialized()) {\n\tstd::cout << \"failed to initialize the client driver: \" << instance.status() << std::endl;\n    return EXIT_FAILURE;\n}\n\nstd::string uri = \"mongodb://username:password@127.0.0.1:27017\";\nstd::string errmsg;\n\nConnectionString cs = ConnectionString::parse(uri, errmsg);\n\nif (!cs.isValid()) {\n\tstd::cout << \"Error parsing connection string \" << uri << \": \" << errmsg << std::endl;\n    return EXIT_FAILURE;\n}\n\nboost::scoped_ptr<DBClientBase> conn(cs.connect(errmsg));\nif (!conn) {\n\tcout << \"couldn't connect : \" << errmsg << endl;\n\treturn EXIT_FAILURE;\n}\n```\n　　<font color=#0000FF>这种方式有密码和无密码的情况都适用，``\"username\"``为登录名，``\"password\"``为登录密码；无密码时去掉``\"username:password@\"``即可连接，这样连接方式比较常用。</font>\n\n**（2）常规连接操作（不带密码连接）**\n```C++\nmongo::DBClientConnection conn; \nmongo::Status status = mongo::client::initialize();\nif (!status.isOK()) {\n\tMongoException m(-1, \"failed to initialize the client driver: \" + status.toString());\n\treturn -1;\n}\nstring url = \"localhost:27017\";\nif (!conn.connect(url, errmsg)) {\n\tMongoException m(0, \"couldn’t connect : \" + errmsg);\n\treturn -1;\n}\n```\n通过这种方式可建立与mongodb的连接，但是是未带权限的连接。\n\n**（3）带密码连接**\n```C++\nconn.auth( \"admin\" , \"username\" , \"password\" , errmsg );\n```\n　　其中``\"admin\"``为验证用户的所在数据库，一般在``\"test.system.users\"``或``\"admin.system.users\"``表中，所以填库名``\"test\"``或``\"admin\"``，``\"username\"``为登录名，``\"password\"``为登录密码。\n或者下面的auth方式也可以：\n\n```C++\nconn.auth(BSON(\n\t\"user\" << \"root\" << \"db\" << \"admin\" <<\n\t\"pwd\" << \"password\" << \"mechanism\" << \"DEFAULT\"\n));\n```\n根据mongodb的设置更改传递给函数``conn.auth``的参数值。\n\n##  **2. C++查询数据**\n```C++\nconst char* ns = \"test.first\";\nconn->findOne(ns, BSONObj()); //查询一条数据\nconn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()); //条件查询\n```\n\n##  **3. C++插入数据**\n```C++\nconst char* ns = \"test.first\";\nconn->insert(ns, BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"123456\" \n                      << \"age\" << 20));\n```\n\n##  **4. C++删除数据**\n```C++\nconst char* ns = \"test.first\";\nconn->remove(ns, BSONObj()); //删除所有\nconn->remove(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()); //删除指定文档\n```\n\n##  **5. C++更新数据**\n\n**(1) 在原数据基础上增加属性**\n```C++\nconst char* ns = \"test.first\";\nBSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\nBSONObj after = BSONObjBuilder().appendElements(res).append(\"name2\", \"h\").obj();\nconn->update(ns, BSONObjBuilder().append(\"name\", \"jeo2\").obj(), after);\t//在原数据上增加属性\n```\n这种update方式只是在原数据基础上增加属性，并不会改变指定属性值。\n**(2) 更改指定的某个属性值**\n**<font color=red>想要update指定属性的值，需要用到\"$set\"指令</font>**，如下代码所示：\n```C++\nBSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n//更改指定的某个属性值\nconn->update(\"test.first\", res, BSON(\"$set\" << BSON(\"age\" << 11)));\n```\n<font color=#0000FF>主要想强调下update更改指定的某个属性值的方式，比较常用。</font>\n\n##  **6. C++操作例子**\n(1) simple_client_test.cpp\n```C++\n/*\n#if defined(_WIN32)\n#include <winsock2.h>\n#include <windows.h>\n#endif*/\n//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test\n#include \"mongo/client/dbclient.h\"  // the mongo c++ driver\n\n#include <iostream>\n\n#ifndef verify\n#define verify(x) MONGO_verify(x)\n#endif\n\nusing namespace std;\nusing namespace mongo;\n//using mongo::BSONObj;\n//using mongo::BSONObjBuilder;\n\nint main(int argc, char* argv[]) {\n    if (argc > 2) {\n        std::cout << \"usage: \" << argv[0] << \" [MONGODB_URI]\" << std::endl;\n        return EXIT_FAILURE;\n    }\n    \n    mongo::client::GlobalInstance instance;\n    if (!instance.initialized()) {\n        std::cout << \"failed to initialize the client driver: \" << instance.status() << std::endl;\n        return EXIT_FAILURE;\n    }\n\n    std::string uri = argc == 2 ? argv[1] : \"mongodb://127.0.0.1:27017\";\n    std::string errmsg;\n\n    ConnectionString cs = ConnectionString::parse(uri, errmsg);\n\n    if (!cs.isValid()) {\n        std::cout << \"Error parsing connection string \" << uri << \": \" << errmsg << std::endl;\n        return EXIT_FAILURE;\n    }\n\n    boost::scoped_ptr<DBClientBase> conn(cs.connect(errmsg));\n    if (!conn) {\n        cout << \"couldn't connect : \" << errmsg << endl;\n        return EXIT_FAILURE;\n    }\n\n    const char* ns = \"test.first\";\n\n    conn->dropCollection(ns);\n    \n    //clean up old data from any previous tesets\n    conn->remove(ns, BSONObj());\n    verify(conn->findOne(ns, BSONObj()).isEmpty()); //verify逻辑表达式，判断是否还存在test.first，是否clenn up成功\n    \n    //test insert\n    cout << \"(1) test insert----\" << endl;\n    conn->insert(ns, \n                 BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"123456\" \n                      << \"age\" << 20));\n    verify(!conn->findOne(ns, BSONObj()).isEmpty());     //判断是否添加成功\n    cout << \"insert data : \" << conn->findOne(ns, BSONObj()) << endl;\n    cout << \"insert success!\" << endl;\n\n    // test remove\n    cout << \"(2) test remove----\" << endl;\n    conn->remove(ns, BSONObj());\n    verify(conn->findOne(ns, BSONObj()).isEmpty());\n    cout << \"remove success!\" << endl;\n    \n    // insert, findOne testing\n    conn->insert(ns, \n                 BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"234567\" \n                      << \"age\" << 21));\n    {\n        BSONObj res = conn->findOne(ns, BSONObj());\n        verify(strstr(res.getStringField(\"name\"), \"joe\"));\n        verify(!strstr(res.getStringField(\"name2\"), \"joe\"));\n        verify(21 == res.getIntField(\"age\"));\n    }\n    cout << \"insert data : \" << conn->findOne(ns, BSONObj()) <<endl;\n\n    // test update\n    {\n        BSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n        verify(!strstr(res.getStringField(\"name2\"), \"jeo\"));\n        \n        BSONObj after = BSONObjBuilder().appendElements(res).append(\"name2\", \"w\").obj();\n        cout << \"(3) test update name joe add name2 name3----\" << endl;\n        //upsert type1 update method\n        conn->update(ns, BSONObjBuilder().append(\"name\", \"joe\").obj(), after);\n        //res = conn->findOne(ns, BSONObjBuilder().append(\"name2\", \"w\").obj());\n        verify(!strstr(res.getStringField(\"name2\"), \"joe\"));\n        verify(conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe2\").obj()).isEmpty());\n        //cout << \" update1 data: \" << conn->findOne(ns, BSONObj()) << endl;\n        cout << \" update1 data : \" << conn->findOne(ns, Query(\"{name2:'w'}\")) << endl;\n        \n        //upsert type2 update method 更改指定的某个属性值 \n        const string TEST_NS = \"test.first\";\n        conn->update(\"test.first\", res, BSON(\"$set\" << BSON(\"age\" << 11)));\n        cout << \" update2 data : \" << conn->findOne(ns, BSONObj()) << endl;\n        res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n\n        //upsert type3 update method\n        try\n        {\n            after = BSONObjBuilder().appendElements(res).append(\"name3\", \"h\").obj();\n            conn->update(ns, BSONObjBuilder().append(\"name\", \"joe\").obj(), after);\n        }\n        catch (OperationException&)\n        {\n            cout << \" update error: \" << conn->getLastErrorDetailed().toString() << endl;\n        }\n        verify(!conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()).isEmpty());\n        //cout << \" update3 data: \" << conn->findOne(ns, BSONObj()) << endl;\n        cout << \" update3 data : \" << conn->findOne(ns, Query(\"{name3:'h'}\")) << endl;\n\n        cout << \"(4) test query-----\" << \"\\n query data : \" \n            << conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()) << endl;\n        cout << \" Query data : \" << conn->findOne(ns, Query(\"{name:'joe'}\")) << endl;\n    }\n\n    return 0;\n}\n\n```\n(2) makefile文件\n```\nCC = g++\nTEST = simple_client_test\n\n$(TEST):\n\t$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@\n\t./$(TEST)\n\trm -f $(TEST)\nrun:\n\t./$(TEST)\n\nclean:\n\trm -f $(TEST)\n```","source":"_posts/mongodb学习笔记--C++操作mongodb.md","raw":"---\ntitle: mongodb学习笔记--C++操作mongodb\ndate: 2016-11-10\ncategories: \n  - C++\n  - MongoDB\ntags: \n  - mongodb\n  - C++\nthumbnail: http://bizhi.zhuoku.com/2015/04/29/zhuoku/ZHUOKU005.jpg\n---\n\n　　在学习mongodb过程当中，必须学习的就是用C++（Java、PHP、C#等）操作mongodb，这里讲述C++操作mongodb，在官方提供的mongo-cxx-driver驱动中有相关的操作例子，可以结合例子学习，目录是``mongo-cxx-driver-legacy-1.0.0-rc0\\src\\mongo\\client\\examples``，这里针对几个重要的点讲述。\n\n<!-- more -->\n\n##  **1. C++连接mongodb**\n\n**（1）<font color=#0000FF>有无密码都适用</font>**\n```C++\nmongo::client::GlobalInstance instance;\nif (!instance.initialized()) {\n\tstd::cout << \"failed to initialize the client driver: \" << instance.status() << std::endl;\n    return EXIT_FAILURE;\n}\n\nstd::string uri = \"mongodb://username:password@127.0.0.1:27017\";\nstd::string errmsg;\n\nConnectionString cs = ConnectionString::parse(uri, errmsg);\n\nif (!cs.isValid()) {\n\tstd::cout << \"Error parsing connection string \" << uri << \": \" << errmsg << std::endl;\n    return EXIT_FAILURE;\n}\n\nboost::scoped_ptr<DBClientBase> conn(cs.connect(errmsg));\nif (!conn) {\n\tcout << \"couldn't connect : \" << errmsg << endl;\n\treturn EXIT_FAILURE;\n}\n```\n　　<font color=#0000FF>这种方式有密码和无密码的情况都适用，``\"username\"``为登录名，``\"password\"``为登录密码；无密码时去掉``\"username:password@\"``即可连接，这样连接方式比较常用。</font>\n\n**（2）常规连接操作（不带密码连接）**\n```C++\nmongo::DBClientConnection conn; \nmongo::Status status = mongo::client::initialize();\nif (!status.isOK()) {\n\tMongoException m(-1, \"failed to initialize the client driver: \" + status.toString());\n\treturn -1;\n}\nstring url = \"localhost:27017\";\nif (!conn.connect(url, errmsg)) {\n\tMongoException m(0, \"couldn’t connect : \" + errmsg);\n\treturn -1;\n}\n```\n通过这种方式可建立与mongodb的连接，但是是未带权限的连接。\n\n**（3）带密码连接**\n```C++\nconn.auth( \"admin\" , \"username\" , \"password\" , errmsg );\n```\n　　其中``\"admin\"``为验证用户的所在数据库，一般在``\"test.system.users\"``或``\"admin.system.users\"``表中，所以填库名``\"test\"``或``\"admin\"``，``\"username\"``为登录名，``\"password\"``为登录密码。\n或者下面的auth方式也可以：\n\n```C++\nconn.auth(BSON(\n\t\"user\" << \"root\" << \"db\" << \"admin\" <<\n\t\"pwd\" << \"password\" << \"mechanism\" << \"DEFAULT\"\n));\n```\n根据mongodb的设置更改传递给函数``conn.auth``的参数值。\n\n##  **2. C++查询数据**\n```C++\nconst char* ns = \"test.first\";\nconn->findOne(ns, BSONObj()); //查询一条数据\nconn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()); //条件查询\n```\n\n##  **3. C++插入数据**\n```C++\nconst char* ns = \"test.first\";\nconn->insert(ns, BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"123456\" \n                      << \"age\" << 20));\n```\n\n##  **4. C++删除数据**\n```C++\nconst char* ns = \"test.first\";\nconn->remove(ns, BSONObj()); //删除所有\nconn->remove(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()); //删除指定文档\n```\n\n##  **5. C++更新数据**\n\n**(1) 在原数据基础上增加属性**\n```C++\nconst char* ns = \"test.first\";\nBSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\nBSONObj after = BSONObjBuilder().appendElements(res).append(\"name2\", \"h\").obj();\nconn->update(ns, BSONObjBuilder().append(\"name\", \"jeo2\").obj(), after);\t//在原数据上增加属性\n```\n这种update方式只是在原数据基础上增加属性，并不会改变指定属性值。\n**(2) 更改指定的某个属性值**\n**<font color=red>想要update指定属性的值，需要用到\"$set\"指令</font>**，如下代码所示：\n```C++\nBSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n//更改指定的某个属性值\nconn->update(\"test.first\", res, BSON(\"$set\" << BSON(\"age\" << 11)));\n```\n<font color=#0000FF>主要想强调下update更改指定的某个属性值的方式，比较常用。</font>\n\n##  **6. C++操作例子**\n(1) simple_client_test.cpp\n```C++\n/*\n#if defined(_WIN32)\n#include <winsock2.h>\n#include <windows.h>\n#endif*/\n//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test\n#include \"mongo/client/dbclient.h\"  // the mongo c++ driver\n\n#include <iostream>\n\n#ifndef verify\n#define verify(x) MONGO_verify(x)\n#endif\n\nusing namespace std;\nusing namespace mongo;\n//using mongo::BSONObj;\n//using mongo::BSONObjBuilder;\n\nint main(int argc, char* argv[]) {\n    if (argc > 2) {\n        std::cout << \"usage: \" << argv[0] << \" [MONGODB_URI]\" << std::endl;\n        return EXIT_FAILURE;\n    }\n    \n    mongo::client::GlobalInstance instance;\n    if (!instance.initialized()) {\n        std::cout << \"failed to initialize the client driver: \" << instance.status() << std::endl;\n        return EXIT_FAILURE;\n    }\n\n    std::string uri = argc == 2 ? argv[1] : \"mongodb://127.0.0.1:27017\";\n    std::string errmsg;\n\n    ConnectionString cs = ConnectionString::parse(uri, errmsg);\n\n    if (!cs.isValid()) {\n        std::cout << \"Error parsing connection string \" << uri << \": \" << errmsg << std::endl;\n        return EXIT_FAILURE;\n    }\n\n    boost::scoped_ptr<DBClientBase> conn(cs.connect(errmsg));\n    if (!conn) {\n        cout << \"couldn't connect : \" << errmsg << endl;\n        return EXIT_FAILURE;\n    }\n\n    const char* ns = \"test.first\";\n\n    conn->dropCollection(ns);\n    \n    //clean up old data from any previous tesets\n    conn->remove(ns, BSONObj());\n    verify(conn->findOne(ns, BSONObj()).isEmpty()); //verify逻辑表达式，判断是否还存在test.first，是否clenn up成功\n    \n    //test insert\n    cout << \"(1) test insert----\" << endl;\n    conn->insert(ns, \n                 BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"123456\" \n                      << \"age\" << 20));\n    verify(!conn->findOne(ns, BSONObj()).isEmpty());     //判断是否添加成功\n    cout << \"insert data : \" << conn->findOne(ns, BSONObj()) << endl;\n    cout << \"insert success!\" << endl;\n\n    // test remove\n    cout << \"(2) test remove----\" << endl;\n    conn->remove(ns, BSONObj());\n    verify(conn->findOne(ns, BSONObj()).isEmpty());\n    cout << \"remove success!\" << endl;\n    \n    // insert, findOne testing\n    conn->insert(ns, \n                 BSON(\"name\" << \"joe\" \n                      << \"pwd\" << \"234567\" \n                      << \"age\" << 21));\n    {\n        BSONObj res = conn->findOne(ns, BSONObj());\n        verify(strstr(res.getStringField(\"name\"), \"joe\"));\n        verify(!strstr(res.getStringField(\"name2\"), \"joe\"));\n        verify(21 == res.getIntField(\"age\"));\n    }\n    cout << \"insert data : \" << conn->findOne(ns, BSONObj()) <<endl;\n\n    // test update\n    {\n        BSONObj res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n        verify(!strstr(res.getStringField(\"name2\"), \"jeo\"));\n        \n        BSONObj after = BSONObjBuilder().appendElements(res).append(\"name2\", \"w\").obj();\n        cout << \"(3) test update name joe add name2 name3----\" << endl;\n        //upsert type1 update method\n        conn->update(ns, BSONObjBuilder().append(\"name\", \"joe\").obj(), after);\n        //res = conn->findOne(ns, BSONObjBuilder().append(\"name2\", \"w\").obj());\n        verify(!strstr(res.getStringField(\"name2\"), \"joe\"));\n        verify(conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe2\").obj()).isEmpty());\n        //cout << \" update1 data: \" << conn->findOne(ns, BSONObj()) << endl;\n        cout << \" update1 data : \" << conn->findOne(ns, Query(\"{name2:'w'}\")) << endl;\n        \n        //upsert type2 update method 更改指定的某个属性值 \n        const string TEST_NS = \"test.first\";\n        conn->update(\"test.first\", res, BSON(\"$set\" << BSON(\"age\" << 11)));\n        cout << \" update2 data : \" << conn->findOne(ns, BSONObj()) << endl;\n        res = conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj());\n\n        //upsert type3 update method\n        try\n        {\n            after = BSONObjBuilder().appendElements(res).append(\"name3\", \"h\").obj();\n            conn->update(ns, BSONObjBuilder().append(\"name\", \"joe\").obj(), after);\n        }\n        catch (OperationException&)\n        {\n            cout << \" update error: \" << conn->getLastErrorDetailed().toString() << endl;\n        }\n        verify(!conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()).isEmpty());\n        //cout << \" update3 data: \" << conn->findOne(ns, BSONObj()) << endl;\n        cout << \" update3 data : \" << conn->findOne(ns, Query(\"{name3:'h'}\")) << endl;\n\n        cout << \"(4) test query-----\" << \"\\n query data : \" \n            << conn->findOne(ns, BSONObjBuilder().append(\"name\", \"joe\").obj()) << endl;\n        cout << \" Query data : \" << conn->findOne(ns, Query(\"{name:'joe'}\")) << endl;\n    }\n\n    return 0;\n}\n\n```\n(2) makefile文件\n```\nCC = g++\nTEST = simple_client_test\n\n$(TEST):\n\t$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@\n\t./$(TEST)\n\trm -f $(TEST)\nrun:\n\t./$(TEST)\n\nclean:\n\trm -f $(TEST)\n```","slug":"mongodb学习笔记--C++操作mongodb","published":1,"updated":"2017-08-01T14:05:28.317Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkgy000pdohge2vljuqd","content":"<p>　　在学习mongodb过程当中，必须学习的就是用C++（Java、PHP、C#等）操作mongodb，这里讲述C++操作mongodb，在官方提供的mongo-cxx-driver驱动中有相关的操作例子，可以结合例子学习，目录是<code>mongo-cxx-driver-legacy-1.0.0-rc0\\src\\mongo\\client\\examples</code>，这里针对几个重要的点讲述。</p>\n<a id=\"more\"></a>\n<h2 id=\"1-C-连接mongodb\"><a href=\"#1-C-连接mongodb\" class=\"headerlink\" title=\"1. C++连接mongodb\"></a><strong>1. C++连接mongodb</strong></h2><p><strong>（1）<font color=\"#0000FF\">有无密码都适用</font></strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo::client::GlobalInstance instance;</div><div class=\"line\"><span class=\"keyword\">if</span> (!instance.initialized()) &#123;</div><div class=\"line\">\t<span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"failed to initialize the client driver: \"</span> &lt;&lt; instance.status() &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> uri = <span class=\"string\">\"mongodb://username:password@127.0.0.1:27017\"</span>;</div><div class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> errmsg;</div><div class=\"line\"></div><div class=\"line\">ConnectionString cs = ConnectionString::parse(uri, errmsg);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> (!cs.isValid()) &#123;</div><div class=\"line\">\t<span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Error parsing connection string \"</span> &lt;&lt; uri &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">boost::scoped_ptr&lt;DBClientBase&gt; conn(cs.connect(errmsg));</div><div class=\"line\"><span class=\"keyword\">if</span> (!conn) &#123;</div><div class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"couldn't connect : \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">\t<span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　<font color=\"#0000FF\">这种方式有密码和无密码的情况都适用，<code>&quot;username&quot;</code>为登录名，<code>&quot;password&quot;</code>为登录密码；无密码时去掉<code>&quot;username:password@&quot;</code>即可连接，这样连接方式比较常用。</font></p>\n<p><strong>（2）常规连接操作（不带密码连接）</strong><br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo::DBClientConnection conn; </div><div class=\"line\">mongo::Status status = mongo::client::initialize();</div><div class=\"line\">if (!status.isOK()) &#123;</div><div class=\"line\">\tMongoException m(-1, \"failed to initialize the client driver: \" + status.toString());</div><div class=\"line\">\treturn -1;</div><div class=\"line\">&#125;</div><div class=\"line\">string url = \"localhost:27017\";</div><div class=\"line\">if (!conn.connect(url, errmsg)) &#123;</div><div class=\"line\">\tMongoException m(0, \"couldn’t connect : \" + errmsg);</div><div class=\"line\">\treturn -1;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>通过这种方式可建立与mongodb的连接，但是是未带权限的连接。</p>\n<p><strong>（3）带密码连接</strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">conn.auth( <span class=\"string\">\"admin\"</span> , <span class=\"string\">\"username\"</span> , <span class=\"string\">\"password\"</span> , errmsg );</div></pre></td></tr></table></figure></p>\n<p>　　其中<code>&quot;admin&quot;</code>为验证用户的所在数据库，一般在<code>&quot;test.system.users&quot;</code>或<code>&quot;admin.system.users&quot;</code>表中，所以填库名<code>&quot;test&quot;</code>或<code>&quot;admin&quot;</code>，<code>&quot;username&quot;</code>为登录名，<code>&quot;password&quot;</code>为登录密码。<br>或者下面的auth方式也可以：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">conn.auth(BSON(</div><div class=\"line\">\t<span class=\"string\">\"user\"</span> &lt;&lt; <span class=\"string\">\"root\"</span> &lt;&lt; <span class=\"string\">\"db\"</span> &lt;&lt; <span class=\"string\">\"admin\"</span> &lt;&lt;</div><div class=\"line\">\t<span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"password\"</span> &lt;&lt; <span class=\"string\">\"mechanism\"</span> &lt;&lt; <span class=\"string\">\"DEFAULT\"</span></div><div class=\"line\">));</div></pre></td></tr></table></figure>\n<p>根据mongodb的设置更改传递给函数<code>conn.auth</code>的参数值。</p>\n<h2 id=\"2-C-查询数据\"><a href=\"#2-C-查询数据\" class=\"headerlink\" title=\"2. C++查询数据\"></a><strong>2. C++查询数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;findOne(ns, BSONObj()); <span class=\"comment\">//查询一条数据</span></div><div class=\"line\">conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()); <span class=\"comment\">//条件查询</span></div></pre></td></tr></table></figure>\n<h2 id=\"3-C-插入数据\"><a href=\"#3-C-插入数据\" class=\"headerlink\" title=\"3. C++插入数据\"></a><strong>3. C++插入数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;insert(ns, BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"123456\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">20</span>));</div></pre></td></tr></table></figure>\n<h2 id=\"4-C-删除数据\"><a href=\"#4-C-删除数据\" class=\"headerlink\" title=\"4. C++删除数据\"></a><strong>4. C++删除数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;remove(ns, BSONObj()); <span class=\"comment\">//删除所有</span></div><div class=\"line\">conn-&gt;remove(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()); <span class=\"comment\">//删除指定文档</span></div></pre></td></tr></table></figure>\n<h2 id=\"5-C-更新数据\"><a href=\"#5-C-更新数据\" class=\"headerlink\" title=\"5. C++更新数据\"></a><strong>5. C++更新数据</strong></h2><p><strong>(1) 在原数据基础上增加属性</strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\">BSONObj after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name2\"</span>, <span class=\"string\">\"h\"</span>).obj();</div><div class=\"line\">conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"jeo2\"</span>).obj(), after);\t<span class=\"comment\">//在原数据上增加属性</span></div></pre></td></tr></table></figure></p>\n<p>这种update方式只是在原数据基础上增加属性，并不会改变指定属性值。<br><strong>(2) 更改指定的某个属性值</strong><br><strong><font color=\"red\">想要update指定属性的值，需要用到”$set”指令</font></strong>，如下代码所示：<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\"><span class=\"comment\">//更改指定的某个属性值</span></div><div class=\"line\">conn-&gt;update(<span class=\"string\">\"test.first\"</span>, res, BSON(<span class=\"string\">\"$set\"</span> &lt;&lt; BSON(<span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">11</span>)));</div></pre></td></tr></table></figure></p>\n<font color=\"#0000FF\">主要想强调下update更改指定的某个属性值的方式，比较常用。</font>\n\n<h2 id=\"6-C-操作例子\"><a href=\"#6-C-操作例子\" class=\"headerlink\" title=\"6. C++操作例子\"></a><strong>6. C++操作例子</strong></h2><p>(1) simple_client_test.cpp<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*</span></div><div class=\"line\">#if defined(_WIN32)</div><div class=\"line\">#include &lt;winsock2.h&gt;</div><div class=\"line\">#include &lt;windows.h&gt;</div><div class=\"line\">#endif*/</div><div class=\"line\"><span class=\"comment\">//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"mongo/client/dbclient.h\"</span>  <span class=\"comment\">// the mongo c++ driver</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> verify</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> verify(x) MONGO_verify(x)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> mongo;</div><div class=\"line\"><span class=\"comment\">//using mongo::BSONObj;</span></div><div class=\"line\"><span class=\"comment\">//using mongo::BSONObjBuilder;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (argc &gt; <span class=\"number\">2</span>) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"usage: \"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\" [MONGODB_URI]\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    mongo::client::GlobalInstance instance;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!instance.initialized()) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"failed to initialize the client driver: \"</span> &lt;&lt; instance.status() &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> uri = argc == <span class=\"number\">2</span> ? argv[<span class=\"number\">1</span>] : <span class=\"string\">\"mongodb://127.0.0.1:27017\"</span>;</div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> errmsg;</div><div class=\"line\"></div><div class=\"line\">    ConnectionString cs = ConnectionString::parse(uri, errmsg);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (!cs.isValid()) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Error parsing connection string \"</span> &lt;&lt; uri &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    boost::scoped_ptr&lt;DBClientBase&gt; conn(cs.connect(errmsg));</div><div class=\"line\">    <span class=\"keyword\">if</span> (!conn) &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"couldn't connect : \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\"></div><div class=\"line\">    conn-&gt;dropCollection(ns);</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">//clean up old data from any previous tesets</span></div><div class=\"line\">    conn-&gt;remove(ns, BSONObj());</div><div class=\"line\">    verify(conn-&gt;findOne(ns, BSONObj()).isEmpty()); <span class=\"comment\">//verify逻辑表达式，判断是否还存在test.first，是否clenn up成功</span></div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">//test insert</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(1) test insert----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    conn-&gt;insert(ns, </div><div class=\"line\">                 BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"123456\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">20</span>));</div><div class=\"line\">    verify(!conn-&gt;findOne(ns, BSONObj()).isEmpty());     <span class=\"comment\">//判断是否添加成功</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert success!\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// test remove</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(2) test remove----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    conn-&gt;remove(ns, BSONObj());</div><div class=\"line\">    verify(conn-&gt;findOne(ns, BSONObj()).isEmpty());</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"remove success!\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">// insert, findOne testing</span></div><div class=\"line\">    conn-&gt;insert(ns, </div><div class=\"line\">                 BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"234567\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">21</span>));</div><div class=\"line\">    &#123;</div><div class=\"line\">        BSONObj res = conn-&gt;findOne(ns, BSONObj());</div><div class=\"line\">        verify(<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(<span class=\"number\">21</span> == res.getIntField(<span class=\"string\">\"age\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt;<span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// test update</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"jeo\"</span>));</div><div class=\"line\">        </div><div class=\"line\">        BSONObj after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name2\"</span>, <span class=\"string\">\"w\"</span>).obj();</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(3) test update name joe add name2 name3----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"comment\">//upsert type1 update method</span></div><div class=\"line\">        conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj(), after);</div><div class=\"line\">        <span class=\"comment\">//res = conn-&gt;findOne(ns, BSONObjBuilder().append(\"name2\", \"w\").obj());</span></div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe2\"</span>).obj()).isEmpty());</div><div class=\"line\">        <span class=\"comment\">//cout &lt;&lt; \" update1 data: \" &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update1 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name2:'w'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"comment\">//upsert type2 update method 更改指定的某个属性值 </span></div><div class=\"line\">        <span class=\"keyword\">const</span> <span class=\"built_in\">string</span> TEST_NS = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">        conn-&gt;update(<span class=\"string\">\"test.first\"</span>, res, BSON(<span class=\"string\">\"$set\"</span> &lt;&lt; BSON(<span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">11</span>)));</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update2 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//upsert type3 update method</span></div><div class=\"line\">        <span class=\"keyword\">try</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name3\"</span>, <span class=\"string\">\"h\"</span>).obj();</div><div class=\"line\">            conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj(), after);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">catch</span> (OperationException&amp;)</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update error: \"</span> &lt;&lt; conn-&gt;getLastErrorDetailed().toString() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        verify(!conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()).isEmpty());</div><div class=\"line\">        <span class=\"comment\">//cout &lt;&lt; \" update3 data: \" &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update3 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name3:'h'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(4) test query-----\"</span> &lt;&lt; <span class=\"string\">\"\\n query data : \"</span> </div><div class=\"line\">            &lt;&lt; conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Query data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name:'joe'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>(2) makefile文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">CC = g++</div><div class=\"line\">TEST = simple_client_test</div><div class=\"line\"></div><div class=\"line\">$(TEST):</div><div class=\"line\">\t$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@</div><div class=\"line\">\t./$(TEST)</div><div class=\"line\">\trm -f $(TEST)</div><div class=\"line\">run:</div><div class=\"line\">\t./$(TEST)</div><div class=\"line\"></div><div class=\"line\">clean:</div><div class=\"line\">\trm -f $(TEST)</div></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<p>　　在学习mongodb过程当中，必须学习的就是用C++（Java、PHP、C#等）操作mongodb，这里讲述C++操作mongodb，在官方提供的mongo-cxx-driver驱动中有相关的操作例子，可以结合例子学习，目录是<code>mongo-cxx-driver-legacy-1.0.0-rc0\\src\\mongo\\client\\examples</code>，这里针对几个重要的点讲述。</p>","more":"<h2 id=\"1-C-连接mongodb\"><a href=\"#1-C-连接mongodb\" class=\"headerlink\" title=\"1. C++连接mongodb\"></a><strong>1. C++连接mongodb</strong></h2><p><strong>（1）<font color=\"#0000FF\">有无密码都适用</font></strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo::client::GlobalInstance instance;</div><div class=\"line\"><span class=\"keyword\">if</span> (!instance.initialized()) &#123;</div><div class=\"line\">\t<span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"failed to initialize the client driver: \"</span> &lt;&lt; instance.status() &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> uri = <span class=\"string\">\"mongodb://username:password@127.0.0.1:27017\"</span>;</div><div class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> errmsg;</div><div class=\"line\"></div><div class=\"line\">ConnectionString cs = ConnectionString::parse(uri, errmsg);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> (!cs.isValid()) &#123;</div><div class=\"line\">\t<span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Error parsing connection string \"</span> &lt;&lt; uri &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">boost::scoped_ptr&lt;DBClientBase&gt; conn(cs.connect(errmsg));</div><div class=\"line\"><span class=\"keyword\">if</span> (!conn) &#123;</div><div class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"couldn't connect : \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">\t<span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　<font color=\"#0000FF\">这种方式有密码和无密码的情况都适用，<code>&quot;username&quot;</code>为登录名，<code>&quot;password&quot;</code>为登录密码；无密码时去掉<code>&quot;username:password@&quot;</code>即可连接，这样连接方式比较常用。</font></p>\n<p><strong>（2）常规连接操作（不带密码连接）</strong><br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">mongo::DBClientConnection conn; </div><div class=\"line\">mongo::Status status = mongo::client::initialize();</div><div class=\"line\">if (!status.isOK()) &#123;</div><div class=\"line\">\tMongoException m(-1, \"failed to initialize the client driver: \" + status.toString());</div><div class=\"line\">\treturn -1;</div><div class=\"line\">&#125;</div><div class=\"line\">string url = \"localhost:27017\";</div><div class=\"line\">if (!conn.connect(url, errmsg)) &#123;</div><div class=\"line\">\tMongoException m(0, \"couldn’t connect : \" + errmsg);</div><div class=\"line\">\treturn -1;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>通过这种方式可建立与mongodb的连接，但是是未带权限的连接。</p>\n<p><strong>（3）带密码连接</strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">conn.auth( <span class=\"string\">\"admin\"</span> , <span class=\"string\">\"username\"</span> , <span class=\"string\">\"password\"</span> , errmsg );</div></pre></td></tr></table></figure></p>\n<p>　　其中<code>&quot;admin&quot;</code>为验证用户的所在数据库，一般在<code>&quot;test.system.users&quot;</code>或<code>&quot;admin.system.users&quot;</code>表中，所以填库名<code>&quot;test&quot;</code>或<code>&quot;admin&quot;</code>，<code>&quot;username&quot;</code>为登录名，<code>&quot;password&quot;</code>为登录密码。<br>或者下面的auth方式也可以：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">conn.auth(BSON(</div><div class=\"line\">\t<span class=\"string\">\"user\"</span> &lt;&lt; <span class=\"string\">\"root\"</span> &lt;&lt; <span class=\"string\">\"db\"</span> &lt;&lt; <span class=\"string\">\"admin\"</span> &lt;&lt;</div><div class=\"line\">\t<span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"password\"</span> &lt;&lt; <span class=\"string\">\"mechanism\"</span> &lt;&lt; <span class=\"string\">\"DEFAULT\"</span></div><div class=\"line\">));</div></pre></td></tr></table></figure>\n<p>根据mongodb的设置更改传递给函数<code>conn.auth</code>的参数值。</p>\n<h2 id=\"2-C-查询数据\"><a href=\"#2-C-查询数据\" class=\"headerlink\" title=\"2. C++查询数据\"></a><strong>2. C++查询数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;findOne(ns, BSONObj()); <span class=\"comment\">//查询一条数据</span></div><div class=\"line\">conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()); <span class=\"comment\">//条件查询</span></div></pre></td></tr></table></figure>\n<h2 id=\"3-C-插入数据\"><a href=\"#3-C-插入数据\" class=\"headerlink\" title=\"3. C++插入数据\"></a><strong>3. C++插入数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;insert(ns, BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"123456\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">20</span>));</div></pre></td></tr></table></figure>\n<h2 id=\"4-C-删除数据\"><a href=\"#4-C-删除数据\" class=\"headerlink\" title=\"4. C++删除数据\"></a><strong>4. C++删除数据</strong></h2><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">conn-&gt;remove(ns, BSONObj()); <span class=\"comment\">//删除所有</span></div><div class=\"line\">conn-&gt;remove(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()); <span class=\"comment\">//删除指定文档</span></div></pre></td></tr></table></figure>\n<h2 id=\"5-C-更新数据\"><a href=\"#5-C-更新数据\" class=\"headerlink\" title=\"5. C++更新数据\"></a><strong>5. C++更新数据</strong></h2><p><strong>(1) 在原数据基础上增加属性</strong><br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\">BSONObj after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name2\"</span>, <span class=\"string\">\"h\"</span>).obj();</div><div class=\"line\">conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"jeo2\"</span>).obj(), after);\t<span class=\"comment\">//在原数据上增加属性</span></div></pre></td></tr></table></figure></p>\n<p>这种update方式只是在原数据基础上增加属性，并不会改变指定属性值。<br><strong>(2) 更改指定的某个属性值</strong><br><strong><font color=\"red\">想要update指定属性的值，需要用到”$set”指令</font></strong>，如下代码所示：<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\"><span class=\"comment\">//更改指定的某个属性值</span></div><div class=\"line\">conn-&gt;update(<span class=\"string\">\"test.first\"</span>, res, BSON(<span class=\"string\">\"$set\"</span> &lt;&lt; BSON(<span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">11</span>)));</div></pre></td></tr></table></figure></p>\n<font color=\"#0000FF\">主要想强调下update更改指定的某个属性值的方式，比较常用。</font>\n\n<h2 id=\"6-C-操作例子\"><a href=\"#6-C-操作例子\" class=\"headerlink\" title=\"6. C++操作例子\"></a><strong>6. C++操作例子</strong></h2><p>(1) simple_client_test.cpp<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*</span></div><div class=\"line\">#if defined(_WIN32)</div><div class=\"line\">#include &lt;winsock2.h&gt;</div><div class=\"line\">#include &lt;windows.h&gt;</div><div class=\"line\">#endif*/</div><div class=\"line\"><span class=\"comment\">//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"mongo/client/dbclient.h\"</span>  <span class=\"comment\">// the mongo c++ driver</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> verify</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> verify(x) MONGO_verify(x)</span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> mongo;</div><div class=\"line\"><span class=\"comment\">//using mongo::BSONObj;</span></div><div class=\"line\"><span class=\"comment\">//using mongo::BSONObjBuilder;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (argc &gt; <span class=\"number\">2</span>) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"usage: \"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\" [MONGODB_URI]\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    mongo::client::GlobalInstance instance;</div><div class=\"line\">    <span class=\"keyword\">if</span> (!instance.initialized()) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"failed to initialize the client driver: \"</span> &lt;&lt; instance.status() &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> uri = argc == <span class=\"number\">2</span> ? argv[<span class=\"number\">1</span>] : <span class=\"string\">\"mongodb://127.0.0.1:27017\"</span>;</div><div class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> errmsg;</div><div class=\"line\"></div><div class=\"line\">    ConnectionString cs = ConnectionString::parse(uri, errmsg);</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (!cs.isValid()) &#123;</div><div class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Error parsing connection string \"</span> &lt;&lt; uri &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    boost::scoped_ptr&lt;DBClientBase&gt; conn(cs.connect(errmsg));</div><div class=\"line\">    <span class=\"keyword\">if</span> (!conn) &#123;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"couldn't connect : \"</span> &lt;&lt; errmsg &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* ns = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\"></div><div class=\"line\">    conn-&gt;dropCollection(ns);</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">//clean up old data from any previous tesets</span></div><div class=\"line\">    conn-&gt;remove(ns, BSONObj());</div><div class=\"line\">    verify(conn-&gt;findOne(ns, BSONObj()).isEmpty()); <span class=\"comment\">//verify逻辑表达式，判断是否还存在test.first，是否clenn up成功</span></div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">//test insert</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(1) test insert----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    conn-&gt;insert(ns, </div><div class=\"line\">                 BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"123456\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">20</span>));</div><div class=\"line\">    verify(!conn-&gt;findOne(ns, BSONObj()).isEmpty());     <span class=\"comment\">//判断是否添加成功</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert success!\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// test remove</span></div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(2) test remove----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    conn-&gt;remove(ns, BSONObj());</div><div class=\"line\">    verify(conn-&gt;findOne(ns, BSONObj()).isEmpty());</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"remove success!\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">// insert, findOne testing</span></div><div class=\"line\">    conn-&gt;insert(ns, </div><div class=\"line\">                 BSON(<span class=\"string\">\"name\"</span> &lt;&lt; <span class=\"string\">\"joe\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"pwd\"</span> &lt;&lt; <span class=\"string\">\"234567\"</span> </div><div class=\"line\">                      &lt;&lt; <span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">21</span>));</div><div class=\"line\">    &#123;</div><div class=\"line\">        BSONObj res = conn-&gt;findOne(ns, BSONObj());</div><div class=\"line\">        verify(<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(<span class=\"number\">21</span> == res.getIntField(<span class=\"string\">\"age\"</span>));</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"insert data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt;<span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// test update</span></div><div class=\"line\">    &#123;</div><div class=\"line\">        BSONObj res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"jeo\"</span>));</div><div class=\"line\">        </div><div class=\"line\">        BSONObj after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name2\"</span>, <span class=\"string\">\"w\"</span>).obj();</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(3) test update name joe add name2 name3----\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"comment\">//upsert type1 update method</span></div><div class=\"line\">        conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj(), after);</div><div class=\"line\">        <span class=\"comment\">//res = conn-&gt;findOne(ns, BSONObjBuilder().append(\"name2\", \"w\").obj());</span></div><div class=\"line\">        verify(!<span class=\"built_in\">strstr</span>(res.getStringField(<span class=\"string\">\"name2\"</span>), <span class=\"string\">\"joe\"</span>));</div><div class=\"line\">        verify(conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe2\"</span>).obj()).isEmpty());</div><div class=\"line\">        <span class=\"comment\">//cout &lt;&lt; \" update1 data: \" &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update1 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name2:'w'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"comment\">//upsert type2 update method 更改指定的某个属性值 </span></div><div class=\"line\">        <span class=\"keyword\">const</span> <span class=\"built_in\">string</span> TEST_NS = <span class=\"string\">\"test.first\"</span>;</div><div class=\"line\">        conn-&gt;update(<span class=\"string\">\"test.first\"</span>, res, BSON(<span class=\"string\">\"$set\"</span> &lt;&lt; BSON(<span class=\"string\">\"age\"</span> &lt;&lt; <span class=\"number\">11</span>)));</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update2 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        res = conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj());</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//upsert type3 update method</span></div><div class=\"line\">        <span class=\"keyword\">try</span></div><div class=\"line\">        &#123;</div><div class=\"line\">            after = BSONObjBuilder().appendElements(res).append(<span class=\"string\">\"name3\"</span>, <span class=\"string\">\"h\"</span>).obj();</div><div class=\"line\">            conn-&gt;update(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj(), after);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">catch</span> (OperationException&amp;)</div><div class=\"line\">        &#123;</div><div class=\"line\">            <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update error: \"</span> &lt;&lt; conn-&gt;getLastErrorDetailed().toString() &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        verify(!conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()).isEmpty());</div><div class=\"line\">        <span class=\"comment\">//cout &lt;&lt; \" update3 data: \" &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" update3 data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name3:'h'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"(4) test query-----\"</span> &lt;&lt; <span class=\"string\">\"\\n query data : \"</span> </div><div class=\"line\">            &lt;&lt; conn-&gt;findOne(ns, BSONObjBuilder().append(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"joe\"</span>).obj()) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Query data : \"</span> &lt;&lt; conn-&gt;findOne(ns, Query(<span class=\"string\">\"&#123;name:'joe'&#125;\"</span>)) &lt;&lt; <span class=\"built_in\">endl</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>(2) makefile文件<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">CC = g++</div><div class=\"line\">TEST = simple_client_test</div><div class=\"line\"></div><div class=\"line\">$(TEST):</div><div class=\"line\">\t$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@</div><div class=\"line\">\t./$(TEST)</div><div class=\"line\">\trm -f $(TEST)</div><div class=\"line\">run:</div><div class=\"line\">\t./$(TEST)</div><div class=\"line\"></div><div class=\"line\">clean:</div><div class=\"line\">\trm -f $(TEST)</div></pre></td></tr></table></figure></p>"},{"title":"mybatis中的#{}和${}的区别","date":"2017-04-19T16:00:00.000Z","thumbnail":"http://pic1.win4000.com/wallpaper/7/518373b077dcc.jpg","_content":"\n　　在使用`mybatis`时都会用到`#{}`和`${}`符号来进行传值，我们来看下两者的区别。<!--more-->\n\n## **1. 特征**\n\n1. `#{}`将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。如：`order by #user_id#`，如果传入的值是111,那么解析成sql时的值为`order by \"111\"`, 如果传入的值是id，则解析成的sql为`order by \"id\"` 。\n\n\n2. `${}`将传入的数据直接显示生成在sql中。如：`order by $user_id$`，如果传入的值是111,那么解析成sql时的值为`order by 111`,  如果传入的值是id，则解析成的sql为`order by id`.\n3. `#{}`方式能够很大程度防止sql注入。\n4. `${}`方式无法防止Sql注入。\n\n5. `${}`方式一般用于传入数据库对象，例如传入表名。\n\n6. 一般能用`#{}`的就别用`${}` 。\n\n> `mybatis`排序时使用`order by `动态参数时需要注意，用`${}`而不是`#{}`\n\n## **2. 字符串替换**\n\n默认情况下，使用`#{}`格式的语法会导致`mybatis`创建预处理语句属性并以它为背景设置安全的值（比如?）。这样做很安全，很迅速也是首选做法，有时你只是想直接在SQL语句中插入一个不改变的字符串。比如，像`ORDER BY`，你可以这样来使用：\n\n```sql\nORDER BY ${columnName}\n```\n\n这里`mybatis`不会修改或转义字符串。\n\n**重要：接受从用户输出的内容并提供给语句中不变的字符串，这样做是不安全的。这会导致潜在的SQL注入攻击，因此你不应该允许用户输入这些字段，或者通常自行转义并检查。**\n\n## **3. mybatis 本身的说明**\n\n```\nString Substitution\n\nBy default, using the #{} syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject a string unmodified into the SQL Statement. For example, for ORDER BY, you might use something like this:\n\nORDER BY ${columnName}\nHere MyBatis won't modify or escape the string.\n\nNOTE It's not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.\n```\n\n从上文可以看出：\n\n1. 使用`#{}`格式的语法在`mybatis`中使用`Preparement`语句来安全的设置值，执行sql类似下面的：\n\n```java\nPreparedStatement ps = conn.prepareStatement(sql);\nps.setInt(1,id);\n```\n\n这样做的好处是：更安全，更迅速，通常也是首选做法。\n\n2. 不过有时你只是想直接在 SQL 语句中插入一个不改变的字符串。比如，像 `ORDER BY`，你可以这样来使用：\n\n```mysql\nORDER BY ${columnName}\n```\n\n此时`mybatis` 不会修改或转义字符串。\n\n这种方式类似于：\n\n```java\nStatement st = conn.createStatement();\nResultSet rs = st.executeQuery(sql);\n```\n\n这种方式的缺点是： \n\n以这种方式接受从用户输出的内容并提供给语句中不变的字符串是不安全的，会导致潜在的 SQL 注入攻击，因此要么不允许用户输入这些字段，要么自行转义并检验。","source":"_posts/mybatis_operator.md","raw":"---\ntitle: mybatis中的#{}和${}的区别\ndate: 2017-4-20\ncategories: \n  - mybatis\ntags: \n  - mybatis \nthumbnail: http://pic1.win4000.com/wallpaper/7/518373b077dcc.jpg\n---\n\n　　在使用`mybatis`时都会用到`#{}`和`${}`符号来进行传值，我们来看下两者的区别。<!--more-->\n\n## **1. 特征**\n\n1. `#{}`将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。如：`order by #user_id#`，如果传入的值是111,那么解析成sql时的值为`order by \"111\"`, 如果传入的值是id，则解析成的sql为`order by \"id\"` 。\n\n\n2. `${}`将传入的数据直接显示生成在sql中。如：`order by $user_id$`，如果传入的值是111,那么解析成sql时的值为`order by 111`,  如果传入的值是id，则解析成的sql为`order by id`.\n3. `#{}`方式能够很大程度防止sql注入。\n4. `${}`方式无法防止Sql注入。\n\n5. `${}`方式一般用于传入数据库对象，例如传入表名。\n\n6. 一般能用`#{}`的就别用`${}` 。\n\n> `mybatis`排序时使用`order by `动态参数时需要注意，用`${}`而不是`#{}`\n\n## **2. 字符串替换**\n\n默认情况下，使用`#{}`格式的语法会导致`mybatis`创建预处理语句属性并以它为背景设置安全的值（比如?）。这样做很安全，很迅速也是首选做法，有时你只是想直接在SQL语句中插入一个不改变的字符串。比如，像`ORDER BY`，你可以这样来使用：\n\n```sql\nORDER BY ${columnName}\n```\n\n这里`mybatis`不会修改或转义字符串。\n\n**重要：接受从用户输出的内容并提供给语句中不变的字符串，这样做是不安全的。这会导致潜在的SQL注入攻击，因此你不应该允许用户输入这些字段，或者通常自行转义并检查。**\n\n## **3. mybatis 本身的说明**\n\n```\nString Substitution\n\nBy default, using the #{} syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject a string unmodified into the SQL Statement. For example, for ORDER BY, you might use something like this:\n\nORDER BY ${columnName}\nHere MyBatis won't modify or escape the string.\n\nNOTE It's not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.\n```\n\n从上文可以看出：\n\n1. 使用`#{}`格式的语法在`mybatis`中使用`Preparement`语句来安全的设置值，执行sql类似下面的：\n\n```java\nPreparedStatement ps = conn.prepareStatement(sql);\nps.setInt(1,id);\n```\n\n这样做的好处是：更安全，更迅速，通常也是首选做法。\n\n2. 不过有时你只是想直接在 SQL 语句中插入一个不改变的字符串。比如，像 `ORDER BY`，你可以这样来使用：\n\n```mysql\nORDER BY ${columnName}\n```\n\n此时`mybatis` 不会修改或转义字符串。\n\n这种方式类似于：\n\n```java\nStatement st = conn.createStatement();\nResultSet rs = st.executeQuery(sql);\n```\n\n这种方式的缺点是： \n\n以这种方式接受从用户输出的内容并提供给语句中不变的字符串是不安全的，会导致潜在的 SQL 注入攻击，因此要么不允许用户输入这些字段，要么自行转义并检验。","slug":"mybatis_operator","published":1,"updated":"2017-07-13T14:34:12.283Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkha000udohg3ghiji06","content":"<p>　　在使用<code>mybatis</code>时都会用到<code>#{}</code>和<code>${}</code>符号来进行传值，我们来看下两者的区别。<a id=\"more\"></a></p>\n<h2 id=\"1-特征\"><a href=\"#1-特征\" class=\"headerlink\" title=\"1. 特征\"></a><strong>1. 特征</strong></h2><ol>\n<li><code>#{}</code>将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。如：<code>order by #user_id#</code>，如果传入的值是111,那么解析成sql时的值为<code>order by &quot;111&quot;</code>, 如果传入的值是id，则解析成的sql为<code>order by &quot;id&quot;</code> 。</li>\n</ol>\n<ol>\n<li><code>${}</code>将传入的数据直接显示生成在sql中。如：<code>order by $user_id$</code>，如果传入的值是111,那么解析成sql时的值为<code>order by 111</code>,  如果传入的值是id，则解析成的sql为<code>order by id</code>.</li>\n<li><code>#{}</code>方式能够很大程度防止sql注入。</li>\n<li><p><code>${}</code>方式无法防止Sql注入。</p>\n</li>\n<li><p><code>${}</code>方式一般用于传入数据库对象，例如传入表名。</p>\n</li>\n<li><p>一般能用<code>#{}</code>的就别用<code>${}</code> 。</p>\n</li>\n</ol>\n<blockquote>\n<p><code>mybatis</code>排序时使用<code>order by</code>动态参数时需要注意，用<code>${}</code>而不是<code>#{}</code></p>\n</blockquote>\n<h2 id=\"2-字符串替换\"><a href=\"#2-字符串替换\" class=\"headerlink\" title=\"2. 字符串替换\"></a><strong>2. 字符串替换</strong></h2><p>默认情况下，使用<code>#{}</code>格式的语法会导致<code>mybatis</code>创建预处理语句属性并以它为背景设置安全的值（比如?）。这样做很安全，很迅速也是首选做法，有时你只是想直接在SQL语句中插入一个不改变的字符串。比如，像<code>ORDER BY</code>，你可以这样来使用：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ORDER BY $&#123;columnName&#125;</div></pre></td></tr></table></figure>\n<p>这里<code>mybatis</code>不会修改或转义字符串。</p>\n<p><strong>重要：接受从用户输出的内容并提供给语句中不变的字符串，这样做是不安全的。这会导致潜在的SQL注入攻击，因此你不应该允许用户输入这些字段，或者通常自行转义并检查。</strong></p>\n<h2 id=\"3-mybatis-本身的说明\"><a href=\"#3-mybatis-本身的说明\" class=\"headerlink\" title=\"3. mybatis 本身的说明\"></a><strong>3. mybatis 本身的说明</strong></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">String Substitution</div><div class=\"line\"></div><div class=\"line\">By default, using the #&#123;&#125; syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject a string unmodified into the SQL Statement. For example, for ORDER BY, you might use something like this:</div><div class=\"line\"></div><div class=\"line\">ORDER BY $&#123;columnName&#125;</div><div class=\"line\">Here MyBatis won&apos;t modify or escape the string.</div><div class=\"line\"></div><div class=\"line\">NOTE It&apos;s not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.</div></pre></td></tr></table></figure>\n<p>从上文可以看出：</p>\n<ol>\n<li>使用<code>#{}</code>格式的语法在<code>mybatis</code>中使用<code>Preparement</code>语句来安全的设置值，执行sql类似下面的：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">PreparedStatement ps = conn.prepareStatement(sql);</div><div class=\"line\">ps.setInt(<span class=\"number\">1</span>,id);</div></pre></td></tr></table></figure>\n<p>这样做的好处是：更安全，更迅速，通常也是首选做法。</p>\n<ol>\n<li>不过有时你只是想直接在 SQL 语句中插入一个不改变的字符串。比如，像 <code>ORDER BY</code>，你可以这样来使用：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ORDER BY $&#123;columnName&#125;</div></pre></td></tr></table></figure>\n<p>此时<code>mybatis</code> 不会修改或转义字符串。</p>\n<p>这种方式类似于：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">Statement st = conn.createStatement();</div><div class=\"line\">ResultSet rs = st.executeQuery(sql);</div></pre></td></tr></table></figure>\n<p>这种方式的缺点是： </p>\n<p>以这种方式接受从用户输出的内容并提供给语句中不变的字符串是不安全的，会导致潜在的 SQL 注入攻击，因此要么不允许用户输入这些字段，要么自行转义并检验。</p>\n","site":{"data":{}},"excerpt":"<p>　　在使用<code>mybatis</code>时都会用到<code>#{}</code>和<code>${}</code>符号来进行传值，我们来看下两者的区别。","more":"</p>\n<h2 id=\"1-特征\"><a href=\"#1-特征\" class=\"headerlink\" title=\"1. 特征\"></a><strong>1. 特征</strong></h2><ol>\n<li><code>#{}</code>将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。如：<code>order by #user_id#</code>，如果传入的值是111,那么解析成sql时的值为<code>order by &quot;111&quot;</code>, 如果传入的值是id，则解析成的sql为<code>order by &quot;id&quot;</code> 。</li>\n</ol>\n<ol>\n<li><code>${}</code>将传入的数据直接显示生成在sql中。如：<code>order by $user_id$</code>，如果传入的值是111,那么解析成sql时的值为<code>order by 111</code>,  如果传入的值是id，则解析成的sql为<code>order by id</code>.</li>\n<li><code>#{}</code>方式能够很大程度防止sql注入。</li>\n<li><p><code>${}</code>方式无法防止Sql注入。</p>\n</li>\n<li><p><code>${}</code>方式一般用于传入数据库对象，例如传入表名。</p>\n</li>\n<li><p>一般能用<code>#{}</code>的就别用<code>${}</code> 。</p>\n</li>\n</ol>\n<blockquote>\n<p><code>mybatis</code>排序时使用<code>order by</code>动态参数时需要注意，用<code>${}</code>而不是<code>#{}</code></p>\n</blockquote>\n<h2 id=\"2-字符串替换\"><a href=\"#2-字符串替换\" class=\"headerlink\" title=\"2. 字符串替换\"></a><strong>2. 字符串替换</strong></h2><p>默认情况下，使用<code>#{}</code>格式的语法会导致<code>mybatis</code>创建预处理语句属性并以它为背景设置安全的值（比如?）。这样做很安全，很迅速也是首选做法，有时你只是想直接在SQL语句中插入一个不改变的字符串。比如，像<code>ORDER BY</code>，你可以这样来使用：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ORDER BY $&#123;columnName&#125;</div></pre></td></tr></table></figure>\n<p>这里<code>mybatis</code>不会修改或转义字符串。</p>\n<p><strong>重要：接受从用户输出的内容并提供给语句中不变的字符串，这样做是不安全的。这会导致潜在的SQL注入攻击，因此你不应该允许用户输入这些字段，或者通常自行转义并检查。</strong></p>\n<h2 id=\"3-mybatis-本身的说明\"><a href=\"#3-mybatis-本身的说明\" class=\"headerlink\" title=\"3. mybatis 本身的说明\"></a><strong>3. mybatis 本身的说明</strong></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">String Substitution</div><div class=\"line\"></div><div class=\"line\">By default, using the #&#123;&#125; syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject a string unmodified into the SQL Statement. For example, for ORDER BY, you might use something like this:</div><div class=\"line\"></div><div class=\"line\">ORDER BY $&#123;columnName&#125;</div><div class=\"line\">Here MyBatis won&apos;t modify or escape the string.</div><div class=\"line\"></div><div class=\"line\">NOTE It&apos;s not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.</div></pre></td></tr></table></figure>\n<p>从上文可以看出：</p>\n<ol>\n<li>使用<code>#{}</code>格式的语法在<code>mybatis</code>中使用<code>Preparement</code>语句来安全的设置值，执行sql类似下面的：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">PreparedStatement ps = conn.prepareStatement(sql);</div><div class=\"line\">ps.setInt(<span class=\"number\">1</span>,id);</div></pre></td></tr></table></figure>\n<p>这样做的好处是：更安全，更迅速，通常也是首选做法。</p>\n<ol>\n<li>不过有时你只是想直接在 SQL 语句中插入一个不改变的字符串。比如，像 <code>ORDER BY</code>，你可以这样来使用：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ORDER BY $&#123;columnName&#125;</div></pre></td></tr></table></figure>\n<p>此时<code>mybatis</code> 不会修改或转义字符串。</p>\n<p>这种方式类似于：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">Statement st = conn.createStatement();</div><div class=\"line\">ResultSet rs = st.executeQuery(sql);</div></pre></td></tr></table></figure>\n<p>这种方式的缺点是： </p>\n<p>以这种方式接受从用户输出的内容并提供给语句中不变的字符串是不安全的，会导致潜在的 SQL 注入攻击，因此要么不允许用户输入这些字段，要么自行转义并检验。</p>"},{"title":"zookeeper提示Unable to read additional data from server sessionid 0x","date":"2017-09-14T16:00:00.000Z","thumbnail":"http://static.oschina.net/uploads/img/201308/08171345_l5K3.jpg","_content":"\n配置zookeeper集群，一开始配置了两台机器server.1和server.2。\n\n配置参数，在zoo.cfg中指定了整个zookeeper集群的server编号、地址和端口：\n\n> server.1=10.10.16.151:2888:3888\n> server.2=10.10.16.234:2888:3888\n\n然后为这两个个节点创建对应的编号文件，在/tmp/zookeeper/data/myid文件中。如下：<!--more-->\n\n在server.1=10.10.16.151机器上执行：\n\n```sh\necho 1 > /tmp/zookeeper/data/myid\n```\n\n在server.1=10.10.16.234机器上执行：\n\n```sh\necho 2 > /tmp/zookeeper/data/myid\n```\n\n启动server.1测试dubbo服务，使用`zkServer.sh start`启动了server.1，然后使用`zkServer.sh status`查看工作状态，显示\n```sh\nError contacting service. It is probably not running.\n```\n通过`zkCli.sh -server 10.10.16.151:2181`查看服务详细，发现服务提示了下面的错误信息。\n\n启动时提示：\n\n```sh\n2017-09-15 14:57:27,139 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@1035] - Opening socket connection to server 10.10.16.151/10.10.16.151:2181. Will not attempt to authenticate using SASL (java.lang.SecurityException: Ϟ·¨¶¨λµȂ¼Ƥ׃)\n2017-09-15 14:57:27,140 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@877] - Socket connection established to 10.10.16.151/10.10.16.151:2181, initiating session\n2017-09-15 14:57:27,143 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@1161] - Unable to read additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect\n```\n\n后来才搞明白，由于我在zoo.cfg中配置了2台机器，但是只启动了1台，zookeeper就会认为服务处于不可用状态。\n\n**通过zookeeper的选举算法得知，当整个集群超过半数机器宕机，zookeeper会认为集群处于不可用状态。**所以启动2台服务正常。\n\n然后我又增加了1台`server.3=10.10.16.241:2888:3888`机器节点，在3台都启动的情况下，关掉其中1台，服务正常，关掉2台，服务不可用。\n\n所以，zookeeper集群只启动一台无法连接，如果启动机器数为半数及以上就可以连接了。","source":"_posts/zookeeper提示Unable to read additional data from server sessionid 0x.md","raw":"---\ntitle: zookeeper提示Unable to read additional data from server sessionid 0x\ndate: 2017-9-15\ncategories: \n  - zookeeper\ntags: \n  - zookeeper\n  - 集群\nthumbnail: http://static.oschina.net/uploads/img/201308/08171345_l5K3.jpg\n---\n\n配置zookeeper集群，一开始配置了两台机器server.1和server.2。\n\n配置参数，在zoo.cfg中指定了整个zookeeper集群的server编号、地址和端口：\n\n> server.1=10.10.16.151:2888:3888\n> server.2=10.10.16.234:2888:3888\n\n然后为这两个个节点创建对应的编号文件，在/tmp/zookeeper/data/myid文件中。如下：<!--more-->\n\n在server.1=10.10.16.151机器上执行：\n\n```sh\necho 1 > /tmp/zookeeper/data/myid\n```\n\n在server.1=10.10.16.234机器上执行：\n\n```sh\necho 2 > /tmp/zookeeper/data/myid\n```\n\n启动server.1测试dubbo服务，使用`zkServer.sh start`启动了server.1，然后使用`zkServer.sh status`查看工作状态，显示\n```sh\nError contacting service. It is probably not running.\n```\n通过`zkCli.sh -server 10.10.16.151:2181`查看服务详细，发现服务提示了下面的错误信息。\n\n启动时提示：\n\n```sh\n2017-09-15 14:57:27,139 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@1035] - Opening socket connection to server 10.10.16.151/10.10.16.151:2181. Will not attempt to authenticate using SASL (java.lang.SecurityException: Ϟ·¨¶¨λµȂ¼Ƥ׃)\n2017-09-15 14:57:27,140 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@877] - Socket connection established to 10.10.16.151/10.10.16.151:2181, initiating session\n2017-09-15 14:57:27,143 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn$SendThread@1161] - Unable to read additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect\n```\n\n后来才搞明白，由于我在zoo.cfg中配置了2台机器，但是只启动了1台，zookeeper就会认为服务处于不可用状态。\n\n**通过zookeeper的选举算法得知，当整个集群超过半数机器宕机，zookeeper会认为集群处于不可用状态。**所以启动2台服务正常。\n\n然后我又增加了1台`server.3=10.10.16.241:2888:3888`机器节点，在3台都启动的情况下，关掉其中1台，服务正常，关掉2台，服务不可用。\n\n所以，zookeeper集群只启动一台无法连接，如果启动机器数为半数及以上就可以连接了。","slug":"zookeeper提示Unable to read additional data from server sessionid 0x","published":1,"updated":"2018-01-17T13:11:18.649Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkhk000wdohguvggemh9","content":"<p>配置zookeeper集群，一开始配置了两台机器server.1和server.2。</p>\n<p>配置参数，在zoo.cfg中指定了整个zookeeper集群的server编号、地址和端口：</p>\n<blockquote>\n<p>server.1=10.10.16.151:2888:3888<br>server.2=10.10.16.234:2888:3888</p>\n</blockquote>\n<p>然后为这两个个节点创建对应的编号文件，在/tmp/zookeeper/data/myid文件中。如下：<a id=\"more\"></a></p>\n<p>在server.1=10.10.16.151机器上执行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">echo</span> 1 &gt; /tmp/zookeeper/data/myid</div></pre></td></tr></table></figure>\n<p>在server.1=10.10.16.234机器上执行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">echo</span> 2 &gt; /tmp/zookeeper/data/myid</div></pre></td></tr></table></figure>\n<p>启动server.1测试dubbo服务，使用<code>zkServer.sh start</code>启动了server.1，然后使用<code>zkServer.sh status</code>查看工作状态，显示<br><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Error contacting service. It is probably not running.</div></pre></td></tr></table></figure></p>\n<p>通过<code>zkCli.sh -server 10.10.16.151:2181</code>查看服务详细，发现服务提示了下面的错误信息。</p>\n<p>启动时提示：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">2017-09-15 14:57:27,139 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1035] - Opening socket connection to server 10.10.16.151/10.10.16.151:2181. Will not attempt to authenticate using SASL (java.lang.SecurityException: Ϟ·¨¶¨λµȂ¼Ƥ׃)</div><div class=\"line\">2017-09-15 14:57:27,140 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@877] - Socket connection established to 10.10.16.151/10.10.16.151:2181, initiating session</div><div class=\"line\">2017-09-15 14:57:27,143 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1161] - Unable to <span class=\"built_in\">read</span> additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect</div></pre></td></tr></table></figure>\n<p>后来才搞明白，由于我在zoo.cfg中配置了2台机器，但是只启动了1台，zookeeper就会认为服务处于不可用状态。</p>\n<p><strong>通过zookeeper的选举算法得知，当整个集群超过半数机器宕机，zookeeper会认为集群处于不可用状态。</strong>所以启动2台服务正常。</p>\n<p>然后我又增加了1台<code>server.3=10.10.16.241:2888:3888</code>机器节点，在3台都启动的情况下，关掉其中1台，服务正常，关掉2台，服务不可用。</p>\n<p>所以，zookeeper集群只启动一台无法连接，如果启动机器数为半数及以上就可以连接了。</p>\n","site":{"data":{}},"excerpt":"<p>配置zookeeper集群，一开始配置了两台机器server.1和server.2。</p>\n<p>配置参数，在zoo.cfg中指定了整个zookeeper集群的server编号、地址和端口：</p>\n<blockquote>\n<p>server.1=10.10.16.151:2888:3888<br>server.2=10.10.16.234:2888:3888</p>\n</blockquote>\n<p>然后为这两个个节点创建对应的编号文件，在/tmp/zookeeper/data/myid文件中。如下：","more":"</p>\n<p>在server.1=10.10.16.151机器上执行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">echo</span> 1 &gt; /tmp/zookeeper/data/myid</div></pre></td></tr></table></figure>\n<p>在server.1=10.10.16.234机器上执行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">echo</span> 2 &gt; /tmp/zookeeper/data/myid</div></pre></td></tr></table></figure>\n<p>启动server.1测试dubbo服务，使用<code>zkServer.sh start</code>启动了server.1，然后使用<code>zkServer.sh status</code>查看工作状态，显示<br><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Error contacting service. It is probably not running.</div></pre></td></tr></table></figure></p>\n<p>通过<code>zkCli.sh -server 10.10.16.151:2181</code>查看服务详细，发现服务提示了下面的错误信息。</p>\n<p>启动时提示：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">2017-09-15 14:57:27,139 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1035] - Opening socket connection to server 10.10.16.151/10.10.16.151:2181. Will not attempt to authenticate using SASL (java.lang.SecurityException: Ϟ·¨¶¨λµȂ¼Ƥ׃)</div><div class=\"line\">2017-09-15 14:57:27,140 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@877] - Socket connection established to 10.10.16.151/10.10.16.151:2181, initiating session</div><div class=\"line\">2017-09-15 14:57:27,143 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1161] - Unable to <span class=\"built_in\">read</span> additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect</div></pre></td></tr></table></figure>\n<p>后来才搞明白，由于我在zoo.cfg中配置了2台机器，但是只启动了1台，zookeeper就会认为服务处于不可用状态。</p>\n<p><strong>通过zookeeper的选举算法得知，当整个集群超过半数机器宕机，zookeeper会认为集群处于不可用状态。</strong>所以启动2台服务正常。</p>\n<p>然后我又增加了1台<code>server.3=10.10.16.241:2888:3888</code>机器节点，在3台都启动的情况下，关掉其中1台，服务正常，关掉2台，服务不可用。</p>\n<p>所以，zookeeper集群只启动一台无法连接，如果启动机器数为半数及以上就可以连接了。</p>"},{"title":"关于=null和clear()问题（Java性能优化）","date":"2016-04-18T16:00:00.000Z","thumbnail":"http://pic1.win4000.com/wallpaper/a/54535d25dfe79.jpg","_content":"\n　　以ArrayList为例，根据情况来看吧，**ArrayList内部维护的是一个数组**。<!--more-->\n## **1. list = null**\n>那么你**list = null; ** 就是**释放这个数组对象，当然里面所引用的对象也就释放了**。\n\n\n## **2. list.clear()**\n\n>如果**list.clear();** 看看源代码就知道了，是**把list里面对象遍历赋值为null**，意思就是**释放list里面所有对象**。\n\n　　这样就很清楚了，如果你这个list还需要使用，那么你可以使用clear去释放掉list里面所有的数据，GC在回收的时候就有可能回收掉原list里面的这些数据了。如果你都不需要了，那么你就用=null这样GC就有可能把list以及里面关联的一些数据也都回收了。\n\n## **3. 咱们来看下clear()源码**\n\n`clear()`源码解析：\nIf we take an `ArrayList` as an example, the `clear()` method does this:\n```Java\npublic void clear() { \n    modCount++;  \n    \n    // Let gc do its work \n    for (int i = 0; i < size; i++)  \n        elementData[i] = null;  \n        \n    size = 0;  \n}\n```\n　　Basically, if elements of a List are not referenced anywhere else in the code there is really no need (or at least you do not gain anything) to call `clear()`. You also do not need to assign `null` to the List because it will be garbage collected as soon as it falls out of scope. \n**译文：** \n　　基本上，如果List中的元素没有被引用到代码中的其他地方，那么确实没有必要（或至少你没有获得任何东西）来调用`clear()`。 您也不需要为List指定`null`，因为它会在超出范围的情况下被垃圾回收。","source":"_posts/关于=null和clear()问题(Java性能篇).md","raw":"---\ntitle: 关于=null和clear()问题（Java性能优化）\ndate: 2016-04-19\ncategories: \n  - Java\ntags: \n  - Java\n  - 性能优化\nthumbnail: http://pic1.win4000.com/wallpaper/a/54535d25dfe79.jpg\n---\n\n　　以ArrayList为例，根据情况来看吧，**ArrayList内部维护的是一个数组**。<!--more-->\n## **1. list = null**\n>那么你**list = null; ** 就是**释放这个数组对象，当然里面所引用的对象也就释放了**。\n\n\n## **2. list.clear()**\n\n>如果**list.clear();** 看看源代码就知道了，是**把list里面对象遍历赋值为null**，意思就是**释放list里面所有对象**。\n\n　　这样就很清楚了，如果你这个list还需要使用，那么你可以使用clear去释放掉list里面所有的数据，GC在回收的时候就有可能回收掉原list里面的这些数据了。如果你都不需要了，那么你就用=null这样GC就有可能把list以及里面关联的一些数据也都回收了。\n\n## **3. 咱们来看下clear()源码**\n\n`clear()`源码解析：\nIf we take an `ArrayList` as an example, the `clear()` method does this:\n```Java\npublic void clear() { \n    modCount++;  \n    \n    // Let gc do its work \n    for (int i = 0; i < size; i++)  \n        elementData[i] = null;  \n        \n    size = 0;  \n}\n```\n　　Basically, if elements of a List are not referenced anywhere else in the code there is really no need (or at least you do not gain anything) to call `clear()`. You also do not need to assign `null` to the List because it will be garbage collected as soon as it falls out of scope. \n**译文：** \n　　基本上，如果List中的元素没有被引用到代码中的其他地方，那么确实没有必要（或至少你没有获得任何东西）来调用`clear()`。 您也不需要为List指定`null`，因为它会在超出范围的情况下被垃圾回收。","slug":"关于=null和clear()问题(Java性能篇)","published":1,"updated":"2017-08-01T14:01:44.714Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkhy000zdohgwgwq4r4f","content":"<p>　　以ArrayList为例，根据情况来看吧，<strong>ArrayList内部维护的是一个数组</strong>。<a id=\"more\"></a></p>\n<h2 id=\"1-list-null\"><a href=\"#1-list-null\" class=\"headerlink\" title=\"1. list = null\"></a><strong>1. list = null</strong></h2><blockquote>\n<p>那么你<strong>list = null; </strong> 就是<strong>释放这个数组对象，当然里面所引用的对象也就释放了</strong>。</p>\n</blockquote>\n<h2 id=\"2-list-clear\"><a href=\"#2-list-clear\" class=\"headerlink\" title=\"2. list.clear()\"></a><strong>2. list.clear()</strong></h2><blockquote>\n<p>如果<strong>list.clear();</strong> 看看源代码就知道了，是<strong>把list里面对象遍历赋值为null</strong>，意思就是<strong>释放list里面所有对象</strong>。</p>\n</blockquote>\n<p>　　这样就很清楚了，如果你这个list还需要使用，那么你可以使用clear去释放掉list里面所有的数据，GC在回收的时候就有可能回收掉原list里面的这些数据了。如果你都不需要了，那么你就用=null这样GC就有可能把list以及里面关联的一些数据也都回收了。</p>\n<h2 id=\"3-咱们来看下clear-源码\"><a href=\"#3-咱们来看下clear-源码\" class=\"headerlink\" title=\"3. 咱们来看下clear()源码\"></a><strong>3. 咱们来看下clear()源码</strong></h2><p><code>clear()</code>源码解析：<br>If we take an <code>ArrayList</code> as an example, the <code>clear()</code> method does this:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span> </span>&#123; </div><div class=\"line\">    modCount++;  </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">// Let gc do its work </span></div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++)  </div><div class=\"line\">        elementData[i] = <span class=\"keyword\">null</span>;  </div><div class=\"line\">        </div><div class=\"line\">    size = <span class=\"number\">0</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　Basically, if elements of a List are not referenced anywhere else in the code there is really no need (or at least you do not gain anything) to call <code>clear()</code>. You also do not need to assign <code>null</code> to the List because it will be garbage collected as soon as it falls out of scope.<br><strong>译文：</strong><br>　　基本上，如果List中的元素没有被引用到代码中的其他地方，那么确实没有必要（或至少你没有获得任何东西）来调用<code>clear()</code>。 您也不需要为List指定<code>null</code>，因为它会在超出范围的情况下被垃圾回收。</p>\n","site":{"data":{}},"excerpt":"<p>　　以ArrayList为例，根据情况来看吧，<strong>ArrayList内部维护的是一个数组</strong>。","more":"</p>\n<h2 id=\"1-list-null\"><a href=\"#1-list-null\" class=\"headerlink\" title=\"1. list = null\"></a><strong>1. list = null</strong></h2><blockquote>\n<p>那么你<strong>list = null; </strong> 就是<strong>释放这个数组对象，当然里面所引用的对象也就释放了</strong>。</p>\n</blockquote>\n<h2 id=\"2-list-clear\"><a href=\"#2-list-clear\" class=\"headerlink\" title=\"2. list.clear()\"></a><strong>2. list.clear()</strong></h2><blockquote>\n<p>如果<strong>list.clear();</strong> 看看源代码就知道了，是<strong>把list里面对象遍历赋值为null</strong>，意思就是<strong>释放list里面所有对象</strong>。</p>\n</blockquote>\n<p>　　这样就很清楚了，如果你这个list还需要使用，那么你可以使用clear去释放掉list里面所有的数据，GC在回收的时候就有可能回收掉原list里面的这些数据了。如果你都不需要了，那么你就用=null这样GC就有可能把list以及里面关联的一些数据也都回收了。</p>\n<h2 id=\"3-咱们来看下clear-源码\"><a href=\"#3-咱们来看下clear-源码\" class=\"headerlink\" title=\"3. 咱们来看下clear()源码\"></a><strong>3. 咱们来看下clear()源码</strong></h2><p><code>clear()</code>源码解析：<br>If we take an <code>ArrayList</code> as an example, the <code>clear()</code> method does this:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span> </span>&#123; </div><div class=\"line\">    modCount++;  </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">// Let gc do its work </span></div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++)  </div><div class=\"line\">        elementData[i] = <span class=\"keyword\">null</span>;  </div><div class=\"line\">        </div><div class=\"line\">    size = <span class=\"number\">0</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>　　Basically, if elements of a List are not referenced anywhere else in the code there is really no need (or at least you do not gain anything) to call <code>clear()</code>. You also do not need to assign <code>null</code> to the List because it will be garbage collected as soon as it falls out of scope.<br><strong>译文：</strong><br>　　基本上，如果List中的元素没有被引用到代码中的其他地方，那么确实没有必要（或至少你没有获得任何东西）来调用<code>clear()</code>。 您也不需要为List指定<code>null</code>，因为它会在超出范围的情况下被垃圾回收。</p>"},{"title":"前后端分离，前端跨域访问后台的两种方式","date":"2017-02-27T16:00:00.000Z","thumbnail":"http://pic1.win4000.com/wallpaper/5/53d8924f003a2.jpg","_content":"\n> ​       在我们做web项目项目时，前端和后端都是不同的开发人员负责，到某个时间点必然要进行前后端数据交互，这时候就会遇到跨域问题。这里介绍两种解决方式。\n\n<!--more-->\n\n## **方式1：如果开发是tomcat服务器，在工程的web.xml添加设置**\n\n​        第一种方式是通过`CORS (Cross-Origin Resource Sharing)`跨域资源共享的方式实现。\n\n​        在web.xml文件中设置CORS内容，如果后台开发人用的是tomcat服务器的话，则在web工程的web.xml文件中添加一下内容即可：\n\n```xml\n<!--解决tomcat部署跨域问题 -->\n<filter>\n\t<filter-name>CORS</filter-name>\n\t<filter-class>com.thetransactioncompany.cors.CORSFilter</filter-class>\n\t<init-param>\n\t\t<param-name>cors.allowOrigin</param-name>\n\t\t<param-value>*</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportedMethods</param-name>\n\t\t<param-value>GET, POST, HEAD, PUT, DELETE</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportedHeaders</param-name>\n\t\t<param-value>Accept, Origin, X-Requested-With, Content-Type, Last-Modified</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.exposedHeaders</param-name>\n\t\t<param-value>Set-Cookie</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportsCredentials</param-name>\n\t\t<param-value>true</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>CORS</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n```\n\n这是通过`CORS (Cross-Origin Resource Sharing)`跨域资源共享的方式实现。这种方式对chrome浏览器调试有点问题，firefox及IE调试正常。\n\n\n\n## **方式2：通过ajax和过滤器实现跨域**\n\n​        第二种方式是通过往请求消息头中加`Access-Control-Allow-Origin`。\n\n​        `Access-Control-Allow-Origin`是`HTML5 `添加的新功能，设置这个属性值为你前端所在服务器的ip地址。\n\n首先后台添加过滤器`AccessFilter.java`：\n\n```java\nimport java.io.IOException;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.FilterConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletResponse;\nimport org.springframework.beans.factory.annotation.Value;\n\n/**   \n * @Title: AccessFilter.java \n * @Description: TODO(设置其他IP地址的机器可以直接访问本项目Url--工具filter) \n */\npublic class AccessFilter extends HttpServlet implements Filter{\n    \n    /**\n     * 序列ID，用来监测控制版本更新的\n     */\n    private static final long serialVersionUID = 1L;\n    \n    @Value(\"${test.mavenspring.project.allow.url}\")\n    private String projectDemoAllowOriginUrl;\n\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {               \n    }\n\n    //设置其他IP地址的机器可以直接访问到这个项目的后端\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response,\n            FilterChain chain) throws IOException, ServletException {\n        \n        HttpServletResponse httpResponse = (HttpServletResponse) response;\n        httpResponse.setHeader(\"Access-Control-Allow-Origin\", projectDemoAllowOriginUrl);\n        httpResponse.setHeader(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\");\n        httpResponse.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n        chain.doFilter(request, httpResponse);     \n    }\n}\n```\n\n\n\n然后在前端js的ajax部分按照下面的方式设置：\n\n```javascript\n$.ajaxSettings.xhrFields = {\n    withCredentials : true\n};\n$.ajax({\n    crossDomain : true,\n    type : 'post',\n    url : 'http://...',\n    dataType : 'json',\n    data : '...',\n    //其他处理不变\n});\n```\n\n\n\n默认情况下`widthCredentials`为`false`，我们需要设置`widthCredentials`为`true`。\n\n有一点需要注意，设置了`widthCredentials`为`true`的请求中会包含远程域的所有`cookie`，但这些`cookie`仍然遵循同源策略，所以你是访问不了这些`cookie`的。\n以上是我在实际项目中用到的两种方式，第一种方式用chrome调试会有点问题，第二种方式兼容性较好，主流浏览器调试正常。\n\n> **不过一定要记得，这个仅仅作为前后端交互调试之用，**\n>\n> **开发完成后记得删除这些跨域部分，**\n>\n> **避免项目上线之后出现安全问题。切记！**","source":"_posts/前后端分离，前端跨域访问后台的两种方式.md","raw":"---\ntitle: 前后端分离，前端跨域访问后台的两种方式\ndate: 2017-2-28\ncategories: \n  - Web\ntags: \n  - Web\n  - Java\n  - 跨域\nthumbnail: http://pic1.win4000.com/wallpaper/5/53d8924f003a2.jpg\n---\n\n> ​       在我们做web项目项目时，前端和后端都是不同的开发人员负责，到某个时间点必然要进行前后端数据交互，这时候就会遇到跨域问题。这里介绍两种解决方式。\n\n<!--more-->\n\n## **方式1：如果开发是tomcat服务器，在工程的web.xml添加设置**\n\n​        第一种方式是通过`CORS (Cross-Origin Resource Sharing)`跨域资源共享的方式实现。\n\n​        在web.xml文件中设置CORS内容，如果后台开发人用的是tomcat服务器的话，则在web工程的web.xml文件中添加一下内容即可：\n\n```xml\n<!--解决tomcat部署跨域问题 -->\n<filter>\n\t<filter-name>CORS</filter-name>\n\t<filter-class>com.thetransactioncompany.cors.CORSFilter</filter-class>\n\t<init-param>\n\t\t<param-name>cors.allowOrigin</param-name>\n\t\t<param-value>*</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportedMethods</param-name>\n\t\t<param-value>GET, POST, HEAD, PUT, DELETE</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportedHeaders</param-name>\n\t\t<param-value>Accept, Origin, X-Requested-With, Content-Type, Last-Modified</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.exposedHeaders</param-name>\n\t\t<param-value>Set-Cookie</param-value>\n\t</init-param>\n\t<init-param>\n\t\t<param-name>cors.supportsCredentials</param-name>\n\t\t<param-value>true</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>CORS</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n```\n\n这是通过`CORS (Cross-Origin Resource Sharing)`跨域资源共享的方式实现。这种方式对chrome浏览器调试有点问题，firefox及IE调试正常。\n\n\n\n## **方式2：通过ajax和过滤器实现跨域**\n\n​        第二种方式是通过往请求消息头中加`Access-Control-Allow-Origin`。\n\n​        `Access-Control-Allow-Origin`是`HTML5 `添加的新功能，设置这个属性值为你前端所在服务器的ip地址。\n\n首先后台添加过滤器`AccessFilter.java`：\n\n```java\nimport java.io.IOException;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.FilterConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletResponse;\nimport org.springframework.beans.factory.annotation.Value;\n\n/**   \n * @Title: AccessFilter.java \n * @Description: TODO(设置其他IP地址的机器可以直接访问本项目Url--工具filter) \n */\npublic class AccessFilter extends HttpServlet implements Filter{\n    \n    /**\n     * 序列ID，用来监测控制版本更新的\n     */\n    private static final long serialVersionUID = 1L;\n    \n    @Value(\"${test.mavenspring.project.allow.url}\")\n    private String projectDemoAllowOriginUrl;\n\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {               \n    }\n\n    //设置其他IP地址的机器可以直接访问到这个项目的后端\n    @Override\n    public void doFilter(ServletRequest request, ServletResponse response,\n            FilterChain chain) throws IOException, ServletException {\n        \n        HttpServletResponse httpResponse = (HttpServletResponse) response;\n        httpResponse.setHeader(\"Access-Control-Allow-Origin\", projectDemoAllowOriginUrl);\n        httpResponse.setHeader(\"Access-Control-Allow-Headers\",\"Origin, X-Requested-With, Content-Type, Accept\");\n        httpResponse.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n        chain.doFilter(request, httpResponse);     \n    }\n}\n```\n\n\n\n然后在前端js的ajax部分按照下面的方式设置：\n\n```javascript\n$.ajaxSettings.xhrFields = {\n    withCredentials : true\n};\n$.ajax({\n    crossDomain : true,\n    type : 'post',\n    url : 'http://...',\n    dataType : 'json',\n    data : '...',\n    //其他处理不变\n});\n```\n\n\n\n默认情况下`widthCredentials`为`false`，我们需要设置`widthCredentials`为`true`。\n\n有一点需要注意，设置了`widthCredentials`为`true`的请求中会包含远程域的所有`cookie`，但这些`cookie`仍然遵循同源策略，所以你是访问不了这些`cookie`的。\n以上是我在实际项目中用到的两种方式，第一种方式用chrome调试会有点问题，第二种方式兼容性较好，主流浏览器调试正常。\n\n> **不过一定要记得，这个仅仅作为前后端交互调试之用，**\n>\n> **开发完成后记得删除这些跨域部分，**\n>\n> **避免项目上线之后出现安全问题。切记！**","slug":"前后端分离，前端跨域访问后台的两种方式","published":1,"updated":"2017-07-13T14:33:10.247Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkig0011dohgcrtuegcr","content":"<blockquote>\n<p>​       在我们做web项目项目时，前端和后端都是不同的开发人员负责，到某个时间点必然要进行前后端数据交互，这时候就会遇到跨域问题。这里介绍两种解决方式。</p>\n</blockquote>\n<a id=\"more\"></a>\n<h2 id=\"方式1：如果开发是tomcat服务器，在工程的web-xml添加设置\"><a href=\"#方式1：如果开发是tomcat服务器，在工程的web-xml添加设置\" class=\"headerlink\" title=\"方式1：如果开发是tomcat服务器，在工程的web.xml添加设置\"></a><strong>方式1：如果开发是tomcat服务器，在工程的web.xml添加设置</strong></h2><p>​        第一种方式是通过<code>CORS (Cross-Origin Resource Sharing)</code>跨域资源共享的方式实现。</p>\n<p>​        在web.xml文件中设置CORS内容，如果后台开发人用的是tomcat服务器的话，则在web工程的web.xml文件中添加一下内容即可：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--解决tomcat部署跨域问题 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>CORS<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>com.thetransactioncompany.cors.CORSFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.allowOrigin<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportedMethods<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>GET, POST, HEAD, PUT, DELETE<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportedHeaders<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>Accept, Origin, X-Requested-With, Content-Type, Last-Modified<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.exposedHeaders<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>Set-Cookie<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportsCredentials<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>CORS<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>这是通过<code>CORS (Cross-Origin Resource Sharing)</code>跨域资源共享的方式实现。这种方式对chrome浏览器调试有点问题，firefox及IE调试正常。</p>\n<h2 id=\"方式2：通过ajax和过滤器实现跨域\"><a href=\"#方式2：通过ajax和过滤器实现跨域\" class=\"headerlink\" title=\"方式2：通过ajax和过滤器实现跨域\"></a><strong>方式2：通过ajax和过滤器实现跨域</strong></h2><p>​        第二种方式是通过往请求消息头中加<code>Access-Control-Allow-Origin</code>。</p>\n<p>​        <code>Access-Control-Allow-Origin</code>是<code>HTML5</code>添加的新功能，设置这个属性值为你前端所在服务器的ip地址。</p>\n<p>首先后台添加过滤器<code>AccessFilter.java</code>：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.Filter;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.FilterChain;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.FilterConfig;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**   </span></div><div class=\"line\"> * <span class=\"doctag\">@Title</span>: AccessFilter.java </div><div class=\"line\"> * <span class=\"doctag\">@Description</span>: TODO(设置其他IP地址的机器可以直接访问本项目Url--工具filter) </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccessFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> <span class=\"keyword\">implements</span> <span class=\"title\">Filter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 序列ID，用来监测控制版本更新的</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;test.mavenspring.project.allow.url&#125;\"</span>)</div><div class=\"line\">    <span class=\"keyword\">private</span> String projectDemoAllowOriginUrl;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">(FilterConfig filterConfig)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;               </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//设置其他IP地址的机器可以直接访问到这个项目的后端</span></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest request, ServletResponse response,</span></span></div><div class=\"line\">            FilterChain chain) <span class=\"keyword\">throws</span> IOException, ServletException &#123;</div><div class=\"line\">        </div><div class=\"line\">        HttpServletResponse httpResponse = (HttpServletResponse) response;</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, projectDemoAllowOriginUrl);</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>,<span class=\"string\">\"Origin, X-Requested-With, Content-Type, Accept\"</span>);</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Credentials\"</span>, <span class=\"string\">\"true\"</span>);</div><div class=\"line\">        chain.doFilter(request, httpResponse);     </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>然后在前端js的ajax部分按照下面的方式设置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">$.ajaxSettings.xhrFields = &#123;</div><div class=\"line\">    <span class=\"attr\">withCredentials</span> : <span class=\"literal\">true</span></div><div class=\"line\">&#125;;</div><div class=\"line\">$.ajax(&#123;</div><div class=\"line\">    <span class=\"attr\">crossDomain</span> : <span class=\"literal\">true</span>,</div><div class=\"line\">    <span class=\"attr\">type</span> : <span class=\"string\">'post'</span>,</div><div class=\"line\">    <span class=\"attr\">url</span> : <span class=\"string\">'http://...'</span>,</div><div class=\"line\">    <span class=\"attr\">dataType</span> : <span class=\"string\">'json'</span>,</div><div class=\"line\">    <span class=\"attr\">data</span> : <span class=\"string\">'...'</span>,</div><div class=\"line\">    <span class=\"comment\">//其他处理不变</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p>默认情况下<code>widthCredentials</code>为<code>false</code>，我们需要设置<code>widthCredentials</code>为<code>true</code>。</p>\n<p>有一点需要注意，设置了<code>widthCredentials</code>为<code>true</code>的请求中会包含远程域的所有<code>cookie</code>，但这些<code>cookie</code>仍然遵循同源策略，所以你是访问不了这些<code>cookie</code>的。<br>以上是我在实际项目中用到的两种方式，第一种方式用chrome调试会有点问题，第二种方式兼容性较好，主流浏览器调试正常。</p>\n<blockquote>\n<p><strong>不过一定要记得，这个仅仅作为前后端交互调试之用，</strong></p>\n<p><strong>开发完成后记得删除这些跨域部分，</strong></p>\n<p><strong>避免项目上线之后出现安全问题。切记！</strong></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>​       在我们做web项目项目时，前端和后端都是不同的开发人员负责，到某个时间点必然要进行前后端数据交互，这时候就会遇到跨域问题。这里介绍两种解决方式。</p>\n</blockquote>","more":"<h2 id=\"方式1：如果开发是tomcat服务器，在工程的web-xml添加设置\"><a href=\"#方式1：如果开发是tomcat服务器，在工程的web-xml添加设置\" class=\"headerlink\" title=\"方式1：如果开发是tomcat服务器，在工程的web.xml添加设置\"></a><strong>方式1：如果开发是tomcat服务器，在工程的web.xml添加设置</strong></h2><p>​        第一种方式是通过<code>CORS (Cross-Origin Resource Sharing)</code>跨域资源共享的方式实现。</p>\n<p>​        在web.xml文件中设置CORS内容，如果后台开发人用的是tomcat服务器的话，则在web工程的web.xml文件中添加一下内容即可：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--解决tomcat部署跨域问题 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>CORS<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>com.thetransactioncompany.cors.CORSFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.allowOrigin<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportedMethods<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>GET, POST, HEAD, PUT, DELETE<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportedHeaders<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>Accept, Origin, X-Requested-With, Content-Type, Last-Modified<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.exposedHeaders<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>Set-Cookie<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>cors.supportsCredentials<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>CORS<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>这是通过<code>CORS (Cross-Origin Resource Sharing)</code>跨域资源共享的方式实现。这种方式对chrome浏览器调试有点问题，firefox及IE调试正常。</p>\n<h2 id=\"方式2：通过ajax和过滤器实现跨域\"><a href=\"#方式2：通过ajax和过滤器实现跨域\" class=\"headerlink\" title=\"方式2：通过ajax和过滤器实现跨域\"></a><strong>方式2：通过ajax和过滤器实现跨域</strong></h2><p>​        第二种方式是通过往请求消息头中加<code>Access-Control-Allow-Origin</code>。</p>\n<p>​        <code>Access-Control-Allow-Origin</code>是<code>HTML5</code>添加的新功能，设置这个属性值为你前端所在服务器的ip地址。</p>\n<p>首先后台添加过滤器<code>AccessFilter.java</code>：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.Filter;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.FilterChain;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.FilterConfig;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletRequest;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</div><div class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</div><div class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**   </span></div><div class=\"line\"> * <span class=\"doctag\">@Title</span>: AccessFilter.java </div><div class=\"line\"> * <span class=\"doctag\">@Description</span>: TODO(设置其他IP地址的机器可以直接访问本项目Url--工具filter) </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AccessFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> <span class=\"keyword\">implements</span> <span class=\"title\">Filter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 序列ID，用来监测控制版本更新的</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;test.mavenspring.project.allow.url&#125;\"</span>)</div><div class=\"line\">    <span class=\"keyword\">private</span> String projectDemoAllowOriginUrl;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">(FilterConfig filterConfig)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;               </div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">//设置其他IP地址的机器可以直接访问到这个项目的后端</span></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilter</span><span class=\"params\">(ServletRequest request, ServletResponse response,</span></span></div><div class=\"line\">            FilterChain chain) <span class=\"keyword\">throws</span> IOException, ServletException &#123;</div><div class=\"line\">        </div><div class=\"line\">        HttpServletResponse httpResponse = (HttpServletResponse) response;</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, projectDemoAllowOriginUrl);</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>,<span class=\"string\">\"Origin, X-Requested-With, Content-Type, Accept\"</span>);</div><div class=\"line\">        httpResponse.setHeader(<span class=\"string\">\"Access-Control-Allow-Credentials\"</span>, <span class=\"string\">\"true\"</span>);</div><div class=\"line\">        chain.doFilter(request, httpResponse);     </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>然后在前端js的ajax部分按照下面的方式设置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">$.ajaxSettings.xhrFields = &#123;</div><div class=\"line\">    <span class=\"attr\">withCredentials</span> : <span class=\"literal\">true</span></div><div class=\"line\">&#125;;</div><div class=\"line\">$.ajax(&#123;</div><div class=\"line\">    <span class=\"attr\">crossDomain</span> : <span class=\"literal\">true</span>,</div><div class=\"line\">    <span class=\"attr\">type</span> : <span class=\"string\">'post'</span>,</div><div class=\"line\">    <span class=\"attr\">url</span> : <span class=\"string\">'http://...'</span>,</div><div class=\"line\">    <span class=\"attr\">dataType</span> : <span class=\"string\">'json'</span>,</div><div class=\"line\">    <span class=\"attr\">data</span> : <span class=\"string\">'...'</span>,</div><div class=\"line\">    <span class=\"comment\">//其他处理不变</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p>默认情况下<code>widthCredentials</code>为<code>false</code>，我们需要设置<code>widthCredentials</code>为<code>true</code>。</p>\n<p>有一点需要注意，设置了<code>widthCredentials</code>为<code>true</code>的请求中会包含远程域的所有<code>cookie</code>，但这些<code>cookie</code>仍然遵循同源策略，所以你是访问不了这些<code>cookie</code>的。<br>以上是我在实际项目中用到的两种方式，第一种方式用chrome调试会有点问题，第二种方式兼容性较好，主流浏览器调试正常。</p>\n<blockquote>\n<p><strong>不过一定要记得，这个仅仅作为前后端交互调试之用，</strong></p>\n<p><strong>开发完成后记得删除这些跨域部分，</strong></p>\n<p><strong>避免项目上线之后出现安全问题。切记！</strong></p>\n</blockquote>"},{"title":"恒大 VS 上港","date":"2017-09-11T16:00:00.000Z","thumbnail":"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg","_content":"\n⚽很少看中超，三线伪球迷，偶得一张恒大对战上港的票，亚冠联赛1/4决赛“中国德比”第二回合，非常值得一看。于是和峰哥守情瞪着小二轮儿就往天河体育中心赶。\n\n<!--more-->\n\n​        首回合上港主场在上海，所以这一回合是恒大广州主场，第一回合上港4-0恒大，所以这一回恒大势必会攻势强劲。这回要5-0上港才能赢得这次比赛。\n\n场外买了件阿兰的7号球衣。\n\n![7th](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/7th.jpg)\n\n比赛开始了。\n\n![start](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg)\n\n头一回靠球迷协会这么近，整场球迷协会都在起势助威，感受到了他们真的很爱恒大，热爱足球。\n\n我等十八线球迷也就是在进球时亢奋十秒，丢！\n\n![fans](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/fans.jpg)\n\n整场下来，上港队队员受伤换下的球员不下4个，一个是部分球员状态不太好，二是恒大队员处于压力踢的太激进。\n\n第90分钟，李学鹏头球破门，广州恒大4-0上海上港！\n\n球迷们又是一阵亢奋！我也特激动，感觉主场来个5-0就赢了，看来胜利不远了，那个激动啊，真切感受到了足球的魅力。\n\n可是，最怕这个可是了。\n\n第109分钟，上港队胡尔克主罚的爆射直钻网窝死角，广州恒大4-1上海上港！恒大压力很大，穆里奇被上港队员拉倒，被罚点球，高拉特主罚命中，5-1打平了，悬的心又放下了。\n\n常规赛结束，比赛进入加时，5-1，阿兰进俩球，高拉特进3球。压力已经在恒大队这边了，加时赛5:1，总比分恒大5-5战平上港，未分胜负，所以呢，就到了精彩的点球大战。又是加时，又是点球，双方都紧咬比分。\n\n![penaltykick](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/penaltykick.jpg)\n\n不幸的是，点球上港队5罚5中，恒大队5罚4中，全场比赛结束，总比分上海上港10-9淘汰广州恒大。\n\n一波三折，常规赛以为要输了，然后又赢了，加时加上点球，以为要赢了，结果还是输了。恒大球员的拼劲有目共睹，整场球真的很精彩，现场看球，不管是球员还是球迷带给人的都是特别感动激昂的感受，尽管广州很热，现场的热情完全掩盖了球场内的热浪。\n\n最后回谢球迷。\n\n![thank](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/thank.jpg)\n\n恒大队，虽败犹荣！","source":"_posts/恒大主上港客.md","raw":"---\ntitle: 恒大 VS 上港\ndate: 2017-9-12\ncategories: \n  - 随记\ntags: \n  - 随记\nthumbnail: https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg\n---\n\n⚽很少看中超，三线伪球迷，偶得一张恒大对战上港的票，亚冠联赛1/4决赛“中国德比”第二回合，非常值得一看。于是和峰哥守情瞪着小二轮儿就往天河体育中心赶。\n\n<!--more-->\n\n​        首回合上港主场在上海，所以这一回合是恒大广州主场，第一回合上港4-0恒大，所以这一回恒大势必会攻势强劲。这回要5-0上港才能赢得这次比赛。\n\n场外买了件阿兰的7号球衣。\n\n![7th](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/7th.jpg)\n\n比赛开始了。\n\n![start](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg)\n\n头一回靠球迷协会这么近，整场球迷协会都在起势助威，感受到了他们真的很爱恒大，热爱足球。\n\n我等十八线球迷也就是在进球时亢奋十秒，丢！\n\n![fans](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/fans.jpg)\n\n整场下来，上港队队员受伤换下的球员不下4个，一个是部分球员状态不太好，二是恒大队员处于压力踢的太激进。\n\n第90分钟，李学鹏头球破门，广州恒大4-0上海上港！\n\n球迷们又是一阵亢奋！我也特激动，感觉主场来个5-0就赢了，看来胜利不远了，那个激动啊，真切感受到了足球的魅力。\n\n可是，最怕这个可是了。\n\n第109分钟，上港队胡尔克主罚的爆射直钻网窝死角，广州恒大4-1上海上港！恒大压力很大，穆里奇被上港队员拉倒，被罚点球，高拉特主罚命中，5-1打平了，悬的心又放下了。\n\n常规赛结束，比赛进入加时，5-1，阿兰进俩球，高拉特进3球。压力已经在恒大队这边了，加时赛5:1，总比分恒大5-5战平上港，未分胜负，所以呢，就到了精彩的点球大战。又是加时，又是点球，双方都紧咬比分。\n\n![penaltykick](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/penaltykick.jpg)\n\n不幸的是，点球上港队5罚5中，恒大队5罚4中，全场比赛结束，总比分上海上港10-9淘汰广州恒大。\n\n一波三折，常规赛以为要输了，然后又赢了，加时加上点球，以为要赢了，结果还是输了。恒大球员的拼劲有目共睹，整场球真的很精彩，现场看球，不管是球员还是球迷带给人的都是特别感动激昂的感受，尽管广州很热，现场的热情完全掩盖了球场内的热浪。\n\n最后回谢球迷。\n\n![thank](https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/thank.jpg)\n\n恒大队，虽败犹荣！","slug":"恒大主上港客","published":1,"updated":"2018-06-22T14:03:56.901Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckh98hkit0015dohgjzkz2ik8","content":"<p>⚽很少看中超，三线伪球迷，偶得一张恒大对战上港的票，亚冠联赛1/4决赛“中国德比”第二回合，非常值得一看。于是和峰哥守情瞪着小二轮儿就往天河体育中心赶。</p>\n<a id=\"more\"></a>\n<p>​        首回合上港主场在上海，所以这一回合是恒大广州主场，第一回合上港4-0恒大，所以这一回恒大势必会攻势强劲。这回要5-0上港才能赢得这次比赛。</p>\n<p>场外买了件阿兰的7号球衣。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/7th.jpg\" alt=\"7th\"></p>\n<p>比赛开始了。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg\" alt=\"start\"></p>\n<p>头一回靠球迷协会这么近，整场球迷协会都在起势助威，感受到了他们真的很爱恒大，热爱足球。</p>\n<p>我等十八线球迷也就是在进球时亢奋十秒，丢！</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/fans.jpg\" alt=\"fans\"></p>\n<p>整场下来，上港队队员受伤换下的球员不下4个，一个是部分球员状态不太好，二是恒大队员处于压力踢的太激进。</p>\n<p>第90分钟，李学鹏头球破门，广州恒大4-0上海上港！</p>\n<p>球迷们又是一阵亢奋！我也特激动，感觉主场来个5-0就赢了，看来胜利不远了，那个激动啊，真切感受到了足球的魅力。</p>\n<p>可是，最怕这个可是了。</p>\n<p>第109分钟，上港队胡尔克主罚的爆射直钻网窝死角，广州恒大4-1上海上港！恒大压力很大，穆里奇被上港队员拉倒，被罚点球，高拉特主罚命中，5-1打平了，悬的心又放下了。</p>\n<p>常规赛结束，比赛进入加时，5-1，阿兰进俩球，高拉特进3球。压力已经在恒大队这边了，加时赛5:1，总比分恒大5-5战平上港，未分胜负，所以呢，就到了精彩的点球大战。又是加时，又是点球，双方都紧咬比分。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/penaltykick.jpg\" alt=\"penaltykick\"></p>\n<p>不幸的是，点球上港队5罚5中，恒大队5罚4中，全场比赛结束，总比分上海上港10-9淘汰广州恒大。</p>\n<p>一波三折，常规赛以为要输了，然后又赢了，加时加上点球，以为要赢了，结果还是输了。恒大球员的拼劲有目共睹，整场球真的很精彩，现场看球，不管是球员还是球迷带给人的都是特别感动激昂的感受，尽管广州很热，现场的热情完全掩盖了球场内的热浪。</p>\n<p>最后回谢球迷。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/thank.jpg\" alt=\"thank\"></p>\n<p>恒大队，虽败犹荣！</p>\n","site":{"data":{}},"excerpt":"<p>⚽很少看中超，三线伪球迷，偶得一张恒大对战上港的票，亚冠联赛1/4决赛“中国德比”第二回合，非常值得一看。于是和峰哥守情瞪着小二轮儿就往天河体育中心赶。</p>","more":"<p>​        首回合上港主场在上海，所以这一回合是恒大广州主场，第一回合上港4-0恒大，所以这一回恒大势必会攻势强劲。这回要5-0上港才能赢得这次比赛。</p>\n<p>场外买了件阿兰的7号球衣。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/7th.jpg\" alt=\"7th\"></p>\n<p>比赛开始了。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg\" alt=\"start\"></p>\n<p>头一回靠球迷协会这么近，整场球迷协会都在起势助威，感受到了他们真的很爱恒大，热爱足球。</p>\n<p>我等十八线球迷也就是在进球时亢奋十秒，丢！</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/fans.jpg\" alt=\"fans\"></p>\n<p>整场下来，上港队队员受伤换下的球员不下4个，一个是部分球员状态不太好，二是恒大队员处于压力踢的太激进。</p>\n<p>第90分钟，李学鹏头球破门，广州恒大4-0上海上港！</p>\n<p>球迷们又是一阵亢奋！我也特激动，感觉主场来个5-0就赢了，看来胜利不远了，那个激动啊，真切感受到了足球的魅力。</p>\n<p>可是，最怕这个可是了。</p>\n<p>第109分钟，上港队胡尔克主罚的爆射直钻网窝死角，广州恒大4-1上海上港！恒大压力很大，穆里奇被上港队员拉倒，被罚点球，高拉特主罚命中，5-1打平了，悬的心又放下了。</p>\n<p>常规赛结束，比赛进入加时，5-1，阿兰进俩球，高拉特进3球。压力已经在恒大队这边了，加时赛5:1，总比分恒大5-5战平上港，未分胜负，所以呢，就到了精彩的点球大战。又是加时，又是点球，双方都紧咬比分。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/penaltykick.jpg\" alt=\"penaltykick\"></p>\n<p>不幸的是，点球上港队5罚5中，恒大队5罚4中，全场比赛结束，总比分上海上港10-9淘汰广州恒大。</p>\n<p>一波三折，常规赛以为要输了，然后又赢了，加时加上点球，以为要赢了，结果还是输了。恒大球员的拼劲有目共睹，整场球真的很精彩，现场看球，不管是球员还是球迷带给人的都是特别感动激昂的感受，尽管广州很热，现场的热情完全掩盖了球场内的热浪。</p>\n<p>最后回谢球迷。</p>\n<p><img src=\"https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/thank.jpg\" alt=\"thank\"></p>\n<p>恒大队，虽败犹荣！</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ckh98hkdp0008dohgsi1k203s","category_id":"ckh98hkbn0004dohgda89vuc7","_id":"ckh98hkex000ddohgsaz9o1cv"},{"post_id":"ckh98hk8p0000dohguq94qjrn","category_id":"ckh98hkbn0004dohgda89vuc7","_id":"ckh98hkfd000hdohgixh2oxwj"},{"post_id":"ckh98hkan0002dohgrdufgl6z","category_id":"ckh98hkbn0004dohgda89vuc7","_id":"ckh98hkfs000jdohgxyy0vynx"},{"post_id":"ckh98hkd10006dohgip8k49j2","category_id":"ckh98hkf6000fdohgfy7k957r","_id":"ckh98hkh2000qdohguaee9rxf"},{"post_id":"ckh98hkf2000edohgwzc2ertl","category_id":"ckh98hkho000xdohghv73zt87","_id":"ckh98hkjd0017dohg5smuog0c"},{"post_id":"ckh98hkfh000idohg9wccqasi","category_id":"ckh98hkil0013dohgvttznf6r","_id":"ckh98hkjq001adohg4441bgzs"},{"post_id":"ckh98hkft000kdohgd0snkvbs","category_id":"ckh98hkji0019dohgtrsu28af","_id":"ckh98hkka001fdohgjk5e4wq7"},{"post_id":"ckh98hkg8000ndohgkopkjltk","category_id":"ckh98hkju001cdohgzf0mhuhc","_id":"ckh98hkkq001jdohgw0qeetcu"},{"post_id":"ckh98hkgy000pdohge2vljuqd","category_id":"ckh98hkf6000fdohgfy7k957r","_id":"ckh98hkl9001odohgrrji82er"},{"post_id":"ckh98hkgy000pdohge2vljuqd","category_id":"ckh98hkkv001ldohg5zofuziq","_id":"ckh98hklm001rdohghgsfq45d"},{"post_id":"ckh98hkha000udohg3ghiji06","category_id":"ckh98hkl0001ndohg6ljlw0l4","_id":"ckh98hklq001udohgu710fl7i"},{"post_id":"ckh98hkep000cdohgj01xyqgo","category_id":"ckh98hkf6000fdohgfy7k957r","_id":"ckh98hkly001zdohgaupurjpx"},{"post_id":"ckh98hkep000cdohgj01xyqgo","category_id":"ckh98hkle001qdohgnwpvwreh","_id":"ckh98hkm60022dohgppr9g5f2"},{"post_id":"ckh98hkhk000wdohguvggemh9","category_id":"ckh98hklt001wdohg68bt3ys8","_id":"ckh98hkma0025dohg1fmc1f7p"},{"post_id":"ckh98hkhy000zdohgwgwq4r4f","category_id":"ckh98hkil0013dohgvttznf6r","_id":"ckh98hkmi0029dohgy6qk90oj"},{"post_id":"ckh98hkig0011dohgcrtuegcr","category_id":"ckh98hkmb0026dohg8mghwvbc","_id":"ckh98hkmq002cdohgsc81lk4m"},{"post_id":"ckh98hkit0015dohgjzkz2ik8","category_id":"ckh98hkmk002adohgnvfdslov","_id":"ckh98hkn4002fdohgkuw9nvff"},{"post_id":"ckh98hke60009dohg6vtkg8s8","category_id":"ckh98hkg3000ldohg16pevzpu","_id":"ckh98hkne002hdohgs5ri8na2"},{"post_id":"ckh98hke60009dohg6vtkg8s8","category_id":"ckh98hkke001hdohg36c8c9vt","_id":"ckh98hknj002jdohgm5cy3ysh"},{"post_id":"ckh98hke60009dohg6vtkg8s8","category_id":"ckh98hkmu002ddohg01t6du1g","_id":"ckh98hknl002kdohgo9ra7p0h"}],"PostTag":[{"post_id":"ckh98hk8p0000dohguq94qjrn","tag_id":"ckh98hkcg0005dohgkz7r8iyw","_id":"ckh98hkgf000odohguu7fe7b2"},{"post_id":"ckh98hk8p0000dohguq94qjrn","tag_id":"ckh98hkec000bdohgwwxqv0tr","_id":"ckh98hkh4000rdohgokna2xb7"},{"post_id":"ckh98hk8p0000dohguq94qjrn","tag_id":"ckh98hkfb000gdohg3pnlps1b","_id":"ckh98hkhj000vdohgafuyd02q"},{"post_id":"ckh98hkan0002dohgrdufgl6z","tag_id":"ckh98hkcg0005dohgkz7r8iyw","_id":"ckh98hkie0010dohggosubzu1"},{"post_id":"ckh98hkan0002dohgrdufgl6z","tag_id":"ckh98hkec000bdohgwwxqv0tr","_id":"ckh98hkij0012dohgr3cwal08"},{"post_id":"ckh98hkd10006dohgip8k49j2","tag_id":"ckh98hkhp000ydohgae5og9rf","_id":"ckh98hkj40016dohgeal4y7gf"},{"post_id":"ckh98hkdp0008dohgsi1k203s","tag_id":"ckh98hkcg0005dohgkz7r8iyw","_id":"ckh98hkjz001ddohggo1fw25b"},{"post_id":"ckh98hkdp0008dohgsi1k203s","tag_id":"ckh98hkec000bdohgwwxqv0tr","_id":"ckh98hkk0001edohghgd2upn4"},{"post_id":"ckh98hkdp0008dohgsi1k203s","tag_id":"ckh98hkjf0018dohg79hh4yfp","_id":"ckh98hkkk001idohgpp4svdh7"},{"post_id":"ckh98hke60009dohg6vtkg8s8","tag_id":"ckh98hkjr001bdohgkjxpksmm","_id":"ckh98hkln001sdohgjdsi4pon"},{"post_id":"ckh98hke60009dohg6vtkg8s8","tag_id":"ckh98hkkd001gdohgtrtv42mk","_id":"ckh98hklp001tdohg9nqag21j"},{"post_id":"ckh98hke60009dohg6vtkg8s8","tag_id":"ckh98hkkr001kdohg88g5flw5","_id":"ckh98hklu001xdohg1kmf8suj"},{"post_id":"ckh98hke60009dohg6vtkg8s8","tag_id":"ckh98hkky001mdohg6otf1pfl","_id":"ckh98hklw001ydohgfp7607j9"},{"post_id":"ckh98hkep000cdohgj01xyqgo","tag_id":"ckh98hklb001pdohg6ybrv4ij","_id":"ckh98hkm70023dohgrpncdfk4"},{"post_id":"ckh98hkep000cdohgj01xyqgo","tag_id":"ckh98hkls001vdohga4agnj6a","_id":"ckh98hkm90024dohg5jke4fie"},{"post_id":"ckh98hkf2000edohgwzc2ertl","tag_id":"ckh98hkm00020dohgi2ibss3w","_id":"ckh98hkmg0028dohgot7timh5"},{"post_id":"ckh98hkfh000idohg9wccqasi","tag_id":"ckh98hkmd0027dohg5kwzah9f","_id":"ckh98hknq002mdohgkkzckqj9"},{"post_id":"ckh98hkfh000idohg9wccqasi","tag_id":"ckh98hkmm002bdohgbesfjr6q","_id":"ckh98hknr002ndohgqyclbv7s"},{"post_id":"ckh98hkfh000idohg9wccqasi","tag_id":"ckh98hkn0002edohghln4v53w","_id":"ckh98hknz002pdohgdqqjkcrp"},{"post_id":"ckh98hkfh000idohg9wccqasi","tag_id":"ckh98hkn5002gdohgr3fsh2x4","_id":"ckh98hko1002qdohgb59lrubf"},{"post_id":"ckh98hkfh000idohg9wccqasi","tag_id":"ckh98hkng002idohgwneayoia","_id":"ckh98hko6002sdohgjd8fpl14"},{"post_id":"ckh98hkft000kdohgd0snkvbs","tag_id":"ckh98hknm002ldohgmh88th0s","_id":"ckh98hko7002tdohggh65ocsq"},{"post_id":"ckh98hkg8000ndohgkopkjltk","tag_id":"ckh98hkns002odohgdujvvusa","_id":"ckh98hkoc002vdohg533ihzsr"},{"post_id":"ckh98hkgy000pdohge2vljuqd","tag_id":"ckh98hko3002rdohge2qlh6gw","_id":"ckh98hkoi002xdohgoh40gjq9"},{"post_id":"ckh98hkgy000pdohge2vljuqd","tag_id":"ckh98hkls001vdohga4agnj6a","_id":"ckh98hkok002ydohghfnk6wvw"},{"post_id":"ckh98hkha000udohg3ghiji06","tag_id":"ckh98hkof002wdohgxbxfaasz","_id":"ckh98hkoo0030dohg1l65ggv1"},{"post_id":"ckh98hkhk000wdohguvggemh9","tag_id":"ckh98hkjr001bdohgkjxpksmm","_id":"ckh98hkp00033dohggvnwp4ka"},{"post_id":"ckh98hkhk000wdohguvggemh9","tag_id":"ckh98hkoq0031dohga7zvxlmq","_id":"ckh98hkp30034dohgqism9bi3"},{"post_id":"ckh98hkhy000zdohgwgwq4r4f","tag_id":"ckh98hkox0032dohg1m2n4jpz","_id":"ckh98hkqy0037dohgf0x2r3e0"},{"post_id":"ckh98hkhy000zdohgwgwq4r4f","tag_id":"ckh98hkp40035dohgbx66vi0l","_id":"ckh98hkqz0038dohgan3x5xvc"},{"post_id":"ckh98hkig0011dohgcrtuegcr","tag_id":"ckh98hkpb0036dohgvvh3c896","_id":"ckh98hkrd003cdohgd802w5jk"},{"post_id":"ckh98hkig0011dohgcrtuegcr","tag_id":"ckh98hkox0032dohg1m2n4jpz","_id":"ckh98hkre003ddohgy7qo69w6"},{"post_id":"ckh98hkig0011dohgcrtuegcr","tag_id":"ckh98hkr7003adohg83y2owc7","_id":"ckh98hkrg003edohgdjk328rc"},{"post_id":"ckh98hkit0015dohgjzkz2ik8","tag_id":"ckh98hkrb003bdohg5ynjabui","_id":"ckh98hkrh003fdohgcx5hxl2p"}],"Tag":[{"name":"elasticsearch","_id":"ckh98hkcg0005dohgkz7r8iyw"},{"name":"ik中文分词","_id":"ckh98hkec000bdohgwwxqv0tr"},{"name":"分页查询","_id":"ckh98hkfb000gdohg3pnlps1b"},{"name":"sprintf","_id":"ckh98hkhp000ydohgae5og9rf"},{"name":"alias","_id":"ckh98hkjf0018dohg79hh4yfp"},{"name":"zookeeper","_id":"ckh98hkjr001bdohgkjxpksmm"},{"name":"mysql","_id":"ckh98hkkd001gdohgtrtv42mk"},{"name":"ibatis","_id":"ckh98hkkr001kdohg88g5flw5"},{"name":"resin","_id":"ckh98hkky001mdohg6otf1pfl"},{"name":"socket","_id":"ckh98hklb001pdohg6ybrv4ij"},{"name":"C++","_id":"ckh98hkls001vdohga4agnj6a"},{"name":"tcp","_id":"ckh98hkm00020dohgi2ibss3w"},{"name":"SpingMvc","_id":"ckh98hkmd0027dohg5kwzah9f"},{"name":"MongoDB","_id":"ckh98hkmm002bdohgbesfjr6q"},{"name":"SpringData","_id":"ckh98hkn0002edohghln4v53w"},{"name":"idea","_id":"ckh98hkn5002gdohgr3fsh2x4"},{"name":"maven","_id":"ckh98hkng002idohgwneayoia"},{"name":"crontab","_id":"ckh98hknm002ldohgmh88th0s"},{"name":"elemMatch条件操作符","_id":"ckh98hkns002odohgdujvvusa"},{"name":"mongodb","_id":"ckh98hko3002rdohge2qlh6gw"},{"name":"mybatis","_id":"ckh98hkof002wdohgxbxfaasz"},{"name":"集群","_id":"ckh98hkoq0031dohga7zvxlmq"},{"name":"Java","_id":"ckh98hkox0032dohg1m2n4jpz"},{"name":"性能优化","_id":"ckh98hkp40035dohgbx66vi0l"},{"name":"Web","_id":"ckh98hkpb0036dohgvvh3c896"},{"name":"跨域","_id":"ckh98hkr7003adohg83y2owc7"},{"name":"随记","_id":"ckh98hkrb003bdohg5ynjabui"}]}}